/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={1:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseManager=void 0;const i=r(5499);t.BaseManager=class{renderer;currentIds=new Set;oMap=new Map;allIds=new Set;creationPromises=new Map;prepareId=0;constructor(e){this.renderer=e}getFromId(e){return this.oMap.get(e)}activeCurrent(){for(let e of this.currentIds)this.oMap.has(e)&&this.active(this.oMap.get(e))}deactiveCrrrent(){for(let e of this.currentIds)this.oMap.has(e)&&this.deactive(this.oMap.get(e))}clear(){for(let e of this.oMap.keys())this.deleteFromId(e)}deleteFromId(e){let t=this.oMap.get(e);t&&(t.delete(),this.currentIds.delete(e),this.oMap.delete(e)),this.allIds.delete(e)}getCurrentDatas(){return[...this.currentIds].map((e=>this.oMap.get(e)))}isCurrentId(e){return this.currentIds.has(e)}async setCurrentDatas(e){let t=e.map((e=>e.id)),r=new Set(t);for(let e of this.currentIds)if(!r.has(e)){let t=this.oMap.get(e);t&&this.deactive(t)}this.currentIds=r;let i=e.map((e=>this.ensure(e)));await Promise.all(i)}async ensure(e){let{id:t}=e;if(this.oMap.has(t))return this.oMap.get(t);if(this.creationPromises.has(t))return this.creationPromises.get(t);this.allIds.add(t);let r=this.create(e);this.creationPromises.set(t,r);let i=await r;return this.creationPromises.delete(t),this.allIds.has(t)?this.oMap.set(t,i):i.delete(),i}async prepare(e,t){let r=new Set(e.map((e=>e.id))),a=++this.prepareId,s=[];for(let e of r)this.allIds.add(e);for(let r of e)if(this.allIds.has(r.id)){let e=this.ensure(r);if(t)s.push(e);else if(await(0,i.sleep)(0),await e,this.prepareId!==a)return}s.length>0&&await Promise.all(s);for(let e of[...this.allIds])r.has(e)||this.currentIds.has(e)||this.deleteFromId(e)}}},23:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextureFrame=void 0;const i=r(2298),a=r(4452),s=r(1484);class n{static active=null;static stack=[];static ensureCanDrawTo(){n.active&&n.active.ensureCanDrawTo()}x=0;y=0;width=0;height=0;sw;context;resultBuffers=null;drawToBuffers=null;resultBuffersRequester;drawToBuffersRequester;constructor(e,t,r){this.sw=e,this.width=t,this.height=r,this.context=e.context}setPartialOrigin(e,t){this.x=e,this.y=t}setResultBuffersRequester(e){this.resultBuffersRequester=e}setDrawToBuffersRequester(e){this.drawToBuffersRequester=e}getMappedSampler(){return new s.MappedSampler(this.getSampler(),this.getSamplingMapMatrix())}getSampler(){return this.resultBuffers?this.resultBuffers.sampler:this.sw.textureFrameManager.getEmptySampler()}getSamplingMapMatrix(){let e=[new a.Vector3(this.x,this.y,1),new a.Vector3(this.x+this.width,this.y,1),new a.Vector3(this.x,this.y+this.height,1)],t=[new a.Vector3(0,0,1),new a.Vector3(this.sw.width,0,1),new a.Vector3(0,this.sw.height,1)],r=[new a.Vector3(0,1,1),new a.Vector3(1,1,1),new a.Vector3(0,0,1)],s=i.Matrix3.fromVectors(...e),n=i.Matrix3.fromVectors(...t),o=i.Matrix3.fromVectors(...r),l=o.inverse();return i.Matrix4.fromMatrix3(o.multiplySelf(s.inverseSelf()).multiplySelf(n).multiplySelf(l))}active(){n.active&&n.stack.push(n.active),n.active=this,this.drawToBuffers&&this.drawToBuffers.active()}ensureCanDrawTo(){if(n.active!==this)throw new Error('TextureFrame must be actived when calling "ensureCanDrawTo"!');this.drawToBuffers||(this.drawToBuffers=this.drawToBuffersRequester(),this.drawToBuffers.active())}deactive(){if(n.active!==this)throw new Error("TextureFrame must be deactived in the opposite order from been activated!");n.stack.length>0?n.active=n.stack.pop()||null:n.active=null,this.drawToBuffers&&(this.ensureResultBuffers(),this.copyToResultBuffers(),this.drawToBuffers.deactive(),this.drawToBuffers=null)}ensureResultBuffers(){this.resultBuffers||(this.resultBuffers=this.resultBuffersRequester())}copyToResultBuffers(){let{width:e,height:t}=this,r=this.drawToBuffers.width,i=this.drawToBuffers.height,a=r===this.width?this.context.NEAREST:this.context.LINEAR;this.drawToBuffers.setAsReadBuffer(),this.resultBuffers.setAsWriteBuffer(),this.context.clearBufferfv(this.context.COLOR,0,[0,0,0,0]),this.context.blitFramebuffer(0,0,r,i,0,0,e,t,this.context.COLOR_BUFFER_BIT,a),this.resultBuffers.endWrite()}}t.TextureFrame=n},47:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeSelect=void 0;const a=r(1919),s=r(1416),n=r(5499);let o=class extends s.Component{theme=n.storage.get("theme","light");render(){return s.html`
		<template class="theme">
			<div class="theme-light-btn" @click=${()=>this.setTheme("light")} :tooltip="白色主题"></div>
			<div class="theme-dark-btn" @click=${()=>this.setTheme("dark")} :tooltip="黑色主题"></div>
		</template>
		`}onCreated(){"dark"===this.theme&&a.theme.changeTheme("dark"),this.watchImmediately((()=>a.theme.mode),(e=>{document.body.classList.remove("theme-light","theme-dark"),document.body.classList.add("theme-"+e)}))}setTheme(e){a.theme.changeTheme(e),n.storage.set("theme",e)}};t.ThemeSelect=o,t.ThemeSelect=o=i([(0,s.define)("theme-select")],o)},62:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.premultiplyColorArray=t.colorArrayToString=void 0;const i=r(256);t.colorArrayToString=function(e){return e?4===e.length?i.Color.fromRGBA(...e).toString():i.Color.fromRGB(...e).toString():"transparent"},t.premultiplyColorArray=function(e){let[t,r,i,a]=e;return[t*a,r*a,i*a,a]}},162:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DirectiveTransition=void 0;const i=r(1078),a=r(5055);t.DirectiveTransition=class{constructor(e){this.options=new a.Options({}),this.firstlyUpdate=null,this.context=e}updateOptions(e){this.options.update(e),this.firstlyUpdate=null===this.firstlyUpdate}shouldPlay(){return!!this.options.get("transition")}shouldPlayEnter(){return!(!this.shouldPlay()||this.firstlyUpdate&&!this.options.get("enterAtStart"))}shouldPlayLeave(){return!(!this.shouldPlay()||this.firstlyUpdate&&!this.options.get("leaveAtStart"))}async playEnter(e){if(!this.shouldPlay())return!0;let t=this.options.get("transition"),r=this.options.get("onend"),a=await new i.Transition(e,t).enter();return r&&r.call(this.context,"enter",a),a}async playLeave(e){if(!this.shouldPlay())return!0;let t=this.options.get("transition"),r=this.options.get("onend"),a=await new i.Transition(e,t).leave();return r&&r.call(this.context,"leave",a),a}}},169:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),(0,r(4062).extendTransitions)({"flash-white":{uniformValues:{flashToColor:[1,1,1]},steps:[{fragShaderName:"flash"}]},"flash-black":{uniformValues:{flashToColor:[0,0,0]},steps:[{fragShaderName:"flash"}]},"flash-brown":{uniformValues:{flashToColor:[.9,.4,.2]},steps:[{fragShaderName:"flash"}]}})},177:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(2824),s=r(2298);(0,i.extendTransitions)({"central-in":{targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{useTexture:i.TextureReference.Source},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).scaleSelf(e,e)}]},"left-top-in":{targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{useTexture:i.TextureReference.Source},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).scaleSelf(e,e).translateSelf(-(1-e),1-e)}]},"right-top-in":{targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{useTexture:i.TextureReference.Source},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).scaleSelf(e,e).translateSelf(1-e,1-e)}]},"left-bottom-in":{targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{useTexture:i.TextureReference.Source},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).scaleSelf(e,e).translateSelf(-(1-e),-(1-e))}]},"right-bottom-in":{targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{useTexture:i.TextureReference.Source},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).scaleSelf(e,e).translateSelf(1-e,-(1-e))}]}});let n=[{useTexture:i.TextureReference.Source},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).scaleSelf(e,e)}];(0,i.extendTransitions)({NEAREAST:{targetParams:{filter:a.SamplerFilter.Nearest},steps:n},LINEAR:{targetParams:{filter:a.SamplerFilter.Linear},steps:n},NEAREST_MIPMAP_NEAREST:{targetParams:{filter:a.SamplerFilter.MipmapNearestStatic},steps:n},NEAREST_MIPMAP_LINEAR:{targetParams:{filter:a.SamplerFilter.MipmapNearest},steps:n},LINEAR_MIPMAP_NEAREST:{targetParams:{filter:a.SamplerFilter.MipmapLinearStatic},steps:n},LINEAR_MIPMAP_LINEAR:{targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:n}})},211:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getExposureTime=void 0,t.getExposureTime=function(e,t){return e/(360*t)}},229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriangleTransformProcesser=t.FaceTransform=void 0;const i=r(4452),a=r(2298),s=r(639),n=r(9381);t.FaceTransform=class{transformProcesser;fromCoords;toCoords;translates;fromTriangleIndices;toTriangleIndices;constructor(e,t){this.fromCoords=e,this.toCoords=t;let r=this.getEyesAndMouseTriangle(e),i=this.getEyesAndMouseTriangle(t);this.transformProcesser=new o(r,i),this.translates=this.generateLandmarkCoordTranslates();let a=this.getEnvironmentCoords();e.push(...a),t.push(...a),this.fromTriangleIndices=this.generateTriangleIndices(e),this.toTriangleIndices=this.generateTriangleIndices(t)}getEyesAndMouseTriangle(e){let t=[e[38],e[39],e[41],e[42]],r=[e[44],e[45],e[47],e[42]],a=new i.Vector2(0,0),s=new i.Vector2(0,0);for(let e=0;e<4;e++)a.x+=t[e].x/4,a.y+=t[e].y/4,s.x+=r[e].x/4,s.y+=r[e].y/4;return[a,s,new i.Vector2((e[63].x+e[67].x)/2,(e[63].y+e[67].y)/2)]}generateLandmarkCoordTranslates(){let e=[];for(let t=0;t<this.fromCoords.length;t++){let r=this.fromCoords[t],a=this.toCoords[t],s=this.transformProcesser.transform.transfer2(r),n=a.x-s.x,o=a.y-s.y;e.push(new i.Vector2(n,o))}for(let t=0;t<8;t++)e.push(new i.Vector2(0,0));return e}getEnvironmentCoords(){return[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map((([e,t])=>new i.Vector2(e,t)))}generateTriangleIndices(e){let t=this.getFrontalFixedCoords(e).map((({x:e,y:t},r)=>new s.Point(e,t,r)));return new s.Triangulate(t).outputIndices()}getFrontalFixedCoords(e){let t=[0,8,16],r=t.map((e=>new i.Vector3(...n.FrontalFacePoints[e],1))),s=t.map((t=>new i.Vector3(...e[t].xy,1))),o=a.Matrix3.fromVectors(...r),l=a.Matrix3.fromVectors(...s).multiply(o.inverse()),c=e.slice(0,17);for(let e=17;e<n.FrontalFacePoints.length;e++)c.push(l.transfer2(new i.Vector2(...n.FrontalFacePoints[e])));return c.push(...e.slice(n.FrontalFacePoints.length)),c}getTransformMatrixesByProgress(e){return this.transformProcesser.getTransformsByProgress(e)}};class o{transform;transformInverse;rotationRadians=0;scaleX=0;scaleY=0;skewX=0;translateX=0;translateY=0;constructor(e,t){let r=e.map((({x:e,y:t})=>new i.Vector3(e,t,1))),s=t.map((({x:e,y:t})=>new i.Vector3(e,t,1))),n=a.Matrix3.fromVectors(...r),o=a.Matrix3.fromVectors(...s).multiply(n.inverse()),[l,c,d,h,u,p]=o.flatten();this.transform=a.Matrix4.fromMatrix3(o),this.transformInverse=this.transform.inverse();let m=l*l+h*h;this.rotationRadians=Math.atan2(h,l),this.scaleX=Math.sqrt(m),this.scaleY=(l*u-h*c)/this.scaleX,this.skewX=Math.atan((l*c+h*u)/m),this.translateX=d,this.translateY=p}getTransformsByProgress(e){let t=(new a.Matrix4).skewSelf(this.skewX*e).scaleSelf(1+(this.scaleX-1)*e,1+(this.scaleY-1)*e).rotateSelf(this.rotationRadians*e).translateSelf(this.translateX*e,this.translateY*e),r=t.multiply(this.transformInverse);return{from:t,to:r}}}t.TriangleTransformProcesser=o},236:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"offsetRadius",desc:"Offset Radius",min:0,max:1,step:.01,value:.1}];(0,r(4062).extendTransitions)({morph:{uniformSlides:i,steps:[{fragShaderName:"morph"}]},"color-offset":{uniformSlides:i,steps:[{fragShaderName:"color-offset"}]},"fly-eye":{uniformSlides:[{name:"offsetRadius",desc:"Offset Radius",min:0,max:1,step:.01,value:.03},{name:"offsetPeriod",desc:"Offset Period",min:0,max:1,step:.01,value:.1},{name:"colorSeparation",desc:"Color Separation",min:0,max:1,step:.1,value:.1}],steps:[{fragShaderName:"fly-eye"}]}})},246:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BindingPart=t.FixedBindingPart=void 0;const i=r(1255);t.FixedBindingPart=class{constructor(e,t,r,a){let s=t.indexOf("."),n=s>-1?t.slice(0,s):t,o=s>-1?t.slice(s+1).split("."):void 0,l=new i.BindingResult(n,r);this.binding=i.createBindingFromResult(e,a,l,o)}update(e){this.binding.update(e)}remove(){this.binding.remove()}},t.BindingPart=class{constructor(e,t,r){this.binding=null,this.name=null,this.el=e,this.context=r,t instanceof i.BindingResult&&(this.name=t.name,this.binding=i.createBindingFromResult(e,r,t),this.binding.update(...t.args))}update(e){e instanceof i.BindingResult?e.name===this.name?this.binding.update(...e.args):(this.removeCurrentBinding(),this.binding=i.createBindingFromResult(this.el,this.context,e)):this.removeCurrentBinding()}removeCurrentBinding(){this.binding&&(this.name=null,this.binding.remove(),this.binding=null)}remove(){this.binding&&this.binding.remove()}}},247:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Stat=void 0;const i=r(5499);var a;!function(e){function t(e){return(0,i.avg)(e)}function r(e){let r=t(e),i=0;for(let t of e)i+=Math.pow(t-r,2);return Math.sqrt(i/e.length)}e.getAverageValue=t,e.getStandardDeviation=r,e.getCoreAverageValues=function(e,i){let a=t(e),s=r(e);return t(e.filter((e=>Math.abs(e-a)<=s*i)))}}(a||(t.Stat=a={}))},256:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;const i=r(5499);class a{static fromRGBA(e,t,r,s){return e=Math.max(Math.min(e,1),0),t=Math.max(Math.min(t,1),0),r=Math.max(Math.min(r,1),0),s=Math.max(Math.min(s,1),0),new a(1===s?"#"+Math.round(255*e).toString(16).padStart(2,"0")+Math.round(255*t).toString(16).padStart(2,"0")+Math.round(255*r).toString(16).padStart(2,"0"):"rgba("+Math.round(255*e).toString()+", "+Math.round(255*t).toString()+", "+Math.round(255*r).toString()+", "+(0,i.toPower)(s,-2)+")")}static fromRGB(e,t,r){return a.fromRGBA(e,t,r,1)}value;constructor(e){this.value=e.trim()}toString(){return this.value}getRGBA(){if(/^#[0-9a-fA-F]{3,6}$/.test(this.value))return[...this.parseNormalColor(this.value),1];let e=this.value.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);if(e)return[Number(e[1])/255,Number(e[2])/255,Number(e[3])/255,1];if(e=this.value.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)$/),e)return[Number(e[1])/255,Number(e[2])/255,Number(e[3])/255,Number(e[4])];if(e=this.value.match(/^rgba\(\s*(#[0-9a-fA-F]{3,6})\s*,\s*([\d.]+)\s*\)$/),e)return[...this.parseNormalColor(e[1]),Number(e[2])];throw new Error(`"${this.value}" is not a valid RGB color`)}getRGB(){return this.getRGBA().slice(0,3)}parseNormalColor(e){return 4===e.length?[17*parseInt(e[1],16)/255,17*parseInt(e[2],16)/255,17*parseInt(e[3],16)/255]:[parseInt(e.slice(1,3),16)/255,parseInt(e.slice(3,5),16)/255,parseInt(e.slice(5,7),16)/255]}darken(e){return this.lighten(-e)}lighten(e){let[t,r,i,s]=this.getRGBA(),n=e/100;return t+=n,r+=n,i+=n,a.fromRGBA(t,r,i,s)}toMiddle(e){return this.getLightness()<.5?this.lighten(e):this.darken(e)}getLightness(){let[e,t,r]=this.getRGBA();return.299*e+.587*t+.114*r}alpha(e){let[t,r,i]=this.getRGBA();return a.fromRGBA(t,r,i,e)}mix(e,t){let[r,i,s,n]=this.getRGBA();"string"==typeof e&&(e=new a(e));let[o,l,c,d]=e.getRGBA(),h=t/100;return r=r*(1-h)+o*h,i=i*(1-h)+l*h,s=s*(1-h)+c*h,n=n*(1-h)+d*h,a.fromRGBA(r,i,s,n)}}t.Color=a},267:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(356),a=r(9856);i.defineBinding("class",class{constructor(e,t,r){if(this.lastClassNames=[],r){if(r.length>1)throw new Error(`Modifier "${r.join(".")}" is not allowed, at most one modifier as class name can be specified for ":class"`);if(!/^\$?[\w-]+$/.test(r[0]))throw new Error(`Modifier "${r[0]}" is not a valid class name`)}this.el=e,this.modifiers=r,this.scopeName=t?t.el.localName:"",this.scopedClassNameSet=this.scopeName?a.getScopedClassNameSet(this.scopeName):void 0}update(e){let t=[];e&&(t=this.parseClass(e));for(let e of this.lastClassNames)t.includes(e)||this.el.classList.remove(e);for(let e of t)this.lastClassNames.includes(e)||this.el.classList.add(e);this.lastClassNames=t}parseClass(e){let t={};if(this.modifiers)e&&(t[this.modifiers[0]]=!0);else if(Array.isArray(e))for(let r of e)t[r]=!0;else if(e&&"object"==typeof e)for(let r of Object.keys(e))t[r]=!!e[r];else if("string"==typeof e)for(let r of e.split(/\s+/))r&&(t[r]=!0);let r=[];for(let e in t)t[e]&&(this.scopedClassNameSet&&this.scopedClassNameSet.has(e)&&(e=e+"__"+this.scopeName),r.push(e));return r}remove(){this.lastClassNames&&this.el.classList.remove(...this.lastClassNames)}})},277:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec4 fRawCoord;\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform mat4 iSamplingTransform;\nuniform mat4 motionMatrix;\nuniform int samplingCount;\nuniform bool repeatEdgePixels;\nfloat seedRandom2(vec2 v) {\nreturn fract(sin(dot(v, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat noise2(vec2 v) {\nvec2 i = floor(v);\nvec2 f = fract(v);\nvec2 u = f * f * (3.0 - 2.0 * f);\nfloat a = seedRandom2(i);\nfloat b = seedRandom2(i + vec2(1, 0));\nfloat c = seedRandom2(i + vec2(0, 1));\nfloat d = seedRandom2(i + vec2(1, 1));\nreturn mix(a, b, u.x) +\n(c - a)* u.y * (1.0 - u.x) +\n(d - b) * u.x * u.y;\n}\nfloat stepRange(float value, float minValue, float maxValue) {\nfloat diffToCenter = abs(value - (minValue + maxValue) / 2.0);\nfloat halfRange = (maxValue - minValue) / 2.0;\nreturn 1.0 - step(halfRange, diffToCenter);\n}\nvec4 sampling(sampler2D sampler, vec2 textureCoord) {\nvec4 color = texture(sampler, textureCoord);\nif (!repeatEdgePixels) {\ncolor *= stepRange(textureCoord.x, 0.0, 1.0) * stepRange(textureCoord.y, 0.0, 1.0);\n}\nreturn color;\n}\nvec4 motionSampling(sampler2D sampler, vec2 textureCoord, vec2 motionV, int sampleCount, float frequency) {\nvec4 totalColor = vec4(0);\nfloat noiseValue = noise2(gl_FragCoord.xy * frequency);\nfor (int i = 0; i < sampleCount; i++) {\nfloat rate = (float(i) + noiseValue) / float(sampleCount);\nvec2 coord = textureCoord + rate * motionV;\nvec4 color = sampling(sampler, coord);\ntotalColor += color;\n}\nreturn totalColor / float(sampleCount);\n}\nvec4 getFragColor() {\nvec4 pixelMotionV = motionMatrix * fRawCoord;\nvec2 textureMotionV = pixelMotionV.xy / iVideoResolution;\ntextureMotionV.y = -textureMotionV.y;\ntextureMotionV = (iSamplingTransform * vec4(textureMotionV, 0, 0)).xy;\ntextureMotionV = (iChannelMap[0] * vec4(textureMotionV, 0, 0)).xy;\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = motionSampling(iChannel[0], textureCoord, textureMotionV, samplingCount, 2.0);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},294:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObservedEmitter=t.ObservedBaseClass=void 0;const i=r(9395),a=r(9739);t.ObservedBaseClass=class{constructor(){return i.observeTarget(this)}};class s extends a.Emitter{constructor(){return super(),i.observeTarget(this)}}t.ObservedEmitter=s},326:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLayerStyleClass=void 0;const i=r(5050),a={dropShadow:r(8369).DropShadowLayerStyle,original:i.LayerStyleDrawOriginal};t.getLayerStyleClass=function(e){let t=a[e];if(!t)throw new Error(`"${e}" is not a registered layer style class!`);return t}},356:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.refBinding=t.createBindingFromResult=t.BindingResult=t.defineBinding=void 0;const r=new Map;t.defineBinding=function e(t,a){return r.has(t)&&console.warn(`You are trying to overwrite binding definition "${t}"`),a?(r.set(t,a),function(...e){return new i(t,...e)}):r=>e(t,r)};class i{constructor(e,...t){this.ref=null,this.name=e,this.args=t}}t.BindingResult=i,t.createBindingFromResult=function(e,t,i,a){let s=function(e){return r.get(e)}(i.name);if(!s)throw new Error(`":${i.name}" on "<${e.localName}>" is not a registered binding class`);let n=new s(e,t,a);return i.ref&&i.ref(n),n.update(...i.args),n},t.refBinding=function(e,t){return e.ref=t,e}},453:function(e,t,r){var i,a=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Loader=void 0;const s=r(1416),n=r(8240);let o=i=class extends s.Component{constructor(){super(...arguments),this.size="medium",this.asCover=!1}static style(){let{mainColor:e,backgroundColor:t}=n.theme;return s.css`
		:host{
			display: inline-block;
			vertical-align: top;
			color: ${e};
		}

		.as-cover{
			position: absolute;
			left: 0;
			top: 0;
			right: 0;
			bottom: 0;
			z-index: 10;
			background: ${t.alpha(.9)};
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			text-align: center;
		}

		svg{
			margin: auto;
		}

		path{
			stroke: currentColor;
			fill: none;
			stroke-linecap: square;
		}

		.bg{
			stroke-opacity: 0.3;
		}
		`}render(){let e=this.getStrokeWidth(),t=e/2,r=i.sizes[this.size],a=`M${t} ${t} H${r-t} V${r-t} H${t}Z`,n=`${r-e} ${3*(r-e)}`;return s.html`
		<template
			:class="size-${this.size}"
			:class.as-cover=${this.asCover}
			:style.width.px=${r}
			:style.height.px=${r}
			:style.animation="loader-snake-${this.size} 2s linear infinite"
		>
			<svg viewBox="0 0 ${r} ${r}" width=${r} height=${r}>
				<path class="bg" d=${a} style="stroke-width: ${e}" />
				<path :ref="snake" d=${a} style="stroke-width: ${e}; stroke-dasharray: ${n};" />
			</svg>
		</template>
		`}getStrokeWidth(){return i.strokeWidths[this.size]}onReady(){let e=this.getStrokeWidth(),t=i.sizes[this.size];this.refs.snake.animate([{strokeDashoffset:0},{strokeDashoffset:4*-(t-e)}],{duration:1500,iterations:1/0})}};o.sizes={small:18,medium:28,large:48},o.strokeWidths={small:3,medium:4,large:5},o=i=a([s.define("f-loader")],o),t.Loader=o},501:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nout vec4 fragColor;\nuniform vec4 solidColor;\nuniform float iOpacity;\nvec4 getFragColor() {\nreturn solidColor * iOpacity;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},511:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Tooltip=void 0;const a=r(1416),s=r(8240),n=r(9782);let o=class extends n.Popup{constructor(){super(...arguments),this.type="default"}static style(){let{adjust:e,adjustFontSize:t,backgroundColor:r,textColor:i,errorColor:n}=s.theme,o=[["default",r.toMiddle(5)],["prompt",i.toMiddle(30)],["error",n.toMiddle(5)]];return a.css`
		:host{
			display: flex;
			font-size: ${t(13)}px;
			max-width: ${e(220)}px;
			padding: ${e(4)}px ${e(8)}px;
			line-height: ${e(20)}px;
			pointer-events: none;
		}

		.text{
			flex: 1;
			min-width: 0;
		}

		.close{
			display: flex;
			width: ${e(28)}px;
			height: ${e(28)}px;
			margin-top: ${e(-4)}px;
			margin-bottom: ${e(-4)}px;
			margin-right: ${e(-8)}px;
			cursor: pointer;

			&:active{
				transform: translateY(1px);
			}

			f-icon{
				margin: auto;
			}
		}

		${o.map((([e,t])=>{let r=t.getLightness()>.5?"#000":"#fff";return a.css`
			.type-${e}{
				background: ${t};
				color: ${r};

				.triangle{
					border-bottom-color: ${t};

					&-herizontal{
						border-right-color: ${t};
						border-bottom-color: transparent;
					}
				}
			}
			`}))}

		.type-prompt{
			pointer-events: auto;
		}

		`.extends(super.style())}render(){return a.html`
		<template class="type-${this.type}">
			<div class="text">
				<slot />
			</div>

			${"prompt"===this.type?a.html`
				<div class="close" @click=${this.close}>
					<f-icon .type="close" />
				</div>
			`:""}
		</template>
		`.extends(super.render())}};o=i([a.define("f-tooltip")],o),t.Tooltip=o},555:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TransformStatusRecord=t.TransformStatus=void 0;const i=r(2111),a=r(2298),s=r(5365),n=r(909),o=r(3470),l=r(7905),c=r(2492),d=r(4452),h=r(1830),u=r(6376);class p{videoWidth;videoHeight;transformMatrix;samplingMatrix;projectionMatrix;opacity;deep=0;layerDeep=0;constructor(e,t,r=a.Matrix4.I,i=1,s=a.Matrix4.I,n=(0,c.get2DProjectionMatrix)(e,t)){this.transformMatrix=r,this.samplingMatrix=s,this.projectionMatrix=n,this.opacity=i,this.videoWidth=e,this.videoHeight=t}clone(){return new p(this.videoWidth,this.videoHeight,this.transformMatrix,this.opacity,this.samplingMatrix,this.projectionMatrix)}cloneOpacity(){return new p(this.videoWidth,this.videoHeight,a.Matrix4.I,this.opacity)}setDeep(e){this.deep=e}setLayerDeep(e){this.layerDeep=e}setProjectionMatrix(e){this.projectionMatrix=e}mergeLookAtMatrix(e){this.transformMatrix=e.multiply(this.transformMatrix)}mergeTransformValues(e){let t=(0,s.getTransformFromValues)(e);this.mergeTransformMatrix(t),this.mergeOpacity(e.opacity/100)}mergeTransformMatrix(e){this.transformMatrix=this.transformMatrix.multiply(e)}mergeSamplingMatrix(e){this.samplingMatrix=this.samplingMatrix.multiply(e)}mergeOpacity(e){this.opacity*=e}is3DProjection(){return(0,c.is3DProjectionMatrix)(this.projectionMatrix)}getProjectedPaintArea(e){let t=(0,c.getFinalProjectedCoords)(e,this.transformMatrix,this.projectionMatrix,this.videoWidth,this.videoHeight);return h.PaintArea.fromCoords(t)}getProjectedPaintAreaAfterSubTransform(e,t){let r=(0,c.getFinalProjectedCoords)(e,this.transformMatrix.multiply(t),this.projectionMatrix,this.videoWidth,this.videoHeight);return h.PaintArea.fromCoords(r)}getFlatProjectionMatrix(){return(0,c.getFlatProjectionMatrix)(this.transformMatrix,this.projectionMatrix,this.videoWidth,this.videoHeight)}projectMatrix(e){let t=this.getFlatProjectionMatrix(),r=t.inverse();return t.multiply(e).multiply(r)}projectVector(e){let t=this.getFlatProjectionMatrix().transfer4(new d.Vector4(...e.xy,0,0));return new d.Vector2(...t.xy).multiplyScalarSelf(this.getDeepScaling())}getDeepScaling(){return 0===this.layerDeep?1:this.deep/this.layerDeep}}t.TransformStatus=p,t.TransformStatusRecord=class{time;map=new Map;videoWidth;videoHeight;initialStatus;justProcessedLayerDeep=0;constructor(e,t,r,i){this.time=t,this.videoWidth=r,this.videoHeight=i,this.generateInitialStatus(),this.generateNodeListStatus(e,this.initialStatus,(0,o.getDefaultCameraLookAtMatrix)(r,i),(0,o.getDefaultCameraProjectionMatrix)(r,i))}get(e){return this.map.get(e)}generateInitialStatus(){this.initialStatus=Object.seal(new p(this.videoWidth,this.videoHeight))}generateNodeListStatus(e,t,r,a){for(let s of e)(0,i.isTransformableRenderNodeType)(s.type)&&this.generateNodeStatus(s,t,r,a)}generateNodeStatus(e,t,r,a){let s,n=t.clone();if(this.mergeTransformTypeEffects(e,n),s=e.type===i.RenderNodeType.CameraLayer?t.clone():n.clone(),e.type===i.RenderNodeType.CameraLayer){let t=e.data,i=e.timeMap.map(this.time);r=(0,o.getCameraLayerLookAtMatrix)(t,i,n.transformMatrix),a=(0,o.getCameraLayerProjectionMatrix)(t,i,this.videoWidth,this.videoHeight)}if(e.inThreeD&&(n.mergeLookAtMatrix(r),n.setProjectionMatrix(a)),this.map.set(e.id,n),e.inputs){switch(e.type){case i.RenderNodeType.Effect:(0,l.isFullscreenEffect)(e.data.type)?s=this.initialStatus.clone():s.opacity=1;break;case i.RenderNodeType.CompositeLayer:s.opacity=1}this.generateNodeListStatus(e.inputs,s,r,a)}this.generateDeeps(e,n)}mergeTransformTypeEffects(e,t){let r=e.effects,i=null;for(let e=r.length-1;e>=0;e--){let{effect:a,timeMap:o}=r[e],l=o.map(this.time);switch(a.type){case"transform":let e=(0,s.getTransformValues)(a,l);t.mergeTransformValues(e);break;case"tile":let{transformMatrix:r,samplingMatrix:o}=(0,n.getTileMatrixes)(a,l,this.videoWidth,this.videoHeight);i=i?i.multiply(r):r,t.mergeSamplingMatrix(o)}}i&&t.mergeTransformMatrix(i)}generateDeeps(e,t){if(!e.inThreeD)return;let r,a=e.data.transform;r=a&&a.anchorPoint?(0,u.getPropertyValue)(a.anchorPoint,this.time):[this.videoWidth/2,this.videoHeight/2,0];let s=this.getLayerDeep(t.transformMatrix,r);t.setDeep(s),(0,i.isRenderableLayeRenderNodeType)(e.type)?(t.setLayerDeep(s),this.justProcessedLayerDeep=s):t.setLayerDeep(this.justProcessedLayerDeep)}getLayerDeep(e,t){return e.transfer3(new d.Vector3(...t)).z}}},557:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(356);i.defineBinding("enable",class{constructor(e){this.el=e}update(e){e?this.el.removeAttribute("disabled"):this.el.setAttribute("disabled","")}remove(){this.el.removeAttribute("disabled")}}),i.defineBinding("disable",class{constructor(e){this.el=e}update(e){e?this.el.setAttribute("disabled",""):this.el.removeAttribute("disabled")}remove(){this.el.removeAttribute("disabled")}})},589:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createComponent=t.define=void 0;const i=r(3393),a=r(900),s=r(8231);t.define=function e(t,r){if(!t.includes("-"))throw new Error(`"${t}" can't be defined as custom element, it must contain "-"`);if(!r)return function(r){e(t,r)};customElements.define(t,class extends HTMLElement{connectedCallback(){!function(e,t){o.has(e)?o.delete(e):(n.set(e,t),o.delete(e),l||c())}(this,r)}disconnectedCallback(){!function(e,t){n.has(e)?n.delete(e):(o.set(e,t),l||c())}(this,r)}}),a.defineComponentConstructor(t,r)};let n=new Map,o=new Map,l=!1;function c(){Promise.resolve().then(d),l=!0}function d(){let e=n;n=new Map,l=!1;for(let[t,r]of e.entries())h(t,r);requestAnimationFrame((()=>{let e=o;o=new Map;for(let t of e.keys())u(t)}))}function h(e,t){let r=s.getComponent(e);r||(r=p(e,t)),r.__emitConnected()}function u(e){let t=s.getComponent(e);t&&t.__emitDisconnected()}function p(e,t){i.ensureComponentStyle(t,e.localName);let r=new t(e);return r.__emitCreated(),r}t.createComponent=p},609:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BulgeEffect=void 0;const i=r(8341),a=r(6376),s=r(5305),n=r(6339),o=r(7810);class l extends i.Effect{async initialize(){this.toDraw=new n.ToDrawEffect({renderer:this.renderer,fragCode:o.default})}update(){super.update();let e=(0,a.getPropertyValues)(this.data,this.time,s.EffectBulgeDefaultValues);this.toDraw.setUniform("horizontalRadius",e.horizontalRadius),this.toDraw.setUniform("verticalRadius",e.verticalRadius),this.toDraw.setUniform("bulgeCenter",e.bulgeCenter),this.toDraw.setUniform("bulgeHeight",e.bulgeHeight)}}t.BulgeEffect=l},623:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform float fillOpacity;\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord0);\nvec4 shadowColor = texture(iChannel[1], textureCoord1);\ncolor *= fillOpacity;\ncolor = shadowColor * (1.0 - color.a) + color;\nvec4 inputColor = texture(iChannel[0], textureCoord0);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},639:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Triangulate=t.Point=void 0;class r{x;y;id;constructor(e,t,r=-1/0){this.x=e,this.y=t,this.id=r}minus(e){return new i(this.x-e.x,this.y-e.y)}isBoundingPoint(){return this.id<0}clone(){return new r(this.x,this.y,this.id)}}t.Point=r;class i{x;y;constructor(e,t){this.x=e,this.y=t}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}}class a{p0;p1;p2;center;radiusSquared;constructor(e,t,r){this.p0=e,this.p1=t,this.p2=r,this.calcCircumcircle()}calcCircumcircle(){let e,t,{p0:i,p1:a,p2:s}=this,n=a.x-i.x,o=a.y-i.y,l=s.x-i.x,c=s.y-i.y,d=n*(i.x+a.x)+o*(i.y+a.y),h=l*(i.x+s.x)+c*(i.y+s.y),u=2*(n*(s.y-a.y)-o*(s.x-a.x));if(Math.abs(u)<1e-9){let n=Math.min(i.x,a.x,s.x),o=Math.min(i.y,a.y,s.y),l=Math.max(i.x,a.x,s.x),c=Math.max(i.y,a.y,s.y);this.center=new r((n+l)/2,(o+c)/2),e=this.center.x-n,t=this.center.y-o}else{let a=(c*d-o*h)/u,s=(n*h-l*d)/u;this.center=new r(a,s),e=this.center.x-i.x,t=this.center.y-i.y}this.radiusSquared=e*e+t*t}isBoundingTriangle(){return this.p0.isBoundingPoint()||this.p1.isBoundingPoint()||this.p2.isBoundingPoint()}isPointInsideCircumcircle(e){let t=this.center.x-e.x,r=this.center.y-e.y;return t*t+r*r<=this.radiusSquared}outputAnticlockwiseIndices(){let e=this.p1.minus(this.p0),t=this.p2.minus(this.p0);return e.cross(t)>=0?[this.p0.id,this.p1.id,this.p2.id]:[this.p0.id,this.p2.id,this.p1.id]}}class s{p0;p1;id;constructor(e,t){this.p0=e,this.p1=t,this.id=e.id<t.id?e.id+"_"+t.id:t.id+"_"+e.id}}t.Triangulate=class{points=[];triangles=[];constructor(e){if(e){this.triangles.push(this.createBoundingTriangle(e));for(let t of e)this.addPoint(t)}}createBoundingTriangle(e){let t=e.map((e=>e.x)),i=e.map((e=>e.y)),s=Math.min(...t),n=Math.max(...t),o=Math.min(...i),l=Math.max(...i),c=1e3*Math.max(n-s,2),d=1e3*Math.max(l-o,2),h=new r(s-3*c,o-d,-1),u=new r(n+3*c,o-d,-2),p=new r((s+n)/2,l+3*d,-3);return new a(h,u,p)}addPoint(e){let t=[];this.triangles=this.triangles.filter((r=>!r.isPointInsideCircumcircle(e)||(t.push(new s(r.p0,r.p1)),t.push(new s(r.p1,r.p2)),t.push(new s(r.p2,r.p0)),!1))),t=this.uniqueEdges(t),this.points.push(e);for(let r of t)this.triangles.push(new a(r.p0,r.p1,e))}uniqueEdges(e){let t=new Set,r=new Set;for(let{id:i}of e)t.has(i)?r.delete(i):(t.add(i),r.add(i));return e.filter((({id:e})=>r.has(e)))}outputIndices(){return this.trianglesToIndices(this.removeBoundingTriangle())}trianglesToIndices(e){return e.map((e=>e.outputAnticlockwiseIndices()))}removeBoundingTriangle(){return this.triangles.filter((e=>!e.isBoundingTriangle()))}}},641:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFontMeasurement=void 0;const i=r(4072);let a,s,n;const o="A quick brown fox jump over the lazy dog.",l=new Map;t.getFontMeasurement=function(e,t){let r;if(i.FontList.has(e)){let a=i.FontList.get(e,t);r={ascent:a.winAscent,descent:a.winDescent,xHeight:a.xHeight,boxHeight:a.boxHeight,leftBearing:-a.minLeftSideBearing,rightBearing:-a.minRightSideBearing,yMin:a.yMin,yMax:a.yMax}}else r=function(e){if(l.has(e))return l.get(e);a||function(){let e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.style.position="fixed",t.style.top="0",t.style.visibility="hidden",t.style.fontSize="100px";let r=document.createElementNS(e,"text");r.setAttribute("x","0"),r.setAttribute("y","0"),r.style.dominantBaseline="alphabetic",r.textContent=o,t.appendChild(r);let i=document.createElementNS(e,"text");i.setAttribute("x","0"),i.setAttribute("y","0"),i.style.dominantBaseline="middle",i.textContent=o,t.appendChild(i),a=t,s=r,n=i}(),a.style.fontFamily=e,document.body.appendChild(a);let t=s.getBoundingClientRect(),r=n.getBoundingClientRect(),i=t.height/100,c=-t.top/100,d=i-c,h={ascent:c,descent:d,xHeight:2*(c- -r.top/100),boxHeight:i,leftBearing:.5,rightBearing:.5,yMin:-d,yMax:c};return l.set(e,h),document.body.removeChild(a),h}(e);if(r.yMax=Math.max(r.yMax,1),r.boxHeight>1.2){let e=(r.boxHeight-1.2)/2;r.ascent-=e,r.descent+=e,r.boxHeight=1.2}return r}},750:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isWhiteSpaceChar=t.reverseFindWordStartIndex=void 0,t.reverseFindWordStartIndex=function(e,t){if(!/\w/i.test(e[t]))return t;for(let r=t;r>=0;r--)if(!/\w/.test(e[r]))return r+1;return 0},t.isWhiteSpaceChar=function(e){return" \r\n\t".includes(e)}},757:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(6725);var s=r(8038);Object.defineProperty(t,"assign",{enumerable:!0,get:function(){return s.assign}}),Object.defineProperty(t,"assignIf",{enumerable:!0,get:function(){return s.assignIf}}),Object.defineProperty(t,"deepClone",{enumerable:!0,get:function(){return s.deepClone}}),Object.defineProperty(t,"deepEqual",{enumerable:!0,get:function(){return s.deepEqual}}),a(r(7388),t),a(r(5956),t),a(r(9184),t),a(r(5845),t),a(r(7340),t),a(r(3549),t),a(r(5429),t),a(r(4915),t),a(r(6218),t)},774:(e,t)=>{function r(e,t){return"number"==typeof t&&/(?:width|height|left|right|top|bottom|size)$/i.test(e)?t+="px":t=t.toString(),t}Object.defineProperty(t,"__esModule",{value:!0}),t.getClosestFixedElement=t.normativeStyleObject=t.normativeStyleValue=void 0,t.normativeStyleValue=r,t.normativeStyleObject=function(e){for(let t of Object.keys(e))e[t]=r(t,e[t]);return e},t.getClosestFixedElement=function(e){for(;e&&e!==document.documentElement&&"fixed"!==getComputedStyle(e).position;)e=e.parentElement;return e===document.documentElement?null:e}},800:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacementMapEffect=void 0;const i=r(8341),a=r(6376),s=r(5305),n=r(6339),o=r(2307),l=r(4452);class c extends i.Effect{async initialize(){this.toDraw=new n.ToDrawEffect({renderer:this.renderer,fragCode:o.default})}update(){super.update();let e=(0,a.getPropertyValues)(this.data,this.time,s.EffectDisplacementMapDefaultValues),t=new l.Vector2(e.maxHorizontalDisplacement,e.maxVerticalDisplacement);t=this.transformStatus.projectVector(t),this.toDraw.setUniform("maxDisplacement",t.xy)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.DisplacementMapEffect=c},845:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Menu=void 0;const a=r(1416),s=r(8240),n=r(9782);let o=class extends n.Popup{constructor(){super(...arguments),this.title="",this.defaultPopupOptions={alignPosition:"bc",fixTriangle:!0}}static style(){let{adjust:e,adjustFontSize:t,textColor:r}=s.theme;return a.css`
		:host{
			min-width: ${e(180)}px;
			max-width: ${e(320)}px;
			padding: ${e(8)}px ${e(16)}px;

			f-list{
				border-bottom: none;
				max-height: 100%;
				overflow-y: auto;
			}
		}

		.triangle{
			left: ${e(15)}px;
		}

		.header{
			display: flex;
			line-height: ${e(22)}px;
			height: ${e(28)+1}px;
			font-size: ${t(13)}px;
			padding-bottom: ${e(6)}px;
			border-bottom: 1px solid ${r.alpha(.8)};
		}

		.title{
			flex: 1;
			min-width: 0;
			padding: 0 ${e(16)}px 0 0;
			font-weight: bold;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}
		`.extends(super.style())}render(){return a.html`
		<f-popup>	
			${this.renderHead()}
			<slot />
		</f-popup>
		`.extends(super.render())}renderHead(){return this.title?a.html`
			<div class="header">
				<div class="title">${this.title}</div>
			</div>
			`:""}};o=i([a.define("f-menu")],o),t.Menu=o},877:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ColLayout=t.RowLayout=void 0;const a=r(1416);let s=class extends a.Component{constructor(){super(...arguments),this.columnCount=24,this.gutter=0,this.justify="start",this.cols=[]}static style(){return a.css`
		:host{
			display: flex;
			flex-wrap: wrap;
		}
		`}onUpdated(){this.el.style.justifyContent="start"===this.justify?"":"end"===this.justify?"flex-end":this.justify}register(e){this.cols.push(e)}getLeftColCount(e){let{columnCount:t}=this,r=0;for(let i of this.cols){if(i===e)break;r+=Math.min(i.span,t)+i.offset%t}return r}isFirstCol(e){return e===this.cols[0]}};s=i([a.define("f-row")],s),t.RowLayout=s;let n=class extends a.Component{constructor(){super(...arguments),this.span=1,this.offset=0}onCreated(){let e=a.getComponent(this.el.parentElement);if(!(e instanceof s))throw new Error('"<f-col>" must be included in a "<f-row>"');e.register(this),this.row=e}onUpdated(){this.el.style.marginLeft=this.getMarginLeft(),this.el.style.width=this.getWidth()}getMarginLeft(){let e=this.row.getLeftColCount(this),{columnCount:t,gutter:r}=this.row,i=this.offset%t;return i>0?i/r*100+"%":(e+i)%t==0?"0":r+"px"}getWidth(){let{gutter:e,columnCount:t}=this.row,r=Math.min(this.span,t),i=r/t;return`calc(${100*i}% - ${-e*(r-1-(t-1)*i)}px)`}};n=i([a.define("f-col")],n),t.ColLayout=n},898:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.dialog=t.QuickDialog=t.Dialog=void 0;const a=r(1416),s=r(8240),n=r(5499);let o=class extends a.Component{constructor(){super(...arguments),this.appendTo="body",this.options=null,this.resolve=null,this.stack=[],this.opened=!0}static style(){let{textColor:e,adjust:t,adjustFontSize:r,popupBorderRadius:i,popupShadowBlurRadius:n,popupShadowColor:o,popupBackgroundColor:l}=s.theme;return a.css`
		:host{
			z-index: 1100;	// Higher that modal, popup, tooltip
			width: ${t(360)}px;
			position: fixed;
			border-radius: ${i}px;
			box-shadow: 0 0 ${n}px ${o};
			background: ${l};
			max-width: 96%;
			max-height: 96%;
			padding: ${t(8)}px ${t(16)}px ${t(16)}px;
		}

		.mask{
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
		}

		.header{
			display: flex;
			line-height: ${t(22)}px;
			height: ${t(28)+1}px;
			font-size: ${r(13)}px;
			padding-bottom: ${t(6)}px;
			border-bottom: 1px solid ${e.alpha(.8)};
		}

		.title{
			flex: 1;
			min-width: 0;
			padding: 0 ${t(16)}px 0 0;
			font-weight: bold;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}

		.content{
			display: flex;
			margin-top: ${t(8)}px;
		}

		.icon{
			padding-right: ${t(12)}px;
		}

		.message{
			flex: 1;
			min-width: 0;
			line-height: ${t(20)}px;
			padding: ${t(4)}px 0;
		}

		.list{
			margin: ${t(8)}px 0;
			line-height: ${t(20)}px;
			list-style-type: square;
			padding-left: ${t(28)}px;
		}

		.actions{
			display: flex;
			justify-content: flex-end;
			margin-top: ${t(16)}px;

			button{
				margin-left: ${t(8)}px;
			}

			.third{
				margin-left: 0;
				margin-right: auto;
			}
		}

		.input{
			margin-top: 8px;
			width: 100%;
		}
		`}render(){let e=this.options;return e?a.html`
		<template
			tabindex="0"
			${a.show(this.opened,{transition:"fade",enterAtStart:!0,onend:this.onTransitionEnd})}
		>
			<div class="mask"
				:ref="mask"
				${a.show(this.opened,{transition:"fade",enterAtStart:!0})}
			/>

			${e.title?a.html`
				<div class="header">
					<div class="title">
						${e.title}
					</div>
				</div>
			`:""}

			<div class="content">

				${e.icon?a.html`<div class="icon">
					<f-icon .type="${e.icon}" />
				</div>`:""}

				<div class="message">
					${e.message}
				</div>

				${e.list&&e.list.length>0?a.html`
					<ul class="list">
						${e.list.map((e=>a.html`<li>${e}</li>`))}
					</ul>
				`:""}
			</div>

			${this.renderActions(e.actions)}
		</template>
		`:""}renderActions(e){if(e&&e.length>0){let t=e.map((e=>a.html`
				<button class="action"
					?primary=${e.primary}
					:class.third=${e.third}
					@click=${()=>this.onClickActionButton(e)}>
					${e.text}
				</button>
			`));return a.html`<div class="actions">${t}</div>`}return""}onClickActionButton(e){if(this.resolve&&(this.resolve(e.value),this.resolve=null),this.stack.length>0){let e=this.stack.shift();this.assignOptions(e.options,e.resolve)}else this.hide()}triggerAction(e){if(!this.options||!this.options.actions)return;let t=this.options.actions.find((t=>t.value===e));t&&this.onClickActionButton(t)}onTransitionEnd(e,t){if("leave"===e&&t)this.refs.mask&&this.refs.mask.remove(),this.el.remove();else if("enter"===e){let e=this.el.querySelector("input");e&&e.focus()}}async onConnected(){await a.renderComplete(),this.refs.mask&&this.el.previousElementSibling!==this.refs.mask&&this.el.before(this.refs.mask),this.toCenter(),0===this.el.tabIndex&&this.el.focus(),a.on(window,"resize",n.debounce(this.onWindowResize,200).wrapped,this)}onDisconnected(){a.off(window,"resize",this.onWindowResize,this)}onWindowResize(){this.opened&&this.toCenter()}toCenter(){n.align(this.el,document.documentElement,"c")}show(){this.opened=!0,this.appendTo&&a.appendTo(this.el,this.appendTo)}hide(){this.opened=!1}assignOptions(e,t){this.options=e,this.resolve=t}async addOptions(e){let t,r=new Promise((e=>{t=e}));return this.resolve?this.stack.push({options:e,resolve:t}):(this.assignOptions(e,t),this.show()),r}};o=i([a.define("f-dialog")],o),t.Dialog=o;class l{constructor(){this.dialogComponent=null,this.actionLabels={ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}}addOptions(e){return this.dialogComponent||(this.dialogComponent=a.renderComponent(a.html`<f-dialog />`).component),this.dialogComponent.addOptions(e)}setLabels(e){Object.assign(this.actionLabels,e)}show(e,t={}){return this.addOptions(Object.assign({message:e,actions:[{value:"ok",text:this.actionLabels.ok}]},t))}confirm(e,t={}){return this.addOptions(Object.assign({icon:"confirm",message:e,actions:[{value:"cancel",text:this.actionLabels.cancel},{value:"ok",text:this.actionLabels.ok,primary:!0}]},t))}async prompt(e,t={}){let r=t.value?String(t.value):"",i=a.html`
			${e}
			<f-input class="input" 
				.placeholder=${t.placeholder}
				@input=${e=>r=e}
				@@keydown.enter=${()=>this.dialogComponent.triggerAction("ok")}
			/>
		`;if("ok"===await this.addOptions(Object.assign({message:i,actions:[{value:"cancel",text:this.actionLabels.cancel},{value:"ok",text:this.actionLabels.ok,primary:!0}]},t)))return r}}t.QuickDialog=l,t.dialog=new l},900:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getComponentConstructor=t.defineComponentConstructor=void 0;const r=new Map;t.defineComponentConstructor=function(e,t){r.has(e)&&console.warn(`You are trying to overwrite component definition "${e}"`),r.set(e,t)},t.getComponentConstructor=function(e){return r.get(e)}},909:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTileMatrixes=void 0;const i=r(5305),a=r(6376),s=r(2298);t.getTileMatrixes=function(e,t,r,n){let o=(0,a.getPropertyValues)(e,t,i.EffectTileDefaultValues),l=function(e,t,r){let{outputWidth:i,outputHeight:a}=e,n=new s.Matrix4,o=t/2,l=r/2;return n.translateSelf(-o,-l),n.scaleSelf(i/100,a/100),n.translateSelf(o,l),n}(o,r,n),c=function(e,t,r){let{tileCenter:i,tileWidth:a,tileHeight:n,outputWidth:o,outputHeight:l}=e,c=new s.Matrix4,d=[-(i[0]/t-.5),i[1]/r-.5];return c.translateSelf(...d),c.translateSelf(-.5,-.5),c.scaleSelf(o/a,l/n),c.translateSelf(.5,.5),c}(o,r,n);return{transformMatrix:l,samplingMatrix:c}}},937:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.PartType=void 0;const i=r(6030),a=r(9856),s=r(6925),n=r(996);var o;!function(e){e[e.Node=0]="Node",e[e.Attr=1]="Attr",e[e.MayAttr=2]="MayAttr",e[e.Property=3]="Property",e[e.Event=4]="Event",e[e.FixedBinging=5]="FixedBinging",e[e.Binding=6]="Binding"}(o=t.PartType||(t.PartType={}));const l=new Map;function c(e){let t=document.createElement("template");return t.innerHTML=e,t}t.parse=function(e,t,r){let a=r?r.localName:"global";if("html"===e||"svg"===e){let n=i.joinWithOrderedMarkers(t),o=l.get(a),c=o?o.get(n):null;return c||(o||(o=new Map,l.set(a,o)),c=new d(e,n,a).parse(),o.set(n,c)),function(e,t){let{template:r,places:i,hasSlots:a,attributes:n}=e,o=r.content.cloneNode(!0),l=[];if(n){if(!t)throw new Error("A context must be provided when rendering `<template>...`");s.cloneAttributes(t,n)}if(i.length>0){let e,r=0,a=0,s=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,null),c=!1;if(n){for(;a<i.length&&0===i[a].nodeIndex;)l.push(t),a++;r=1}if(a<i.length)for(;e=s.nextNode();){for(;i[a].nodeIndex===r;)if(l.push(e),a++,a===i.length){c=!0;break}if(c)break;r++}}return{fragment:o,nodesInPlaces:l,places:i,hasSlots:a}}(c,r)}if("css"===e)return{fragment:c(`<style>${t[0]}</style>`).content,nodesInPlaces:null,places:null,hasSlots:!1};{let e=t[0],r=document.createDocumentFragment();return r.append(document.createTextNode(e)),{fragment:r,nodesInPlaces:null,places:null,hasSlots:!1}}};class d{constructor(e,t,r){this.nodeIndex=0,this.places=[],this.nodeIndexs=[],this.type=e,this.string=t,this.scopeName=r,this.scopedClassNameSet=a.getScopedClassNameSet(this.scopeName)}parse(){let e=n.parseToHTMLTokens(this.string),t="",r=!1;for(let i of e)switch(i.type){case n.HTMLTokenType.StartTag:let e=i.tagName,a=i.attributes;"slot"===e&&(r=!0),a.length>=9&&(a=this.parseAttribute(a)),t+="<"+e+a+">",this.nodeIndex++;break;case n.HTMLTokenType.EndTag:t+=`</${i.tagName}>`;break;case n.HTMLTokenType.Text:t+=this.parseText(i.text)}let i=e.find((e=>e.type===n.HTMLTokenType.StartTag)),a=!1;i&&"svg"===this.type&&"svg"!==i.tagName&&(t="<svg>"+t+"</svg>",a=!0);let s=c(t),o=null;if(a){let e=s.content.firstElementChild;s.content.append(...e.childNodes),e.remove()}return i&&"template"===i.tagName&&(s=s.content.firstElementChild,o=[...s.attributes].map((({name:e,value:t})=>({name:e,value:t})))),{template:s,places:this.places,hasSlots:r,attributes:o}}parseText(e){if(!e)return e;if(i.containsOrderedMarker(e)){let{strings:t,valueIndexes:r}=i.splitByOrderedMarkers(e);for(let e=1;e<t.length;e++)this.places.push({type:o.Node,name:null,strings:null,valueIndexes:r.slice(e-1,e),nodeIndex:this.nodeIndex}),this.nodeIndexs.push(this.nodeIndex),this.nodeIndex+=1;e=t.map(s.trim).join("\x3c!---\x3e")}return e}parseAttribute(e){return e.replace(/([.:?@\w-]+)\s*(?:=\s*(".*?"|'.*?'|\{flit:\d+\})\s*)?|\{flit:(\d+)\}\s*/g,((e,t,r="",a)=>{if(a)return this.places.push({type:o.Binding,name:null,strings:null,valueIndexes:[Number(a)],nodeIndex:this.nodeIndex}),this.nodeIndexs.push(this.nodeIndex),"";let s,n=i.containsOrderedMarker(r);switch(t[0]){case".":s=o.Property;break;case":":s=o.FixedBinging;break;case"?":s=o.MayAttr;break;case"@":s=o.Event}if(void 0!==s&&(t=t.slice(1)),void 0===s&&n&&(s="class"===t?o.FixedBinging:o.Attr),void 0!==s){if("'"!==r[0]&&'"'!==r[0]||(r=r.slice(1,-1)),n){let{strings:e,valueIndexes:a}=i.parseOrderedMarkers(r);this.places.push({type:s,name:t,strings:e,valueIndexes:a,nodeIndex:this.nodeIndex})}else this.places.push({type:s,name:t,strings:[r],valueIndexes:null,nodeIndex:this.nodeIndex});return this.nodeIndexs.push(this.nodeIndex),s===o.Attr?t+'="" ':""}return"class"===t&&this.scopedClassNameSet?(r=r.replace(/[\w-]+/g,(e=>this.scopedClassNameSet.has(e)?e+"__"+this.scopeName:e)),t+"="+r):e}))}}},967:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateComponents=t.onComponentDisconnected=t.onComponentConnected=t.emitComponentCreatedCallbacks=t.onComponentCreatedAt=void 0;const i=r(7860),a=new WeakMap;t.onComponentCreatedAt=function(e,t){let r=a.get(e);r||a.set(e,r=[]),r.push(t)},t.emitComponentCreatedCallbacks=function(e,t){let r=a.get(e);if(r){for(let e of r)e(t);a.delete(e)}};const s=new Set;t.onComponentConnected=function(e){s.add(e)},t.onComponentDisconnected=function(e){s.delete(e)},t.updateComponents=function(){i.globalWatcherGroup.update();for(let e of s)e.update(),e.__updateWatcherGroup()}},972:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Form=void 0;const a=r(1416);let s=class extends a.Component{constructor(){super(...arguments),this.valid=!0,this.inputs=[]}static style(){return a.css`
		:host{
			display: block;
		}
		`}register(e){this.inputs.push(e),this.valid=this.valid&&!1!==e.valid,e.on("change",this.onInputChange,this)}onInputChange(e,t){t!==this.valid&&(this.valid=!!t&&this.inputs.every((e=>e.valid)))}validate(){for(let e of this.inputs)e.setTouched(!0)}reset(){for(let e of this.inputs)e.setTouched(!1)}};s=i([a.define("f-form")],s),t.Form=s},996:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.joinHTMLTokens=t.parseToHTMLTokens=t.HTMLTokenType=void 0;const i=r(6925);var a;!function(e){e[e.StartTag=0]="StartTag",e[e.EndTag=1]="EndTag",e[e.Text=2]="Text"}(a=t.HTMLTokenType||(t.HTMLTokenType={}));const s=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];t.parseToHTMLTokens=function(e){const t=/<!--[\s\S]*?-->|<([\w-]+)([\s\S]*?)\/?>|<\/[\w-]+>/g;let r,n=0,o=[];for(;r=t.exec(e);){let l=r[0];if(r.index>n){let t=i.trim(e.slice(n,r.index));t&&o.push({type:a.Text,text:t})}if(n=t.lastIndex,"!"!==l[1])if("/"===l[1]){let e=l.slice(2,-1);s.includes(e)||o.push({type:a.EndTag,tagName:e})}else{let e=r[1],t=r[2],i=s.includes(e);o.push({type:a.StartTag,tagName:e,attributes:t,selfClose:i}),"/"!==l[l.length-2]||i||o.push({type:a.EndTag,tagName:e})}}return n<e.length&&i.trim(e.slice(n))&&o.push({type:a.Text,text:e.slice(n)}),o},t.joinHTMLTokens=function(e){let t="";for(let r of e)switch(r.type){case a.StartTag:t+="<"+r.tagName+r.attributes+">";break;case a.EndTag:t+=`</${r.tagName}>`;break;case a.Text:t+=r.text}return t}},1007:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDrawImageVideo=void 0;const i=r(2824),a=r(2298),s=r(4452),n=r(1484),o=r(2440);class l extends o.ToDrawTransform{setSubMedia(e,t){let r=this.getSubSampler("iChannel",e);if(r)r.updateData(t);else{r=new i.PixelSampler(this.sw,t);let a=new n.MappedSampler(r);this.setSubMappedChannel(e,a)}}extractMappedSampler(){if(this.transformStatus.is3DProjection())return null;let e=this.mappedSamplers[0],{sampler:t}=e,r=this.getTextureMappedMatrix();return new n.MappedSampler(t,r)}getTextureMappedMatrix(){let{width:e,height:t}=this.renderer.project.data,r=this.transformStatus.transformMatrix,i=this.transformStatus.samplingMatrix,n=this.coords.map((e=>e.slice(0,2))),o=this.textureCoords,l=new a.Matrix4(1/e,0,0,0,0,-1/t,0,1,0,0,1,0,0,0,0,1),c=n.slice(0,3).map((e=>new s.Vector3(...e,1))),d=o.slice(0,3).map((e=>new s.Vector3(...e,1))),h=a.Matrix3.fromVectors(...c),u=a.Matrix3.fromVectors(...d),p=a.Matrix4.fromMatrix3(u.multiply(h.inverse()));return i.multiply(p).multiply(l.multiply(r).inverse())}}t.ToDrawImageVideo=l},1008:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"wipeBlurRate",desc:"Wipe Blur Rate",min:0,max:1,step:.01,value:0}];(0,r(4062).extendTransitions)({"wipe-left":{uniformSlides:i,uniformValues:{directionAngle:-180},steps:[{fragShaderName:"wipe"}]},"wipe-right":{uniformSlides:i,uniformValues:{directionAngle:180},steps:[{fragShaderName:"wipe"}]},"wipe-top":{uniformSlides:i,uniformValues:{directionAngle:90},steps:[{fragShaderName:"wipe"}]},"wipe-bottom":{uniformSlides:i,uniformValues:{directionAngle:-90},steps:[{fragShaderName:"wipe"}]}})},1047:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform int channel;\nuniform float inputBlack;\nuniform float inputWhite;\nuniform float gamma;\nuniform float outputBlack;\nuniform float outputWhite;\nfloat adjustChannel(float c) {\nc = (c - inputBlack) / (inputWhite - inputBlack);\nc = pow(c, 1.0 / gamma);\nc = (c - outputBlack) / (outputWhite - outputBlack);\nreturn c;\n}\nvec4 getFragColor() {\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord);\nswitch (channel) {\ncase 1:\ncolor.r = adjustChannel(color.r);\ncolor.g = adjustChannel(color.g);\ncolor.b = adjustChannel(color.b);\nbreak;\ncase 2:\ncolor.r = adjustChannel(color.r);\nbreak;\ncase 3:\ncolor.g = adjustChannel(color.g);\nbreak;\ncase 4:\ncolor.b = adjustChannel(color.b);\nbreak;\ncase 5:\ncolor.a = adjustChannel(color.a);\nbreak;\n}\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},1078:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clearTransition=t.Transition=t.formatShortTransitionOptions=t.defineTransion=t.getEasing=void 0;const i=r(8948),a=r(8135),s="ease-out",n={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-quad":[.55,.085,.68,.53],"ease-in-cubic":[.55,.055,.675,.19],"ease-in-quart":[.895,.03,.685,.22],"ease-in-quint":[.755,.05,.855,.06],"ease-in-sine":[.47,0,.745,.715],"ease-in-expo":[.95,.05,.795,.035],"ease-in-circ":[.6,.04,.98,.335],"ease-in-back":[.6,-.28,.735,.045],"ease-out-quad":[.25,.46,.45,.94],"ease-out-cubic":[.215,.61,.355,1],"ease-out-quart":[.165,.84,.44,1],"ease-out-quint":[.23,1,.32,1],"ease-out-sine":[.39,.575,.565,1],"ease-out-expo":[.19,1,.22,1],"ease-out-circ":[.075,.82,.165,1],"ease-out-back":[.175,.885,.32,1.275],"ease-in-out-quad":[.455,.03,.515,.955],"ease-in-out-cubic":[.645,.045,.355,1],"ease-in-out-quart":[.77,0,.175,1],"ease-in-out-quint":[.86,0,.07,1],"ease-in-out-sine":[.445,.05,.55,.95],"ease-in-out-expo":[1,0,0,1],"ease-in-out-circ":[.785,.135,.15,.86],"ease-in-out-back":[.68,-.55,.265,1.55]};function o(e){return n.hasOwnProperty(e)?"cubic-bezier("+n[e].join(", ")+")":"linear"}t.getEasing=o;const l=new WeakMap,c=new Map;t.defineTransion=function(e,t){c.has(e)&&console.warn(`You are trying to overwrite transition definition "${e}"`),d.hasOwnProperty(e)&&console.warn(`"${e}" is an available CSS property, you may confuse them when using short transition`),c.set(e,t)};const d={width:!0,height:!0,opacity:!0,margin:!0,marginLeft:!0,marginRght:!0,marginTop:!0,marginBottom:!0,padding:!0,paddingLeft:!0,paddingRght:!0,paddingTop:!0,paddingBottom:!0,borderWidth:!0,borderLeftWidth:!0,borderRightWidth:!0,borderTopWidth:!0,borderBottomWidth:!0,transform:!0};function h(e){return Array.isArray(e)?{properties:e}:"string"==typeof e?d.hasOwnProperty(e)?{properties:[e]}:{name:e}:e}function u(e){l.has(e)&&l.get(e).clean()}function p(e,t,r,i,a){if(!e.animate)return{promise:Promise.resolve(!1),cancel:()=>{}};let s=o(a),n=e.animate([t,r],{easing:s,duration:i});return{promise:new Promise((e=>{n.addEventListener("finish",(()=>{e(!0)}),!1),n.addEventListener("cancel",(()=>{e(!1)}),!1)})),cancel:function(){n.cancel()}}}t.formatShortTransitionOptions=h,t.Transition=class{constructor(e,t){this.cleaner=null,this.el=e,this.options=h(t),u(this.el),l.set(this.el,this)}enter(){return new Promise((e=>{this.clean();let t=this.options.direction;if("enter"!==t&&"both"!==t&&void 0!==t)return void e(!0);let r=t=>{l.delete(this.el),e(t)};this.options.properties?this.cssEnter(r):c.has(name)?this.jsEnter(r):this.classEnterOrLeave("enter",r)}))}leave(){return new Promise((e=>{this.clean();let t=this.options.direction;if("leave"!==t&&"both"!==t&&void 0!==t)return void e(!0);let r=this.el,i=t=>{r.style.pointerEvents="",l.delete(this.el),e(t)};r.style.pointerEvents="none",this.options.properties?this.cssLeave(i):c.has(name)?this.jsLeave(i):this.classEnterOrLeave("leave",i)}))}cssEnter(e){let t={};for(let e of this.options.properties)t[e]="transform"===e?"none":"0";let{promise:r,cancel:i}=function(e,t,r,i){let a={},s=getComputedStyle(e);for(let e in t)a[e]=s[e]||m[e]||"0";return p(e,t,a,r,i)}(this.el,t,this.options.duration||200,this.options.easing||s);r.then(e),this.cleaner=i}cssLeave(e){let t={};for(let e of this.options.properties)t[e]="transform"===e?"none":"0";let{promise:r,cancel:i}=function(e,t,r,i){let a={},s=getComputedStyle(e);for(let e in t)a[e]=s[e]||m[e]||"0";return p(e,a,t,r,i)}(this.el,t,this.options.duration||200,this.options.easing||s);r.then(e),this.cleaner=i}jsEnter(e){let t=this.getJSTransitionInstance();t.enter?(t.enter.then(e),this.cleaner=t.clean.bind(t)):e(!0)}jsLeave(e){let t=this.getJSTransitionInstance();t.leave?(t.leave.then(e),this.cleaner=t.clean.bind(t)):e(!0)}getJSTransitionInstance(){return new(c.get(this.options.name))(this.el,{duration:this.options.duration||200,easing:this.options.easing||s})}async classEnterOrLeave(e,t){let r=this.options.name+"-"+e,i=this.options.duration,s=this.options.easing,n=!1,l=this.el;i&&(l.style.transitionDuration=String(i/1e3)+"s"),s&&(l.style.transitionTimingFunction=o(s)),l.style.transition="none",l.classList.add(r,r+"-from"),this.cleaner=()=>{n=!0},a.onRenderComplete((()=>{requestAnimationFrame((()=>{n?l.classList.remove(r,r+"-from"):(i&&(l.style.transitionDuration=""),s&&(l.style.transitionTimingFunction=""),l.style.transition="",l.classList.remove(r+"-from"),l.classList.add(r+"-to"),this.onceTransitionEnd((e=>{l.classList.remove(r,r+"-to"),t(e)})))}))}))}onceTransitionEnd(e){let t=this.el,r=getComputedStyle(t),a=parseFloat(r.transitionDuration)||0,s=parseFloat(r.animationDuration)||0,n=a>0?"transitionend":"animationend",o=()=>{clearTimeout(l),t.style.pointerEvents="",e(!0)},l=setTimeout((()=>{i.off(t,n,o),t.style.pointerEvents="",e(!0)}),1e3*(a||s)+50);i.once(t,n,o),this.cleaner=()=>{clearTimeout(l),i.off(t,n,o),e(!1)}}clean(){this.cleaner&&(this.cleaner(),this.cleaner=null)}},t.clearTransition=u;const m={transform:"none"}},1118:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBlobURL=t.isRelativePath=t.isAbsolutePath=t.getPathExtension=t.getPathParent=t.getPathBaseName=t.getPathName=t.getFilefromURL=t.readBlobAsArrayBuffer=void 0;const i=r(5499);function a(e){return(0,i.firstMatch)(e,/([^\\\/]+)$/)}function s(e){return/^\w+:|^\/\//.test(e)}t.readBlobAsArrayBuffer=function(e){return new Promise(((t,r)=>{var i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=()=>{r(i.error)},i.readAsArrayBuffer(e)}))},t.getFilefromURL=async function(e){let t=await(await fetch(e)).blob(),r=a(e)||"unknown";return new File([t],r)},t.getPathName=a,t.getPathBaseName=function(e){return a(e).replace(/\.(\w+)$/,"")},t.getPathParent=function(e){return e.replace(/[\\\/]([^\\\/]+)$/,"")},t.getPathExtension=function(e){return(0,i.firstMatch)(e,/\.(\w+)$/).toLowerCase()},t.isAbsolutePath=s,t.isRelativePath=function(e){return!s(e)},t.isBlobURL=function(e){return/^blob:/.test(e)}},1126:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderProgramManager=t.ShaderProgram=void 0;const i=r(5499);class a{manager;vertCode;fragCode;webglProgram;context;uniformLocations={};uniformValues={};activated=!1;usedCount=0;constructor(e,t,r){this.manager=e,this.context=e.context,this.vertCode=t,this.fragCode=r,this.webglProgram=this.createProgram(),this.matchUniformLocations()}createProgram(){let e=this.initShader(this.vertCode,this.context.VERTEX_SHADER),t=this.initShader(this.fragCode,this.context.FRAGMENT_SHADER),r=this.context.createProgram();if(!r)throw new Error("Failed to create shader program!");if(this.context.attachShader(r,e),this.context.attachShader(r,t),this.context.linkProgram(r),!this.context.getProgramParameter(r,this.context.LINK_STATUS))throw this.context.getProgramInfoLog(r);return r}initShader(e,t){let r=this.context.createShader(t);if(!r)throw this.context.getError();return this.context.shaderSource(r,e),this.context.compileShader(r),this.context.getShaderParameter(r,this.context.COMPILE_STATUS)||this.reportCompileError(e,r),r}reportCompileError(e,t){let r=this.context.getShaderInfoLog(t),a=Number((0,i.firstMatch)(r,/0:(\d+)/));if(a)throw'"'+e.split(/\r?\n/)[a-1].trim()+'"\n'+r;throw r}matchUniformLocations(){this.matchUniformLocationsFromCode(this.vertCode),this.matchUniformLocationsFromCode(this.fragCode)}matchUniformLocationsFromCode(e){let t=(0,i.subMatches)(e,/uniform\s+(\w+)\s+(\w+)/g);for(let[e,r]of t){let t=this.context.getUniformLocation(this.webglProgram,r);t&&(this.uniformLocations[r]={type:e,location:t})}}active(){this.context.useProgram(this.webglProgram),this.activated=!0}deactive(){this.activated=!1}use(){this.usedCount++}unuse(){this.usedCount--,this.usedCount<=0&&setTimeout((()=>{this.usedCount<=0&&this.manager.delete(this)}),0)}getUniformLocation(e){return this.uniformLocations[e]?this.uniformLocations[e].location:null}hasUniform(e){return!!this.uniformLocations[e]}syncUniform(e){if(!this.activated)throw new Error("Shader must be in use when syncing uniform values");for(let[t,r]of Object.entries(e))this.uniformLocations[t]&&!(0,i.deepEqual)(this.uniformValues[t],r)&&this.doSettingUniformValue(t,r)}doSettingUniformValue(e,t){let{type:r,location:i}=this.uniformLocations[e];switch(["number","boolean"].includes(typeof t)&&(t=[t]),r){case"float":case"double":this.context.uniform1fv(i,t);break;case"int":case"bool":case"sampler2D":this.context.uniform1iv(i,t);break;case"uint":this.context.uniform1uiv(i,t);break;case"vec2":case"dvec2":this.context.uniform2fv(i,t);break;case"ivec2":case"bvec2":this.context.uniform2iv(i,t);break;case"uvec2":this.context.uniform2uiv(i,t);break;case"vec3":case"dvec3":this.context.uniform3fv(i,t);break;case"ivec3":case"bvec3":this.context.uniform3iv(i,t);break;case"uvec3":this.context.uniform3uiv(i,t);break;case"vec4":case"dvec4":this.context.uniform4fv(i,t);break;case"ivec4":case"bvec4":this.context.uniform4iv(i,t);break;case"uvec4":this.context.uniform4uiv(i,t);break;case"mat2":this.context.uniformMatrix2fv(i,!1,t);break;case"mat3":this.context.uniformMatrix3fv(i,!1,t);break;case"mat4":this.context.uniformMatrix4fv(i,!1,t);break;default:throw`Unmapped uniform data type "${r}"`}this.uniformValues[e]=t}getAttributeLocation(e){return this.context.getAttribLocation(this.webglProgram,e)}}t.ShaderProgram=a,t.ShaderProgramManager=class{context;map={};constructor(e){this.context=e}create(e,t){let r=this.map[e]?this.map[e][t]:void 0;return r||(r=new a(this,e,t),this.map[e]=this.map[e]||{},this.map[e][t]=r),r.use(),r}delete(e){this.context.deleteProgram(e.webglProgram),delete this.map[e.vertCode][e.fragCode]}}},1146:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.watchLayoutUntil=t.watchLayoutOnce=t.watchLayout=void 0;const i=r(5992),a=r(757),s={show:e=>e.offsetWidth>0||e.offsetHeight>0,hide:e=>0===e.offsetWidth&&0===e.offsetHeight,inview:e=>i.isInViewport(e),outview:e=>!i.isInViewport(e),size:e=>({width:e.clientWidth,height:e.clientHeight}),rect:e=>i.getRect(e)};function n(e,t,r,i,n){let o,l=s[i],c=null,d=null;if(!l)throw new Error(`Failed to watch, type "${i}" is not supported`);if(t&&(o=l(r),o&&t&&n(o)),t&&o)return u;function h(r){(function(e,t){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||!e||!t)return!1;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let i of r){if(!t.hasOwnProperty(i))return!1;if(e[i]!==t[i])return!1}return!0})(r,o)||(n(o=r),(e||t&&r)&&u())}function u(){c?c.cancel():d&&d.unobserve(r)}return"size"===i&&"function"==typeof window.ResizeObserver?(d=new window.ResizeObserver((function(e){for(let{contentRect:t}of e)h({width:t.width,height:t.height})})),d.observe(r)):"inview"!==i&&"outview"!==i||"function"!=typeof IntersectionObserver?(o=l(r),c=new a.Interval((()=>{h(l(r))}),200)):(d=new IntersectionObserver((function(e){for(let{intersectionRatio:t}of e)h("inview"===i?t>0:0===t)})),d.observe(r)),u}t.watchLayout=function(e,t,r){return n(!1,!1,e,t,r)},t.watchLayoutOnce=function(e,t,r){return n(!0,!1,e,t,r)},t.watchLayoutUntil=function(e,t,r){return n(!0,!0,e,t,r)}},1149:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Vertices=void 0;const i=r(7678),a=r(5499);var s;!function(e){e[e.Float=WebGL2RenderingContext.prototype.FLOAT]="Float",e[e.Int=WebGL2RenderingContext.prototype.INT]="Int"}(s||(s={}));class n extends a.Emitter{id=(0,i.generateUniqueID)();drawCount;hasIndices=!1;context;vao;deleteAfterNoReference=!0;records={};vertexCount;counter;constructor(e,t,r,i){super(),this.context=e.context,this.counter=e.verticesReferenceCounter,this.vertexCount=r,this.vao=this.context.createVertexArray(),this.context.bindVertexArray(this.vao);for(let e of Object.keys(t))this.bufferData(e,t[e]);i&&this.setIndicesOnVAOActivated(i),this.drawCount=i?i.length:r}bufferData(e,t){let r=Array.isArray(t)?new Float32Array(t):t,i=this.context.createBuffer();this.createDataRecord(e,r,i),this.context.bindBuffer(this.context.ARRAY_BUFFER,i),this.context.bufferData(this.context.ARRAY_BUFFER,r,this.context.STATIC_DRAW)}createDataRecord(e,t,r){if(t.length%this.vertexCount!=0)throw new Error("Data count must exactly divide vertex count");let i=t.length/this.vertexCount,a=t.BYTES_PER_ELEMENT,n=t instanceof Float64Array||t instanceof Float32Array?s.Float:s.Int;this.records[e]={type:n,buffer:r,size:i,bytesPerElement:a}}setIndices(e){this.active(),e?this.setIndicesOnVAOActivated(e):(this.context.bindBuffer(this.context.ELEMENT_ARRAY_BUFFER,null),this.hasIndices=!1)}setIndicesOnVAOActivated(e){let t=this.context.createBuffer(),r=new Uint16Array(e);this.context.bindBuffer(this.context.ELEMENT_ARRAY_BUFFER,t),this.context.bufferData(this.context.ELEMENT_ARRAY_BUFFER,r,this.context.STATIC_DRAW),this.hasIndices=!0}updateData(e){this.active();for(let t of Object.keys(e)){let r=e[t],i=Array.isArray(r)?new Float32Array(r):r,a=this.records[t];if(!a)throw new Error(`Vertex data "${t}" must be set when initializing`);this.context.bindBuffer(this.context.ARRAY_BUFFER,a.buffer),this.context.bufferSubData(this.context.ARRAY_BUFFER,0,i)}}__useBy(e){this.active();for(let t of Object.keys(this.records)){let{type:r,size:i,buffer:a,bytesPerElement:s}=this.records[t],n=e.program.getAttributeLocation(t);if(this.context.bindBuffer(this.context.ARRAY_BUFFER,a),i>4){let e=i/4,t=i*s;for(let i=0;i<e;i++)this.context.enableVertexAttribArray(n+i),this.context.vertexAttribPointer(n+i,4,r,!1,t,4*i*s)}else this.context.enableVertexAttribArray(n),this.context.vertexAttribPointer(n,i,r,!1,0,0)}this.counter.use(this,e)}active(){if(!this.vao)throw new Error(`Vertex data ${this.id} has been deleted!`);this.context.bindVertexArray(this.vao)}inUse(){return this.counter.isUsing(this)}__unuse(e){this.counter.unuse(this,e)}__onNoReference(){this.emit("noreference")}__onNoReferenceForSeconds(){this.deleteAfterNoReference&&this.delete()}__onNoTouchForSeconds(e){console.warn(`Vertices "${this.id}" has no reference for ${e} seconds after created`)}delete(){this.context.deleteVertexArray(this.vao),this.vao=null}}t.Vertices=n},1221:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Layer=void 0;const i=r(7928),a=r(9658);class s extends a.Drawer{ready;activated=!1;constructor(e,t){super(e,t),this.ready=Promise.resolve().then((()=>this.initialize())),i.debug.verbose(`${this.constructor.name} ${this.data.id} created`)}active(){this.activated||(this.activated=!0)}deactive(){this.activated&&(this.activated=!1)}async syncTime(e){}delete(){this.deactive(),i.debug.verbose(`${this.constructor.name} ${this.data.id} deleted`)}}t.Layer=s},1235:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(3481),s=r(2824);(0,i.extendTransitions)({"face-transform":{sourceParams:{filter:s.SamplerFilter.MipmapLinear},targetParams:{filter:s.SamplerFilter.MipmapLinear},steps:[{useTexture:i.TextureReference.Source,drawType:a.ToDrawType.Triangles,vertShaderName:"face-transform-source"},{useTexture:i.TextureReference.Target,drawType:a.ToDrawType.Triangles,vertShaderName:"face-transform-target"},{useTexture:i.TextureReference.None,fragShaderName:"face-transform-target"}]}})},1255:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0});var s=r(356);Object.defineProperty(t,"defineBinding",{enumerable:!0,get:function(){return s.defineBinding}}),Object.defineProperty(t,"BindingResult",{enumerable:!0,get:function(){return s.BindingResult}}),Object.defineProperty(t,"createBindingFromResult",{enumerable:!0,get:function(){return s.createBindingFromResult}}),Object.defineProperty(t,"refBinding",{enumerable:!0,get:function(){return s.refBinding}}),r(267),r(2378),r(9154),r(3554),r(4554),r(557),r(5525),r(8759),a(r(8759),t)},1305:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompositeLayer=void 0;const i=r(7818),a=r(2440);class s extends i.PixelLayer{async initialize(){await super.initialize(),this.toDraw=new a.ToDrawTransform({renderer:this.renderer})}setToDrawTransformStatus(e){this.toDraw.setTransformStatus(e.cloneOpacity())}}t.CompositeLayer=s},1324:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateList=void 0;const i=r(3863);var a;!function(e){let t,r,a="aegl";e.configDirectory=function(e){a=e},e.get=async function(){return r||(r=async function(){let e=(0,i.addTimestamp)(`${a}/templates/list.json`);t=await(await fetch(e)).json()}()),await r,t}}(a||(t.TemplateList=a={}))},1326:(e,t)=>{async function r(e){return await(await fetch(e,{mode:"cors"})).blob()}Object.defineProperty(t,"__esModule",{value:!0}),t.loadStyle=t.loadScript=t.preloadAudio=t.preloadVideo=t.preloadImage=void 0,t.preloadImage=async function(e){return new Promise((async(t,i)=>{let a=await r(e),s=new Image;s.src=URL.createObjectURL(a),s.onload=()=>t(s),s.onerror=e=>i(e)}))},t.preloadVideo=function(e){return new Promise((async(t,i)=>{let a=await r(e),s=document.createElement("video");s.preload="auto",s.oncanplaythrough=()=>t(s),s.onerror=e=>i(e),s.src=URL.createObjectURL(a),setTimeout((()=>{t(s)}),1e3)}))},t.preloadAudio=function(e){return new Promise((async(t,i)=>{let a=await r(e),s=document.createElement("audio");s.preload="auto",s.oncanplaythrough=()=>t(s),s.onerror=e=>i(e),s.src=URL.createObjectURL(a),setTimeout((()=>{t(s)}),1e3)}))},t.loadScript=function(e){return new Promise(((t,r)=>{let i=document.createElement("script");i.async=!1,i.src=e,document.head.append(i),i.addEventListener("load",(()=>t())),i.addEventListener("error",(()=>r()))}))},t.loadStyle=function(e){return new Promise(((t,r)=>{let i=document.createElement("link");i.rel="stylesheet",i.href=e,document.head.append(i),i.addEventListener("load",(()=>t())),i.addEventListener("error",(()=>r()))}))}},1382:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DropShadowEffect=void 0;const i=r(6376),a=r(5305),s=r(8341),n=r(6339),o=r(1830),l=r(555),c=r(2298),d=r(5468),h=r(623),u=r(62),p=r(4452);class m extends s.Effect{toBlendShadow;shadowTranslateMatrix;async initialize(){this.toBlendShadow=new n.ToDrawEffect({renderer:this.renderer,fragCode:h.default}),this.toBlendShadow.setUniform("fillOpacity",1!==this.data.shadowOnly?1:0);let e=this.renderer.project.options.dropShadowRenderingIterateCount,t=4*(this.data.softness?(0,i.getMaxPropertyValue)(this.data.softness)/2:0)*this.renderer.scaleRatio;this.toDraw=new d.ToDrawDropShadow({renderer:this.renderer,iterateCount:e,samplingCount:t})}setMappedChannel(e){this.toBlendShadow.setMappedChannel(e),this.toDraw.setMappedChannel(e)}clearChannel(){this.toDraw.clearChannel()}update(){super.update();let e=(0,i.getPropertyValues)(this.data,this.time,a.EffectDropShadowDefaultValues),{width:t,height:r}=this.renderer.project.data,{distance:s,direction:n}=e,o=this.transformStatus.projectVector(p.Vector2.fromAngle(n-90).multiplyScalarSelf(s)),d=(new c.Matrix4).translateSelf(o.x,o.y),h=e.opacity/100*this.transformStatus.opacity,m=new l.TransformStatus(t,r,d,h);this.shadowTranslateMatrix=d,this.toDraw.setTransformStatus(m);let f=this.transformStatus.projectVector(new p.Vector2(e.softness/2,e.softness/2));this.toDraw.setBlurRadius(f),this.toDraw.setUniform("shadowColor",(0,u.premultiplyColorArray)(e.shadowColor))}setMaskArea(e){this.toBlendShadow.setMaskArea(e),this.toDraw.setMaskArea(e)}draw(e){this.toDraw.setInputPaintArea(e);let t=this.toDraw.drawAsSampler(),r=o.PaintArea.union([this.toDraw.getPaintArea(),e]);return this.toBlendShadow.setInputPaintArea(r),this.toBlendShadow.setSubMappedChannel(1,t),this.toBlendShadow.draw(),this.toBlendShadow.clearChannel(),r}delete(){super.delete(),this.toBlendShadow.delete()}}t.DropShadowEffect=m},1404:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useQuery=t.parseQuery=void 0,t.parseQuery=function(e){let t=e.match(/\?(.+)/),r=t?t[1].split("&"):[],i={};for(let e of r){let[t,r]=e.split("=");t&&(r=decodeURIComponent(r||""),i[t]=r)}return i},t.useQuery=function(e,t){let r=e.includes("?");if("string"==typeof t)return e+(r?"&":"?")+t;if(t&&"object"==typeof t)for(let i in t)e+=(r?"&":"?")+i+"="+encodeURIComponent(t[i]),r=!0;return e}},1413:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(2824),s=r(2298);(0,i.extendTransitions)({"alternate-from-left":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(4*-e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(4*(e-1))}]},"alternate-from-right":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(4*e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(4*(1-e))}]},"alternate-from-top":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(0,4*e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(0,4*(1-e))}]},"alternate-from-bottom":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(0,4*-e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(0,4*(e-1))}]}})},1416:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(294);Object.defineProperty(t,"ObservedBaseClass",{enumerable:!0,get:function(){return i.ObservedBaseClass}}),Object.defineProperty(t,"ObservedEmitter",{enumerable:!0,get:function(){return i.ObservedEmitter}});var a=r(2662);Object.defineProperty(t,"render",{enumerable:!0,get:function(){return a.render}}),Object.defineProperty(t,"renderComponent",{enumerable:!0,get:function(){return a.renderComponent}}),Object.defineProperty(t,"appendTo",{enumerable:!0,get:function(){return a.appendTo}});var s=r(4511);Object.defineProperty(t,"html",{enumerable:!0,get:function(){return s.html}}),Object.defineProperty(t,"css",{enumerable:!0,get:function(){return s.css}}),Object.defineProperty(t,"svg",{enumerable:!0,get:function(){return s.svg}}),Object.defineProperty(t,"TemplateResult",{enumerable:!0,get:function(){return s.TemplateResult}}),Object.defineProperty(t,"Template",{enumerable:!0,get:function(){return s.Template}});var n=r(9856);Object.defineProperty(t,"Component",{enumerable:!0,get:function(){return n.Component}}),Object.defineProperty(t,"define",{enumerable:!0,get:function(){return n.define}}),Object.defineProperty(t,"addGlobalStyle",{enumerable:!0,get:function(){return n.addGlobalStyle}}),Object.defineProperty(t,"updateStyles",{enumerable:!0,get:function(){return n.updateStyles}}),Object.defineProperty(t,"getComponent",{enumerable:!0,get:function(){return n.getComponent}}),Object.defineProperty(t,"getComponentAsync",{enumerable:!0,get:function(){return n.getComponentAsync}}),Object.defineProperty(t,"getClosestComponent",{enumerable:!0,get:function(){return n.getClosestComponent}}),Object.defineProperty(t,"updateComponents",{enumerable:!0,get:function(){return n.updateComponents}});var o=r(1255);Object.defineProperty(t,"defineBinding",{enumerable:!0,get:function(){return o.defineBinding}}),Object.defineProperty(t,"refBinding",{enumerable:!0,get:function(){return o.refBinding}}),Object.defineProperty(t,"BindingResult",{enumerable:!0,get:function(){return o.BindingResult}}),Object.defineProperty(t,"show",{enumerable:!0,get:function(){return o.show}}),Object.defineProperty(t,"hide",{enumerable:!0,get:function(){return o.hide}});var l=r(8948);Object.defineProperty(t,"on",{enumerable:!0,get:function(){return l.on}}),Object.defineProperty(t,"once",{enumerable:!0,get:function(){return l.once}}),Object.defineProperty(t,"off",{enumerable:!0,get:function(){return l.off}});var c=r(9395);Object.defineProperty(t,"observe",{enumerable:!0,get:function(){return c.observe}}),Object.defineProperty(t,"observeGetter",{enumerable:!0,get:function(){return c.observeGetter}}),Object.defineProperty(t,"getObservedTarget",{enumerable:!0,get:function(){return c.getObservedTarget}});var d=r(7860);Object.defineProperty(t,"watch",{enumerable:!0,get:function(){return d.watch}}),Object.defineProperty(t,"watchOnce",{enumerable:!0,get:function(){return d.watchOnce}}),Object.defineProperty(t,"watchUntil",{enumerable:!0,get:function(){return d.watchUntil}}),Object.defineProperty(t,"watchImmediately",{enumerable:!0,get:function(){return d.watchImmediately}}),Object.defineProperty(t,"Watcher",{enumerable:!0,get:function(){return d.Watcher}});var h=r(8135);Object.defineProperty(t,"onRenderComplete",{enumerable:!0,get:function(){return h.onRenderComplete}}),Object.defineProperty(t,"renderComplete",{enumerable:!0,get:function(){return h.renderComplete}});var u=r(2951);Object.defineProperty(t,"defineDirective",{enumerable:!0,get:function(){return u.defineDirective}}),Object.defineProperty(t,"refDirective",{enumerable:!0,get:function(){return u.refDirective}}),Object.defineProperty(t,"RepeatDirective",{enumerable:!0,get:function(){return u.RepeatDirective}}),Object.defineProperty(t,"PalyDirective",{enumerable:!0,get:function(){return u.PalyDirective}}),Object.defineProperty(t,"CacheDirective",{enumerable:!0,get:function(){return u.CacheDirective}}),Object.defineProperty(t,"DirectiveResult",{enumerable:!0,get:function(){return u.DirectiveResult}}),Object.defineProperty(t,"cache",{enumerable:!0,get:function(){return u.cache}}),Object.defineProperty(t,"play",{enumerable:!0,get:function(){return u.play}}),Object.defineProperty(t,"repeat",{enumerable:!0,get:function(){return u.repeat}}),Object.defineProperty(t,"liveRepeat",{enumerable:!0,get:function(){return u.liveRepeat}}),Object.defineProperty(t,"LiveRepeatDirective",{enumerable:!0,get:function(){return u.LiveRepeatDirective}}),Object.defineProperty(t,"liveAsyncRepeat",{enumerable:!0,get:function(){return u.liveAsyncRepeat}}),Object.defineProperty(t,"LiveAsyncRepeatDirective",{enumerable:!0,get:function(){return u.LiveAsyncRepeatDirective}});var p=r(1078);Object.defineProperty(t,"defineTransion",{enumerable:!0,get:function(){return p.defineTransion}}),Object.defineProperty(t,"getEasing",{enumerable:!0,get:function(){return p.getEasing}}),Object.defineProperty(t,"Transition",{enumerable:!0,get:function(){return p.Transition}}),Object.defineProperty(t,"clearTransition",{enumerable:!0,get:function(){return p.clearTransition}});var m=r(5055);Object.defineProperty(t,"Options",{enumerable:!0,get:function(){return m.Options}})},1429:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Popover=void 0;const a=r(1416),s=r(8240),n=r(9782);let o=class extends n.Popup{constructor(){super(...arguments),this.title="",this.closable=!1,this.defaultPopupOptions={alignPosition:"bc",fixTriangle:!0}}static style(){let{adjust:e,adjustFontSize:t,textColor:r}=s.theme;return a.css`
		:host{
			padding: ${e(8)}px ${e(16)}px;
			min-width: ${e(240)}px;
			max-width: ${e(400)}px;
		}

		.triangle{
			left: ${e(12)}px;
		}

		.header{
			display: flex;
			line-height: ${e(22)}px;
			height: ${e(28)+1}px;
			font-size: ${t(13)}px;
			padding-bottom: ${e(6)}px;
			border-bottom: 1px solid ${r.alpha(.8)};
			margin-bottom: ${e(8)}px;
		}

		.title{
			flex: 1;
			min-width: 0;
			font-weight: bold;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}

		.close{
			display: flex;
			width: ${e(28)}px;
			height: ${e(28)}px;
			margin-top: ${e(-6)}px;
			margin-right: ${e(-9)}px;
			cursor: pointer;

			&:active{
				transform: translateY(1px);
			}

			f-icon{
				margin: auto;
			}
		}

		.actions{
			margin-left: ${e(15)}px;

			button{
				margin-left: ${e(6)}px;
				height: ${e(22)}px;
				line-height: ${20}px;
				padding: 0 ${e(8)}px;
			}
		}

		.content{}
		`.extends(super.style())}render(){return a.html`
		<f-popup>	
			${this.renderHead()}
			<div class="content"><slot /></div>
		</f-popup>
		`.extends(super.render())}renderHead(){if(this.title){let e=this.closable&&!this.slots.action;return a.html`
			<div class="header">
				<div class="title">${this.title}</div>

				<div class="actions" :show=${this.slots.action}>
					<slot name="action" />
				</div>

				${e?a.html`
					<div class="close" @click=${this.close}>
						<f-icon .type="close" />
					</div>
				`:""}
			</div>
			`}return""}};o=i([a.define("f-popover")],o),t.Popover=o},1443:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeMap=void 0;const i=r(6376);class a{static fromLayer(e){let{timeRemap:t,inPoint:r,startTime:i}=e,s=[];return t?s.push(t):void 0!==i?0!==i&&s.push(-i):0!==r&&s.push(-r),new a(s)}maps=[];constructor(e=[]){this.maps=e}mergeInner(e){return new a([...this.maps,...e.maps])}mergeInnerLayer(e){let{timeRemap:t,inPoint:r,startTime:i}=e;return t?new a([...this.maps,t]):void 0!==i?0!==i?new a([...this.maps,-i]):this:0!==r?new a([...this.maps,-e.inPoint]):this}map(e){for(let t of this.maps)Array.isArray(t)?e=(0,i.getPropertyValue)(t,e):e+=t;return e}mapAllRange(e){let t=e;for(let e of this.maps)Array.isArray(e)?t=this.getTimeForAllRange(e,t):t+=e;return t}getTimeForAllRange(e,t){if(Array.isArray(e)){let r=e,i=r[0].time,a=r.length-1,s=r[a].time;if(t<i){let e=r[0],a=r[1],s=e.outEase?e.outEase[0].speed:(a.value-e.value)/(a.time-e.time);return e.value+(t-i)*s}if(t>s){let e=r[a-1],i=r[a],n=i.inEase?i.inEase[0].speed:(i.value-e.value)/(i.time-e.time);return i.value+(t-s)*n}}return(0,i.getPropertyValue)(e,t)}}t.TimeMap=a},1484:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MappedSampler=void 0;const i=r(2298);t.MappedSampler=class{sampler;mapMatrix;constructor(e,t=i.Matrix4.I){this.sampler=e,this.mapMatrix=t}release(){this.sampler.release()}}},1485:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.svgSymbols=void 0,t.svgSymbols={"checkbox-checked":'\n\t\t<svg viewBox="0 0 17 17">\n\t\t\t<path style="fill:currentColor; stroke:none;" d="M3.6,0h9.8c2,0,3.6,1.6,3.6,3.6v9.8c0,2-1.6,3.6-3.6,3.6H3.6c-2,0-3.6-1.6-3.6-3.6V3.6C0,1.6,1.6,0,3.6,0z"/>\n\t\t\t<polyline style="fill:none;stroke:#FFFFFF;" points="13.3,4.8 6.8,12.2 3.7,8.7"/>\n\t\t</svg>\n\t',"checkbox-indeterminate":'\n\t\t<svg viewBox="0 0 17 17">\n\t\t\t<path style="fill:currentColor; stroke:none;" d="M3.6,0h9.8c2,0,3.6,1.6,3.6,3.6v9.8c0,2-1.6,3.6-3.6,3.6H3.6c-2,0-3.6-1.6-3.6-3.6V3.6C0,1.6,1.6,0,3.6,0z"/>\n\t\t\t<path style="fill:none;stroke:#FFFFFF;stroke-linecap:square;" d="M4.4,8.5h8.1"/>\n\t\t</svg>\n\t',"checkbox-unchecked":'\n\t\t<svg viewBox="0 0 17 17">\n\t\t\t<path style="fill:none;stroke:currentColor;" d="M4.1,0.5H13c2,0,3.6,1.6,3.6,3.6V13c0,2-1.6,3.6-3.6,3.6H4.1c-2,0-3.6-1.6-3.6-3.6V4.1C0.5,2.1,2.1,0.5,4.1,0.5z"/>\n\t\t</svg>\n\t',checked:'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<polyline style="fill:none;stroke:currentColor;" points="12.5,3.4 5.7,11.6 2.5,7.8"/>\n\t\t</svg>\n\t',close:'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<path style="fill:currentColor; stroke:none;" d="M28.1,12.5c-0.2,0-0.4-0.2-0.4-0.4c0-0.1,0-0.2,0.1-0.3L37,1.7c0.2-0.2,0.4-0.2,0.6,0c0.2,0.2,0.2,0.4,0,0.7l-9.2,10C28.4,12.5,28.2,12.5,28.1,12.5z"/>\n\t\t\t<path style="fill:currentColor; stroke:none;" d="M37.3,12.5c-0.1,0-0.2,0-0.3-0.1L27.9,2.3c-0.1-0.2-0.1-0.4,0-0.6c0.2-0.2,0.4-0.2,0.6,0l9.2,10.1c0.2,0.2,0.2,0.4,0,0.7C37.5,12.4,37.5,12.5,37.3,12.5L37.3,12.5z"/>\n\t\t\t<line style="fill:none;stroke:currentColor;stroke-width:1.0526;" x1="12.5" y1="2.5" x2="2.5" y2="12.5"/>\n\t\t\t<line style="fill:none;stroke:currentColor;stroke-width:1.0526;" x1="12.5" y1="12.5" x2="2.5" y2="2.5"/>\n\t\t</svg>\n\t',confirm:'\n\t\t<svg viewBox="0 0 21 21">\n\t\t\t<rect style="fill:currentColor; stroke:none;" x="9.5" y="14.5" width="2" height="2"/>\n\t\t\t<path style="fill:currentColor; stroke:none;" d="M13.6,6.4c-0.1-0.4-0.3-0.7-0.6-1c-0.3-0.3-0.6-0.5-1-0.7c-0.5-0.2-1-0.3-1.5-0.3c-0.5,0-0.9,0.1-1.3,0.3C8.8,4.9,8.5,5.2,8.2,5.5C7.9,5.8,7.6,6.2,7.5,6.7C7.3,7.2,7.2,7.7,7.2,8.3h1.7c0-0.3,0.1-0.7,0.2-1C9.1,7,9.3,6.8,9.4,6.5c0.1-0.2,0.3-0.4,0.5-0.5c0.2-0.1,0.4-0.2,0.6-0.2c0.2,0,0.4,0,0.6,0.1c0.2,0.1,0.3,0.2,0.5,0.3c0.1,0.1,0.2,0.3,0.3,0.5C12,7,12,7.3,12,7.5C12,7.7,12,8,11.9,8.2c-0.1,0.2-0.3,0.4-0.5,0.6c-0.2,0.2-0.4,0.4-0.6,0.6c-0.2,0.2-0.4,0.4-0.6,0.6c-0.2,0.2-0.3,0.5-0.5,0.7c-0.1,0.3-0.2,0.6-0.2,0.9V12l0,0v1h2v-0.6l0,0v-0.7c0-0.3,0.1-0.5,0.2-0.8c0.1-0.2,0.3-0.4,0.4-0.6c0.2-0.2,0.3-0.4,0.6-0.6c0.2-0.2,0.4-0.4,0.6-0.6c0.2-0.2,0.3-0.5,0.4-0.7c0.1-0.3,0.2-0.6,0.2-0.9C13.8,7.1,13.7,6.7,13.6,6.4z"/>\n\t\t\t<circle style="fill:none;stroke:currentColor;" cx="10.5" cy="10.5" r="10"/>\n\t\t</svg>\n\t',down:'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<polygon style="fill:currentColor; stroke:none;" points="7.5,11 3.5,4.4 4.2,4 7.5,9.4 10.8,4 11.5,4.4"/>\n\t\t</svg>\n\t',error:'\n\t\t<svg viewBox="0 0 21 21">\n\t\t\t<circle style="fill:none;stroke:currentColor;" cx="10.5" cy="10.5" r="10"/>\n\t\t\t<line style="fill:none;stroke:currentColor;" x1="14.4" y1="6.6" x2="6.6" y2="14.4"/>\n\t\t\t<line style="fill:none;stroke:currentColor;" x1="14.4" y1="14.4" x2="6.6" y2="6.6"/>\n\t\t</svg>\n\t',info:'\n\t\t<svg viewBox="0 0 21 21">\n\t\t\t<rect style="fill:currentColor; stroke:none;" x="9.5" y="4" width="2" height="2"/>\n\t\t\t<polygon style="fill:currentColor; stroke:none;" points="11.5,9 11.5,8 9.5,8 8.5,8 8.5,9 9.5,9 9.5,16 8.5,16 8.5,17 9.5,17 11.5,17 12.5,17 12.5,16 11.5,16"/>\n\t\t\t<circle style="fill:none;stroke:currentColor;" cx="10.5" cy="10.5" r="10"/>\n\t\t</svg>\n\t',love:'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<path style="fill:none;stroke:currentColor;" d="M12.7,3.4c-1.1-1.1-2.8-1.1-3.8,0L7.5,4.7L6.1,3.4c-1.1-1.1-2.8-1.1-3.8,0c-1.1,1.1-1.1,2.8,0,3.8l1.4,1.4l3.8,3.8l3.8-3.8l1.4-1.4C13.8,6.2,13.8,4.4,12.7,3.4z"/>\n\t\t</svg>\n\t',"order-asc":'\n\t\t<svg viewBox="0 0 7 14">\n\t\t\t<polygon style="fill:currentColor;stroke:none;fill-opacity:0.4;" points="5.7,8 3.5,11.8 1.3,8 0.2,8 0.1,8 3.5,13.8 6.9,8 6.8,8"/>\n\t\t\t<polygon style="fill:currentColor;stroke:none;" points="3.5,0.3 0.1,6 0.2,6 1.3,6 3.5,2.2 5.7,6 6.8,6 6.9,6"/>\n\t\t</svg>\n\t',"order-default":'\n\t\t<svg viewBox="0 0 7 14">\n\t\t\t<polygon style="fill:currentColor;stroke:none;fill-opacity:0.4;" points="5.7,8 3.5,11.8 1.3,8 0.2,8 0.1,8 3.5,13.8 6.9,8 6.8,8"/>\n\t\t\t<polygon style="fill:currentColor;stroke:none;fill-opacity:0.4;" points="3.5,0.3 0.1,6 0.2,6 1.3,6 3.5,2.2 5.7,6 6.8,6 6.9,6"/>\n\t\t</svg>\n\t',"order-desc":'\n\t\t<svg viewBox="0 0 7 14">\n\t\t\t<polygon style="fill:currentColor;stroke:none;" points="5.7,8 3.5,11.8 1.3,8 0.2,8 0.1,8 3.5,13.8 6.9,8 6.8,8"/>\n\t\t\t<polygon style="fill:currentColor;stroke:none;fill-opacity:0.4;" points="3.5,0.3 0.1,6 0.2,6 1.3,6 3.5,2.2 5.7,6 6.8,6 6.9,6"/>\n\t\t</svg>\n\t',"radio-checked":'\n\t\t<svg viewBox="0 0 17 17">\n\t\t\t<circle style="fill:none;stroke:currentColor;" cx="8.5" cy="8.5" r="8"/>\n\t\t\t<circle style="fill-rule:evenodd;clip-rule:evenodd;fill:currentColor; stroke:none;" cx="8.5" cy="8.5" r="3.5"/>\n\t\t</svg>\n\t',"radio-unchecked":'\n\t\t<svg viewBox="0 0 17 17">\n\t\t\t<circle style="fill:none;stroke:currentColor;" cx="8.5" cy="8.5" r="8"/>\n\t\t</svg>\n\t',right:'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<polygon style="fill:currentColor; stroke:none;" points="4.4,11.5 4,10.8 9.4,7.5 4,4.2 4.4,3.5 11,7.5"/>\n\t\t</svg>\n\t',search:'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<line style="fill:none;stroke:currentColor;stroke-linecap:round;" x1="9.6" y1="9.6" x2="13.9" y2="13.9"/>\n\t\t\t<ellipse transform="matrix(0.7071 -0.7071 0.7071 0.7071 -2.5312 6.1109)" style="fill:none;stroke:currentColor;" cx="6.1" cy="6.1" rx="5" ry="5"/>\n\t\t</svg>\n\t',success:'\n\t\t<svg viewBox="0 0 21 21">\n\t\t\t<circle style="fill:none;stroke:currentColor;" cx="10.5" cy="10.5" r="10"/>\n\t\t\t<polyline style="fill:none;stroke:currentColor;" points="16.2,6.4 9.3,14.6 6.1,10.8"/>\n\t\t</svg>\n\t',tips:'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<path style="fill:currentColor; stroke:none;" d="M7,1c3.3,0,6,2.7,6,6s-2.7,6-6,6s-6-2.7-6-6S3.7,1,7,1 M7,0C3.1,0,0,3.1,0,7s3.1,7,7,7s7-3.1,7-7S10.9,0,7,0z"/>\n\t\t\t<rect style="fill:currentColor; stroke:none;" x="6" y="3" width="2" height="2"/>\n\t\t\t<polygon style="fill:currentColor; stroke:none;" points="8,10 8,7 8,6 6,6 5,6 5,7 6,7 6,10 5,10 5,11 6,11 8,11 9,11 9,10"/>\n\t\t</svg>\n\t',"triangle-down":'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<polygon style="fill:currentColor; stroke:none;" points="7,11 11,3 3,3"/>\n\t\t</svg>\n\t',"triangle-right":'\n\t\t<svg viewBox="0 0 15 15">\n\t\t\t<polygon style="fill:currentColor; stroke:none;" points="11,7 3,3 3,11"/>\n\t\t</svg>\n\t',warning:'\n\t\t<svg viewBox="0 0 21 21">\n\t\t\t<line style="fill:none;stroke:currentColor;stroke-width:2;" x1="10.5" y1="7.5" x2="10.5" y2="12.5"/>\n\t\t\t<rect style="fill:currentColor; stroke:none;" x="9.5" y="14" width="2" height="2"/>\n\t\t\t<path style="fill:currentColor; stroke:none;" d="M10.5,3l8.8,15H1.7L10.5,3 M10.5,1L0,19h21L10.5,1L10.5,1z"/>\n\t\t</svg>\n\t'}},1583:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PicoFace=void 0;const i=r(1326),a=r(5499),s=r(1118);var n;!function(e){let t,r,n=document.currentScript instanceof HTMLScriptElement?(0,s.getPathParent)((0,s.getPathParent)(document.currentScript.src))+"/":"",o=n+"libs/pico.js",l=n+"libs/pico-cascade-facefinder.dat",c=320;function d(e){if(!e.length)return null;let t=0,r=0,i=0,a=0;for(let s of e){let e=s.p*s.r*s.r;t+=s.x*e,r+=s.y*e,i+=s.r*e,a+=e}return{x:t/a,y:r/a,d:i/a}}e.configPinoJSPath=function(e){o=e},e.configCascadeFaceFinderPath=function(e){l=e},e.configMinMaxScalingToSize=function(e){c=e},e.getTotalFaceCenter=d,e.getTotalFaceAlignPosition=function(e){if(!e.length)return null;let{x:t,y:r,d:i}=d(e),s=(t-i/2)/(1-i),n=(r-i/2)/(1-i);return s=(0,a.constrain)(s,0,1),n=(0,a.constrain)(n,0,1),{x:s,y:n}},e.getFaces=async function(e,a=50){await async function(){t||(t=(async()=>{await async function(){await(0,i.loadScript)(o)}(),await async function(){let e=await fetch(l),t=await e.arrayBuffer(),i=new Uint8Array(t);r=pico.unpack_cascade(i)}()})()),await t}();let s=function(e){let t,r=e instanceof HTMLImageElement?e.naturalWidth:e.videoWidth,i=e instanceof HTMLImageElement?e.naturalHeight:e.videoHeight;t=r>i?c/i:c/r;let a=Math.round(r*t),s=Math.round(i*t),n=document.createElement("canvas");n.width=a,n.height=s;let o=n.getContext("2d");return o.drawImage(e,0,0,a,s),o.getImageData(0,0,a,s)}(e),n=function(e,t,r){let i=new Uint8Array(t*r);for(let a=0;a<t;a++)for(let t=0;t<r;t++)i[a*r+t]=(2*e[4*a*r+4*t+0]+7*e[4*a*r+4*t+1]+1*e[4*a*r+4*t+2])/10;return i}(s.data,s.width,s.height),d=1/s.width,h=1/s.height,u=Math.sqrt(d*h),p={pixels:n,nrows:s.height,ncols:s.width,ldim:s.width},m={shiftfactor:.1,minsize:20,maxsize:c,scalefactor:1.1},f=pico.run_cascade(p,r,m);return f=pico.cluster_detections(f,.2),f=f.filter((e=>e[3]>a)),f.map((e=>({x:e[1]*d,y:e[0]*h,r:e[2]*u,p:e[3]})))}}(n||(t.PicoFace=n={}))},1648:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Project=void 0;const i=r(7616),a=r(6061),s=r(9886),n=r(5499),o=r(3568),l=r(4173),c=r(6376),d=r(7153),h=r(6133),u=r(4310),p={textPlaceholder:"Add Text Here",preloadSeconds:10.5,preserveSeconds:5.5,frameRate:60,motionBlurSamplingCount:32,fastBlurSamplingCount:32,fastBlurRenderingIterateCount:2,maxDropShadowSamplingCount:32,dropShadowRenderingIterateCount:1,clearResourcesAfterNoInteractionForSeconds:60,textSuperSamplingRate:2},m={textPlaceholder:"",preloadSeconds:30,preserveSeconds:0,frameRate:30,motionBlurSamplingCount:64,fastBlurSamplingCount:64,fastBlurRenderingIterateCount:3,maxDropShadowSamplingCount:64,dropShadowRenderingIterateCount:3,clearResourcesAfterNoInteractionForSeconds:0,textSuperSamplingRate:2};class f extends n.Emitter{canvas;rootDirectory;options;data;resourceLoader;renderer;timeline;encoder=null;footages;mode;constructor(e,t,r,l={},c=null){super();let u=new o.SimpleWebGL(e);this.canvas=e,this.rootDirectory=t,this.options=(0,n.assignIf)(l,c?m:p),this.encoder=c,this.mode=c?"encoding":"previewing",this.data=new h.ProjectData(r),this.resourceLoader=new a.ResourceLoader(this,u),this.timeline=new s.Timeline(this),this.renderer=new i.Renderer(this,u),this.footages=new d.Footages(this)}clearResoures(){this.clearPropertyCaches(),this.timeline.resetAllTimeRanges(),this.renderer.clear(),this.resourceLoader.clear(),requestAnimationFrame((()=>{this.renderer.sw.warnIfNotClean()}))}clearPropertyCaches(){(0,l.clearKeyframeCache)(),(0,c.resetStaticPropertyValuesCache)(),(0,u.clearTextAnimaterPlugins)()}notifyProjectUpdated(){this.clearPropertyCaches(),this.emit("updateproject")}notifyTimelineUpdated(){this.clearPropertyCaches(),this.emit("updatetimeline")}notifyLayerUpdated(e){this.clearPropertyCaches(),this.emit("updatelayer",e)}notifyEffectUpdated(e){this.clearPropertyCaches(),this.emit("updateeffect",e)}notifyUpdated(){this.clearPropertyCaches(),this.emit("update")}delete(){this.clearPropertyCaches(),this.resourceLoader.delete(),this.renderer.delete()}}t.Project=f},1650:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MotionBlurEffect=void 0;const i=r(8341),a=r(9160),s=r(5499),n=r(6376),o=r(211);class l extends i.Effect{async initialize(){this.toDraw=new a.ToDrawMotionBlur({renderer:this.renderer}),this.toDraw.setRepeatEdgePixels(!0)}setBaseMotionMatrix(e){let t=(0,s.sum)(this.data.shutterAngles.map((e=>(0,n.getPropertyValue)(e,this.time)))),r=this.renderer.project.options.frameRate,i=(0,o.getExposureTime)(t,r);this.toDraw.setMotionMatrix(e.multiplyScalar(i))}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),this.toDraw.getPaintArea()}}t.MotionBlurEffect=l},1657:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TintEffect=void 0;const i=r(8341),a=r(6339),s=r(2458),n=r(6376),o=r(62),l=r(5305);class c extends i.Effect{async initialize(){this.toDraw=new a.ToDrawEffect({renderer:this.renderer,fragCode:s.default})}update(){super.update();let e=(0,n.getPropertyValues)(this.data,this.time,l.EffectTintDefaultValues);this.toDraw.setUniform("mapBlackTo",(0,o.premultiplyColorArray)(e.mapBlackTo)),this.toDraw.setUniform("mapWhiteTo",(0,o.premultiplyColorArray)(e.mapWhiteTo)),this.toDraw.setUniform("amountToTint",e.amountToTint/100)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.TintEffect=c},1824:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.promiseWithResolves=void 0,t.promiseWithResolves=function(){let e,t;return{promise:new Promise(((r,i)=>{e=r,t=i})),resolve:e,reject:t}}},1830:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaintArea=void 0;const i=r(5042);var a;!function(e){e.fromCoords=function(e){return i.RectArea.fromCoords(e)},e.union=function(e){let t=e.filter((e=>e));return i.RectArea.union(t)},e.cross=function(e){let t=e.filter((e=>e));return i.RectArea.cross(t)}}(a||(t.PaintArea=a={}))},1918:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"raysCount",desc:"Rays Count",min:1,max:50,step:1,value:10},{name:"blurRate",desc:"Blur Rate",min:0,max:.5,step:.01,value:0}];(0,r(4062).extendTransitions)({"rays-clockwise":{uniformSlides:i,uniformValues:{startDirectionAngle:90,moveDirection:1},steps:[{fragShaderName:"rays"}]},"rays-anticlockwise":{uniformSlides:i,uniformValues:{startDirectionAngle:90,moveDirection:0},steps:[{fragShaderName:"rays"}]}})},1919:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(2150),a(r(8240),t),a(r(8854),t),a(r(7916),t),a(r(3345),t),a(r(3583),t),a(r(2959),t),a(r(8259),t),a(r(4983),t),a(r(4074),t),a(r(9771),t),a(r(972),t),a(r(3792),t),a(r(8352),t),a(r(3946),t),a(r(6073),t),a(r(9782),t),a(r(511),t),a(r(1429),t),a(r(7975),t),a(r(2522),t),a(r(3656),t),a(r(3582),t),a(r(845),t),a(r(8248),t),a(r(5897),t),a(r(898),t),a(r(6833),t),a(r(6716),t),a(r(2954),t),a(r(877),t),a(r(453),t),a(r(9611),t),a(r(6585),t),a(r(6530),t),a(r(8708),t),a(r(4218),t),a(r(8699),t),a(r(4462),t)},1924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatingQueue=void 0,t.UpdatingQueue=class{updater;constructor(e){this.updater=e}updatingPromise=null;latestTime=null;resolveRejects=[];async enqueue(e){let t=new Promise(((t,r)=>{null!==e&&(this.latestTime=e),this.resolveRejects.push([t,r])}));await Promise.resolve(),this.updatingPromise||this.update(),await t}async update(){for(;this.resolveRejects.length>0;){let e=this.resolveRejects;this.resolveRejects=[],this.updatingPromise=this.updater(this.latestTime),this.latestTime=null;try{await this.updatingPromise;for(let[t]of e)t()}catch(t){for(let[,r]of e)r(t)}this.updatingPromise=null,e=[],await Promise.resolve()}}clear(){this.latestTime=null,this.resolveRejects=[]}}},1954:(e,t)=>{function r(e,t,r){return new Promise((i=>{e.toBlob((e=>{i(e)}),`image/${t}`,r)}))}function i(e,t,r,i){let a=e,s=t;return a/s>r?a=s*r:s=a/r,a=Math.round(a),s=Math.round(s),[i[0]*(e-a),i[1]*(t-s),a,s]}async function a(e,t=3e3){return new Promise((r=>{let i=setInterval((()=>{e.readyState>=e.HAVE_CURRENT_DATA&&(clearInterval(i),clearTimeout(a),r(!0),e.ontimeupdate=null)}),10),a=setTimeout((()=>{clearInterval(i),r(!1)}),t)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.waitForVideoDecoded=t.VideoFrameExtractor=t.extractVideoFrame=t.cropImageToMaximumSize=t.cropImageToAspectRatio=t.getCoverCropImageRect=t.createSameAspectRatioImageThumbnail=t.createImageThumbnail=t.readCanvasAsImage=t.readCanvasAsJPEG=t.isSameFrameTimes=void 0,t.isSameFrameTimes=function(e,t,r=30){return Math.round(e*r)===Math.round(t*r)},t.readCanvasAsJPEG=async function(e,t){return await r(e,"jpeg",t)},t.readCanvasAsImage=r,t.createImageThumbnail=async function(e,t,r,a){let s=t/r,[n,o,l,c]=i(e.naturalWidth,e.naturalHeight,s,a),d=document.createElement("canvas");return d.width=t,d.height=r,d.getContext("2d").imageSmoothingQuality="high",d.getContext("2d").drawImage(e,n,o,l,c,0,0,t,r),d},t.createSameAspectRatioImageThumbnail=async function(e,t,r){let i=e.naturalWidth/e.naturalHeight,a=r,s=Math.round(i*a);s<t&&(s=t,a=Math.round(s/i));let n=document.createElement("canvas");return n.width=s,n.height=a,n.getContext("2d").imageSmoothingQuality="high",n.getContext("2d").drawImage(e,0,0,s,a),n},t.getCoverCropImageRect=i,t.cropImageToAspectRatio=async function(e,t,r){let a=document.createElement("canvas"),[s,n,o,l]=i(e.naturalWidth,e.naturalHeight,t,r);return a.width=o,a.height=l,a.getContext("2d").drawImage(e,s,n,o,l,0,0,o,l),a},t.cropImageToMaximumSize=async function(e,t,r,a){let s=document.createElement("canvas"),n=t/r,[o,l,c,d]=i(e.naturalWidth,e.naturalHeight,n,a),h=Math.min(t,c),u=Math.min(r,d);return s.width=h,s.height=u,s.getContext("2d").drawImage(e,o,l,c,d,0,0,h,u),s},t.extractVideoFrame=async function(e){let t=document.createElement("canvas"),r=e.videoWidth,i=e.videoHeight;return t.width=r,t.height=i,e.readyState<e.HAVE_CURRENT_DATA&&await a(e),t.getContext("2d").drawImage(e,0,0,r,i),t},t.VideoFrameExtractor=class{canvas;context;initializeCanvas(e){let t=document.createElement("canvas"),r=e.videoWidth,i=e.videoHeight;t.width=r,t.height=i,this.canvas=t,this.context=t.getContext("2d")}clearCanvas(){let e=this.canvas.width,t=this.canvas.height;this.context.clearRect(0,0,e,t)}async extract(e){this.canvas?this.clearCanvas():this.initializeCanvas(e),e.readyState<e.HAVE_CURRENT_DATA&&await a(e);let t=e.videoWidth,r=e.videoHeight;return this.context.drawImage(e,0,0,t,r),this.canvas}},t.waitForVideoDecoded=a},2030:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cache=t.CacheDirective=void 0;const i=r(5428),a=r(4511),s=r(9838),n=r(162);class o{constructor(e,t){this.templates=[],this.currentTemplate=null,this.anchor=e,this.context=t,this.transition=new n.DirectiveTransition(t)}canMergeWith(e){return!0}merge(e,t){if(this.transition.updateOptions(t),e)if(this.currentTemplate&&this.currentTemplate.canMergeWith(e))this.currentTemplate.merge(e);else{this.currentTemplate&&this.cacheCurrentTemplate();let t=this.templates.find((t=>t.canMergeWith(e)));t?(t.merge(e),this.anchor.insert(t.range.getFragment()),this.playEnterTransition(t),this.currentTemplate=t):this.initNewResult(e)}else this.currentTemplate&&this.cacheCurrentTemplate()}async playEnterTransition(e){let t=e.range.getFirstElement();t&&await this.transition.playEnter(t)}initNewResult(e){let t=new a.Template(e,this.context),r=t.range.getFragment();this.anchor.insert(r),this.transition.shouldPlayEnter()&&this.playEnterTransition(t),this.currentTemplate=t,this.templates.push(t)}async cacheCurrentTemplate(){let e=this.currentTemplate,t=e.range.getFirstElement();this.anchor.type===s.NodeAnchorType.Next&&t&&t.parentNode&&t.parentNode!==this.anchor.el.parentNode&&(this.anchor=new s.NodeAnchor(t.parentNode,s.NodeAnchorType.Parent)),this.transition.shouldPlay()&&t?this.transition.playLeave(t).then((t=>{t&&e.range.cacheFragment()})):e.range.cacheFragment(),this.currentTemplate=null}remove(){this.currentTemplate&&this.currentTemplate.remove()}}t.CacheDirective=o,t.cache=i.defineDirective(o)},2037:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.GaussBlur2DGenerator=t.GaussBlur1DGenerator=void 0;const a=r(1416),s=r(5499),n=r(3432);let o=class extends a.Component{radius=s.storage.get("gauss_blur_1d_radius",4);template=s.storage.get("gauss_blur_1d_template","\tcolor += texture(iChannel[0], fTextureCoord + {x}.0 * d) * {p};");output="";render(){return a.html`
		<template class="gauss-blur">
			<f-input .value=${this.radius} :tooltip="半径像素" @change=${this.onChangeRadius} />
			<f-input .value=${this.template} :tooltip="代码模板" @change=${this.onChangeTemplate}" />
			<button @click=${this.generate} :enable=${this.radius}>生成高斯模糊权重代码</button>
			<f-textarea .value=${this.output} .placeholder="点击上面的按钮然后在此拷贝" />
		</template>
		`}onChangeRadius(e){this.radius=e,s.storage.set("gauss_blur_1d_radius",e)}onChangeTemplate(e){this.template=e,s.storage.set("gauss_blur_1d_template",e)}generate(){let e=(0,n.generate1DGaussBlurPriorities)(this.radius);e.forEach((e=>e.p=(0,s.toDecimal)(e.p,4))),this.output=e.map((({x:e,p:t})=>(0,s.format)(this.template,{x:e,p:t}))).join("\n").replace(/\+(\s*)-/g,"-$1")}};t.GaussBlur1DGenerator=o,t.GaussBlur1DGenerator=o=i([(0,a.define)("gauss-blur-1d-generator")],o);let l=class extends a.Component{radius=s.storage.get("gauss_blur_2d_radius",4);template=s.storage.get("gauss_blur_2d_template","\tcolor += texture(iChannel[0], fTextureCoord + vec2({x}.0, {y}.0) * d) * {p};");output="";render(){return a.html`
		<template class="gauss-blur">
			<f-input .value=${this.radius} :tooltip="半径像素" @change=${this.onChangeRadius} />
			<f-input .value=${this.template} :tooltip="代码模板" @change=${this.onChangeTemplate}" />
			<button @click=${this.generate} :enable=${this.radius}>生成高斯模糊权重代码</button>
			<f-textarea .value=${this.output} .placeholder="点击上面的按钮然后在此拷贝" />
		</template>
		`}onChangeRadius(e){this.radius=e,s.storage.set("gauss_blur_2d_radius",e)}onChangeTemplate(e){this.template=e,s.storage.set("gauss_blur_2d_template",e)}generate(){let e=(0,n.generate2DGaussBlurPriorities)(this.radius);e.forEach((e=>e.p=(0,s.toDecimal)(e.p,4))),this.output=e.map((({x:e,y:t,p:r})=>(0,s.format)(this.template,{x:e,y:t,p:r}))).join("\n").replace(/\+(\s*)-/g,"-$1")}};t.GaussBlur2DGenerator=l,t.GaussBlur2DGenerator=l=i([(0,a.define)("gauss-blur-2d-generator")],l)},2069:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.FaceTransformPreview=void 0;const a=r(1416),s=r(8638),n=r(4452),o=r(229);let l=class extends s.TransitionPreview{names=["face-transform"];transitionTimePercent=1;images=["7.jpg","8.jpg","11.jpg","12.jpg"];imageDirectory="face-transform";facePictureSize=[1920,1080];faceTransform;async onChangeImage(){let e=(this.toImageIndex-1+this.images.length)%this.images.length,t=await this.getFaceLandmarkCoords(e),r=await this.getFaceLandmarkCoords(this.toImageIndex);this.setFaceTransform(new o.FaceTransform(t,r))}async getFaceLandmarkCoords(e){let[t,r]=this.facePictureSize,i=`pictures/${this.imageDirectory}/${this.images[e]}`.replace(/.jpg$/,"");return(await(await fetch(i)).text()).trim().split(/\r?\n/g).slice(1).map((e=>e.split(",").map((e=>Number(e))))).map((([e,i])=>new n.Vector2(e/t*2-1,2*(1-i/r)-1)))}setFaceTransform(e){this.faceTransform=e;let{fromCoords:t,toCoords:r,translates:i}=e,a=t.map((e=>[e.x,e.y])).flat(),s=r.map((e=>[e.x,e.y])).flat(),n=i.map((e=>[e.x,e.y])).flat(),o=e.fromTriangleIndices.flat(),l=e.toTriangleIndices.flat(),d=[...this.sw.toDraws],h=c(a),u=c(s);d[0].setVertices({vPosition:a,vTextureCoord:h,translate:n},t.length,o),d[1].setVertices({vPosition:s,vTextureCoord:u,translate:n},r.length,l)}drawAll(){this.processor.updateProgress(this.progress),this.sw.clear(),this.setTransformUniforms();let e=[...this.sw.toDraws];e[0].draw();let t=this.sw.textureFrameManager.requestFull(!0);t.active(),e[1].draw(),t.deactive(),e[2].useSampler("iChannel",t.getSampler()),e[2].draw()}setTransformUniforms(){let e=[...this.sw.toDraws],{from:t,to:r}=this.faceTransform.getTransformMatrixesByProgress(this.progress);e[0].setUniform("iTransform",t.toFloat32Array()),e[1].setUniform("iTransform",r.toFloat32Array())}};function c(e){let t=[];for(let r=0;r<e.length;r+=2)t.push(e[r]/2+.5),t.push(e[r+1]/2+.5);return t}t.FaceTransformPreview=l,t.FaceTransformPreview=l=i([(0,a.define)("face-transform-preview")],l)},2111:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compileToRenderTree=t.isTransformableRenderNodeType=t.isRenderableLayeRenderNodeType=t.isLayerRenderNodeType=t.RenderNodeType=void 0;const i=r(7905),a=r(5323),s=r(7678),n=r(5365),o=r(5305),l=r(1443),c=r(3568);var d;!function(e){e[e.PixelLayer=0]="PixelLayer",e[e.ShapeLayer=1]="ShapeLayer",e[e.AudioLayer=2]="AudioLayer",e[e.CameraLayer=3]="CameraLayer",e[e.CompositeLayer=4]="CompositeLayer",e[e.PlaceholderLayer=5]="PlaceholderLayer",e[e.Effect=6]="Effect"}(d||(t.RenderNodeType=d={})),t.isLayerRenderNodeType=function(e){return e!==d.Effect},t.isRenderableLayeRenderNodeType=function(e){return e!==d.Effect&&e!==d.AudioLayer},t.isTransformableRenderNodeType=function(e){return e!==d.AudioLayer},t.compileToRenderTree=function(e){return(new h).compile(e)};class h{timeMap=new l.TimeMap;inThreeD=!1;beThreeD=!1;siblingLayerDatas;topNodes=[];compile(e){let t=this.compileLayers(e,[],this.timeMap);return(0,a.generateTransformStat)(t),[...this.topNodes,...t]}compileLayers(e,t,r){let i=this.inThreeD,a=this.beThreeD,s=this.siblingLayerDatas,n=this.timeMap,o=this.getUnPaintedLayerIds(e);this.siblingLayerDatas=e,this.timeMap=r;for(let r=e.length-1;r>=0;r--){let a=e[r];if(this.inThreeD=i||!!a.threeD,this.beThreeD=!!a.threeD,!o.has(a.id))switch(a.type){case"image":case"video":case"text":case"solid":t=this.compilePixelLayer(a,t);break;case"shape":t=this.compileShapeLayer(a,t);break;case"composite":t=this.compileCompositeLayer(a,t);break;case"camera":t=this.compileCameraLayer(a,t);break;case"audio":this.topNodes.push(this.compileAudiolLayer(a));break;case"adjustment":t=this.compileAdjustmentLayer(a,t);break;case"empty":break;default:throw new Error(`Can't compile layer in type "${a.type}"!`)}}return this.inThreeD=i,this.beThreeD=a,this.siblingLayerDatas=s,this.timeMap=n,t}getUnPaintedLayerIds(e){let t=new Set;for(let r of e)if(r.effects)for(let e of r.effects)if("displacementMap"===e.type){let r=e.displacementMapLayerId;t.add(r)}return t}createRenderNode(e,t,r){return{id:(0,s.generateUniqueID)(),type:e,data:t,inThreeD:this.inThreeD,beThreeD:this.beThreeD,inputs:r,effects:[],timeMap:this.timeMap,transformStat:null}}compilePixelLayer(e,t){let r=this.createRenderNode(d.PixelLayer,e,null);return this.compileRenderableLayer(e,[r],t)}compileAudiolLayer(e){return this.createRenderNode(d.AudioLayer,e,null)}compileShapeLayer(e,t){let r=this.createRenderNode(d.ShapeLayer,e,null);return this.compileRenderableLayer(e,[r],t)}compileRenderableLayer(e,t,r){if(e.transform){let r=(0,n.createTransformEffectFromLayerData)(e);t=this.compileEffects([r],t,e)}if(e.parentId&&(t=this.linkParentLayer(e,t)),e.effects&&(t=this.compileEffects(e.effects,t,e)),e.isTrackMatte){let i=this.getNextLayer(e);t=i.hasTrackMatte?this.compileMaskEffect(e,i,t,r):[]}if(e.hasTrackMatte){let r=this.getPreviousLayer(e);r&&r.isTrackMatte||["ALPHA","LUMAINANCE"].includes(e.trackMatteType)&&(t=[])}return t.length>0&&e.blendingMode&&!c.SimpleWebGL.supportsBlendMode(c.SimpleWebGLBlendMode[e.blendingMode])&&(t=this.compileBlendingEffect(e,t,r),r=[]),r.push(...t),r}getPreviousLayer(e){let t=this.siblingLayerDatas.findIndex((t=>t.id===e.id));return t>0?this.siblingLayerDatas[t-1]:null}getNextLayer(e){let t=this.siblingLayerDatas.findIndex((t=>t.id===e.id));return t<this.siblingLayerDatas.length-1?this.siblingLayerDatas[t+1]:null}linkParentLayer(e,t){let r=e.parentId;for(;r;){let i=this.siblingLayerDatas.find((e=>e.id===r));if(!i)break;if(i.transform){let r=(0,n.createTransformEffectFromLayerData)(i);delete r.opacity,t=this.compileEffects([r],t,e)}r=i.parentId}return t}compileEffects(e,t,r){for(let a of e){let e=(0,i.isRenderableEffect)(a.type);"tile"===a.type&&1===t.length&&(e=!1),e?t=this.compileRenderableEffect(a,t):("transform"===a.type&&a.shutterAngle&&!("text"===r.type&&r.animaters)&&(t=this.compileMotionBlur(a.shutterAngle,t)),t.forEach((e=>{e.effects.push({effect:a,timeMap:this.timeMap})})))}return t}compileRenderableEffect(e,t){let r=(0,i.getEffectInputCount)(e.type);if("displacementMap"===e.type){let r=e.displacementMapLayerId,i=this.siblingLayerDatas.find((e=>e.id===r));switch(i.type){case"image":case"video":case"text":case"solid":t=this.compilePixelLayer(i,t);break;case"shape":t=this.compileShapeLayer(i,t);break;default:throw new Error(`displacementMap Effect doesn't support "${i.type}" layer as a map layer!`)}}return t.length<r&&0===t.length?t:[this.createRenderNode(d.Effect,e,t)]}compileMotionBlur(e,t){if(1===t.length&&t[0].type===d.Effect&&"motionBlur"===t[0].data.type)return t[0].data.shutterAngles.push(e),t;{let r={id:(0,s.generateUniqueID)(),name:"Temp Motion Blur",type:"motionBlur",shutterAngles:[e]};return this.compileRenderableEffect(r,t)}}compileMaskEffect(e,t,r,i){if(i.length>0){r.length>1&&(r=this.compositeInputs(d.CompositeLayer,e,r));let a=i.pop();r.push(a);let n={id:(0,s.generateUniqueID)(),type:"mask",name:"Temp Mask",trackMatteType:t.trackMatteType||o.EffectMaskDefaultValues.trackMatteType};return[this.createRenderNode(d.Effect,n,r)]}return[]}compileBlendingEffect(e,t,r){if(t.length>1&&(t=this.compositeInputs(d.CompositeLayer,e,t)),r.length>1){let e={id:(0,s.generateUniqueID)(),name:"Temp Composite",type:"composite"};r=this.compositeInputs(d.CompositeLayer,e,r)}r.length>0&&t.push(r[0]);let i={id:(0,s.generateUniqueID)(),type:"blend",name:"Temp Blend",blendingMode:e.blendingMode};return[this.createRenderNode(d.Effect,i,t)]}compileAdjustmentLayer(e,t){return e.effects&&(t=this.compileEffects(e.effects,t,e)),t}compileCompositeLayer(e,t){let r=e.layers,i=this.isForAdjustment(e),a=this.timeMap.mergeInnerLayer(e);if(i)t=this.compileLayers(r,t,a);else{let i=this.compileLayers(r,[],a),s=(this.mustCompositeInputs(e,i),d.CompositeLayer);i=this.compositeInputs(s,e,i),t=this.compileRenderableLayer(e,i,t)}return t}mustCompositeInputs(e,t){return!!(t.length>1&&(e.hasTrackMatte||e.transform&&void 0!==e.transform.opacity))||!(!e.layerStyle&&!e.masks)}compositeInputs(e,t,r){return[this.createRenderNode(e,t,r)]}isForAdjustment(e){let t=this.getUnPaintedLayerIds(e.layers);return e.layers.every((e=>"adjustment"===e.type||"camera"===e.type||"empty"===e.type||"audio"===e.type||"composite"===e.type&&this.isForAdjustment(e)||t.has(e.id)))}compileCameraLayer(e,t){if(0===t.length)return t;let r=this.createRenderNode(d.CameraLayer,e,t);return e.parentId&&(r=this.linkParentLayer(e,[r])[0]),e.effects&&(r=this.compileEffects(e.effects,[r],e)[0]),[r]}}},2130:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BlendEffect=void 0;const i=r(8341),a=r(3528),s=r(6339);class n extends i.Effect{async initialize(){this.toDraw=new s.ToDrawEffect({renderer:this.renderer,fragCode:(0,a.getBlendFragCode)(this.data.blendingMode)})}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.BlendEffect=n},2146:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FastBlurEffect=void 0;const i=r(8341),a=r(6376),s=r(5305),n=r(6412),o=r(4452);class l extends i.Effect{async initialize(){this.toDraw=new n.ToDrawFastBlur({renderer:this.renderer,iterateCount:this.renderer.project.options.fastBlurRenderingIterateCount,samplingCount:this.renderer.project.options.fastBlurSamplingCount})}update(){let e=(0,a.getPropertyValues)(this.data,this.time,s.EffectBoxBlurDefaultValues),t=this.transformStatus.projectVector(new o.Vector2(e.blurriness,e.blurriness));this.toDraw.setBlurRadius(t),this.toDraw.setBlurDimension(e.blurDimensions)}setMappedChannel(...e){this.toDraw.setMappedChannel(...e)}clearChannel(){this.toDraw.clearChannel()}setMaskArea(e){this.toDraw.setMaskArea(e)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),this.toDraw.getPaintArea()}}t.FastBlurEffect=l},2150:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(1416),a=r(8240);i.addGlobalStyle((()=>{let{mainColor:e,textColor:t,borderColor:r,errorColor:s,fontSize:n,borderRadius:o,focusBlurRadius:l,adjust:c,adjustFontSize:d,backgroundColor:h}=a.theme;return i.css`
	html{
		color: ${t};
		font-size: ${n}px;
		line-height: ${c(28)}px;
		background-color: ${h};
	}

	h1{
		font-size: ${d(68)}px;
		line-height: 1.2;
		font-weight: 700;
	}

	h2{
		font-size: ${d(36)}px;
		line-height: 1.2;
		font-weight: 100;
	}

	h3{
		font-size: ${d(26)}px;
		line-height: 1.2;
		font-weight: 400;
	}

	h4{
		font-size: ${d(22)}px;
		line-height: 1.2;
		font-weight: 400;
	}

	h5{
		font-size: ${d(18)}px;
		line-height: 1.2;
	}

	h6{
		font-size: ${d(14)}px;
		line-height: 1.2;
	}

	button{
		display: inline-flex;
		justify-content: center;
		height: ${c(28)}px;
		line-height: ${c(28)-2}px;
		border: 1px solid ${r};
		color: ${t};
		border-radius: ${o}px;
		padding: 0 ${c(12)}px;
		background: ${h};
		text-align: center;
		cursor: pointer;
		vertical-align: top;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		
		&:hover, &:focus{
			border-color: #666;
			background-color: #666;
			color: #fff;
		}

		&:active{
			background: ${t};
			border-color: ${t};
			color: ${h};
		}

		&:focus{
			box-shadow: 0 0 ${l}px ${e};
		}

		f-icon, f-icon-loading{
			&:first-child{
				margin-right: ${c(8)}px;
			}

			&:last-child{
				margin-left: ${c(8)}px;
			}

			&:only-child{
				margin-left: 0;
				margin-right: 0;
			}
		}

		&[primary]{
			background: ${e};
			border-color: ${e};
			color: #fff;

			&:hover, &:focus{
				background: ${e.darken(15)};
				border-color: ${e.darken(15)};
			}
		
			&:active{
				background: ${e.darken(30)};
				border-color: ${e.darken(30)};
			}
		}

		&[flat]{
			border: none;
			padding-left: 0;
			padding-right: 0;
			line-height: ${c(28)}px;

			&:hover, &:focus{
				background: none;
				color: ${t};
			}

			&:active{
				background: none;
			}

			&:focus{
				box-shadow: none;
			}
		}
	}

	a[primary]{
		color: ${e};
	}

	label{
		font-weight: bold;
		font-size: ${d(13)}px;

		&[required]{
			&::after{
				position: relative;
				content: '*';
				color: ${s};
				margin-left: 2px;
				top: ${c(-5)}px;
			}
		}

		f-icon{
			margin-left: 4px;
			color: ${t.toMiddle(20)};
		}
	}


	.fade-enter, .fade-leave{
		transition: opacity 0.2s ease-out;
	}
	
	.fade-enter-from, .fade-leave-to{
		opacity: 0;
	}
	
	.fade-enter-to, .fade-leave-from{
		opacity: 1;
	}


	::-webkit-scrollbar{
		height: 10px;
		width: 10px;
		background: ${h.toMiddle(10)};
	}

	::-webkit-scrollbar-thumb{
		background: ${h.toMiddle(30)};

		&:hover{
			background: ${h.toMiddle(40)};
		}

		&:active{
			background: ${h.toMiddle(50)};
		}
	}
`}))},2154:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCubicBezierEasingFunction=void 0,t.getCubicBezierEasingFunction=function(e,t,r,i){let a=3*e-3*r+1,s=-6*e+3*r,n=3*e,o=3*t-3*i+1,l=-6*t+3*i,c=3*t;function d(e){return((a*e+s)*e+n)*e}return function(e){if(0===e)return 0;if(1===e)return 1;let t=0,r=1,i=.5;for(;r-t>1e-4;)d(i)-e<0?t=i:r=i,i=(t+r)/2;return((o*i+l)*i+c)*i}}},2171:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CameraLayer=void 0;const i=r(1221);class a extends i.Layer{toDraw;async initialize(){}}t.CameraLayer=a},2195:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkQueue=void 0,t.WorkQueue=class{threadCount=1;workers=[];requestResolves=[];untilIdlePromise=null;idleResolve=null;constructor(e=1){this.threadCount=e}configThreadCount(e){this.threadCount=Math.max(e,1)}async request(){return this.workers.length<this.threadCount?this.createWorker():new Promise((e=>{this.requestResolves.push(e)}))}createWorker(){let e=this.create();if(this.workers.push(e),!e)throw new Error("Ensure each worker to be a meaningful and special value");return e}delete(e){this.workers=this.workers.filter((t=>t!==e)),this.checkReuqests()}checkReuqests(){for(;this.requestResolves.length>0;){let e=this.createWorker();this.requestResolves.shift()(e)}this.workers.length<this.threadCount&&this.idleResolve&&(this.idleResolve(),this.idleResolve=null,this.untilIdlePromise=null)}isIdle(){return this.workers.length<this.threadCount}async untilIdle(){return this.workers.length<this.threadCount?void 0:this.untilIdlePromise?this.untilIdlePromise:this.untilIdlePromise=new Promise((e=>{this.idleResolve=e}))}}},2255:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;const i=r(9739),a=r(4511),s=r(8135),n=r(9395),o=r(7860),l=r(3393),c=r(9838),d=r(8231),h=r(967),u=r(7378);class p extends i.Emitter{constructor(e){return super(),this.refs={},this.slots={},this.__slotProcesser=null,this.__rootPart=null,this.__updated=!1,this.__watcherGroup=null,this.__connected=!1,this.__connectedBefore=!1,this.__mustUpdate=!0,this.el=e,n.observeComTarget(this)}__emitCreated(){d.setComponentAtElement(this.el,this),h.emitComponentCreatedCallbacks(this.el,this),this.onCreated()}__emitConnected(){this.__connectedBefore?(n.restoreAsDependency(this),this.__watcherGroup&&this.__watcherGroup.connect()):this.__connectedBefore=!0,this.__connected=!0,this.__mustUpdate&&this.update(),this.onConnected(),this.emit("connected"),h.onComponentConnected(this)}__emitDisconnected(){n.clearDependencies(this),n.clearAsDependency(this),this.__watcherGroup&&this.__watcherGroup.disconnect(),this.__connected=!1,this.__mustUpdate=!0,this.onDisconnected(),this.emit("disconnected"),h.onComponentDisconnected(this)}__foundSlotsWhenRendering(){!this.__slotProcesser&&this.el.childNodes.length>0&&(this.__slotProcesser=new u.SlotProcesser(this)),this.__slotProcesser&&this.__slotProcesser.needToFillSlotsLater()}__updateImmediately(e=!1){if(this.__connected||e){this.__mustUpdate=!1,n.startUpdating(this);try{let e=this.render();n.endUpdating(this),this.__rootPart?this.__rootPart.update(e):null!==e&&(this.__rootPart=new a.NodePart(new c.NodeAnchor(this.el,c.NodeAnchorType.Root),e,this))}catch(e){n.endUpdating(this),console.warn(e)}this.__slotProcesser&&this.__slotProcesser.mayFillSlots(),!this.__updated&&(this.onReady(),this.__updated=!0),this.onUpdated()}else this.__mustUpdate=!0}__updateWatcherGroup(){this.__watcherGroup&&this.__watcherGroup.update()}render(){return null}update(){s.enqueueComponentToUpdate(this)}onCreated(){}onReady(){}onUpdated(){}onRendered(){}onConnected(){}onDisconnected(){}watch(e,t){return this.__watcherGroup=this.__watcherGroup||new o.WatcherGroup,this.__watcherGroup.watch(e,t.bind(this))}watchImmediately(e,t){return this.__watcherGroup=this.__watcherGroup||new o.WatcherGroup,this.__watcherGroup.watchImmediately(e,t.bind(this))}watchOnce(e,t){return this.__watcherGroup=this.__watcherGroup||new o.WatcherGroup,this.__watcherGroup.watchOnce(e,t.bind(this))}watchUntil(e,t){return this.__watcherGroup=this.__watcherGroup||new o.WatcherGroup,this.__watcherGroup.watchUntil(e,t.bind(this))}__addWatcher(e){this.__watcherGroup=this.__watcherGroup||new o.WatcherGroup,this.__watcherGroup.add(e)}__deleteWatcher(e){this.__watcherGroup=this.__watcherGroup||new o.WatcherGroup,this.__watcherGroup.delete(e)}scopeClassName(e){let t="."===e[0]?e.slice(1):e,r=l.getScopedClassNameSet(this.el.localName);return r&&r.has(t)?e+"__"+this.el.localName:e}}t.Component=p,p.style=null},2258:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SamplerManager=t.TextureUploadState=void 0;const i=r(5499);var a;!function(e){e[e.NotUploaded=0]="NotUploaded",e[e.Uploaded=1]="Uploaded"}(a||(t.TextureUploadState=a={}));class s extends i.Emitter{context;samplerUnits;dataCacher=new Map;mipmapGenerated=new Set;constructor(e){super(),this.context=e;let t=this.context.getParameter(this.context.MAX_TEXTURE_IMAGE_UNITS);this.samplerUnits=new Array(t)}requestUnitIndex(e,t=null){e.unitIndex=this.requestAUnitIndex(t),this.storeIntoUnits(e)}requestAUnitIndex(e=null){let t=-1;if(t=this.samplerUnits.findIndex((e=>void 0===e)),-1===t)for(let r=0;r<this.samplerUnits.length;r++){let i=this.samplerUnits[r],a=e&&e.__isUsingSampler(i);if(!e||!a){t=r;break}}if(-1===t)throw new Error("All of the texture units are in use!");return this.context.activeTexture(this.context.TEXTURE0+t),t}storeIntoUnits(e){let t=e.unitIndex,r=this.samplerUnits[t];r&&this.unstoreFromUnits(r),this.samplerUnits[t]=e}unstoreFromUnits(e){e.unitIndex>-1&&(this.samplerUnits[e.unitIndex]=void 0,e.unitIndex=-1)}requestTexture(e){let t=this.findTextureForData(e.data),r=a.Uploaded;return t||(t=this.context.createTexture(),r=a.NotUploaded),this.context.bindTexture(this.context.TEXTURE_2D,t),e.texture=t,this.cacheData(e),r}hasTextureForData(e){return this.dataCacher.has(e)}findTextureForData(e){if(!this.shouldCacheData(e))return null;let t=this.dataCacher.get(e);return t?[...t][0].texture:null}ensureMipmapIfNeeded(e){!this.mipmapGenerated.has(e.texture)&&e.shouldGenerateMipmap()&&this.generateMipmapIfNeeded(e)}generateMipmapIfNeeded(e){e.shouldGenerateMipmap()?(e.activeAsCurrent(),this.context.generateMipmap(this.context.TEXTURE_2D),this.mipmapGenerated.add(e.texture)):this.mipmapGenerated.delete(e.texture)}cacheData(e){let t=e.data;if(this.shouldCacheData(t)){let r=this.dataCacher.get(t);r||(r=new Set,this.dataCacher.set(t,r)),r.add(e)}}shouldCacheData(e){return!!e}replaceDataReference(e,t){this.mipmapGenerated.delete(e.texture);let r=e.data;if(r===t)return;let i=null;if(this.shouldCacheData(r)&&(i=this.dataCacher.get(r),this.dataCacher.delete(r),this.emit("deletedata",r)),this.shouldCacheData(t)){i=i||new Set,i.add(e),this.dataCacher.set(t,i);for(let e of i)e.data=t}}uncacheData(e){let t=!1,{data:r,texture:i}=e;if(this.shouldCacheData(r)){let i=this.dataCacher.get(r);i.delete(e),t=i.size>0,t||(this.dataCacher.delete(r),this.emit("deletedata",r))}t||(this.context.deleteTexture(i),this.mipmapGenerated.delete(i))}deleteUnitAndTexture(e){this.unstoreFromUnits(e),this.uncacheData(e)}}t.SamplerManager=s},2290:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeRectDrawer=void 0;const i=r(9573),a=r(6376),s=r(5305),n=r(9176);class o extends i.VectorShapeBaseDrawer{checkIsDataDynamic(){return!(!(0,a.isPropertyValueBeKeyFrames)(this.data.size)&&!(0,a.isPropertyValueBeKeyFrames)(this.data.roundness))||super.checkIsDataDynamic()}update(){this.values=(0,a.getPropertyValues)(this.data,this.time,s.ShapeRectDefaultValues),super.update()}getFillCoords(){let e=this.values.size[0]/2,t=this.values.size[1]/2;return{coords:[[-e,-t],[-e,t],[e,-t],[e,t]]}}getStrokCoords(){let e=this.values.size[0]/2,t=this.values.size[1]/2,r=this.strokeValues.strokeWidth,i=[[-e,-t],[e,-t],[e,t],[-e,t]];return{coords:(0,n.triangulatePolygonLine)(i,r,!0)}}}t.ShapeRectDrawer=o},2298:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix4=t.Matrix3=t.Matrix2=void 0;const i=r(4452);class a{static I=Object.seal(new a);static zero(){return new a(0,0,0,0)}static fromVectors(e,t){return new a(e.x,t.x,e.y,t.y)}data;constructor(e=1,t=0,r=0,i=1){this.set(e,t,r,i)}set(e,t,r,i){this.data=[e,r,t,i]}clone(){let[e,t,r,i]=this.data;return new a(e,r,t,i)}flatten(){let[e,t,r,i]=this.data;return[e,r,t,i]}toFloat32Array(){return new Float32Array(this.data)}transpose(){return this.clone().transposeSelf()}transposeSelf(){let[e,t,r,i]=this.data;return this.set(e,t,r,i),this}add(e){return this.clone().addSelf(e)}addSelf(e){let[t,r,i,a]=e.data;return this.data[0]+=t,this.data[1]+=r,this.data[2]+=i,this.data[3]+=a,this}minus(e){return this.clone().minusSelf(e)}minusSelf(e){let[t,r,i,a]=e.data;return this.data[0]-=t,this.data[1]-=i,this.data[2]-=r,this.data[3]-=a,this}multiplyScalar(e){return this.clone().multiplyScalarSelf(e)}multiplyScalarSelf(e){return this.data[0]*=e,this.data[1]*=e,this.data[2]*=e,this.data[3]*=e,this}multiply(e){return this.clone().multiplySelf(e)}multiplySelf(e){let[t,r,i,a]=this.data,[s,n,o,l]=e.data;return this.set(t*s+i*n,t*o+i*l,r*s+a*n,r*o+a*l),this}inverse(){return this.clone().inverseSelf()}inverseSelf(){let[e,t,r,i]=this.data,a=e*i-r*t;if(0===a)this.set(0,0,0,0);else{let s=1/a;this.set(i*s,-r*s,-t*s,e*s)}return this}getDeterminant(){let[e,t,r,i]=this.data;return e*i-r*t}transfer(e){let[t,r,a,s]=this.data,{x:n,y:o}=e;return new i.Vector2(t*n+a*o,r*n+s*o)}print(){let[e,t,r,i]=this.data;console.table([[e,r],[t,i]])}}t.Matrix2=a;class s{static I=Object.seal(new s);static zero(){return new s(0,0,0,0,0,0,0,0,0)}static fromVectors(e,t,r){return new s(e.x,t.x,r.x,e.y,t.y,r.y,e.z,t.z,r.z)}data;constructor(e=1,t=0,r=0,i=0,a=1,s=0,n=0,o=0,l=1){this.set(e,t,r,i,a,s,n,o,l)}set(e,t,r,i,a,s,n,o,l){this.data=[e,i,n,t,a,o,r,s,l]}clone(){let[e,t,r,i,a,n,o,l,c]=this.data;return new s(e,i,o,t,a,l,r,n,c)}flatten(){let[e,t,r,i,a,s,n,o,l]=this.data;return[e,i,n,t,a,o,r,s,l]}toFloat32Array(){return new Float32Array(this.data)}transpose(){return this.clone().transposeSelf()}transposeSelf(){let[e,t,r,i,a,s,n,o,l]=this.data;return this.set(e,t,r,i,a,s,n,o,l),this}add(e){return this.clone().addSelf(e)}addSelf(e){let[t,r,i,a,s,n,o,l,c]=e.data;return this.data[0]+=t,this.data[1]+=r,this.data[2]+=i,this.data[3]+=a,this.data[4]+=s,this.data[5]+=n,this.data[6]+=o,this.data[7]+=l,this.data[8]+=c,this}minus(e){return this.clone().minusSelf(e)}minusSelf(e){let[t,r,i,a,s,n,o,l,c]=e.data;return this.data[0]-=t,this.data[1]-=r,this.data[2]-=i,this.data[3]-=a,this.data[4]-=s,this.data[5]-=n,this.data[6]-=o,this.data[7]-=l,this.data[8]-=c,this}multiplyScalar(e){return this.clone().multiplyScalarSelf(e)}multiplyScalarSelf(e){return this.data[0]*=e,this.data[1]*=e,this.data[2]*=e,this.data[3]*=e,this.data[4]*=e,this.data[5]*=e,this.data[6]*=e,this.data[7]*=e,this.data[8]*=e,this}multiply(e){return this.clone().multiplySelf(e)}multiplySelf(e){let[t,r,i,a,s,n,o,l,c]=this.data,[d,h,u,p,m,f,g,y,w]=e.data;return this.set(t*d+a*h+o*u,t*p+a*m+o*f,t*g+a*y+o*w,r*d+s*h+l*u,r*p+s*m+l*f,r*g+s*y+l*w,i*d+n*h+c*u,i*p+n*m+c*f,i*g+n*y+c*w),this}leftMultiplyDataToSelf(...e){let[t,r,i,a,s,n,o,l,c]=e,[d,h,u,p,m,f,g,y,w]=this.data;return this.set(t*d+r*h+i*u,t*p+r*m+i*f,t*g+r*y+i*w,a*d+s*h+n*u,a*p+s*m+n*f,a*g+s*y+n*w,o*d+l*h+c*u,o*p+l*m+c*f,o*g+l*y+c*w),this}inverse(){return this.clone().inverseSelf()}inverseSelf(){let[e,t,r,i,a,s,n,o,l]=this.data,c=a*l-o*s,d=s*n-l*i,h=i*o-n*a,u=e*c+t*d+r*h;if(0===u)this.set(0,0,0,0,0,0,0,0,0);else{let p=1/u;this.set(c*p,d*p,h*p,(o*r-t*l)*p,(l*e-r*n)*p,(n*t-e*o)*p,(t*s-a*r)*p,(r*i-s*e)*p,(e*a-i*t)*p)}return this}getDeterminant(){let[e,t,r,i,a,s,n,o,l]=this.data;return e*a*l-n*a*r+i*o*r-i*t*l+n*t*s-e*o*s}transfer2(e){let t=i.Vector3.fromVector2(e),r=this.transfer3(t);return new i.Vector2(...r.xy)}transfer3(e){let[t,r,a,s,n,o,l,c,d]=this.data,{x:h,y:u,z:p}=e;return new i.Vector3(t*h+s*u+l*p,r*h+n*u+c*p,a*h+o*u+d*p)}print(){let[e,t,r,i,a,s,n,o,l]=this.data;console.table([[e,i,n],[t,a,o],[r,s,l]])}translate(e=0,t=0){return this.clone().translateSelf(e,t)}translateSelf(e=0,t=0){return this.leftMultiplyDataToSelf(1,0,e,0,1,t,0,0,1)}scale(e=1,t=1){return this.clone().scaleSelf(e,t)}scaleSelf(e=1,t=1){return this.leftMultiplyDataToSelf(e,0,0,0,t,0,0,0,1)}rotate(e=0){return this.clone().rotateSelf(e)}rotateSelf(e=0){let t=Math.cos(e),r=Math.sin(e);return this.leftMultiplyDataToSelf(t,-r,0,r,t,0,0,0,1)}skew(e=0,t=0){return this.clone().skewSelf(e,t)}skewSelf(e=0,t=0){let r=Math.tan(e),i=Math.tan(t);return this.leftMultiplyDataToSelf(1,r,0,i,1,0,0,0,1)}}t.Matrix3=s;class n{static I=Object.seal(new n);static zero(){return new n(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}static fromVectors(e,t,r,i){return new n(e.x,t.x,r.x,i.x,e.y,t.y,r.y,i.y,e.z,t.z,r.z,i.z,e.w,t.w,r.w,i.w)}static fromMatrix3(e){let[t,r,i,a,s,o,l,c,d]=e.data;return new n(t,a,0,l,r,s,0,c,0,0,1,0,i,o,0,d)}static lookAt(e,t,r=new i.Vector3(0,1,0)){let a=e.minus(t).normalize(),s=r.cross(a).normalize(),o=a.cross(s),l=e,c=new n(s.x,s.y,s.z,0,o.x,o.y,o.z,0,a.x,a.y,a.z,0,0,0,0,1),d=new n(1,0,0,-l.x,0,1,0,-l.y,0,0,1,-l.z,0,0,0,1);return c.multiplySelf(d)}static perspective(e,t,r,i=.1,a=100){return new n(r/(e/2),0,0,0,0,r/(t/2),0,0,0,0,-(a+i)/(a-i),-2*a*i/(a-i),0,0,-1,0)}data;constructor(e=1,t=0,r=0,i=0,a=0,s=1,n=0,o=0,l=0,c=0,d=1,h=0,u=0,p=0,m=0,f=1){this.set(e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f)}set(e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f){this.data=[e,a,l,u,t,s,c,p,r,n,d,m,i,o,h,f]}clone(){let[e,t,r,i,a,s,o,l,c,d,h,u,p,m,f,g]=this.data;return new n(e,a,c,p,t,s,d,m,r,o,h,f,i,l,u,g)}flatten(){let[e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f]=this.data;return[e,a,l,u,t,s,c,p,r,n,d,m,i,o,h,f]}toFloat32Array(){return new Float32Array(this.data)}transpose(){return this.clone().transposeSelf()}transposeSelf(){let[e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f]=this.data;return this.set(e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f),this}add(e){return this.clone().addSelf(e)}addSelf(e){let[t,r,i,a,s,n,o,l,c,d,h,u,p,m,f,g]=e.data;return this.data[0]+=t,this.data[1]+=r,this.data[2]+=i,this.data[3]+=a,this.data[4]+=s,this.data[5]+=n,this.data[6]+=o,this.data[7]+=l,this.data[8]+=c,this.data[9]+=d,this.data[10]+=h,this.data[11]+=u,this.data[12]+=p,this.data[13]+=m,this.data[14]+=f,this.data[15]+=g,this}minus(e){return this.clone().minusSelf(e)}minusSelf(e){let[t,r,i,a,s,n,o,l,c,d,h,u,p,m,f,g]=e.data;return this.data[0]-=t,this.data[1]-=r,this.data[2]-=i,this.data[3]-=a,this.data[4]-=s,this.data[5]-=n,this.data[6]-=o,this.data[7]-=l,this.data[8]-=c,this.data[9]-=d,this.data[10]-=h,this.data[11]-=u,this.data[12]-=p,this.data[13]-=m,this.data[14]-=f,this.data[15]-=g,this}multiplyScalar(e){return this.clone().multiplyScalarSelf(e)}multiplyScalarSelf(e){return this.data[0]*=e,this.data[1]*=e,this.data[2]*=e,this.data[3]*=e,this.data[4]*=e,this.data[5]*=e,this.data[6]*=e,this.data[7]*=e,this.data[8]*=e,this.data[9]*=e,this.data[10]*=e,this.data[11]*=e,this.data[12]*=e,this.data[13]*=e,this.data[14]*=e,this.data[15]*=e,this}multiply(e){return this.clone().multiplySelf(e)}multiplySelf(e){let[t,r,i,a,s,n,o,l,c,d,h,u,p,m,f,g]=this.data,[y,w,v,x,b,S,T,C,k,P,M,R,D,_,E,I]=e.data;return this.set(t*y+s*w+c*v+p*x,t*b+s*S+c*T+p*C,t*k+s*P+c*M+p*R,t*D+s*_+c*E+p*I,r*y+n*w+d*v+m*x,r*b+n*S+d*T+m*C,r*k+n*P+d*M+m*R,r*D+n*_+d*E+m*I,i*y+o*w+h*v+f*x,i*b+o*S+h*T+f*C,i*k+o*P+h*M+f*R,i*D+o*_+h*E+f*I,a*y+l*w+u*v+g*x,a*b+l*S+u*T+g*C,a*k+l*P+u*M+g*R,a*D+l*_+u*E+g*I),this}leftMultiply(e){return e.multiply(this)}leftMultiplySelf(e){return this.leftMultiplyDataToSelf(...e.flatten())}leftMultiplyDataToSelf(...e){let[t,r,i,a,s,n,o,l,c,d,h,u,p,m,f,g]=e,[y,w,v,x,b,S,T,C,k,P,M,R,D,_,E,I]=this.data;return this.set(t*y+r*w+i*v+a*x,t*b+r*S+i*T+a*C,t*k+r*P+i*M+a*R,t*D+r*_+i*E+a*I,s*y+n*w+o*v+l*x,s*b+n*S+o*T+l*C,s*k+n*P+o*M+l*R,s*D+n*_+o*E+l*I,c*y+d*w+h*v+u*x,c*b+d*S+h*T+u*C,c*k+d*P+h*M+u*R,c*D+d*_+h*E+u*I,p*y+m*w+f*v+g*x,p*b+m*S+f*T+g*C,p*k+m*P+f*M+g*R,p*D+m*_+f*E+g*I),this}inverse(){return this.clone().inverseSelf()}inverseSelf(){let[e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f]=this.data,g=c*m*o-p*d*o+p*n*h-s*m*h-c*n*f+s*d*f,y=u*d*o-l*m*o-u*n*h+a*m*h+l*n*f-a*d*f,w=l*p*o-u*c*o+u*s*h-a*p*h-l*s*f+a*c*f,v=u*c*n-l*p*n-u*s*d+a*p*d+l*s*m-a*c*m,x=e*g+t*y+r*w+i*v,b=0===x?0:1/x;return this.set(g*b,y*b,w*b,v*b,(p*d*i-c*m*i-p*r*h+t*m*h+c*r*f-t*d*f)*b,(l*m*i-u*d*i+u*r*h-e*m*h-l*r*f+e*d*f)*b,(u*c*i-l*p*i-u*t*h+e*p*h+l*t*f-e*c*f)*b,(l*p*r-u*c*r+u*t*d-e*p*d-l*t*m+e*c*m)*b,(s*m*i-p*n*i+p*r*o-t*m*o-s*r*f+t*n*f)*b,(u*n*i-a*m*i-u*r*o+e*m*o+a*r*f-e*n*f)*b,(a*p*i-u*s*i+u*t*o-e*p*o-a*t*f+e*s*f)*b,(u*s*r-a*p*r-u*t*n+e*p*n+a*t*m-e*s*m)*b,(c*n*i-s*d*i-c*r*o+t*d*o+s*r*h-t*n*h)*b,(a*d*i-l*n*i+l*r*o-e*d*o-a*r*h+e*n*h)*b,(l*s*i-a*c*i-l*t*o+e*c*o+a*t*h-e*s*h)*b,(a*c*r-l*s*r+l*t*n-e*c*n-a*t*d+e*s*d)*b),this}getDeterminant(){let[e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f]=this.data;return e*s*d*f-u*c*n*i+a*c*m*i-l*s*r*f+l*p*r*o-a*t*m*h+u*t*n*h-e*p*d*o}transfer2(e){let t=i.Vector4.fromVector2(e),r=this.transfer4(t);return new i.Vector2(...r.xy)}transfer3(e){let t=i.Vector4.fromVector3(e),r=this.transfer4(t);return new i.Vector3(...r.xyz)}transfer4(e){let[t,r,a,s,n,o,l,c,d,h,u,p,m,f,g,y]=this.data,{x:w,y:v,z:x,w:b}=e;return new i.Vector4(t*w+n*v+d*x+m*b,r*w+o*v+h*x+f*b,a*w+l*v+u*x+g*b,s*w+c*v+p*x+y*b)}print(){let[e,t,r,i,a,s,n,o,l,c,d,h,u,p,m,f]=this.data;console.table([[e,a,l,u],[t,s,c,p],[r,n,d,m],[i,o,h,f]])}translate(e=0,t=0,r=0){return this.clone().translateSelf(e,t,r)}translateSelf(e=0,t=0,r=0){return this.leftMultiplyDataToSelf(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1)}scale(e=1,t=1,r=1){return this.clone().scaleSelf(e,t,r)}scaleSelf(e=1,t=1,r=1){return this.leftMultiplyDataToSelf(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1)}rotate(e=0){return this.clone().rotateSelf(e)}rotateSelf(e=0){let t=Math.cos(e),r=Math.sin(e);return this.leftMultiplyDataToSelf(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}rotate3D(e=0,t=0,r=0){return this.clone().rotate3DSelf(e,t,r)}rotate3DSelf(e=0,t=0,r=0){if(0!==e){let t=Math.cos(e),r=Math.sin(e);this.leftMultiplyDataToSelf(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1)}if(0!==t){let e=Math.cos(t),r=Math.sin(t);this.leftMultiplyDataToSelf(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1)}if(0!==r){let e=Math.cos(r),t=Math.sin(r);this.leftMultiplyDataToSelf(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1)}return this}skew(e=0,t=0){return this.clone().skewSelf(e,t)}skewSelf(e=0,t=0){let r=Math.tan(e),i=Math.tan(t);return this.leftMultiplyDataToSelf(1,r,0,0,i,1,0,0,0,0,1,0,0,0,0,1)}}t.Matrix4=n},2307:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform vec2 \t maxDisplacement;\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 displacementColor = texture(iChannel[1], textureCoord1);\nfloat luminance = 0.299 * displacementColor.r + 0.587 * displacementColor.g + 0.114 * displacementColor.b;\nvec2 displacement = (2.0 * luminance - 1.0) * maxDisplacement / iVideoResolution;\ndisplacement.y = - displacement.y;\nvec2 displacedTextureCoord = textureCoord0 + displacement;\nvec4 color = texture(iChannel[0], displacedTextureCoord);\nvec4 inputColor = texture(iChannel[0], textureCoord0);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},2355:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decodeHTML=t.encodeHTML=void 0,t.encodeHTML=function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">")},t.decodeHTML=function(e){return(new DOMParser).parseFromString(`<!DOCTYPE html><body>${e}</body></html>`,"text/html").body.textContent}},2362:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),(0,r(4062).extendTransitions)({wave:{uniformSlides:[{name:"waveRadius",desc:"Wave Radius",min:.01,max:1,step:.01,value:.1},{name:"waveStrength",desc:"Wave Strength",min:.1,max:1,step:.1,value:.5},{name:"photoDeep",desc:"Photo Deep",min:.01,max:1,step:.01,value:.1},{name:"blurRadius",desc:"Blur Radius",min:.01,max:1,step:.01,value:.1}],steps:[{fragShaderName:"wave"}]}})},2378:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(356),a=["px","percent","url"];i.defineBinding("style",class{constructor(e,t,r){if(this.lastStyle={},r){if(r.length>2)throw new Error(`Modifier "${r.join(".")}" is not allowed, at most two modifiers (as style name property value modifier) can be specified for ":style"`);if(2===r.length&&!a.includes(r[1]))throw new Error(`Modifier "${r[1]}" is not allowed, it must be one of ${a.join(", ")}`);if(!/^[\w-]+$/.test(r[0])||a.includes(r[0]))throw new Error(`Modifier "${r[0]}" is not a valid style property`)}this.el=e,this.modifiers=r}update(e){let t=Object.keys(this.lastStyle),r=this.parseStyle(e),i=Object.keys(r);for(let e of t)i.includes(e)||(this.el.style[e]="");for(let e of i)t.includes(e)&&this.lastStyle[e]===r[e]||this.setStyle(e,r[e]);this.lastStyle=r}setStyle(e,t){let r=this.modifiers?this.modifiers[1]:"";null==t?t="":"px"===r?t+="px":"percent"===r?t+="%":"url"===r&&(t='url("'+t+'")'),"number"==typeof t&&(t+="px"),this.el.style[e]=t}parseStyle(e){let t={};if(this.modifiers)""!==e&&null!=e&&(t[this.modifiers[0]]=e);else if(Array.isArray(e))for(let r of e.join(";").split(/\s*;\s*/)){let[e,i]=r.split(/\s*:\s*/);e&&i&&(t[e]=i)}else if(e&&"object"==typeof e)t=e;else if(e&&"string"==typeof e)for(let r of e.split(/\s*;\s*/)){let[e,i]=r.split(/\s*:\s*/);e&&i&&(t[e]=i)}return t}remove(){if(this.lastStyle)for(let e of Object.keys(this.lastStyle))this.el.style[e]=""}})},2440:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDrawTransform=void 0;const i=r(555),a=r(9729),s=r(4910),n=r(3481),o=r(5499),l=r(1484);class c extends n.ToDraw{renderer;scissor=null;transformStatus;coords;textureCoords=null;mappedSamplers=[];constructor(e){super(e.renderer.sw,e),this.renderer=e.renderer,this.initializeUniforms()}initializeOptions(e){(0,o.assignIf)(e,{vertCode:a.default,fragCode:s.default}),super.initializeOptions(e)}initializeUniforms(){let{width:e,height:t}=this.renderer.project.data;this.setTransformStatus(new i.TransformStatus(e,t))}setTransformStatus(e){let{transformMatrix:t,projectionMatrix:r,samplingMatrix:i}=e;this.setUniform("iTransform",t.toFloat32Array()),this.setUniform("iProjection",r.toFloat32Array()),this.setUniform("iSamplingTransform",i.toFloat32Array()),this.setUniform("iOpacity",e.opacity),this.transformStatus=e}setSamplingParameters(e){let t=this.getSampler("iChannel");if(t)for(let r of t)r.updateParameters(e)}setCoords(e,t,r){this.coords=e;let i={vPosition:e.flat()};t&&(this.textureCoords=t,i.vTextureCoord=t.flat()),this.setVertices(i,e.length,r)}setChannel(...e){let t=e.map((e=>new l.MappedSampler(e)));this.setMappedChannel(...t)}setMappedChannel(...e){this.mappedSamplers=e,this.useSampler("iChannel",...e.map((e=>e.sampler))),this.setUniform("iChannelMap",new Float32Array(e.map((e=>e.mapMatrix.data)).flat()))}setSubMappedChannel(e,t){this.mappedSamplers[e]=t,this.useSubSampler("iChannel",e,t.sampler),this.setUniform("iChannelMap",new Float32Array(this.mappedSamplers.map((e=>e.mapMatrix.data)).flat()))}clearChannel(){this.mappedSamplers=[],this.unuseSampler("iChannel")}setInputPaintArea(e){let{width:t,height:r}=this.renderer.project.data,{x1:i,y1:a,x2:s,y2:n}=e,o=i/t,l=s/t,c=1-a/r,d=1-n/r,h=[[i,a],[i,n],[s,a],[s,n]],u=[[o,c],[o,d],[l,c],[l,d]];this.setCoords(h,u)}getPaintArea(){return this.transformStatus.getProjectedPaintArea(this.coords)}setMaskArea(e){if(e){let t=e.scale(this.renderer.scaleRatio).extend(2).round(),r=t.x1,i=this.sw.height-t.y2,a=t.width,s=t.height;this.scissor=[r,i,a,s]}else this.scissor=null}beforeDraw(){super.beforeDraw(),this.vertices||this.setFullscreenCoords(),this.scissor&&this.sw.setScissor(...this.scissor)}setFullscreenCoords(){let{width:e,height:t}=this.renderer.project.data,r=[[0,0],[0,t],[e,0],[e,t]];this.setCoords(r,[[0,1],[0,0],[1,1],[1,0]])}afterDraw(){super.afterDraw(),this.scissor&&this.sw.clearScissor()}}t.ToDrawTransform=c},2443:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.SVGPolarSampling=void 0;const a=r(1416),s=r(1919),n=r(4452),o=r(5499);let l=class extends a.Component{code="";output="";polarRadius=new Array(360);svgRect;svgCenter;render(){return a.html`
		<template class="polar-sampling">
			<f-textarea @change=${this.onTextareaChange} .placeholder="在这里黏贴 SVG 代码, 请确保你的代码使用 stroke 描边路径" />
			<button @click=${this.generate} :enable=${this.code}>生成极坐标采样数据</button>
			<f-input .value=${this.output} .placeholder="点击上面的按钮然后在此拷贝" />
		</template>
		`}onTextareaChange(e){this.code=e}generate(){let e=document.createElement("div");e.style.cssText="dispaly: fixed; left: 0; top: 0; visibility: hidden;",e.innerHTML=this.code;let t=e.querySelector("svg");if(!t)throw s.notification.error('未包含任何 "<svg>".'),"";document.body.append(e);let r=e.querySelectorAll("path");if(!r.length)throw s.notification.error('未包含任何 "<path>".'),"";this.svgRect=t.getBBox(),this.svgCenter=new n.Vector2(this.svgRect.x+this.svgRect.width/2,this.svgRect.y+this.svgRect.height/2);for(let e of r)this.processPath(e);this.makesureAllRadiusFilled();let i=new n.Vector2(this.svgRect.width,this.svgRect.height).length()/2,a=this.polarRadius.map((e=>(0,o.toDecimal)(e/i,4)));this.output=JSON.stringify(a)}processPath(e){let t=e.getTotalLength(),r=Math.min(this.svgRect.width,this.svgRect.height)/2*Math.PI/180,i=null,a=0;for(let s=0;s<t;s+=r)[i,a]=this.processLengthAtPath(e,s,i,a);this.processLengthAtPath(e,t,i,a)}processLengthAtPath(e,t,r,i){let a=e.getPointAtLength(t),o=new n.Vector2(a.x-this.svgCenter.x,-(a.y-this.svgCenter.y)),l=Math.atan2(o.y,o.x)/Math.PI*180;if(null!==r){if(r=this.fixAngleFrom(r,l),Math.abs(l-r)>5)throw s.notification.error("过大的采样跨度, 请确保你的 SVG 路径为单一的 stroke 描边路径, 您可以使用 Adobe Illustrator 进行编辑"),"";this.markRadiusAtIntegarAngle(e,r,i,l,t)}return[l,t]}fixAngleFrom(e,t){return Math.abs(t-e)>180&&(e=t<0?e-360:e+360),e}markRadiusAtIntegarAngle(e,t,r,i,a){t>i&&([t,i]=[i,t],[r,a]=[a,r]);let s=Math.ceil(t),n=Math.floor(i);for(let t=s;t<=n;t++){let i=(t+360)%360;this.polarRadius[i]=this.binarySearchRadius(e,t,r,a)}}binarySearchRadius(e,t,r,i){let a;for(let s=0;s<20;s++){let s=(r+i)/2,o=e.getPointAtLength(s);a=new n.Vector2(o.x-this.svgCenter.x,-(o.y-this.svgCenter.y));let l=Math.atan2(a.y,a.x)/Math.PI*180;if(l=this.fixAngleFrom(l,t),l>t)i=s;else{if(!(l<t))break;r=s}}return a.length()}makesureAllRadiusFilled(){if(this.polarRadius.filter((e=>void 0!==e)).length<2)throw s.notification.error("采样到的数据少于两个."),"";for(let e=0;e<this.polarRadius.length;e++)void 0===this.polarRadius[e]&&this.makesureRadiusFilled(e)}makesureRadiusFilled(e){let t=e,r=e;for(;t-- >-360&&void 0===this.polarRadius[(t+360)%360];);for(;r++<720&&void 0===this.polarRadius[(r+360)%360];);this.polarRadius[e]=(0*(r-e)+0*(e-t))/(r-t)}};t.SVGPolarSampling=l,t.SVGPolarSampling=l=i([(0,a.define)("svg-polar-sampling")],l)},2458:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform vec4 \t mapBlackTo;\nuniform vec4 \t mapWhiteTo;\nuniform float \t amountToTint;\nvec4 getFragColor() {\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord);\nfloat luminance = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\nvec4 tintColor = vec4(0);\ntintColor += mapBlackTo * (1.0 - luminance) * amountToTint;\ntintColor += mapWhiteTo * luminance * amountToTint;\ntintColor += color * (1.0 - amountToTint);\ntintColor *= iOpacity;\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\nreturn tintColor;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},2490:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebSafeFonts=void 0,t.WebSafeFonts={"en-US":{common:["Arial","Arial Black","Book Antiqua","Charcoal","Comic Sans MS","Consolas","Courier","Courier New","cursive","Gadget","Geneva","Georgia","Helvetica","Impact","Lucida Grande","Lucida Sans Unicode","Monaco","Palatino","Palatino Linotype","sans-serif","Tahoma","Times","Times New Roman","Trebuchet MS","Verdana"]},"zh-CN":{win:["黑体","宋体","新宋体","仿宋","楷体","微软雅黑"],mac:["冬青黑体","华文细黑","华文黑体","华文楷体","华文宋体","华文仿宋"]}}},2492:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFlatProjectionMatrix=t.getPixelReflectionMatrix=t.getFinalProjectedCoords=t.get2DProjectionMatrix=t.is3DProjectionMatrix=void 0;const i=r(2298),a=r(4452);function s(e){return 0!==e.data[11]}function n(e,t){let r=e/2,a=t/2;return new i.Matrix4(r,0,0,r,0,-a,0,a,0,0,1,0,0,0,0,1)}t.is3DProjectionMatrix=s,t.get2DProjectionMatrix=function(e,t){let r=2/e,a=2/t;return new i.Matrix4(r,0,0,-1,0,-a,0,1,0,0,0,0,0,0,0,1)},t.getFinalProjectedCoords=function(e,t,r,i,o){return s(r)?function(e,t,r,i,s){let o=r.multiply(t),l=n(i,s);return e.map((e=>{let t=o.transfer3(new a.Vector3(...e)),r=t.x/t.z,i=t.y/t.z;return l.transfer2(new a.Vector2(r,i))}))}(e,t,r,i,o):e.map((e=>t.transfer2(new a.Vector2(...e))))},t.getPixelReflectionMatrix=n,t.getFlatProjectionMatrix=function(e,t,r,a){let s=t.multiply(e),o=s.data[15],l=s.data[0]/o,c=s.data[4]/o,d=s.data[12]/o,h=s.data[1]/o,u=s.data[5]/o,p=s.data[13]/o,m=new i.Matrix4(l,c,0,d,h,u,0,p,0,0,1,0,0,0,0,1);return n(r,a).multiply(m)}},2501:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextACBase=void 0;const i=r(2854),a=r(9997);class s extends i.TextAnimationPlugin{inTime=0;outTime=0;effect;ignoreRandomStartVal;initialize(){this.isIn?this.inTime=this.getMarkerFromName("TR In").time:this.outTime=this.getMarkerFromName("TR Out").time,this.effect=this.getEffectFromName(this.effectName)}amount(e,t){let r;return r=this.isIn?(this.time-this.data.inPoint)/(this.inTime-this.data.inPoint):1-(this.time-this.outTime)/(this.data.outPoint-this.outTime),this.getAmountFromTimeRate(r,e,t)}getAmountFromTimeRate(e,t,r){let i=t+(this.effect.randomSeed||1),s=this.effect,n=s.reversedOrder?r-t:t,o=(s.delay||50)/100/r,l=1-o*(r-1);s.randomizedOrder&&(n=(0,a.seedRandom)(0,r,i));let c=(e-n*o)/l,d=0;d=c>1?0:c<0?1:this.calcAmount(c);let h=s.randomStartValueMin||100,u=s.randomStartValueMax||100;return(this.ignoreRandomStartVal?100:(0,a.seedRandom)(h,u,i))*d}}t.TextACBase=s},2522:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.List=void 0;const a=r(1416),s=r(8240),n=r(5499),o=r(6585);let l=class extends a.Component{constructor(){super(...arguments),this.type="selection",this.selectable=!1,this.multipleSelect=!1,this.data=[],this.selected=[],this.active=null}static style(){let{mainColor:e,adjust:t,borderColor:r,adjustFontSize:i}=s.theme;return a.css`
		:host{
			display: block;
			border-bottom: 1px solid ${r.alpha(.4)};
		}
		
		.option{
			position: relative;
			display: flex;
			padding-top: ${t(2)}px;
			padding-bottom: ${t(2)}px;
			cursor: pointer;
			border-top: 1px solid ${r.alpha(.4)};

			&:first-child{
				border-top: none;
			}

			&:hover{
				color: ${e};
			}

			&.selected{
				color: ${e};
			}

			&.active{
				color: ${e};

				&::after{
					content: '';
					position: absolute;
					top: ${t(3)}px;
					bottom: ${t(3)}px;
					right: 0;
					width: 2px;
					background: ${e.alpha(.8)};
				}
			}
		}

		.toggle{
			display: flex;
			width: ${t(22)}px;
			opacity: 0.7;
		}

		.icon{
			display: flex;
			width: ${t(22)}px;
		}

		.text{
			flex: 1;
			min-width: 0;
			padding-right: 4px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.selected-icon{
			margin: 0 ${t(6)}px;
		}

		.subsection{
			padding-left: ${t(22)}px;
			padding-bottom: ${t(4)}px;
			overflow: hidden;
			font-size: ${i(13)}px;

			.option{
				padding-top: 0;
				padding-bottom: 0;
				border-top: none;
				line-height: ${t(26)}px;
			}

			.subsection{
				padding-top: 0;
				padding-bottom: ${t(3)}px;
				margin-bottom: ${t(3)}px;
				border-bottom: 1px solid ${r.alpha(.4)};
			}
		}
		`}render(){return a.html`${this.renderDataOrChildren(this.data)}`}renderDataOrChildren(e){let t=e.some((e=>e.icon)),r=e.some((e=>e.children));return a.repeat(e,(e=>this.renderOption(e,t,r)))}renderOption(e,t,r){let i=e.children&&e.opened?a.html`
			<div class="subsection">${this.renderDataOrChildren(e.children)}</div>
		`:null,s=e.tip?o.tooltip(e.tip):null;return a.html`
		<div
			class="option"
			:class=${this.renderClassName(e)}
			@click.prevent=${()=>this.onClickOption(e)}
			${s}

		>
			${e.children?a.html`
				<div class='toggle' @click.stop=${()=>this.toggle(e)}>
					<f-icon .type=${e.opened?"triangle-down":"triangle-right"} />
				</div>
			`:r?a.html`
				<div class='toggle' />
			`:""}

			${t?a.html`
				<div class='icon'>
					<f-icon .type=${e.icon} />
				</div>
			`:""}
	
			<div class="text">
				${e.text}
			</div>

			${this.isSelected(e)?a.html`<f-icon class="selected-icon" .type="checked" />`:""}
		</div>

		${a.play(i,{transition:{properties:["height","opacity"]}})}
		`}renderClassName(e){if("navigation"===this.type){if(this.active===e.value)return"active"}else if(this.isSelected(e))return"selected";return""}isSelected(e){return this.selected.includes(e.value)}onClickOption(e){"navigation"===this.type?(this.active=e.value,this.emit("navigate",e.value)):this.selectable?(this.multipleSelect?this.selected.includes(e.value)?n.remove(this.selected,e.value):n.add(this.selected,e.value):this.selected=[e.value],this.emit("select",this.selected)):this.emit("click",e.value)}toggle(e){e.children&&(e.opened=!e.opened)}onCreated(){this.active&&this.ensureActiveItemVisible(this.data)}ensureActiveItemVisible(e){return e.some((e=>e.value===this.active||(e.children&&this.ensureActiveItemVisible(e.children)&&(e.opened=!0),e.opened)))}};l=i([a.define("f-list")],l),t.List=l},2579:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayer=void 0;const i=r(7818),a=r(2824),s=r(4008),n=r(4310),o=r(2440),l=r(3481),c=r(9160),d=r(1830),h=r(8066);r(8320);const u=r(4072),p=r(6412),m=r(4452),f=r(211);class g extends i.PixelLayer{toBlendText=null;toDrawMotionBlur=null;textAtlas;charPositions;previousCharTransformsAtTime=null;currentCharTransformsAtTime=null;outerMotionMatrix=null;charMotionMatrixes=null;flatProjectionMatrixInverse;toDrawBlur=null;sampler;charBlurList=null;async initialize(){await super.initialize(),await u.FontList.ensure(),this.initializeToDraws(),await this.initializeTextAtlas(),this.renderer.on("resize",this.onResize,this)}initializeToDraws(){this.toDraw=new h.ToDrawMultiple({renderer:this.renderer,type:this.data.animaters?l.ToDrawType.TriangleStrip:l.ToDrawType.Triangles}),this.sampler=new a.PixelSampler(this.renderer.sw,null),this.toDraw.setChannel(this.sampler),this.data.motionBlur&&this.data.animaters?this.toDrawMotionBlur=new c.ToDrawMotionBlur({renderer:this.renderer}):this.toBlendText=new o.ToDrawTransform({renderer:this.renderer}),this.data.animaters&&this.data.animaters.some((e=>e.properties.blur))&&(this.toDrawBlur=new p.ToDrawFastBlur({renderer:this.renderer,iterateCount:1,samplingCount:this.renderer.project.options.fastBlurSamplingCount}))}async initializeTextAtlas(){let e=this.renderer.sw.context,t=e.getParameter(e.MAX_TEXTURE_SIZE),r="encoding"===this.renderer.project.mode,i=this.renderer.project.data.height;this.textAtlas=new s.TextAtlas(this.data,t,i,{interfaceScaling:this.renderer.scaleRatio,transformScaling:1,textSuperSamplingRate:this.renderer.project.options.textSuperSamplingRate}),r||this.textAtlas.on("fontloaded",this.onFontLoaded,this),await this.updateTextAtlasCanvas(0,!0)}onFontLoaded(){this.renderer.mayUpdateAfterLayerUpdated(this.data)}onResize(){this.textAtlas&&(this.textAtlas.state.interfaceScaling=this.renderer.scaleRatio)}async syncTime(e){await this.updateTextAtlasCanvas(e,"encoding"===this.renderer.project.mode)}async updateTextAtlasCanvas(e,t){this.textAtlas.setTime(e),this.textAtlas.state.text=this.getCurrentText(),await this.textAtlas.tryUpdateCanvas(t)!==s.TextAtlasUpdatedOfCanvas.Nothing&&this.sampler.updateData(this.textAtlas.canvas)}getCurrentText(){return this.data.text||this.renderer.project.options.textPlaceholder||" "}setTransformStatus(e){super.setTransformStatus(e),this.flatProjectionMatrixInverse=this.toDraw.transformStatus.getFlatProjectionMatrix().inverse()}update(){super.update(),this.updateTextAtlas(),this.data.animaters&&this.updateAnimaters()}updateTextAtlas(){if(this.textAtlas.state.shouldUpdateCharPosition()){this.charPositions=this.textAtlas.generateCharPositions();let e=this.charPositions.getVertexCoords(),t=this.charPositions.getTextureCoords(),r=this.data.animaters?void 0:this.charPositions.getCoordIndices();this.toDraw.setCoords(e,t,r)}}updateAnimaters(){let{charTransforms:e,charOpacityList:t,charBlurList:r}=this.getPerCharAnimationProperties(this.time);this.toDraw.setSubTransformMatrixes(e),this.toDraw.setSubOpacityList(t),this.data.motionBlur&&this.updateMotionMatrixes(e),this.charBlurList=r.map((([e,t])=>new m.Vector2(e,t)))}getPerCharAnimationProperties(e){let t=this.charPositions.getCharIndices(),r=(0,n.getTextAnimaterProperties)(this.data,e,t);return{charTransforms:this.charPositions.getPerTextTransforms(r),charOpacityList:r.map((e=>e.opacity/100)),charBlurList:r.map((e=>e.blur))}}updateMotionMatrixes(e){if(this.previousCharTransformsAtTime=null,this.currentCharTransformsAtTime){let e=this.time-this.currentCharTransformsAtTime.time,t=Math.abs(e);t<=.05&&t>=.001&&(this.previousCharTransformsAtTime=this.currentCharTransformsAtTime)}if(!this.previousCharTransformsAtTime){let e=.015;this.time-e<this.data.inPoint&&(e=-.015),this.previousCharTransformsAtTime={transforms:this.getPerCharAnimationProperties(this.time-e).charTransforms,time:this.time-e}}this.currentCharTransformsAtTime={transforms:e,time:this.time};let t=this.renderer.project.options.frameRate,r=(0,f.getExposureTime)(180,t),i=this.previousCharTransformsAtTime.transforms,a=this.currentCharTransformsAtTime.transforms.map(((e,t)=>e.minus(i[t]))),s=this.currentCharTransformsAtTime.time-this.previousCharTransformsAtTime.time,n=a.map((e=>e.multiplyScalar(r/s))),o=this.toDraw.transformStatus.getFlatProjectionMatrix();this.charMotionMatrixes=n.map((e=>o.multiply(e)))}setBaseMotionMatrix(e){let t=this.renderer.project.options.frameRate,r=(0,f.getExposureTime)(180,t);this.outerMotionMatrix=e.multiplyScalar(r)}drawMainContent(){return this.toDrawMotionBlur||this.toDrawBlur?this.drawEachSeperately():this.drawAllTogether()}drawEachSeperately(){let e=[];for(let t=0;t<this.charPositions.getLength();t++){let{mappedSampler:r,paintArea:i}=this.drawEachCharAsSampler(t);if(!r||!i)continue;let a=null,s=()=>!(a&&(({mappedSampler:r,paintArea:i}=this.renderer.drawAsMappedSamplerFromFn(a)),!r||!i));if(this.toDrawBlur){if(!s())continue;a=this.willDrawBlur(t,r,i)}if(this.toDrawMotionBlur){if(!s())continue;a=this.willDrawMotionBlur(t,r,i)}a&&e.push(a())}return d.PaintArea.union(e)}drawEachCharAsSampler(e){let t=this.toDraw.getPaintAreaByIndex(e);if(!t)return{mappedSampler:null,paintArea:t};let r=this.renderer.requestPartialTextureFrame(t,!1,2);return r.active(),this.toDraw.drawFromIndex(e),r.deactive(),{mappedSampler:r.getMappedSampler(),paintArea:t}}willDrawMotionBlur(e,t,r){let i=this.toDrawMotionBlur,a=this.outerMotionMatrix,s=this.currentCharTransformsAtTime.transforms[e],n=a.multiply(s),o=this.charMotionMatrixes[e],l=n.add(o).multiply(this.flatProjectionMatrixInverse);return i.setMotionMatrix(l),i.setInputPaintArea(r),i.setMappedChannel(t),()=>(i.draw(),i.clearChannel(),i.getPaintArea())}willDrawBlur(e,t,r){let i=this.toDrawBlur;return i.setBlurRadius(this.transformStatus.projectVector(this.charBlurList[e])),i.setInputPaintArea(r),i.setMappedChannel(t),()=>(i.draw(),i.clearChannel(),i.getPaintArea())}drawAllTogether(){let e=this.toDraw.getPaintArea(),t=null;return e&&(t=this.renderer.requestPartialTextureFrame(e,!1,2),t.active(),this.toDraw.draw(),t.deactive(),this.toBlendText.setInputPaintArea(e),this.toBlendText.setMappedChannel(t.getMappedSampler()),this.toBlendText.draw(),this.toBlendText.clearChannel()),e}delete(){super.delete(),this.toDrawMotionBlur&&this.toDrawMotionBlur.delete(),this.toDrawBlur&&this.toDrawBlur.delete(),this.toBlendText&&this.toBlendText.delete(),this.renderer.off("resize",this.onResize,this),this.textAtlas.off("fontloaded",this.onFontLoaded,this)}}t.TextLayer=g},2623:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),r(1413),r(177),r(3819),r(3602),r(1008),r(9819),r(5043),r(2362),r(9663),r(9315),r(5685),r(8611),r(1918),r(169),r(6147),r(4762),r(5007),r(4201),r(1235),r(8219),r(236),r(9162),r(9803),r(5466),r(7286),r(3744)},2659:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nout vec4 fragColor;\nuniform vec4 solidColor;\nuniform float iOpacity;\nvec4 getFragColor() {\nreturn solidColor * iOpacity;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},2662:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.appendTo=t.renderComponent=t.render=void 0;const i=r(4511),a=r(9856),s=r(7860),n=r(2951);function o(e,t=null,r){return"function"==typeof e?l(e,t,r):function(e,t=null){e instanceof n.DirectiveResult&&(e=i.html`${e}`);let r=new i.Template(e,t),a=r.range.getFragment();return{template:r,fragment:a}}(e,t)}function l(e,t=null,r){let a,o=(t||s.globalWatcherGroup).watchImmediately(e,(e=>{e instanceof n.DirectiveResult&&(e=i.html`${e}`),a?(a.merge(e),r&&r()):a=new i.Template(e,t)}));return{fragment:a.range.getFragment(),unwatch:o}}t.render=o,t.renderComponent=function(e,t=null,r){let i,s,n=null,c=null;"function"==typeof e?({fragment:s,unwatch:c}=l(e,t,r)):({fragment:s,template:i}=o(e,t));let d=s.firstElementChild;if(d){let e=a.getComponentConstructor(d.localName);e&&(n=a.createComponent(d,e))}return c?{component:n,unwatch:c}:{component:n,template:i}},t.appendTo=function(e,t){let r=e.firstElementChild;if("string"==typeof t){let r=document.querySelector(t);r&&r.lastElementChild!==e&&r.append(e)}else t&&t.lastElementChild!==e&&t.append(e);return r}},2703:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec4 fRawCoord;\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform float \t contrast;\nuniform float brightness;\nuniform float complexity;\nuniform float subInfluence;\nuniform mat4 noiseTransform;\nuniform mat4 subNoiseTransform;\nfloat random2(vec2 v) {\nreturn fract(sin(dot(v, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat noise2(vec2 v) {\nvec2 i = floor(v);\nvec2 f = fract(v);\nvec2 u = f * f * (3.0 - 2.0 * f);\nfloat a = random2(i);\nfloat b = random2(i + vec2(1.0, 0.0));\nfloat c = random2(i + vec2(0.0, 1.0));\nfloat d = random2(i + vec2(1.0, 1.0));\nreturn mix(a, b, u.x) +\n(c - a)* u.y * (1.0 - u.x) +\n(d - b) * u.x * u.y;\n}\nvec4 getFragColor() {\nvec2 pixelCoord = (noiseTransform * vec4(fRawCoord.xy, 0, 1)).xy;\nfloat noiseRadiusInPx = 50.0;\nvec2 noiseCoord = pixelCoord / noiseRadiusInPx;\nfloat influence = 1.0;\nfloat sum = 0.0;\nfloat total = 0.0;\nfloat loopCount = ceil(complexity);\nfor (float i = 0.0; i <= loopCount; i += 1.0) {\nfloat noiseValue = noise2(noiseCoord);\nfloat smoothValue = smoothstep(0.0, 1.0, noiseValue);\nfloat complexityRate = max(complexity + 1.0 - i, 1.0);\nsum += smoothValue * influence * complexityRate;\ntotal += influence * complexityRate;\nnoiseCoord = (subNoiseTransform * vec4(noiseCoord, 0, 1)).xy;\ninfluence *= subInfluence;\n}\nfloat value = sum / total;\nvalue = (value - 0.5) * contrast + 0.5 + brightness;\nvec4 color = vec4(value, value, value, 1);\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},2736:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.repeat=t.RepeatDirective=void 0;const i=r(5428),a=r(7860),s=r(162),n=r(4850),o=r(9395);class l{constructor(e,t){this.data=[],this.wtems=[],this.unwatchData=null,this.startIndex=0,this.anchor=e,this.context=t,this.transition=new s.DirectiveTransition(t)}watchAndUpdateDataImmediately(e){this.unwatchData&&(this.unwatchData(),this.unwatchData=null),e?this.unwatchData=(this.context||a.globalWatcherGroup).watchImmediately((()=>[...e].map(o.observe)),(e=>{this.updateData(e)})):this.updateData([])}canMergeWith(e,t){return t.toString()===this.templateFn.toString()}merge(e,t,r){this.templateFn=t,this.transition.updateOptions(r),this.watchAndUpdateDataImmediately(e)}updateData(e){let t=this.transition.shouldPlay(),r=this.data,i=new Map,a=this.wtems,s=this.data=e,n=new Set(this.data);this.wtems=[];let o=new Set,l=new Set;for(let e=0;e<r.length;e++){let t=r[e];null===t||i.has(t)?o.add(e):(i.set(t,e),n.has(t)||o.add(e))}function c(e){for(let t=e;t<r.length;t++){let e=r[t];if(n.has(e)&&i.get(e)===t)return t}return r.length}let d=c(0),h=-1;for(let e=0;e<s.length;e++){let n=s[e],u=e+this.startIndex;if(i.has(n)){let e=i.get(n);if(l.has(e)&&(e=-1),e>=d){this.useMatchedOne(a[e],u),l.add(e),h=e,d=c(e+1);continue}if(e>-1){this.moveOneBefore(a[e],d<r.length?a[d]:null),this.useMatchedOne(a[e],u),l.add(e),h=d;continue}}if(!t&&this.shouldReuse(n)&&o.size>0){let e=o.keys().next().value;e>h&&e<d||(this.moveOneBefore(a[e],d<r.length?a[d]:null),h=d),this.reuseOne(a[e],n,u),o.delete(e),l.add(e)}else this.wtems.push(this.createOne(n,u,d<r.length?a[d]:null))}if(l.size<r.length)for(let e=0;e<r.length;e++)l.has(e)||this.removeOne(a[e])}shouldReuse(e){return!0}useMatchedOne(e,t){e.updateIndex(t),this.wtems.push(e)}reuseOne(e,t,r){e.update(t,r),this.wtems.push(e)}moveOneBefore(e,t){let r=e.template.range.getFragment();t?t.template.range.startNode.before(r):this.anchor.insert(r)}createOne(e,t,r){let i=this.createWatchedTemplate(e,t),a=i.template.range.getFragment(),s=null;return this.transition.shouldPlayEnter()&&(s=a.firstElementChild),r?r.template.range.startNode.before(a):this.anchor.insert(a),s&&this.transition.playEnter(s),i}createWatchedTemplate(e,t){return new n.WatchedTemplate(this.context,this.templateFn,e,t)}removeOne(e){let t=e.template;if(this.transition.shouldPlay()){let r=t.range.getFirstElement();r?this.transition.playLeave(r).then((t=>{t&&this.onWatchedTemplateNotInUse(e)})):this.onWatchedTemplateNotInUse(e)}else this.onWatchedTemplateNotInUse(e)}onWatchedTemplateNotInUse(e){e.remove()}remove(){this.unwatchData&&this.unwatchData();for(let e of this.wtems)e.remove()}}t.RepeatDirective=l,t.repeat=i.defineDirective(l)},2824:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextureFrameSampler=t.FloatSampler=t.PixelSampler=t.Sampler=t.SamplerWrapType=t.SamplerFilter=void 0;const i=r(7678),a=r(2258),s=r(5499),n=r(7928);var o,l;!function(e){e[e.Nearest=WebGL2RenderingContext.prototype.NEAREST]="Nearest",e[e.Linear=WebGL2RenderingContext.prototype.LINEAR]="Linear",e[e.MipmapNearestStatic=WebGL2RenderingContext.prototype.NEAREST_MIPMAP_NEAREST]="MipmapNearestStatic",e[e.MipmapNearest=WebGL2RenderingContext.prototype.NEAREST_MIPMAP_LINEAR]="MipmapNearest",e[e.MipmapLinearStatic=WebGL2RenderingContext.prototype.LINEAR_MIPMAP_NEAREST]="MipmapLinearStatic",e[e.MipmapLinear=WebGL2RenderingContext.prototype.LINEAR_MIPMAP_LINEAR]="MipmapLinear"}(o||(t.SamplerFilter=o={})),function(e){e[e.Repeat=WebGL2RenderingContext.prototype.REPEAT]="Repeat",e[e.Mirror=WebGL2RenderingContext.prototype.MIRRORED_REPEAT]="Mirror",e[e.ClampToEdge=WebGL2RenderingContext.prototype.CLAMP_TO_EDGE]="ClampToEdge"}(l||(t.SamplerWrapType=l={}));const c={filter:o.Nearest,wrapType:l.Mirror,anisotropy:!1};class d extends s.Emitter{id=(0,i.generateUniqueID)();data;width;height;params;texture;unitIndex;context;manager;deleteAfterNoReference=!0;glSampler;counter;constructor(e,t,r={}){super(),this.context=e.context,this.manager=e.samplerManager,this.counter=e.samplerReferenceCounter,this.data=t;let i=this.getDataSize(t);this.width=i.width,this.height=i.height,this.glSampler=this.context.createSampler(),this.setupParameters(Object.assign({},c,r)),this.initialize()}initialize(){if(this.manager.requestUnitIndex(this),this.manager.requestTexture(this)===a.TextureUploadState.NotUploaded){let{width:e,height:t}=this;if(e&&t){let r=n.debug.timeStart(`${this.data?"Uploading":"Allocating"} ${this.constructor.name} ${this.id} in size "${e}x${t}"`);this.uploadData(),r()}else this.uploadData()}this.manager.ensureMipmapIfNeeded(this),this.context.bindSampler(this.unitIndex,this.glSampler)}setupParameters(e){this.setupFilterParameter(e.filter),this.setupAnisotropyParameter(e.anisotropy),this.setupWrapTypeParameter(e.wrapType),this.params=e}setupFilterParameter(e){let t=this.context,r=this.glSampler;switch(e){case o.MipmapLinearStatic:case o.MipmapLinear:case o.Linear:t.samplerParameteri(r,t.TEXTURE_MAG_FILTER,t.LINEAR);break;default:t.samplerParameteri(r,t.TEXTURE_MAG_FILTER,t.NEAREST)}t.samplerParameteri(r,t.TEXTURE_MIN_FILTER,e)}setupAnisotropyParameter(e){let t=this.context,r=this.glSampler;if(e){var i=t.getExtension("EXT_texture_filter_anisotropic");if(i){var a=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT);t.samplerParameterf(r,i.TEXTURE_MAX_ANISOTROPY_EXT,a)}t.samplerParameteri(r,t.TEXTURE_MAG_FILTER,t.LINEAR),t.samplerParameteri(r,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR)}}setupWrapTypeParameter(e){let t=this.context,r=this.glSampler;t.samplerParameteri(r,t.TEXTURE_WRAP_S,e),t.samplerParameteri(r,t.TEXTURE_WRAP_T,e)}inUse(){return this.counter.isUsing(this)}__use(e){this.counter.use(this,e)}__unuse(e){this.counter.unuse(this,e)}__onNoReference(){this.emit("noreference")}__onNoReferenceForSeconds(){this.deleteAfterNoReference&&this.delete()}__onNoTouchForSeconds(e){console.warn(`Sampler "${this.id}" has no reference for ${e} seconds after created`)}active(e=null){if(!(this.unitIndex>-1)){if(!this.glSampler)throw new Error(`Sampler "${this.id}" has been deleted!`);this.manager.requestUnitIndex(this,e),this.context.bindSampler(this.unitIndex,this.glSampler),this.context.bindTexture(this.context.TEXTURE_2D,this.texture)}}activeAsCurrent(){this.unitIndex>-1?(this.context.activeTexture(this.context.TEXTURE0+this.unitIndex),this.context.bindTexture(this.context.TEXTURE_2D,this.texture)):this.active()}updateParameters(e){e=Object.assign({},c,e),(0,s.deepEqual)(e,this.params)||(this.setupParameters(e),this.manager.ensureMipmapIfNeeded(this))}updateMipmapIfNeed(){this.manager.generateMipmapIfNeeded(this)}shouldGenerateMipmap(){let e=this.params.filter;return[o.MipmapNearestStatic,o.MipmapLinearStatic,o.MipmapNearest,o.MipmapLinear].includes(e)}updateData(e){e!==this.data&&this.manager.hasTextureForData(e)&&this.updateDataWithNewTexture(e);let t=this.getDataSize(e);t.width===this.width&&t.height===this.height?this.updateDataInSameSize(e):this.updateDataWithNewTexture(e)}updateDataInSameSize(e){this.manager.replaceDataReference(this,e),this.data=e,this.activeAsCurrent(),this.replaceData(),this.context.bindSampler(this.unitIndex,this.glSampler),this.updateMipmapIfNeed()}updateDataWithNewTexture(e){this.manager.deleteUnitAndTexture(this);let t=this.getDataSize(e);this.width=t.width,this.height=t.height,this.data=e,this.initialize()}release(){this.__onNoReference()}delete(){this.manager.deleteUnitAndTexture(this),this.counter.delete(this),this.context.deleteSampler(this.glSampler),this.glSampler=null;let{width:e,height:t}=this;n.debug.verbose(`${this.constructor.name} ${this.id} in size "${e}x${t}" deleted`),this.emit("delete")}}t.Sampler=d,t.PixelSampler=class extends d{getDataSize(e){let t=0,r=0;return e instanceof HTMLVideoElement?(t=e.videoWidth,r=e.videoHeight):e instanceof HTMLImageElement?(t=e.naturalWidth,r=e.naturalHeight):(e instanceof HTMLCanvasElement||e)&&(t=e.width,r=e.height),{width:t,height:r}}uploadData(){if(this.data)if(this.data instanceof HTMLElement){let e=this.data;this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,e)}else{let{width:e,height:t,data:r}=this.data;this.data.data=null,this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,e,t,0,this.context.RGBA,this.context.UNSIGNED_BYTE,r)}}replaceData(){if(this.data)if(this.data instanceof HTMLElement){let e=this.data;this.context.texSubImage2D(this.context.TEXTURE_2D,0,0,0,this.context.RGBA,this.context.UNSIGNED_BYTE,e)}else{let{width:e,height:t,data:r}=this.data;if(!r)throw new Error("Decoded image data has been released, please don't use it directly!");this.context.texSubImage2D(this.context.TEXTURE_2D,0,0,0,e,t,this.context.RGBA,this.context.UNSIGNED_BYTE,r)}}shouldGenerateMipmap(){return!!this.data&&super.shouldGenerateMipmap()}},t.FloatSampler=class extends d{getDataSize(e){return{width:e.width,height:e.height}}uploadData(){this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.R16F,this.width,this.height,0,this.context.RED,this.context.FLOAT,this.data.data)}replaceData(){let e=this.width,t=this.height;this.data&&this.context.texSubImage2D(this.context.TEXTURE_2D,0,0,0,e,t,this.context.RGBA,this.context.UNSIGNED_BYTE,this.data.data)}},t.TextureFrameSampler=class extends d{deleteAfterNoReference=!1;getDataSize(e){return{width:e.width,height:e.height}}uploadData(){this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.width,this.height,0,this.context.RGBA,this.context.UNSIGNED_BYTE,null)}updateData(){throw new Error('Can\'t update data for "TextureFrameSampler"!')}replaceData(){throw new Error('Can\'t replace data for "TextureFrameSampler"!')}}},2846:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.GLDocs=void 0;const a=r(1919),s=r(1416),n=r(1416),o=r(5499),l=r(8783);window.flit=n,a.theme.changeTheme("large");let c=class extends s.Component{pageName=location.hash.slice(1)||"about";navData=[{value:"about",text:"关于 (About)"},{value:"references/",text:"参考 (References)",children:[{value:"references/computer-graphics",text:"计算机图形学 (Computer Graphics)"},{value:"references/computational-geometry",text:"计算几何 (Computational Geometry)"}]},{value:"math/",text:"数学 (Math)",children:[{value:"math/function-fitting",text:"函数拟合 (Function Fitting)"},{value:"math/continuous",text:"连续 (Continous)"},{value:"math/vector-modeling",text:"向量建模 (Vector Modeling)"},{value:"math/filtering",text:"滤波 (Filtering)"},{value:"math/gradient-sampling",text:"梯度采样 (Gradient Sampling)"},{value:"math/transform",text:"变换的数学原理 (Transform)"}]},{value:"algorithms/",text:"算法 (Algorithms)",children:[{value:"algorithms/easing",text:"缓动 (Easing)"},{value:"algorithms/blur",text:"模糊 (Blur)"}]},{value:"opengl/",text:"OpenGL",children:[{value:"opengl/architecture",text:"架构 (Architecture)"},{value:"opengl/shader-program",text:"着色程序 (Shader Program)"},{value:"opengl/vertex",text:"顶点数据 (Vertex Data)"},{value:"opengl/texture-units",text:"纹理单元 (Texture Units)"},{value:"opengl/sampling",text:"采样 (Sampling)"},{value:"opengl/glsl",text:"GLSL"},{value:"opengl/performance",text:"性能 (Performance)"},{value:"opengl/blending",text:"混合 (blending)"}]},{value:"color-correction/",text:"调色 (Color Grading)",children:[{value:"color-correction/color-balance",text:"色彩平衡 (Color Balance)"},{value:"color-correction/lightness",text:"亮度 (Lightness)"},{value:"color-correction/exposure",text:"曝光度 (Exposure)"},{value:"color-correction/contrast",text:"对比度 (Contrast)"},{value:"color-correction/saturation",text:"饱和度 (Saturation)"},{value:"color-correction/vibrance",text:"自然饱和度 (Vibrance)"},{value:"color-correction/hue",text:"色相 (Hue)"},{value:"color-correction/hue-by-color",text:"单色色相 (Hue)"},{value:"color-correction/saturation-by-color",text:"单色饱和度 (Saturation)"},{value:"color-correction/lightness-by-color",text:"单色亮度 (Lightness)"},{value:"color-correction/shadows",text:"阴影 (Shadows)"},{value:"color-correction/highlights",text:"高光 (Highlights)"}]},{value:"transitions/",text:"转场 (Transitions)",children:[{value:"transitions/geometry",text:"几何 (Geometry)",children:[{value:"transitions/geometry/push",text:"滑动 (Push)"},{value:"transitions/geometry/wipe",text:"擦除 (Wipe)"},{value:"transitions/geometry/slant-wipe",text:"斜线擦除 (Slant-Wipe)"},{value:"transitions/geometry/radar",text:"雷达 (Radar)"},{value:"transitions/geometry/rays",text:"射线 (Rays)"},{value:"transitions/geometry/enlarge",text:"放大 (Enlarge)"},{value:"transitions/geometry/alternate",text:"轮换 (Alternate)"},{value:"transitions/geometry/shuffle",text:"洗牌 (Shuffle)"},{value:"transitions/geometry/split",text:"分割 (Split)"},{value:"transitions/geometry/face-transform",text:"脸部变换 (Face Transform)"}]},{value:"transitions/pixelate",text:"像素化 (Pixelate)",children:[{value:"transitions/pixelate/cube-pixelate",text:"方格像素化 (Cube Pixelate)"},{value:"transitions/pixelate/hexagon-pixelate",text:"六边形像素化 (Hexagon Pixelate)"}]},{value:"transitions/dissolve",text:"溶解 (Dissolve)",children:[{value:"transitions/dissolve/fade",text:"淡入淡出 (Fade)"},{value:"transitions/dissolve/flash",text:"闪烁 (Flash)"},{value:"transitions/dissolve/mask",text:"蒙版 (Mask)"},{value:"transitions/dissolve/mask-fade",text:"渐变蒙版 (Mask Fade)"},{value:"transitions/dissolve/mask-of-shape",text:"形状蒙版 (Mask of Shape)"},{value:"transitions/dissolve/mask-of-polar-sampling",text:"极坐标采样蒙版 (Mask of Polar Sampling)"}]},{value:"transitions/distortion",text:"扭曲 (Distortion)",children:[{value:"transitions/distortion/morph",text:"变形 (Morph)"},{value:"transitions/distortion/color-offset",text:"颜色偏离 (Color Offset)"},{value:"transitions/distortion/fly-eye",text:"蝇眼 (Fly Eye)"},{value:"transitions/wave",text:"波浪 (Wave)"}]},{value:"transitions/blur",text:"模糊 (Blur)",children:[{value:"transitions/blur/zoom-blur",text:"缩放模糊 (Zoom Blur)"},{value:"transitions/blur/motion-blur",text:"运动模糊 (Motion Blur)"}]},{value:"transitions/stripe-or-grid",text:"条纹和网格 (Stripe or Grid)",children:[{value:"transitions/stripe-or-grid/stripe-merge",text:"条纹合并 (Stripe-Merge)"},{value:"transitions/stripe-or-grid/grid-zoom",text:"网格缩放 (Grid Zoom)"},{value:"transitions/stripe-or-grid/shutter",text:"百叶窗 (Shutter)"}]},{value:"transitions/3d",text:"3D",children:[{value:"transitions/3d/page-curl",text:"卷页 (Page Curl)"},{value:"transitions/3d/cube",text:"立方体 (Cube)"}]}]},{value:"aegl/",text:"AEGL",children:[]}];aeglTemplateList;render(){return s.html`
		<template class="docs">
			<div class="wrapper docs-wrapper">
				<f-navigation :ref="navigation" class="navigation" @navigate=${this.navigateTo} .data=${this.navData} .active=${this.pageName} />
				<div class="content" :ref="content"></div>
			</div>
		</template>
		`}onCreated(){this.watchImmediately((()=>a.theme.mode),(e=>{document.body.classList.remove("theme-light","theme-dark"),document.body.classList.add("theme-"+e)}))}async onReady(){await this.loadAEGLTemplateList(),await this.load(this.pageName),window.onhashchange=()=>{this.navigateTo(location.hash.slice(1))}}async loadAEGLTemplateList(){this.aeglTemplateList=await l.TemplateList.get();let e=this.navData.find((e=>"aegl/"===e.value)),t=this.aeglTemplateList.map((({id:e,name:t})=>({value:`aegl/${e}`,text:`${t}`})));e.children.push(...t)}async navigateTo(e){this.pageName!==e&&(this.pageName=e,location.hash="#"+e,this.load(e))}async load(e){if(/^aegl\/(\d+)$/.test(e)){let t=Number((0,o.firstMatch)(e,/^aegl\/(\d+)$/)),{name:r}=this.aeglTemplateList.find((e=>e.id===t)),i=`\n# ${t} - ${r}\n<aegl-preview .id="${t}"></aegl-preview>\n`;this.loadHTML(marked(i))}else{let t="md/"+e.replace(/\/$/,"/index")+".md",r=await fetch(t,{credentials:"include"}),i=await r.text();this.loadHTML(marked(i))}}async loadHTML(e){let t=new s.TemplateResult("html",[e],[]);this.refs.content.innerHTML="",this.refs.content.append((0,s.render)(t,this).fragment),this.refs.content.querySelectorAll('pre[class^="language-"]').forEach((e=>{Prism.highlightElement(e)})),MathJax.typeset()}};t.GLDocs=c,t.GLDocs=c=i([(0,s.define)("gl-docs")],c)},2854:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTextAnimaterPlugin=t.registerTextAnimaterPlugin=t.TextAnimationPlugin=void 0,t.TextAnimationPlugin=class{animater;data;time=0;constructor(e,t){this.data=e,this.animater=t}getEffectFromName(e){return this.data.effects.find((t=>t.name===e))}getMarkerFromName(e){return this.data.markers.find((t=>t.comment===e))}updateTime(e){this.time=e}amount(e,t){return 0}anchorPoint(e,t){return[0,0,0]}position(e,t){return[0,0,0]}scale(e,t){return[0,0,0]}skew(e,t){return 0}skewAxis(e,t){return 0}rotation(e,t){return 0}xRotation(e,t){return 0}yRotation(e,t){return 0}zRotation(e,t){return 0}opacity(e,t){return 0}trackingAmount(e,t){return 0}};const r=new Map;t.registerTextAnimaterPlugin=function(e,t){r.set(e,t)},t.getTextAnimaterPlugin=function(e){e=e.replace(/\s+\d\s*/g," ").trim();let t=r.get(e);if(!t)throw new Error(`No plugin with name ${e} exist!`);return t}},2855:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateResult=t.css=t.svg=t.html=void 0;const i=r(9749);t.html=function(e,...t){return new a("html",e,t)},t.svg=function(e,...t){return new a("svg",e,t)},t.css=function(e,...t){return new a("css",e,t)};class a{constructor(e,t,r){this.type=e,this.strings=t,this.values=r}toString(){let e=this.strings[0];for(let t=0;t<this.strings.length-1;t++){let r=this.values[t];null!=r&&(Array.isArray(r)?e+=r.join(""):e+=String(r)),e+=this.strings[t+1]}return e}extends(e){return"html"===this.type||"svg"===this.type?i.extendsTemplateResult(this,e):new a(this.type,[...e.strings,...this.strings],[...e.values,"",...this.values])}}t.TemplateResult=a},2888:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReferenceCounter=void 0,t.ReferenceCounter=class{noReferenceForSeconds=5;noTouchForSeconds=5;usedMap=new Map;deleteTimeoutMap=new Map;warnNoTouchTimeoutMap=new Map;constructor(e={}){void 0!==e.noReferenceForSeconds&&(this.noReferenceForSeconds=e.noReferenceForSeconds),void 0!==e.noTouchForSeconds&&(this.noTouchForSeconds=e.noTouchForSeconds)}register(e){let t=setTimeout((()=>this.warnNoTouch(e)),1e3*this.noTouchForSeconds);this.warnNoTouchTimeoutMap.set(e.id,t)}warnNoTouch(e){this.warnNoTouchTimeoutMap.delete(e.id),e.__onNoTouchForSeconds(this.noTouchForSeconds)}use(e,t){this.clearTimeouts(e.id);let r=this.usedMap.get(e.id);r||(r=new Set,this.usedMap.set(e.id,r)),r.add(t)}clearTimeouts(e){let t=this.deleteTimeoutMap.get(e);void 0!==t&&(clearTimeout(t),this.deleteTimeoutMap.delete(e));let r=this.warnNoTouchTimeoutMap.get(e);void 0!==r&&(clearTimeout(r),this.warnNoTouchTimeoutMap.delete(e))}unuse(e,t){if(!this.usedMap.has(e.id))return;let r=this.usedMap.get(e.id);if(r.delete(t),0===r.size){let t=setTimeout((()=>this.deleteReference(e)),1e3*this.noReferenceForSeconds);this.deleteTimeoutMap.set(e.id,t),e.__onNoReference()}}isUsing(e){let t=this.usedMap.get(e.id);return!!t&&t.size>0}deleteReference(e){this.deleteTimeoutMap.delete(e.id),this.usedMap.delete(e.id),e.__onNoReferenceForSeconds(this.noReferenceForSeconds)}delete(e){this.clearTimeouts(e.id),this.usedMap.delete(e.id)}}},2951:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(5428);Object.defineProperty(t,"defineDirective",{enumerable:!0,get:function(){return i.defineDirective}}),Object.defineProperty(t,"refDirective",{enumerable:!0,get:function(){return i.refDirective}}),Object.defineProperty(t,"DirectiveResult",{enumerable:!0,get:function(){return i.DirectiveResult}}),Object.defineProperty(t,"createDirectiveFromResult",{enumerable:!0,get:function(){return i.createDirectiveFromResult}});var a=r(2030);Object.defineProperty(t,"cache",{enumerable:!0,get:function(){return a.cache}}),Object.defineProperty(t,"CacheDirective",{enumerable:!0,get:function(){return a.CacheDirective}});var s=r(7497);Object.defineProperty(t,"play",{enumerable:!0,get:function(){return s.play}}),Object.defineProperty(t,"PalyDirective",{enumerable:!0,get:function(){return s.PlayDirective}});var n=r(2736);Object.defineProperty(t,"repeat",{enumerable:!0,get:function(){return n.repeat}}),Object.defineProperty(t,"RepeatDirective",{enumerable:!0,get:function(){return n.RepeatDirective}});var o=r(8457);Object.defineProperty(t,"liveRepeat",{enumerable:!0,get:function(){return o.liveRepeat}}),Object.defineProperty(t,"LiveRepeatDirective",{enumerable:!0,get:function(){return o.LiveRepeatDirective}});var l=r(8718);Object.defineProperty(t,"liveAsyncRepeat",{enumerable:!0,get:function(){return l.liveAsyncRepeat}}),Object.defineProperty(t,"LiveAsyncRepeatDirective",{enumerable:!0,get:function(){return l.LiveAsyncRepeatDirective}})},2954:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Resizer=void 0;const a=r(1416),s=r(5499);let n=class extends a.Component{constructor(){super(...arguments),this.position="right",this.rate=1,this.max=1/0,this.min=0,this.resizedValue=-1}static style(){return a.css`
		:host{
			position: absolute;
			z-index: 100;
		}

		.top{
			width: 100%;
			height: 10px;
			top: -5px;
			left: 0;
			cursor: ns-resize;
		}

		.bottom{
			width: 100%;
			height: 10px;
			bottom: -5px;
			left: 0;
			cursor: ns-resize;
		}

		.left{
			width: 10px;
			height: 100%;
			top: 0;
			left: -5px;
			cursor: ew-resize;
		}

		.right{
			width: 10px;
			height: 100%;
			top: 0;
			right: -5px;
			cursor: ew-resize;
		}

		.resizing-mask{
			position: fixed;
			z-index: 9999;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;

			&.herizontal{
				cursor: ew-resize;
			}

			&.vertical{
				cursor: ns-resize;
			}
		}
		`}render(){return a.html`
		<template
			:class=${this.position}
			@@mousedown=${this.onStartResize}
		/>
		`}onReady(){if("static"===s.getStyle(this.el.parentElement,"position"))throw new Error('Parent of "<f-resizer>" must can\'t have an "static" position')}onStartResize(e){let t=e.clientX,r=e.clientY,i=this.el.parentElement.offsetWidth,s=this.el.parentElement.offsetHeight,n=e=>{e.preventDefault(),this.resize(i,s,e.clientX-t,e.clientY-r)},o=a.render(a.html`
			<div class="resizing-mask" class="${"left"===this.position||"right"===this.position?"herizontal":"vertical"}"
		/>`,this).fragment.firstElementChild;document.body.append(o),a.on(document,"mousemove",n),a.once(document,"mouseup",(()=>{a.off(document,"mousemove",n),o.remove(),this.emit("change",this.resizedValue)}))}resize(e,t,r,i){let a;"top"===this.position||"bottom"===this.position?(a=t+("bottom"===this.position?1:-1)*i*this.rate,a=s.constrain(a,this.min,this.max),this.el.parentElement.style.height=a+"px"):(a=e+("right"===this.position?1:-1)*r*this.rate,a=s.constrain(a,this.min,this.max),this.el.parentElement.style.width=a+"px"),this.resizedValue=a}};n=i([a.define("f-resizer")],n),t.Resizer=n},2959:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.IconLoading=t.Icon=void 0;const a=r(1416),s=r(1485),n=r(5499),o=r(8240);let l=class extends a.Component{constructor(){super(...arguments),this.type=""}render(){let e=s.svgSymbols[this.type];if(!e)return"";let[t,r]=n.subMatches(e,/<svg viewBox="(.+?)">([\s\S]+?)<\/svg>/)[0],[,,i,l]=t.split(" "),c=o.theme.adjust(Number(i)),d=o.theme.adjust(Number(l));return a.html`
		<template>
			<svg
				viewBox=${t}
				width=${c}
				height=${d}
				:html=${r}
			/>
		</template>
		`}};l.style=a.css`
	:host{
		display: inline-flex;
		stroke: currentColor;
		fill: none;
		margin: auto 0;
		vertical-align: middle;

		svg{
			margin: auto;
		}
	}
	`,l=i([a.define("f-icon")],l),t.Icon=l;let c=class extends l{constructor(){super(...arguments),this.type="loading",this.loading=!1,this.playing=!1}onCreated(){this.watchImmediately((()=>this.loading),(e=>{e&&!this.playing&&(this.play(),this.playing=!0)}))}play(){n.animateByFunction((e=>{this.el.style.transform="rotate("+e+"deg)"}),0,360,1e3,"linear").promise.then((()=>{this.loading?this.play():this.playing=!1}))}};c.style=a.css`
	:host{
		display: inline-flex;
		stroke: currentColor;
		fill: none;
		margin: auto 0;
		vertical-align: top;
		position: relative;
	}`,c=i([a.define("f-icon-loading")],c),t.IconLoading=c},2972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttrPart=void 0,t.AttrPart=class{constructor(e,t,r){this.el=e,this.name=t,this.setValue(r)}setValue(e){null!=e&&String(e),this.el.setAttribute(this.name,e)}update(e){this.setValue(e)}remove(){}}},2988:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AEGLEncodingConfig=void 0;const a=r(1416),s=r(5499),n=r(5963),o=r(1919),l=r(7928);let c=class extends o.Modal{title="Export Video";project;config;heightData;frameRateData;crfData;encoder=null;encodingAnalyser;progress=0;canceled=!1;onCreated(){this.initializeConfig(),this.initializeFrameRates(),this.initializeResolution(),this.encodingAnalyser=new n.VideoEncodingAnalyser(this.project),this.crfData=[{value:"very-low",text:"Very Low"},{value:"low",text:"Low"},{value:"medium",text:"Medium"},{value:"high",text:"High"},{value:"very-high",text:"Very High"}]}initializeConfig(){this.config=s.storage.get("aegl_encoding_config",{name:"",frameRate:30,height:720,quality:"medium"}),this.config.name=this.project.data.name}initializeFrameRates(){let e=[25,30,60],t=Math.round(this.project.footages.getTemplateVideoFrameRate()),r=Math.round(this.project.footages.getUserVideoFrameRate());t&&!e.includes(t)&&e.push(t),r&&!e.includes(r)&&e.push(r),e.sort(),t&&r?this.config.frameRate=Math.min(t,r):t?this.config.frameRate=t:r&&(this.config.frameRate=r),this.frameRateData=e.map((e=>{let i,s=e+" fps";return t===e&&t&&r&&t===r?i=`Framerate of template assets and your videos is all ${t} fps, suggest you to choose ${e} fps`:e===r?i=`Framerate of your videos is  ${r} fps, suggest you to choose ${e} fps`:e===t?i=`Framerate of template assets is ${t} fps, suggest you to choose ${e} fps`:r?(s=a.html`<span class="secondary-choice">${s}<span>`,i=e>=2*r?`Framerate of your videos is  ${r} fps, choose ${e} fps would not provide the expected boost`:`Framerate of your videos is  ${r} fps, choose ${e} fps may result in framerate mismatch artifacts.`):t&&(s=a.html`<span class="secondary-choice">${s}<span>`,i=e>=2*t?`Framerate of template assets is ${t} fps, choose ${e} fps would not provide the expected boost`:`Framerate of template assets is ${t} fps, choose ${e} fps may result in framerate mismatch artifacts.`),{value:e,text:s,tip:i}}))}initializeResolution(){let e=[360,480,720,1080,1440,2160],t=this.project.data.width/this.project.data.height;1===t&&(e.push(1e3),e.sort(((e,t)=>e-t))),t<1&&(e=e.map((e=>2*Math.round(e/t/2))));let r=e.map((e=>({value:e,text:`${e}P`,tip:`${2*Math.round(t*e/2)}x${e}`}))),i=Math.round(this.project.footages.getTemplateFootageHeight()),s=Math.round(this.project.footages.getUserFootageHeight()),n=r.filter((e=>e.value<=1.15*s)).pop();this.config.height=n?n.value:this.project.data.height,this.heightData=r.map((({value:e,text:t,tip:r})=>(e>=1.15*s?(t=a.html`<span class="secondary-choice">${t}<span>`,r+=`. Average resolution of your resources is ${s}P, choose ${e}P would not provide the expected boost`):i&&e>i&&(r+=`. Average resolution of template assets is ${i}P, choose ${e}P would not provide the expected boost`),{value:e,text:t,tip:r})))}render(){return a.html`<template class="aegl-encoding-config">
		<f-row>
			<f-col .span="12">
				Video Name:
			</f-col>
			<f-col .span="12">
				<f-input :model="config.name" />
			</f-col>
		</f-row>

		<f-row>
			<f-col .span="12">
				Resolution:
			</f-col>
			<f-col .span="12">
				<f-select :model="config.height"
					.data=${this.heightData}
				/>
			</f-col>
		</f-row>

		<f-row>
			<f-col .span="12">
				Framerate:
			</f-col>
			<f-col .span="12">
				<f-select :model="config.frameRate"
					.data=${this.frameRateData}
				/>
			</f-col>
		</f-row>

		<f-row>
			<f-col .span="12">
				Video Quality:
			</f-col>
			<f-col .span="12">
				<f-select :model="config.quality"
					.data=${this.crfData}
				/>
			</f-col>
		</f-row>

		<div :show=${!this.encoder} class="encoding-tips">
			Video export will take about ${this.getExportTimeInMinutes()} mins, file size is about ${this.getExportFileSizeInM()} MB.
		</div>

		<button :show=${!this.encoder} primary @click=${this.export}>Export</button>

		<div :show=${this.encoder} class="encoding-progress">
			<f-progress .value=${this.progress} />
		</div>
		<button :show=${this.encoder} @click=${this.cancelExport}>Cancel</button>

		</template>`.extends(super.render())}getExportTimeInMinutes(){return this.encodingAnalyser.guessEncodingTimeInMinutes(this.config.height,this.config.frameRate,this.config.quality)}getExportFileSizeInM(){return this.encodingAnalyser.guessExportFileSizeInM(this.config.height,this.config.quality)}async export(){onbeforeunload=()=>`Encoding video, current progress is ${100*this.progress}%, are you sure you want to quit?`;let e={name:this.config.name,frameRate:this.config.frameRate,height:this.config.height,quality:this.config.quality},t=l.debug.timeStart("Video Encoding");this.emit("beginexport"),this.encoder=new n.FFVideoEncoder(this.project,e),this.progress=0,this.encoder.on("progress",((e,t)=>{this.progress=(0,s.toDecimal)(e/t,3)}));try{window.VideoEncoder?await this.encoder.encodeByWeb():(await this.encoder.encodeByFF(),o.notification.warn("You are encoding videos by wasm version of ffmpeg, which is 10x slower. try switch to modern browsers supports WebCodecs like Chrome or Edge.",{hideDelay:1e4})),t(),this.saveEncodingResults()}catch(e){this.canceled||(console.warn(e),o.notification.error("Failed to encode video!",{hideDelay:1e4}))}this.encoder=null,onbeforeunload=null,this.emit("endexport")}saveEncodingResults(){s.storage.set("aegl_encoding_config",this.config),this.encodingAnalyser.saveEncodingSpeed(this.encoder)}cancelExport(){this.encoder.terminate(),this.canceled=!0,this.encoder=null}};t.AEGLEncodingConfig=c,t.AEGLEncodingConfig=c=i([(0,a.define)("aegl-encoding-config")],c)},3075:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayerManager=void 0;const i=r(5623),a=r(2579),s=r(8516),n=r(1),o=r(9737),l=r(2111),c=r(2171),d=r(3395),h=r(5097),u=r(1305),p=r(9811);class m extends n.BaseManager{static filterLayerDatasFromRenderNodes(e){let t=[];for(let r of e)(0,l.isLayerRenderNodeType)(r.type)&&t.push(r.data),r.inputs&&t.push(...m.filterLayerDatasFromRenderNodes(r.inputs));return t}static filterRenderableLayerDatas(e){let t=[];for(let r of e)"composite"===r.type?t.push(...m.filterRenderableLayerDatas(r.layers)):["adjustment","empty"].includes(r.type)||t.push(r);return t}active(e){e.active()}deactive(e){e.deactive()}async create(e){let t;switch(e.type){case"image":t=new i.ImageLayer(this.renderer,e);break;case"text":t=new a.TextLayer(this.renderer,e);break;case"audio":t=new s.AudioLayer(this.renderer,e);break;case"video":t="encoding"===this.renderer.project.mode?new p.VideoPerFrameLayer(this.renderer,e):new o.VideoLayer(this.renderer,e);break;case"camera":t=new c.CameraLayer(this.renderer,e);break;case"shape":t=new d.ShapeLayer(this.renderer,e);break;case"solid":t=new h.SolidLayer(this.renderer,e);break;case"composite":t=new u.CompositeLayer(this.renderer,e);break;default:throw new Error(`Can't render layers in type "${e.type}"!`)}return await t.ready,t}}t.LayerManager=m},3119:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform sampler2D iChannel[2];\nuniform int maxSearchingFgRadius;\nuniform int maxMaskErrorPixels;\nvec4 guessForegroundColor(vec4 color, vec4 bgColor) {\nvec4 fgColor = vec4(0);\nfloat fgTargetValue = 0.0;\nfor (int i = -maxSearchingFgRadius; i <= maxSearchingFgRadius; i++) {\nfor (int j = -maxSearchingFgRadius; j <= maxSearchingFgRadius; j++) {\nvec2 pixelCoord = fTextureCoord + vec2(i, j) / iResolution;\nvec4 pixelFgColor = texture(iChannel[0], pixelCoord);\nvec4 pixelMaskColor = texture(iChannel[1], fTextureCoord);\nfloat pixelMaskAlpha = pixelMaskColor.r * 0.333 + pixelMaskColor.g * 0.333 + pixelMaskColor.b * 0.334;\nfloat pixelAlpha = dot(color.rgb - bgColor.rgb, pixelFgColor.rgb - bgColor.rgb)\n/ pow(length(pixelFgColor.rgb - bgColor.rgb), 2.0);\npixelAlpha = clamp(pixelAlpha, 0.0, 1.0);\nfloat beFrontPriority = pow((pixelMaskAlpha + 1.0) / 2.0, 24.0);\nfloat distancePriority = float(maxSearchingFgRadius) / float(maxSearchingFgRadius + abs(i) + abs(j));\nfloat colorDecompressionPriority = pow(1.0 / (0.5 + distance(color, pixelFgColor * pixelAlpha + (1.0 - pixelAlpha) * bgColor)), 2.0);\nfloat farFromBgPriority = pow(distance(pixelFgColor, bgColor) + 0.5, 3.0);\nfloat targetValue = beFrontPriority\n* distancePriority\n* farFromBgPriority\n* colorDecompressionPriority;\nif (targetValue > fgTargetValue) {\nfgColor = pixelFgColor;\nfgTargetValue = targetValue;\n}\n}\n}\nfgColor /= fgColor.a;\nreturn fgColor;\n}\nfloat getAverageMaskAlpha() {\nfloat alphaTotal = 0.0;\nfloat pixelCount = pow(float(maxMaskErrorPixels * 2 + 1), 2.0);\nfor (int i = -maxMaskErrorPixels; i <= maxMaskErrorPixels; i++) {\nfor (int j = -maxMaskErrorPixels; j <= maxMaskErrorPixels; j++) {\nvec2 pixelCoord = fTextureCoord + vec2(i, j) / iResolution;\nvec4 pixelMaskColor = texture(iChannel[1], pixelCoord);\nfloat pixelMaskAlpha = pixelMaskColor.r * 0.333 + pixelMaskColor.g * 0.333 + pixelMaskColor.b * 0.334;\nalphaTotal += pixelMaskAlpha;\n}\n}\nreturn alphaTotal / pixelCount;\n}\nvec4 getFragColor() {\nvec4 color = texture(iChannel[0], fTextureCoord);\nvec4 bgColor = vec4(0, 0, 0, 1);\nvec4 fgColor = guessForegroundColor(color, bgColor);\nfloat averageMaskAlpha = getAverageMaskAlpha();\nfloat alpha = dot(color.rgb - bgColor.rgb, fgColor.rgb - bgColor.rgb)\n/ pow(length(fgColor.rgb - bgColor.rgb), 2.0);\nalpha = clamp(alpha, 0.0, 1.0);\nif (averageMaskAlpha > 0.99) {\nreturn color;\n}\nelse {\nreturn fgColor;\n}\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},3163:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceLoader=void 0;const i=r(5956),a=r(757);class s extends a.Emitter{constructor(e={}){super(),this.base="",this.continueOnError=!1,this.blobMap=new Map,Object.assign(this,e)}async load(e){let t=this.normalizeResources(e),r=(await this.getTotalSizes(t.map((e=>e.url)))).map((e=>e||0)),i=a.sum(r),s=0;for(let{name:e,url:a,type:n}of t)try{let t=await this.loadOne(e,a,(e=>{this.emit("progress",Math.min(s+e,i),i)}));s+=r.shift(),t&&await this.handleBlob(n,t)}catch(e){if(!this.continueOnError)throw e}}async getTotalSizes(e){let t=[];for(let r of e)t.push(this.getURLSize(r));return await Promise.all(t)}async getURLSize(e){let t=(await fetch(this.getAbsoluteURL(e),{method:"HEAD"})).headers.get("content-length");return null===t?null:Number(t)||null}getAbsoluteURL(e){return/^(?:https?:|\/\/)/.test(e)||!this.base?e:this.base+e}normalizeResources(e){return e.map((e=>"string"==typeof e?{name:this.getBaseNameFromURL(e),url:e,type:this.inferResourceTypeFromURL(e)}:{name:e.name||this.getBaseNameFromURL(e.url),url:e.url,type:e.type||"blob"}))}getBaseNameFromURL(e){return i.firstMatch(e,/([^\/]+)$/).replace(/\.\w+$/,"")}inferResourceTypeFromURL(e){let t=i.firstMatch(e,/\.(\w+)(?:\?.*?)?$/).toLowerCase();return["css","js"].includes(t)?t:"blob"}async loadOne(e,t,r){let i=this.getAbsoluteURL(t);return new Promise(((a,s)=>{let n=new XMLHttpRequest;n.responseType="blob",n.open("GET",i),n.onprogress=e=>{e.lengthComputable&&r(e.loaded,e.total)},n.onloadend=()=>{n.status>=200&&n.status<400?(this.blobMap.set(e,n.response),this.blobMap.set(t,n.response),a(n.response)):s()},n.send()}))}async handleBlob(e,t){"css"===e?await this.loadStyle(t):"js"===e&&await this.loadScript(t)}loadStyle(e){return new Promise(((t,r)=>{let i=document.createElement("link");i.rel="stylesheet",i.href=URL.createObjectURL(e),document.head.append(i),i.addEventListener("load",(()=>t())),i.addEventListener("error",(()=>r()))}))}loadScript(e){return new Promise(((t,r)=>{let i=document.createElement("script");i.async=!1,i.src=URL.createObjectURL(e),document.head.append(i),i.addEventListener("load",(()=>t())),i.addEventListener("error",(()=>r()))}))}getAsBlobURL(e){let t=this.blobMap.get(e);return t?URL.createObjectURL(t):null}getAsText(e){return new Promise((t=>{let r=this.blobMap.get(e);if(!r)return t(null);let i=new FileReader;i.onload=()=>{t(i.result)},i.readAsText(r)}))}async getAsHTML(e){let t=await this.getAsText(e);return t?(new DOMParser).parseFromString(t,"text/html"):null}async getAsJSON(e){let t=await this.getAsText(e);return t?JSON.parse(t):null}async getAsBuffer(e){return new Promise(((t,r)=>{let i=this.blobMap.get(e);if(!i)return t(null);let a=new FileReader;a.onload=()=>{t(a.result)},a.onerror=e=>{r(e)},a.readAsArrayBuffer(i)}))}async getAsImage(e){return new Promise(((t,r)=>{let i=this.getAsBlobURL(e);if(!i)return t(null);let a=new Image;a.src=i,a.onload=()=>t(a),a.onerror=e=>r(e)}))}async getAsVideo(e){return new Promise(((t,r)=>{let i=this.getAsBlobURL(e);if(!i)return t(null);let a=document.createElement("video");a.preload="auto",a.oncanplaythrough=()=>{t(a)},a.onerror=e=>{r(e)},a.src=i}))}async getAsAudio(e){return new Promise(((t,r)=>{let i=this.getAsBlobURL(e);if(!i)return t(null);let a=document.createElement("audio");a.preload="auto",a.oncanplaythrough=()=>{t(a)},a.onerror=e=>{r(e)},a.src=i}))}}t.ResourceLoader=s},3190:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fixJPEGOrientation=void 0;const i=r(1326);t.fixJPEGOrientation=async function(e){if("image/jpeg"!==e.type)return e;if(await async function(e){return new Promise((t=>{let r=new FileReader;r.onload=e=>{if(!e.target)return;let r=e.target,i=new DataView(r.result);if(65496!=i.getUint16(0,!1))return t(-2);let a=i.byteLength,s=2;for(;s<a;){if(i.getUint16(s+2,!1)<=8)return t(-1);let e=i.getUint16(s,!1);if(s+=2,65505==e){if(1165519206!=i.getUint32(s+=2,!1))return t(-1);let e=18761==i.getUint16(s+=6,!1);s+=i.getUint32(s+4,e);let r=i.getUint16(s,e);s+=2;for(let a=0;a<r;a++)if(274==i.getUint16(s+12*a,e))return t(i.getUint16(s+12*a+8,e))}else{if(65280&~e)break;s+=i.getUint16(s,!1)}}t(-1)},r.readAsArrayBuffer(e)}))}(e)<=1)return e;let t=URL.createObjectURL(e),r=await(0,i.preloadImage)(t),a=document.createElement("canvas"),s=r.naturalWidth,n=r.naturalHeight;return a.width=s,a.height=n,a.getContext("2d").drawImage(r,0,0),new Promise((t=>{a.toBlob((r=>{let i=new File([r],e.name);t(i)}),"image/$jpeg",1)}))}},3205:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform mat4 iSamplingTransform;\nuniform vec2 blurVector;\nuniform int samplingCount;\nuniform bool repeatEdgePixels;\nfloat seedRandom2(vec2 v) {\nreturn fract(sin(dot(v, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat noise2(vec2 v) {\nvec2 i = floor(v);\nvec2 f = fract(v);\nvec2 u = f * f * (3.0 - 2.0 * f);\nfloat a = seedRandom2(i);\nfloat b = seedRandom2(i + vec2(1, 0));\nfloat c = seedRandom2(i + vec2(0, 1));\nfloat d = seedRandom2(i + vec2(1, 1));\nreturn mix(a, b, u.x) +\n(c - a) * u.y * (1.0 - u.x) +\n(d - b) * u.x * u.y;\n}\nfloat stepRange(float value, float minValue, float maxValue) {\nfloat diffToCenter = abs(value - (minValue + maxValue) / 2.0);\nfloat halfRange = (maxValue - minValue) / 2.0;\nreturn 1.0 - step(halfRange, diffToCenter);\n}\nvec4 sampling(sampler2D sampler, vec2 textureCoord) {\nvec4 color = texture(sampler, textureCoord);\nif (!repeatEdgePixels) {\ncolor *= stepRange(textureCoord.x, 0.0, 1.0) * stepRange(textureCoord.y, 0.0, 1.0);\n}\nreturn color;\n}\nvec4 motionSampling(sampler2D sampler, vec2 textureCoord, vec2 textureMotionV, int sampleCount, float frequency) {\nvec4 totalColor = vec4(0);\nfloat noiseValue = noise2(gl_FragCoord.xy * frequency);\nfor (int i = 0; i < sampleCount; i++) {\nfloat rate = (float(i) + noiseValue) / float(sampleCount);\nvec2 coord = textureCoord + rate * textureMotionV;\nvec4 color = sampling(sampler, coord);\ntotalColor += color;\n}\nreturn totalColor / float(sampleCount);\n}\nvec4 getFragColor() {\nvec2 textureMotionV = blurVector / iVideoResolution;\ntextureMotionV.y = -textureMotionV.y;\ntextureMotionV = (iSamplingTransform * vec4(textureMotionV, 0, 0)).xy;\ntextureMotionV = (iChannelMap[0] * vec4(textureMotionV, 0, 0)).xy;\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = motionSampling(iChannel[0], textureCoord, textureMotionV, samplingCount, 2.0);\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},3345:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncStore=void 0;const i=r(5499);class a extends i.Emitter{constructor(){super(...arguments),this.key="",this.orderName="",this.orderKey="",this.orderDirection=""}setRepeatDirective(e){this.repeatDir=e}reset(e=0){this.repeatDir&&this.repeatDir.reset(e),this.emit("change")}setNamedOrder(e,t,r){this.orderName=e,this.orderKey=t,this.orderDirection=r,this.emit("orderchanged",e,r)}setOrder(e,t){this.setNamedOrder(e,e,t)}clearOrder(){this.orderKey="",this.orderDirection="",this.emit("orderchanged","","")}reload(){this.repeatDir&&this.repeatDir.reload(),this.emit("change")}getFirstVisibleIndex(){return this.repeatDir.getFirstVisibleIndex()}}t.AsyncStore=a},3393:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getScopedClassNameSet=t.updateStyles=t.addGlobalStyle=t.ensureComponentStyle=void 0;const i=r(8135),a=new Map,s=new Set;function n(e,t){let r=document.createElement("style");return r.setAttribute("name",t),r.textContent=o(e,"global"===t?"":t),document.head.append(r),r}function o(e,t){return"function"==typeof e&&(e=e()),l.parse(String(e),"global"===t?"":t)}var l;t.ensureComponentStyle=function(e,t){if(e.style&&!a.has(e)){let r=n(e.style,t);a.set(e,r)}},t.addGlobalStyle=function(e){let t=n(e,"global");return s.add([e,t]),t},t.updateStyles=function(){i.onRenderComplete((()=>{let e=[...s];for(let[t,r]of a)t.style&&r&&e.push([t.style,r]);for(let[t,r]of e)if("function"==typeof t){let e=o(t,r.getAttribute("name"));e!==r.textContent&&(r.textContent=e)}}))},function(e){function t(e,t,r){let a,s=/((?:\[.*?\]|\(.*?\)|[\s\S])+?)(?:,|$)/g,n=[];for(;a=s.exec(e);){let e=a[1].trim();e&&(t||(e=i(e,r)),n.push(e))}return t&&(n=function(e,t){let r=/(^|[\s+>~])&/g,i=[];for(let a of e)if(r.test(a))for(let e of t)i.push(a.replace(r,"$1"+e));else for(let e of t)i.push(e+" "+a);return i}(n,t)),n}function r(e,t,r){return e.replace(/\.([\w-]+)/g,((e,i)=>e.includes("__")?e:(r.add(i),e+"__"+t)))}function i(e,t){return e.replace(/^(?=\w)/g,t+" ").replace(/:host/g,t)}e.scopedClassNameSetMap=new Map,e.getScopedClassNameSet=function(t){return e.scopedClassNameSetMap.get(t)},e.parse=function(i,a){let s,n,o,l=/(\s*)(?:\/\/.*|\/\*[\s\S]*?\*\/|((?:\(.*?\)|".*?"|'.*?'|[\s\S])*?)([;{}]))/g,c=[],d="",h=0;for(a&&(o=e.scopedClassNameSetMap.get(a),o||(o=new Set,e.scopedClassNameSetMap.set(a,o)));s=l.exec(i);){let e=s[1],i=s[2],l=s[3];if("{"===l&&i)if("@"===i[0]||h>0)d+=s[0],i.startsWith("@keyframes")?h=1:h>0&&h++;else{n&&(c.push(n),d+="}");let s=n=t(i,n,a);a&&(s=n.map((e=>r(e,a,o)))),d+=e+s.join(", ")+"{"}else"}"===l?(h>0&&h--,n=c.pop(),n||(d+=s[0])):"/"!==s[0][e.length]&&(d+=s[0])}return d}}(l||(l={})),t.getScopedClassNameSet=l.getScopedClassNameSet},3395:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeLayer=void 0;const i=r(2290),a=r(1830),s=r(6100),n=r(8552),o=r(8737);class l extends n.RenderableLayer{shapes;forFill=!1;async initialize(){await super.initialize(),this.shapes=this.data.contents.map((e=>this.createShape(e)))}createShape(e){let t;switch(e.type){case"rect":t=new i.ShapeRectDrawer(this.renderer,e);break;case"ellipse":t=new s.ShapeEllipseDrawer(this.renderer,e);break;case"group":t=new o.ShapeGroupDrawer(this.renderer,e);break;default:throw new Error(`Can't render shape in type "${e.type}"!`)}return t.initialize(),t}setTransformStat(e){super.setTransformStat(e);for(let t of this.shapes)t.setTransformStat(e)}setTime(e){super.setTime(e);for(let t of this.shapes)t.setTime(e)}setTransformStatus(e){super.setTransformStatus(e);for(let t of this.shapes)t.setTransformStatus(e)}update(){super.update();for(let e of this.shapes)e.update()}setMaskArea(e){for(let t of this.shapes)t.setMaskArea(e)}setMappedChannel(e){for(let t of this.shapes)t.setMappedChannel(e)}clearChannel(){for(let e of this.shapes)e.clearChannel()}getSuggestedAntialiasType(){return!0}drawMainContent(){let e=[];for(let t of this.shapes){let r=t.draw();e.push(r)}return a.PaintArea.union(e)}delete(){super.delete();for(let e of this.shapes)e.delete()}}t.ShapeLayer=l},3416:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCorrectionUniforms=void 0;const r={name:"iPercent",desc:"Percent",min:-100,max:100,step:1,value:0};t.ColorCorrectionUniforms={"color-balance":[{name:"rPercent",desc:"Red",min:-100,max:100,step:1,value:0},{name:"gPercent",desc:"Green",min:-100,max:100,step:1,value:0},{name:"bPercent",desc:"Blue",min:-100,max:100,step:1,value:0}],"hue-by-color":[r,{name:"tolerance",desc:"Tolerance",min:.1,max:8,step:.1,value:.5}],"saturation-by-color":[r,{name:"tolerance",desc:"Tolerance",min:.1,max:8,step:.1,value:.5}],"lightness-by-color":[r,{name:"tolerance",desc:"Tolerance",min:.1,max:8,step:.1,value:.5}]}},3432:(e,t)=>{function r(e,t){let r=-e*e/(2*t*t);return Math.pow(Math.E,r)/(Math.sqrt(2*Math.PI)*t)}function i(e,t,r){let i=-(e*e+t*t)/(2*r*r);return Math.pow(Math.E,i)}Object.defineProperty(t,"__esModule",{value:!0}),t.generate2DGaussBlurPriorities=t.generate1DGaussBlurPriorities=void 0,t.generate1DGaussBlurPriorities=function(e){let t=e/2/1.5,i=0,a=[];for(let s=-e/2;s<=e/2;s++){let e=r(s,t);i+=e,a.push({x:s,p:e})}return a.forEach((e=>e.p/=i)),a},t.generate2DGaussBlurPriorities=function(e){let t=e/2/1.5,r=0,a=[];for(let s=-e/2;s<=e/2;s++)for(let n=-e/2;n<=e/2;n++){let e=i(s,n,t);r+=e,a.push({x:s,y:n,p:e})}return a.forEach((e=>e.p/=r)),a}},3470:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultCameraProjectionMatrix=t.getCameraLayerProjectionMatrix=t.getDefaultCameraLookAtMatrix=t.getCameraLookAtMatrix=t.getCameraLayerLookAtMatrix=void 0;const i=r(6376),a=r(5305),s=r(4452),n=r(2298);function o(e,t,r,i){const a=Math.PI/180;let o=i.transfer3(new s.Vector3(...e)),l=i.transfer3(new s.Vector3(...t)),c=new s.Vector3(0,-1,0),d=n.Matrix4.lookAt(l,o,c);return(new n.Matrix4).rotate3D(...r.map((e=>-a*e))).multiply(d)}t.getCameraLayerLookAtMatrix=function(e,t,r){let{pointOfInterest:s,position:n,orientation:l}=(0,i.getPropertyValues)(e.transform,t,a.CameraTransformDefaultValues);return o(s,n,l,r)},t.getCameraLookAtMatrix=o,t.getDefaultCameraLookAtMatrix=function(e,t){return o([e/2,t/2,0],[e/2,t/2,-Math.max(e,t)*Math.sqrt(2)],[0,0,0],n.Matrix4.I)},t.getCameraLayerProjectionMatrix=function(e,t,r,a){let s=(0,i.getPropertyValue)(e.zoom,t,0);return n.Matrix4.perspective(r,a,s,10,1e5)},t.getDefaultCameraProjectionMatrix=function(e,t){let r=Math.max(e,t)*Math.sqrt(2);return n.Matrix4.perspective(e,t,r,10,1e5)}},3481:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDraw=t.ToDrawType=void 0;const i=r(1149),a=r(23);var s;!function(e){e[e.Points=WebGL2RenderingContext.prototype.POINTS]="Points",e[e.Lines=WebGL2RenderingContext.prototype.LINES]="Lines",e[e.LineStrip=WebGL2RenderingContext.prototype.LINE_STRIP]="LineStrip",e[e.LineLoop=WebGL2RenderingContext.prototype.LINE_LOOP]="LineLoop",e[e.TriangleStrip=WebGL2RenderingContext.prototype.TRIANGLE_STRIP]="TriangleStrip",e[e.Triangles=WebGL2RenderingContext.prototype.TRIANGLES]="Triangles",e[e.TriangleFan=WebGL2RenderingContext.prototype.TRIANGLE_FAN]="TriangleFan"}(s||(t.ToDrawType=s={})),t.ToDraw=class{sw;type=s.TriangleStrip;program;vertices;samplers={};uniforms={};deleted=!1;constructor(e,t){this.sw=e,this.initializeOptions(t)}initializeOptions(e){void 0!==e.type&&(this.type=e.type),this.program=this.sw.__createProgram(e.vertCode,e.fragCode),e.uniforms&&(this.uniforms=e.uniforms),void 0!==e.vertices&&this.initializeVertices(e.vertices),void 0!==e.samplers&&this.initializeSampler(e.samplers),this.sw.__registerToDraw(this)}initializeVertices(e){let{data:t,count:r,indices:i}=e;this.setVertices(t,r,i)}initializeSampler(e){for(let[t,r]of Object.entries(e)){let e=Array.isArray(r)?r:[r];this.useSampler(t,...e)}}setUniform(e,t){this.uniforms[e]=t}setSubUniform(e,t,r){(this.uniforms[e]||(this.uniforms[e]=[]))[t]=r}hasUniform(e){return this.uniforms.hasOwnProperty(e)}setVertices(e,t,r){let a=new i.Vertices(this.sw,e,t,r);this.useVertices(a)}useVertices(e){e!==this.vertices&&(this.vertices&&this.vertices.__unuse(this),e.__useBy(this),this.vertices=e)}hasSampler(e){return!!this.samplers[e]}hasSubSampler(e,t){return!(!this.samplers[e]||!this.samplers[e][t])}getSampler(e){return this.samplers[e]}getSubSampler(e,t){return this.samplers[e]&&this.samplers[e][t]||null}useSampler(e,...t){if(!this.program.hasUniform(e))return;let r=this.samplers[e],i=r?r.map((e=>e.id)):[],a=t.map((e=>e.id));if(r)for(let e of r)a.includes(e.id)||e.__unuse(this);for(let e of t)i.includes(e.id)||e.__use(this);this.samplers[e]=t}useSubSampler(e,t,r){let i=this.samplers[e],a=i?[...i]:[];a[t]=r,this.useSampler(e,...a)}unuseSampler(e){if(this.samplers[e])for(let t of this.samplers[e])t.__unuse(this);delete this.samplers[e]}__isUsingSampler(e){for(let t of Object.values(this.samplers))if(t.includes(e))return!0;return!1}draw(e=0,t=-1){this.beforeDraw(),-1===t&&(t=this.vertices.drawCount);let{type:r,vertices:i}=this,a=this.sw.context;this.sw.__prepareToDraw(this),i.active(),this.activeSamplers(),this.program.syncUniform(this.uniforms),i.hasIndices?a.drawElements(r,t,a.UNSIGNED_SHORT,e):a.drawArrays(r,e,t),this.afterDraw()}beforeDraw(){a.TextureFrame.ensureCanDrawTo()}afterDraw(){}activeSamplers(){for(let[e,t]of Object.entries(this.samplers)){for(let e of t)e.active(this);this.setUniform(e,t.map((e=>e.unitIndex)))}}delete(){this.deleted||(this.program.unuse(),this.vertices&&this.vertices.__unuse(this),this.unuseAllSamplers(),this.sw.__deleteToDraw(this))}unuseAllSamplers(){for(let e of Object.values(this.samplers))for(let t of e)t.__unuse(this)}}},3528:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBlendFragCode=void 0;const i=r(8067),a=r(4365),s=r(6169),n=r(8286),o={MULTIPLY:a.default,SCREEN:s.default,OVERLAY:i.default,DIFFERENCE:n.default};t.getBlendFragCode=function(e){let t=o[e];if(!t)throw new Error(`Please config fragment codes for blending mode "${e}"!`);return t}},3549:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatSecondsToTime=t.formatSecondsToDuration=t.parseSecondsToDurationObject=t.parseDurationToSeconds=t.parseDurationToObject=void 0;const i=r(5956),a="yMdhms",s={y:31536e3,M:2592e3,w:604800,d:86400,h:3600,m:60,s:1};function n(e){let t={y:0,M:0,d:0,h:0,m:0,s:0};if(e.includes(":")){let[r,a,s]=i.subMatches(e,/(?:(\d\d):)?(\d\d):(\d\d(?:\.\d+)?)/)[0].map((e=>Number(e)||0));t.h=r,t.m=a,t.s=s}else{let r=i.subMatches(e,/(\d+(?:\.\d+)?) ?([yMwdhms])/g);for(let[e,i]of r)t[i]=Number(e)}return t}function o(e,t=a){let r={y:0,M:0,d:0,h:0,m:0,s:0};for(let i of t){let t=s[i],a=Math.floor(e/t);a>0&&(r[i]=a,e%=t)}return r}t.parseDurationToObject=n,t.parseDurationToSeconds=function(e){let t=n(e),r=0;for(let e of Object.keys(t))r+=t[e]*s[e];return r},t.parseSecondsToDurationObject=o,t.formatSecondsToDuration=function(e,t=a,r=t.length){let i=o(e,t),s="",n=0;for(let e of Object.keys(i)){let t=i[e];if(t>0&&(s+=t+e,n++),n>=r)break}return s},t.formatSecondsToTime=function(e){let t=Math.floor(e/3600),r=Math.floor(e%3600/60)||0,i=Math.floor(e%60)||0;return(t?String(t).padStart(2,"0")+":":"")+String(r).padStart(2,"0")+":"+String(i).padStart(2,"0")}},3554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),r(356).defineBinding("ref",class{constructor(e,t){if(!t)throw new Error('A context must be provided when using ":ref"');this.el=e,this.context=t}update(e){"string"==typeof e?this.context.refs[e]=this.el:"function"==typeof e&&e.call(this.context,this.el)}remove(){}})},3568:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleWebGL=t.SimpleWebGLBlendMode=void 0;const i=r(1126),a=r(5499),s=r(2258),n=r(2888),o=r(5129),l=r(2298),c=r(4452),d=r(7928);var h;!function(e){e[e.ADD=0]="ADD",e[e.ALPHA_ADD=1]="ALPHA_ADD",e[e.CLASSIC_COLOR_BURN=2]="CLASSIC_COLOR_BURN",e[e.CLASSIC_COLOR_DODGE=3]="CLASSIC_COLOR_DODGE",e[e.CLASSIC_DIFFERENCE=4]="CLASSIC_DIFFERENCE",e[e.COLOR=5]="COLOR",e[e.COLOR_BURN=6]="COLOR_BURN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.DANCING_DISSOLVE=8]="DANCING_DISSOLVE",e[e.DARKEN=9]="DARKEN",e[e.DARKER_COLOR=10]="DARKER_COLOR",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.DISSOLVE=12]="DISSOLVE",e[e.EXCLUSION=13]="EXCLUSION",e[e.HARD_LIGHT=14]="HARD_LIGHT",e[e.HARD_MIX=15]="HARD_MIX",e[e.HUE=16]="HUE",e[e.LIGHTEN=17]="LIGHTEN",e[e.LIGHTER_COLOR=18]="LIGHTER_COLOR",e[e.LINEAR_BURN=19]="LINEAR_BURN",e[e.LINEAR_DODGE=20]="LINEAR_DODGE",e[e.LINEAR_LIGHT=21]="LINEAR_LIGHT",e[e.LUMINESCENT_PREMUL=22]="LUMINESCENT_PREMUL",e[e.LUMINOSITY=23]="LUMINOSITY",e[e.MULTIPLY=24]="MULTIPLY",e[e.NORMAL=25]="NORMAL",e[e.OVERLAY=26]="OVERLAY",e[e.PIN_LIGHT=27]="PIN_LIGHT",e[e.SATURATION=28]="SATURATION",e[e.SCREEN=29]="SCREEN",e[e.SILHOUETE_ALPHA=30]="SILHOUETE_ALPHA",e[e.SILHOUETTE_LUMA=31]="SILHOUETTE_LUMA",e[e.SOFT_LIGHT=32]="SOFT_LIGHT",e[e.STENCIL_ALPHA=33]="STENCIL_ALPHA",e[e.STENCIL_LUMA=34]="STENCIL_LUMA",e[e.VIVID_LIGHT=35]="VIVID_LIGHT"}(h||(t.SimpleWebGLBlendMode=h={}));const u={alpha:!1,antialias:!0,depth:!0,premultipliedAlpha:!0,stencil:!1,flipY:!0,clearColor:[0,0,0,1],preserveDrawingBuffer:!1};class p extends a.Emitter{static supportsBlendMode(e){return[h.NORMAL,h.ADD].includes(e)}canvas;width=0;height=0;context;toDraws=new Set;uniforms={};verticesReferenceCounter;samplerManager;samplerReferenceCounter;textureFrameManager;currentProgram;enabledDepth=!1;enabledStencil=!1;enabledBlend=!1;enabledPolygonOffsetFill=!1;shaderProgramManager;viewport=null;constructor(e,t={}){super(),this.canvas=e;let r=Object.assign({},u,t);this.context=e.getContext("webgl2",r),this.context.clearColor(...r.clearColor),this.context.pixelStorei(this.context.UNPACK_FLIP_Y_WEBGL,r.flipY?1:0),this.context.pixelStorei(this.context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultipliedAlpha),this.enableBlend(),this.resetBlendMode(),this.shaderProgramManager=new i.ShaderProgramManager(this.context),this.verticesReferenceCounter=new n.ReferenceCounter,this.samplerManager=new s.SamplerManager(this.context),this.samplerReferenceCounter=new n.ReferenceCounter,this.textureFrameManager=new o.TextureFrameManager(this)}enableBlend(){this.enabledBlend||(this.context.enable(this.context.BLEND),this.enabledBlend=!0)}disableBlend(){this.enabledBlend&&(this.context.disable(this.context.BLEND),this.enabledBlend=!1)}enableDepth(){this.enabledDepth||(this.context.enable(this.context.DEPTH_TEST),this.enabledDepth=!0)}disableDepth(){this.enabledDepth&&(this.context.disable(this.context.DEPTH_TEST),this.enabledDepth=!1)}enableStencil(){this.enabledStencil||(this.context.enable(this.context.STENCIL_TEST),this.enabledStencil=!0)}disableStencil(){this.enabledStencil&&(this.context.disable(this.context.STENCIL_TEST),this.enabledStencil=!1)}enablePolygonOffsetFill(){this.enabledPolygonOffsetFill||(this.context.enable(this.context.POLYGON_OFFSET_FILL),this.enabledPolygonOffsetFill=!0)}disablePolygonOffsetFill(){this.enabledPolygonOffsetFill&&(this.context.disable(this.context.POLYGON_OFFSET_FILL),this.enabledPolygonOffsetFill=!1)}setClearColor(e){this.context.clearColor(...e)}setBlendMode(e){const{ONE:t,ONE_MINUS_SRC_ALPHA:r}=this.context;switch(e){case h.NORMAL:this.context.blendFunc(t,r);break;case h.ADD:this.context.blendFunc(t,t);break;default:throw new Error(`Can't set blending type "${h[e]}", try blend them by a "ToDraw" object!`)}}resetBlendMode(){this.setBlendMode(h.NORMAL)}__createProgram(e,t){return this.shaderProgramManager.create(e,t)}__useProgram(e){e!==this.currentProgram&&(this.currentProgram&&this.currentProgram.deactive(),e.active(),this.currentProgram=e)}setUniform(e,t){this.uniforms[e]=t}getUniform(e){return this.uniforms[e]}__registerToDraw(e){this.toDraws.add(e)}__deleteToDraw(e){this.toDraws.delete(e)}clear(){let e=this.context.COLOR_BUFFER_BIT;this.enabledDepth&&(e|=this.context.DEPTH_BUFFER_BIT),this.context.clear(e)}__prepareToDraw(e){let{program:t}=e;this.__useProgram(t),t.syncUniform(this.uniforms)}drawAll(){for(let e of this.toDraws)e.draw()}setCanvasSize(e,t,r=devicePixelRatio){e=Math.round(Math.max(e,1)),t=Math.round(Math.max(t,1)),this.canvas.style.width=e+"px",this.canvas.style.height=t+"px";let i=Math.round(e*r),a=Math.round(t*r);this.width===i&&this.height===a||this.setDefaultViewportFromSize(i,a)}setDefaultViewportFromSize(e,t){this.canvas.width=e,this.canvas.height=t,this.context.viewport(0,0,e,t),this.width=e,this.height=t,this.emit("resize")}setViewport(e,t,r,i){(0,a.deepEqual)([e,t,r,i],this.viewport)||(this.context.viewport(e,t,r,i),this.viewport=[e,t,r,i])}resetViewport(){(0,a.deepEqual)([0,0,this.width,this.height],this.viewport)||(this.context.viewport(0,0,this.width,this.height),this.viewport=null)}setScissor(e,t,r,i){let a=Math.min(e+r,this.width),s=Math.min(t+i,this.height);if(r=a-(e=Math.max(e,0)),i=s-(t=Math.max(t,0)),r=Math.max(0,r),i=Math.max(0,i),this.viewport){let[a,s,n,o]=this.viewport,d=l.Matrix3.fromVectors(new c.Vector3(0,0,1),new c.Vector3(this.width,0,1),new c.Vector3(0,this.height,1)),h=l.Matrix3.fromVectors(new c.Vector3(a,s,1),new c.Vector3(a+n,s,1),new c.Vector3(a,s+o,1)).multiplySelf(d.inverseSelf()),u=h.transfer2(new c.Vector2(e,t)),p=h.transfer2(new c.Vector2(e+r,t+i)).minusSelf(u);e=u.x,t=u.y,r=p.x,i=p.y}this.context.enable(this.context.SCISSOR_TEST),this.context.scissor(e,t,r,i)}clearScissor(){this.context.disable(this.context.SCISSOR_TEST)}waitDrawingCompleted(){let e=this.context,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0),r=!1;return(e.getSyncParameter(t,e.SYNC_STATUS)==e.SIGNALED||e.clientWaitSync(t,0,0)==e.CONDITION_SATISFIED)&&(r=!0),e.deleteSync(t),r}loseContext(){let e=this.context.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.textureFrameManager.clearAll()}warnIfNotClean(){this.toDraws.size>0&&d.debug.development&&console.warn("Following ToDraw objects are unexpected not been released:",[...this.toDraws])}}t.SimpleWebGL=p},3575:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observeGetter=void 0,t.observeGetter=function(e,t){let r=function(e,t){let r=e;do{let e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=Object.getPrototypeOf(r)}while(r);return null}(e,t);return r&&r.get?r.get.call(e):e[t]}},3582:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0;const a=r(1416),s=r(8240),n=r(5499),o=r(7975);let l=class extends o.Dropdown{constructor(){super(...arguments),this.trigger="click",this.triangle=!1,this.alignMargin=0,this.data=[],this.value=null,this.multiple=!1,this.searchable=!1,this.ordered=!1,this.placeholder="",this.inputed="",this.editing=!1}static style(){let{mainColor:e,adjust:t,borderColor:r,popupShadowBlurRadius:i,backgroundColor:n,popupShadowColor:o}=s.theme;return a.css`
		:host{
			display: inline-flex;
			vertical-align: top;
			width: ${t(200)}px;
			height: ${t(28)}px;
			background: ${n.toMiddle(5)};
			line-height: ${t(28)}px;
			justify-content: space-between;
			align-items: center;
			cursor: pointer;
			box-shadow: inset 0 -1px 0 0 ${r};

			&:hover, &.opened{
				box-shadow: inset 0 -1px 0 0 ${e};

				.icon{
					color: ${e};
				}
			}

			&.not-inputable input{
				cursor: pointer;
			}
		}

		.down-icon{
			margin-left: auto;
			margin-right: 4px;
		}
	
		.display, .input{
			flex: 1;
			min-width: 0;
			padding: 0 0 0 ${t(8)}px;
			height: 100%;
			border: none;
			background: transparent;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			box-shadow: none;

			&:focus{
				box-shadow: none;
			}
		}

		.placeholder{
			opacity: 0.5;
		}
	
		.popup{
			padding: 0;
			border-radius: 0;
			filter: none;
			box-shadow: 0 1px ${i}px ${o};
		}

		.list{
			border-bottom: none;

			.option__f-list{
				padding-left: ${t(8)}px;
				border-top: none;
			}
		}

		.selected-icon{
			margin-right: -4px;
		}
		`.extends(super.style())}render(){return a.html`
		<template :class.not-inputable=${!this.searchable}>
			${this.renderDisplayOrInput()}
		</template>
		`.extends(super.render())}renderDisplayOrInput(){if(this.editing)return a.html`
			<input type="text"
				class="input"
				:ref="input"
				.value=${this.inputed}
				.placeholder=${this.placeholder}
				?readonly=${!this.editing}
				@click=${this.onClick}
				@input=${this.onInput}
			>
			`;{let e=this.renderCurrentDisplay();return a.html`
			<div
				class="input"
				:class.placeholder=${!e}
				@click=${this.onClick}
			>
				${e||this.placeholder}
			</div>
			`}}renderPopup(){let e=this.getOptionData();return a.html`
		<f-popup
			class="popup"
			:ref="popup"
			.triangle="false"
		>
			<f-list class="list"
				:ref="list"
				.type="selection"
				.selectable
				.data=${e}
				.multipleSelect=${this.multiple}
				.selected=${this.multiple?this.value:[this.value]}
				@select=${this.select}
			/>
		</f-popup>
		`}renderCurrentDisplay(){if(this.multiple){let e=[];for(let{value:t,text:r}of this.data)this.value.includes(t)&&e.push(r.toString());return e.join("; ")}for(let{value:e,text:t}of this.data)if(this.value===e)return t;return""}getOptionData(){if(this.searchable&&this.inputed){let e=this.inputed.toLowerCase(),t=[];for(let r of this.data)String(r.value).includes(e)&&t.push(r);return t}return this.data}onCreated(){this.initValue(),this.initEditing()}initValue(){this.multiple&&!Array.isArray(this.value)&&(this.value=[])}initEditing(){this.searchable&&this.watch((()=>this.opened),(e=>{!e&&this.editing&&this.endEditing()}))}onClick(){this.searchable&&!this.editing&&this.startEditing()}select(e){this.multiple?this.value=e:(this.value=e[0],this.hidePopup()),this.emit("change",this.value)}async startEditing(){this.editing=!0,this.inputed="",await a.renderComplete(),this.refs.input.focus()}endEditing(){this.editing=!1}async onPopupOpened(){if(await a.renderComplete(),this.editing&&this.refs.input&&this.refs.input.focus(),this.popupBinding&&this.popupBinding.popup){let e=this.popupBinding.popup.el;e.style.minWidth=String(this.el.offsetWidth)+"px",await a.renderComplete();let t=e.querySelector(".selected__f-list");t&&"y"===n.getScrollDirection(this.refs.list)&&n.scrollToTop(t)}}onInput(){this.inputed=this.refs.input.value,this.showPopup()}};l=i([a.define("f-select")],l),t.Select=l},3583:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonGroup=void 0;const a=r(1416),s=r(8240);let n=class extends a.Component{static style(){let{textColor:e,backgroundColor:t}=s.theme;return a.css`
		:host{
			display: inline-flex;
			vertical-align: top;
		}

		button{
			&:nth-child(n+2){
				margin-left: -1px;
				border-top-left-radius: 0;
				border-bottom-left-radius: 0;
			}
	
			&:nth-last-child(n+2){
				border-top-right-radius: 0;
				border-bottom-right-radius: 0;
			}
	
			&[primary]{
				position: relative;
				z-index: 1;
				background: ${e};
				border-color: ${e};
				color: ${t};
			}

			&:hover{
				position: relative;
				z-index: 1;
			}
		}
		`}};n=i([a.define("f-buttongroup")],n),t.ButtonGroup=n},3602:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(2824),s=r(2298);(0,i.extendTransitions)({"shuffle-left":{threeD:!0,sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>{let t=Math.abs(e-.5)-.5,r=e<.5?-.1:.1;return(new s.Matrix4).translateSelf(2*t,0,2*r)}},{useTexture:i.TextureReference.Target,transform:e=>{let t=.5-Math.abs(e-.5);return(new s.Matrix4).translateSelf(2*t)}}]},"shuffle-right":{threeD:!0,sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>{let t=.5-Math.abs(e-.5),r=e<.5?-.1:.1;return(new s.Matrix4).translateSelf(2*t,0,2*r)}},{useTexture:i.TextureReference.Target,transform:e=>{let t=Math.abs(e-.5)-.5;return(new s.Matrix4).translateSelf(2*t)}}]},"shuffle-top":{threeD:!0,sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>{let t=.5-Math.abs(e-.5),r=e<.5?-.1:.1;return(new s.Matrix4).translateSelf(0,2*t,2*r)}},{useTexture:i.TextureReference.Target,transform:e=>{let t=Math.abs(e-.5)-.5;return(new s.Matrix4).translateSelf(0,2*t)}}]},"shuffle-bottom":{threeD:!0,sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>{let t=Math.abs(e-.5)-.5,r=e<.5?-.1:.1;return(new s.Matrix4).translateSelf(0,2*t,2*r)}},{useTexture:i.TextureReference.Target,transform:e=>{let t=.5-Math.abs(e-.5);return(new s.Matrix4).translateSelf(0,2*t)}}]}})},3656:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Navigation=void 0;const a=r(1416),s=r(2522),n=r(8240);let o=class extends s.List{constructor(){super(...arguments),this.type="navigation",this.title=""}static style(){let{backgroundColor:e,adjust:t,adjustFontSize:r}=n.theme;return a.css`
		:host{
			padding: ${t(8)}px ${t(16)}px;
			border-bottom: none;
			background: ${e.toMiddle(9)};
			overflow-y: auto;
		}

		.title{
			font-size: ${r(18)}px;
			font-weight: 300;
			margin-top: ${t(4)}px;
			margin-bottom: ${t(8)}px;
		}

		`.extends(super.style())}render(){return a.html`
		<tempalte>
			${this.title?a.html`
			<div class="title">
				${this.title}
			</div>`:""}

			${this.renderDataOrChildren(this.data)}
		</tempalte>`}};o=i([a.define("f-navigation")],o),t.Navigation=o},3730:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform sampler2D iChannel[1];\nuniform float blurRadius;\nuniform float luminanceRadius;\nfloat getLuminance(vec4 color) {\nreturn (color.r + color.g + color.b) / 3.0;\n}\nvec4 getFragColor() {\nvec4 totalColor;\nfloat totalPriority;\nfloat coreLuminance = getLuminance(texture(iChannel[0], fTextureCoord));\nfor (float i = -blurRadius; i <= blurRadius; i++) {\nfor (float j = -blurRadius; j <= blurRadius; j++) {\nvec2 pixelCoord = fTextureCoord + vec2(i, j) / iResolution;\nvec4 pixelColor = texture(iChannel[0], pixelCoord);\nfloat luminance = getLuminance(pixelColor);\nfloat distancePriority = exp(- (i * i + j * j) / (2.0 * blurRadius * blurRadius));\nfloat luminanceDiff = luminance - coreLuminance;\nfloat luminancePriority = exp(- luminanceDiff * luminanceDiff / (2.0 * luminanceRadius * luminanceRadius));\nfloat priority = distancePriority * luminancePriority;\ntotalColor += pixelColor * priority;\ntotalPriority += priority;\n}\n}\nreturn totalColor / totalPriority;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},3744:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),(0,r(4062).extendTransitions)({})},3792:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Textarea=t.Input=void 0;const a=r(1416),s=r(8240),n=r(972);let o=class extends a.Component{constructor(){super(...arguments),this.type="text",this.touched=!1,this.valid=null,this.placeholder="",this.value="",this.validator=null,this.error=""}static style(){let{adjust:e,adjustFontSize:t,errorColor:r,borderColor:i,backgroundColor:n,mainColor:o,successColor:l,focusBlurRadius:c}=s.theme;return a.css`
		:host{
			display: inline-block;
			vertical-align: top;
			position: relative;
			width: ${e(200)}px;
			height: ${e(28)}px;
			background: ${n.toMiddle(5)};
			box-shadow: inset 0 -1px 0 0 ${i};
		}

		input, textarea{
			width: 100%;
			height: 100%;
			border: none;
			background: none;
			
			&:focus{
				box-shadow: 0 0 ${c}px ${o.alpha(.5)};
			}
		}

		input{
			height: 100%;
			padding: 0 0 0 ${e(8)}px;
		}

		textarea{
			line-height: ${e(20)}px;
			padding: ${e(4)}px ${e(8)}px;
		}

		.valid{
			box-shadow: inset 0 -1px 0 0 ${l};

			input, textarea{
				padding-right: ${e(28)}px;

				&:focus{
					box-shadow: 0 0 ${c}px ${l.alpha(.5)};
				}
			}
		}

		.invalid{
			box-shadow: inset 0 -1px 0 0 ${r};

			input, textarea{
				padding-right: ${e(28)}px;

				&:focus{
					box-shadow: 0 0 ${c}px ${r.alpha(.5)};
				}
			}
		}

		.valid-icon{
			position: absolute;
			top: 0;
			bottom: 0;
			right: 6px;
			color: ${l};
		}

		.error{
			position: absolute;
			left: 0;
			top: 100%;
			margin-bottom: -${e(28)}px;
			font-size: ${t(13)}px;
			color: ${r};
		}
		`}render(){return a.html`
		<template
			:class.valid=${this.touched&&!0===this.valid}
			:class.invalid=${this.touched&&!1===this.valid}
		>
			<input type=${this.type}
				placeholder=${this.placeholder||""}
				.value=${this.value}
				:ref="input"
				@blur=${this.onBlur}
				@input=${e=>this.onInput(e)}
				@change=${e=>this.onChange(e)}
			/>
			${this.touched&&!0===this.valid?a.html`<f-icon class="valid-icon" .type="checked" />`:""}
			${this.touched&&this.error?a.html`<div class="error">${this.error}</div>`:""}
		</template>
		`}onBlur(){this.touched=!0}onInput(e){let t=e.target.value;this.emit("input",t)}onChange(e){let t=e.target,r=this.value=t.value;this.validate(),this.emit("change",r,this.valid)}onCreated(){this.validate();let e=a.getClosestComponent(this.el,n.Form);e&&e.register(this)}validate(){this.validator&&(this.error=this.validator(this.value),this.valid=!this.error)}setTouched(e){this.touched=e}};o=i([a.define("f-input")],o),t.Input=o;let l=class extends o{static style(){return a.css`
		:host{
			height: auto;
		}
		`.extends(super.style())}render(){return a.html`
		<textarea
			placeholder=${this.placeholder}
			.value=${this.value}
			:ref="input"
			:class.valid=${this.touched&&!0===this.valid}
			:class.invalid=${this.touched&&!1===this.valid}
			@focus=${this.onBlur}
			@input=${e=>this.onInput(e)}
			@change=${e=>this.onChange(e)}
		/>
		`}};l=i([a.define("f-textarea")],l),t.Textarea=l},3819:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(2824),s=r(2298);(0,i.extendTransitions)({"push-left":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(-2*e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(2*(1-e))}]},"push-right":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(2*e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(2*(e-1))}]},"push-top":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(0,2*e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(0,2*(e-1))}]},"push-bottom":{sourceParams:{filter:a.SamplerFilter.Linear},targetParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Source,transform:e=>(new s.Matrix4).translateSelf(0,2*-e)},{useTexture:i.TextureReference.Target,transform:e=>(new s.Matrix4).translateSelf(0,2*(1-e))}]}})},3863:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addTimestamp=void 0;const i=r(5499),a=r(1118),s=document.currentScript instanceof HTMLScriptElement?(0,i.firstMatch)(document.currentScript.src,/\?(\d+|\w+=\d+)/):"";t.addTimestamp=function(e){return!s||(0,a.isBlobURL)(e)?e:e.includes("?")?e+"&"+s:e+"?"+s}},3874:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AEGLFontWeightSelect=t.AEGLFontFamilySelect=t.AEGLSceneEditor=void 0;const a=r(1416),s=r(1919),n=r(6318),o=r(5499),l=r(62),c=r(4072);let d=null,h=class extends a.Component{project;editor;ready;currentScene=null;includedFontNames=[];adjustingDuration=!1;render(){let e=this.currentScene&&this.project.renderer.paused?this.renderCurrentSceneEditor():null;return a.html`
		<div class="aegl-editor">
			${this.renderScenes()}
			${(0,a.cache)(e,{transition:"fade"})}
		</div>
		`}renderScenes(){let e=(0,s.droppable)(((e,t)=>this.onDropScene(e,t)));return a.html`
			<div class="editor-scenes" ${e}>
				<div class="editor-scenes-slider">
					${(0,a.repeat)(this.editor.scenes.map((e=>e.info)),((e,t)=>this.renderScene(this.editor.scenes[t],t)))}
				</div>
			</div>
		`}renderScene(e,t){let r=e.info.thumbnailPath,i=e.main.root.inPoint/this.project.data.duration,n=(e.main.root.outPoint-e.main.root.inPoint)/this.project.data.duration,o=e.info.mediaPosition,l=e.canBeMoved?(0,s.draggable)(e,t):null,c=e.canBeRemoved&&this.editor.scenes.length>=2?(0,s.contextmenu)(this.renderSceneContextMenu(e)):null;return a.html`
			<div class="editor-scene"
				:style.left=${`calc(${100*i}% - 2px)`}
				:style.width=${`calc(${100*n}% + 4px)`}
				:class.active=${this.currentScene===e}
				:class.covered=${!e.media}
				@click=${()=>this.viewScene(e)}
				${l}
				${c}
			>
				<img :src=${r} :style.object-position="${100*o[0]}% ${100*o[1]}%" />
			</div>
		`}renderSceneContextMenu(e){return()=>a.html`
		<f-contextmenu>
			<f-list .data=${[{text:a.html`<div @click=${()=>this.removeScene(e)}>Remove Scene</div>`}]}/>
		</f-contextmenu>
		`}renderCurrentSceneEditor(){return a.html`
		<div class="current-scene">
			<header class="scene-title">
				Edit Scene
			</header>

			<div class="scene-content">
				${this.renderPhotoAdjustment()}
				${this.renderRightEditing()}
			</div>
		</div>`}renderPhotoAdjustment(){let e=this.currentScene,t=e.info.thumbnailPath,{imageRect:r,containerSize:i}=this.generatePhotoStyle();return a.html`
		<div class="scene-photo" :style.width.px=${i.width+8}>
			<div class="photo-area">
				<div class="photo-clip" :style.width.px=${i.width}>
					<img :src=${t} :style=${r}/>
				</div>
				<div class="photo-full">
					<img :src=${t} :style=${r} @mousedown=${this.startDraggingPhoto} />
				</div>
			</div>

			<button :show=${t} flat @click=${()=>this.changeSceneMedia(e)}>Replace Photo</button>
		</div>
		`}renderRightEditing(){let e=this.currentScene;return a.html`
		<div class="scene-text">
			<f-row :show=${e.canSetDuration}>
				<f-col .span="2" class="text-label" style="min-width: 100px;">
					Duration:
				</f-col>
				<f-col .span="10" style="display: flex;">
					<f-slider .value=${e.getDuration()} .min="1" .max="20" .step="0.1" .decimalCount="1"
						@change=${t=>this.changeDuration(e,t)}
						@dragstart=${()=>this.adjustingDuration=!0}
						@dragend=${()=>{this.adjustingDuration=!1,this.checkCurrentScene()}}
					/>
				</f-col>
				<f-col .span="4">
					<button style="margin-left: 8px; font-size: 12px;" @click=${()=>this.resetDuration(e)}>Reset</button>
				</f-col>
			</f-row>

			${(0,a.cache)(e.text?this.renderTextEdit():"",{transition:"fade"})}
		</div>`}renderTextEdit(){let e=this.currentScene,t=e.text.layers[0];return a.html`
		<div>
			<f-row>
				<f-col .span="2" class="text-label" style="padding-top: 3px; min-width: 100px;">
					Text:
				</f-col>

				<f-col .span="22" style="max-width: calc(100% - 100px);">
					<f-textarea type="text"
						.value=${t.text}
						.placeholder="Add Text Here"
						:style='font-family: "${t.fontFamily}"'
						:ref="textarea"
						@@keydown.stop=${()=>{}}
						@input=${t=>this.changeText(e,t)}
					/>
				</f-col>
			</f-row>

			<f-row>
				<f-col .span="2" class="text-label" style="min-width: 100px;">
					Font Family:
				</f-col>
				<f-col .span="10">
					<aegl-font-family-select
						.additionalFontNames=${this.includedFontNames}
						.value=${t.fontFamily}
						@change=${t=>this.changeFontFamily(e,t)}
					/>
				</f-col>
				<f-col .span="4">
					<button style="margin-left: 8px; font-size: 12px;" @click=${()=>this.resetFontFamily(e)}>Reset</button>
				</f-col>
			</f-row>
			
			<f-row>
				<f-col .span="2" class="text-label" style="min-width: 100px;">
					Font Weight:
				</f-col>
				<f-col .span="10">
					<aegl-font-weight-select
						.family=${t.fontFamily}
						.value=${t.fauxBold?"Bold":c.FontList.getFontWeight(t.fontStyle||"")}
						@change=${t=>this.changeFontStyle(e,t)}
					/>
				</f-col>
				<f-col .span="4">
					<button style="margin-left: 8px; font-size: 12px;" @click=${()=>this.resetFontStyle(e)}>Reset</button>
				</f-col>
			</f-row>

			<f-row>
				<f-col .span="2" class="text-label" style="min-width: 100px;">
					Font Size:
				</f-col>
				<f-col .span="10">
					<f-slider .value=${t.fontSize} .min="1" .max="400" .step="1" .decimalCount="0"
						@change=${t=>this.changeFontSize(e,t)}
					/>
				</f-col>
				<f-col .span="4">
					<button style="margin-left: 8px; font-size: 12px;" @click=${()=>this.resetFontSize(e)}>Reset</button>
				</f-col>
			</f-row>

			<f-row>
				<f-col .span="2" class="text-label" style="min-width: 100px;">
					Text Color:
				</f-col>
				<f-col .span="10">
					<input type="color" .value=${(0,l.colorArrayToString)(t.fillColor||[0,0,0])}
						@input=${t=>this.changeTextColor(e,t.target.value)}
					/>
				</f-col>
				<f-col .span="4">
					<button style="margin-left: 8px; font-size: 12px;" @click=${()=>this.resetTextColor(e)}>Reset</button>
				</f-col>
			</f-row>
		</div>
		`}onCreated(){this.editor=new n.SceneEditor(this.project,d),this.project.renderer.on("updatetree",this.onUpdateTree,this),this.ready=this.editor.ready.then()}async onReady(){await c.FontList.ensure(),this.includedFontNames=this.project.footages.getIncludedFontFamilies().sort()}onDisconnected(){d=this.editor.extractLocalSceneData()}onUpdateTree(e){this.adjustingDuration||this.checkSceneAtTime(e)}checkCurrentScene(){this.checkSceneAtTime(this.project.renderer.time)}checkSceneAtTime(e){this.currentScene=this.editor.getActiveSceneAtTime(e)}async useMyPhotos(){let e=s.notification.unique(),t=await this.editor.uploadMedias(((t,r)=>{e.info(`Appending scenes (${t} / ${r})...`)}));t>0&&e.success(`Appended ${t} scenes.`),this.project.notifyProjectUpdated()}async changeMusic(){await this.editor.changeMusic();let e=this.project.footages.getReplaceableAudioLayerData();this.project.notifyLayerUpdated(e),s.notification.success("Replaces audio.")}viewScene(e){this.project.renderer.pause();let t=(e.main.root.inPoint+e.main.root.outPoint)/2;this.project.renderer.setTime(t)}onDropScene(e,t){let r=this.editor.moveSceneTo(e,t);for(let e of r)e.notifyMediaChanged()}removeScene(e){this.editor.removeScene(e),this.project.notifyProjectUpdated()}generatePhotoStyle(){let e=180,t=e*(this.project.data.width/this.project.data.height),r=this.currentScene;if(!r.media)return{imageRect:{left:0,top:0,width:t,height:e},containerSize:{width:t,height:e}};let{mediaWidth:i,mediaHeight:a,mediaPosition:s}=r.info,n=t/i;a*n<e&&(n=e/a);let o=i*n,l=a*n;return{imageRect:{left:(t-o)*s[0],top:(e-l)*s[1],width:o,height:l},containerSize:{width:t,height:e}}}startDraggingPhoto(e){let t=this.currentScene;if(!t.media||!t.willCropMedia())return;let{mediaWidth:r,mediaHeight:i,mediaPosition:s}=t.info,n=this.project.data.width/this.project.data.height,l=180,c=l*n,d=s[0],h=s[1],u=e.clientX,p=e.clientY,m=c/r;i*m<l&&(m=l/i);let f=r*m,g=i*m,y=!1,w=e=>{e.preventDefault();let r=e.clientX-u,i=e.clientY-p,a=r/(c-f)+d,s=i/(l-g)+h;y=0!==r||0!==i,a=(0,o.constrain)(a||0,0,1),s=(0,o.constrain)(s||0,0,1),t.setMediaPosition([a,s])};e.preventDefault(),(0,a.on)(document,"mousemove",w),(0,a.once)(document,"mouseup",(async()=>{(0,a.off)(document,"mousemove",w),y&&(await t.updateCroppedMedia(),t.notifyMediaChanged())}))}async changeSceneMedia(e){await this.editor.changeSceneMedia(e),e.notifyMediaChanged()}changeText(e,t){e.setText(t),this.project.notifyUpdated(),this.refs.textarea.style.height=this.refs.textarea.querySelector("textarea").scrollHeight+"px"}changeFontFamily(e,t){this.editor.setBunchFontFamily(e,t);let r=c.FontList.getFontWeightList(t)||["Regular","Bold"];e.info.fontStyle&&r.includes(e.info.fontStyle)||this.editor.setBunchFontStyle(e,r.includes("Regular")?"Regular":r[0]),this.project.notifyUpdated()}changeFontSize(e,t){this.editor.setBunchFontSize(e,t),this.project.notifyUpdated()}changeTextColor(e,t){this.editor.setBunchFillColor(e,new s.Color(t).getRGB()),this.project.notifyUpdated()}changeFontStyle(e,t){this.editor.setBunchFontStyle(e,t),this.project.notifyUpdated()}resetFontFamily(e){this.changeFontFamily(e,e.startFontFamily)}resetFontSize(e){this.changeFontSize(e,e.startFontSize)}resetFontStyle(e){this.changeFontStyle(e,e.startFontStyle)}resetTextColor(e){this.changeTextColor(e,e.startFillColor)}changeDuration(e,t){this.editor.setSceneDuration(e,t),this.project.notifyTimelineUpdated()}resetDuration(e){this.editor.resetSceneDuration(e),this.project.notifyTimelineUpdated()}async adjustWithTotalDuration(e){e=(0,o.toDecimal)(e,1);let t=this.project.data.duration,r=this.editor.getAdjustableDuration(),i=t-r.duration;if(0!==r.duration){if(1===(0,o.toDecimal)((e-i)/r.duration,2))return void s.notification.success(`Adjusted total duration to ${e} seconds.`);this.editor.adjustScenesDuration(e),this.project.notifyTimelineUpdated(),s.notification.success(`Adjusted total duration to ${(0,o.toDecimal)(this.project.data.duration,1)} seconds.`)}else s.notification.error("Can't adjust duration since scenes contain video assets.")}async adjustToAudioDuration(){let e=this.project.footages.getReplaceableAudioLayerData().duration;await this.adjustWithTotalDuration(e)}resetTotalDuration(){this.editor.resetTotalDuration(),this.project.notifyTimelineUpdated(),s.notification.success(`Reset total duration back to ${(0,o.toDecimal)(this.project.data.duration,1)} seconds.`)}async reset(){let e=s.notification.unique();await this.editor.reset(((t,r)=>{e.info(`Resetting scenes (${t} / ${r})...`)})),e.success("All scenes reset.",{hideDelay:3e3}),this.project.notifyProjectUpdated(),this.checkCurrentScene()}async reloadSceneData(){let e=s.notification.unique();await this.editor.reloadSceneData(((t,r)=>{e.info(`Reloading scenes (${t} / ${r})...`)})),e.success("All scenes reloaded.",{hideDelay:3e3}),this.project.notifyProjectUpdated()}};t.AEGLSceneEditor=h,t.AEGLSceneEditor=h=i([(0,a.define)("aegl-scene-editor")],h);let u=class extends s.Select{additionalFontNames=[];async onCreated(){let e=[...c.FontList.getWebSafeFonts("en-US").map((e=>[e,e])),...(await c.FontList.getFamilyListByLanguage("en-US")).map((e=>[e.fontFamily,e.localizedName]))].sort(((e,t)=>e[0].localeCompare(t[0],void 0,{numeric:!0}))),t=[...c.FontList.getWebSafeFonts("zh-CN").map((e=>[e,e])),...(await c.FontList.getFamilyListByLanguage("zh-CN")).map((e=>[e.fontFamily,e.localizedName]))].sort(((e,t)=>e[0].localeCompare(t[0],void 0,{numeric:!0})));this.data=[...e,...t].map((([e,t])=>({value:e,text:a.html`<div style='font-family: "${e}"'>${t}</div>`})))}};t.AEGLFontFamilySelect=u,t.AEGLFontFamilySelect=u=i([(0,a.define)("aegl-font-family-select")],u);let p=class extends s.Select{family="";onCreated(){this.watchImmediately((()=>this.family),(()=>{let e=c.FontList.getFontWeightList(this.family)||["Regular","Bold"];e.includes("Bold")||e.push("Bold"),this.data=e.map((e=>({value:e,text:e})))}))}};t.AEGLFontWeightSelect=p,t.AEGLFontWeightSelect=p=i([(0,a.define)("aegl-font-weight-select")],p)},3921:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform vec4 shadowColor;\nuniform mat4 iSamplingTransform;\nuniform vec2 blurRadius;\nfloat stepRange(float value, float minValue, float maxValue) {\nfloat diffToCenter = abs(value - (minValue + maxValue) / 2.0);\nfloat halfRange = (maxValue - minValue) / 2.0;\nreturn 1.0 - step(halfRange, diffToCenter);\n}\nvec4 sampling(sampler2D sampler, vec2 textureCoord) {\ntextureCoord.x = min(textureCoord.x, 1.0);\ntextureCoord.x = max(textureCoord.x, 0.0);\ntextureCoord.y = min(textureCoord.y, 1.0);\ntextureCoord.y = max(textureCoord.y, 0.0);\nvec4 color = texture(sampler, textureCoord);\nreturn color;\n}\nvec4 getFragColor() {\nfloat samplingCount = 1.0;\nvec2 d = vec4(blurRadius * 2.0 / iVideoResolution, 0, 0).xy;\nd = (iSamplingTransform * vec4(d, 0, 0)).xy;\nd = (iChannelMap[0] * vec4(d, 0, 0)).xy;\nd /= samplingCount;\nfloat alpha = 0.0;\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nalpha += sampling(iChannel[0], textureCoord).a;\nvec4 color = shadowColor * alpha;\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},3946:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Search=void 0;const a=r(1416),s=r(8240);let n=class extends a.Component{constructor(){super(...arguments),this.placeholder="",this.value="",this.focused=!1}static style(){let{adjust:e,borderColor:t,borderRadius:r,mainColor:i,focusBlurRadius:n}=s.theme;return a.css`
		:host{
			display: inline-block;
			vertical-align: top;
			position: relative;
		}

		input{
			width: 100%;
			border: none;
			background: none;
			height: ${e(28)}px;
			padding: 0 ${e(26)}px 0 ${e(26)}px;
			border: 1px solid ${t};
			border-radius: ${r}px;
			
			&:focus{
				border-color: ${i};
				box-shadow: 0 0 ${n}px ${i.alpha(.5)};
			}
		}

		.search-icon{
			position: absolute;
			top: 0;
			bottom: 0;
			left: 8px;
			color: ${t.toMiddle(10)};
		}

		.clear{
			display: flex;
			position: absolute;
			width: ${e(28)}px;
			top: 0;
			bottom: 0;
			right: 0px;
			color: ${t.toMiddle(10)};
			cursor: pointer;

			&:hover{
				color: ${i};
			}

			&:active{
				transform: translateY(1px);
			}
		}

		.close-icon{
			margin: auto;
		}
		`}render(){return a.html`
			<f-icon class="search-icon" .type="search" />

			<input type="text"
				placeholder=${this.placeholder}
				.value=${this.value}
				:ref="input"
				@focus=${this.onFocus}
				@change=${e=>this.onChange(e)}
			/>

			${this.value&&!this.focused?a.html`
			<div class="clear" @click=${this.clear}>
				<f-icon class="close-icon" .type="close" />
			</div>`:""}
		`}onFocus(){this.focused=!0,a.once(this.refs.input,"blur",(()=>this.focused=!1))}onChange(e){let t=e.target,r=this.value=t.value;this.emit("change",r)}clear(){this.value="",this.emit("change","")}};n=i([a.define("f-search")],n),t.Search=n},3975:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform float fillOpacity;\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord0);\nvec4 shadowColor = texture(iChannel[1], textureCoord1);\ncolor = shadowColor * (1.0 - color.a) + color * fillOpacity;\nvec4 inputColor = texture(iChannel[0], textureCoord0);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},4008:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextAtlas=t.TextAtlasUpdatedOfCanvas=void 0;const i=r(6376),a=r(4310),s=r(5499),n=r(5305),o=r(8272),l=r(750),c=r(9100),d=r(7928);var h;!function(e){e[e.Nothing=0]="Nothing",e[e.Content=1]="Content",e[e.Size=2]="Size"}(h||(t.TextAtlasUpdatedOfCanvas=h={}));class u extends s.Emitter{data;maxTextureSize;videoHeight;loadingFontPromise=null;moreFontsLoadedAfterRendering=!1;context;canvas;state;renderedCharRectMap;renderedCharWidthMap;renderedNextCharPosition={x:0,y:0};renderedCanvasSize={w:0,h:0};constructor(e,t,r,i={}){super(),this.data=e,this.maxTextureSize=t,this.videoHeight=r,this.state=new o.TextAtlasState(i),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}setTime(e){this.state.values=(0,i.getPropertyValues)(this.data,e,n.TextLayerDefaultValues)}async tryUpdateCanvas(e){let t=h.Nothing;if(this.state.shouldUpdateContextState())this.updateContextState(),await this.loadFontFaces(e),t=this.rerenderAllChars();else{let r=(0,s.unique)([...this.state.text]),i=(0,s.unique)([...r]).filter((e=>!this.renderedCharRectMap.has(e)));i.length>0&&(await this.loadFontFaces(e),t=this.renderMoreChars(i,r)),this.moreFontsLoadedAfterRendering&&(t=this.rerenderAllChars())}return t!==h.Nothing&&this.state.onCanvasUpdated(),t}updateContextState(){for(let e of Object.keys(this.state.contextState))this.context[e]=this.state.contextState[e]}rerenderAllChars(){this.clearRenderedResults();let e=(0,s.unique)([...this.state.text]);return this.renderMoreChars(e,e)}clearRenderedResults(){this.renderedCharRectMap=new Map,this.renderedCharWidthMap=new Map,this.renderedNextCharPosition={x:0,y:0}}async loadFontFaces(e){let t=new Promise((async e=>{await document.fonts.load(this.state.contextState.font,this.state.text),t===this.loadingFontPromise&&r&&(this.moreFontsLoadedAfterRendering=!0,this.emit("fontloaded")),e()}));this.loadingFontPromise=t;let r=!1;e?await t:await Promise.race([t,(0,s.sleep)(200)]),r=!0}renderMoreChars(e,t){let{values:r}=this.state,i=this.renderedCharRectMap.size>0,a=h.Content;this.calcCharWidths(e);let{coords:s,width:n,height:o}=this.layoutChars(e),{w:l,h:c}=this.renderedCanvasSize,u=Math.max(n,l),p=Math.max(o,c);if(u>this.maxTextureSize||p>this.maxTextureSize){if(this.renderedCharRectMap.size===t.length)throw new Error("Text Atlas size execeed because too many unique characters to render!");return this.rerenderAllChars()}if(u>l||p>c){let e=d.debug.timeStart(`Allocating TextAtlas Canvas in size "${u}x${p}"`),t=i?this.context.getImageData(0,0,this.canvas.width,this.canvas.height):null;this.canvas.width=Math.ceil(u),this.canvas.height=Math.ceil(p),this.updateContextState(),t&&this.context.putImageData(t,0,0),e(),this.renderedCanvasSize={w:u,h:p},a=h.Size}else i||this.context.clearRect(0,0,l,c);for(let{char:e,x:t,y:i}of s)r.strokeWidth&&r.strokeColor&&this.context.strokeText(e,t,i),r.fillColor&&this.context.fillText(e,t,i);return this.moreFontsLoadedAfterRendering=!1,a}layoutChars(e){let{leftBearing:t,rightBearing:r,maxHeight:i,yMax:a}=this.state.renderIn,{x:s,y:n}=this.renderedNextCharPosition,o=n+a,l=[];for(let a of e){let e=this.renderedCharWidthMap.get(a)+t+r,c=s+e;c>this.maxTextureSize&&(s=0,n+=i,o+=i),l.push({char:a,x:s+t,y:o}),this.renderedCharRectMap.set(a,{x1:s,y1:n,x2:s+e,y2:n+i}),s=c}return this.renderedNextCharPosition={x:s,y:n},{coords:l,width:Math.round(n/i)>0?this.maxTextureSize:Math.pow(2,Math.ceil(Math.log(s)/Math.log(2))),height:Math.pow(2,Math.ceil(Math.log(n+i)/Math.log(2)))}}calcCharWidths(e){for(let t of e)if(!this.renderedCharWidthMap.has(t)){let e=this.context.measureText(t).width;this.renderedCharWidthMap.set(t,e)}}generateCharPositions(){let e=this.state.renderIn,{fontSize:t}=this.state.values,r=t/e.fontSize,i=e.boxHeight*r,a=e.maxHeight*r,s=e.leftBearing*r,n=e.rightBearing*r,o=e.yMax*r,l=this.measureTextLines(),d=[],h=[],u=this.getPositionYPercentage();for(let e=0;e<l.length;e++){let{text:t,xPositions:c}=l[e],p=(e-(l.length-1)*u)*i,m=p-o,f=m+a,g=p;for(let i=0;i<c.length;i++){let a=t[i],o=c[i]*r,l=this.renderedCharWidthMap.get(a)*r,u=o+l/2,p=o-s,y=o+l+n;d.push([p,m],[p,f],[y,m],[y,f]),h.push({char:a,charWidth:l,anchorPoint:[u,g],lineIndex:e})}}return new c.TextAtlasCharPositions(this,h,d)}getPositionYPercentage(){let e=.5;return this.data.transform&&(this.data.transform.position||this.data.transform.yPosition)&&(e=(this.data.transform.position?(0,i.getPropertyValue)(this.data.transform.position,0)[1]:(0,i.getPropertyValue)(this.data.transform.yPosition,0))/this.videoHeight),e}measureTextLines(){let{text:e}=this.state,{fontSize:t}=this.state.renderIn,{fontSize:r,boxTextSize:i}=this.state.values,a=r/t,s=this.measureOneLineText(this.state.text),{lineWidth:n}=s,o=[s],l=1/0;return i&&(l=i[0]/a),(n>l||e.includes("\n"))&&(o=this.splitTextLines(s,l)),o}measureOneLineText(e){let{fontSize:t}=this.state.renderIn,{tracking:r,justification:i}=this.state.values,s=(0,a.getLetterSpacingFronTracking)(t,r),n=this.measureText(e),o=n.width+s*(e.length-1),l=n.advances,c=[],d=(0,a.getAlignRateFromLeft)(i)*o;for(let t=0;t<e.length;t++){let e=-d+l[t]+t*s;c.push(e)}return{text:e,xPositions:c,lineWidth:o,letterSpacing:s,wrapInEnd:!1}}measureText(e){let t=this.context.measureText(e),r=t.advances;if(!r){r=[0];for(let i=1;i<e.length;i++){let a=e[i],s=e.slice(0,i+1),n=i===e.length-1?t.width:this.context.measureText(s).width,o=this.renderedCharWidthMap.get(a);r.push(n-o)}t.advances=r}return t}splitTextLines(e,t){let{text:r,xPositions:i,lineWidth:a,letterSpacing:n}=e,o=[],c=0;for(let e=0;e<i.length;e++){let s=i[c],d=r[e],h=e===i.length-1?a-(s-i[0]):i[e+1]-n-s;if(h>t||"\n"===d){let a=e,d=!1;h>t&&(a=(0,l.reverseFindWordStartIndex)(r,e),d=!0,a<=c&&(a=e));let u=r.slice(c,a),p=i.slice(c,a),m=i[a]-n-s;o.push({text:u,xPositions:p,lineWidth:m,letterSpacing:n,wrapInEnd:d}),c=a}}if(c<i.length){let e=r.slice(c),t=i.slice(c),l=a-(0,s.sum)(o.map((e=>e.lineWidth+n)));o.push({text:e,xPositions:t,lineWidth:l,letterSpacing:n,wrapInEnd:!1})}if(o.length>1)for(let e=0;e<o.length;e++){let t=o[e],r=e>0&&o[e-1].wrapInEnd;this.alignLinePositions(t,r)}return o}alignLinePositions(e,t){let r=(0,a.getAlignRateFromLeft)(this.state.values.justification),{text:i,lineWidth:s,xPositions:n,letterSpacing:o,wrapInEnd:c}=e;c&&(0,l.isWhiteSpaceChar)(i[i.length-1])&&(s=n[n.length-1]-n[0]-o,n=n.slice(0,-1),i=i.slice(0,-1)),("\n"===i[0]||t&&(0,l.isWhiteSpaceChar)(i[0]))&&(s-=n[1]-n[0],n=n.slice(1),i=i.slice(1));let d=-r*s-n[0];e.text=i,e.xPositions=n.map((e=>e+d))}}t.TextAtlas=u},4062:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getUniformSlides=t.TransitionProcessor=t.extendTransitions=t.DefinedTransitions=t.TextureReference=void 0;const i=r(1326),a=r(3481),s=r(2824),n=r(2298);var o;!function(e){e[e.None=0]="None",e[e.Source=1]="Source",e[e.Target=2]="Target",e[e.Both=3]="Both"}(o||(t.TextureReference=o={})),t.DefinedTransitions={},t.extendTransitions=function(e){Object.assign(t.DefinedTransitions,e)},t.TransitionProcessor=class{ready;transitionName;sw;options;toDraw;constructor(e,r){this.transitionName=e,this.options=t.DefinedTransitions[this.transitionName],this.sw=r,this.ready=this.initialize()}async initialize(){let e=this.options;if(e.threeD?this.sw.enableDepth():this.sw.disableDepth(),e.uniformValues)for(let[t,r]of Object.entries(e.uniformValues))this.sw.setUniform(t,r);if(await this.initializeSteps(),e.polarSamplingData){let t=new s.FloatSampler(this.sw,{data:new Float32Array(e.polarSamplingData),width:e.polarSamplingData.length,height:1},{filter:s.SamplerFilter.Linear,wrapType:s.SamplerWrapType.Repeat});this.sw.setUniform("minimalPolarRadius",Math.min(...e.polarSamplingData)),this.toDraw.useSampler("polarSampler",t)}if(e.mask){let t=await(0,i.preloadImage)(`textures/${e.mask}.png`),r=new s.PixelSampler(this.sw,t,{filter:s.SamplerFilter.Linear});this.toDraw.useSampler("mask",r)}}async initializeSteps(){for(let e of this.options.steps)await this.createToDraw(e)}async createToDraw(e){let t=await this.getVertexCode(e),r=await this.getFragmentCode(e),i=this.getVerticesData(e),s={data:{vPosition:i,vTextureCoord:e.textureCoords||function(e){let t=[];for(let r=0;r<e.length;r+=3)t.push(e[r]/2+.5),t.push(e[r+1]/2+.5);return t}(i)},count:i.length/3},o={};e&&e.transform||(o.iTransform=n.Matrix4.I.toFloat32Array()),this.toDraw=new a.ToDraw(this.sw,{type:e.drawType,vertCode:t,fragCode:r,vertices:s,uniforms:o})}async getVertexCode(e){return e&&e.vertShaderName?await(await fetch(`shaders/transitions/out/${e.vertShaderName}.vert`)).text():"#version 300 es\n\t\t\tprecision mediump float;\n\t\t\tlayout (location = 0) in vec4 vPosition;\n\t\t\tlayout (location = 1) in vec2 vTextureCoord;\n\t\t\tuniform mat4 iTransform;\n\t\t\tout vec2 fTextureCoord;\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = iTransform * vPosition;\n\t\t\t\tfTextureCoord = vTextureCoord;\n\t\t\t}\n\t\t"}async getFragmentCode(e){return e&&e.fragShaderName?await(await fetch(`shaders/transitions/out/${e.fragShaderName}.frag`)).text():"#version 300 es\n\t\t\tprecision mediump float; \n\t\t\tuniform sampler2D iChannel[1];\n\t\t\tin vec2 fTextureCoord;\n\t\t\tout vec4 color;\n\t\t\tvoid main() {\n\t\t\t\tcolor = texture(iChannel[0], fTextureCoord);\n\t\t\t}\n\t\t"}getVerticesData(e){return e.vertices?e.vertices:[-1,1,0,-1,-1,0,1,1,0,1,-1,0]}updateProgress(e){let{width:t,height:r}=this.sw,i=0;for(let a of this.sw.toDraws){let s=this.options.steps[i];if(s.transform){let i=s.transform(e,this.sw.uniforms,[t,r]);a.setUniform("iTransform",i.toFloat32Array())}i++}}getSourceParams(){return this.options.sourceParams}getTargetParams(){return this.options.targetParams}useSamplers(e,t){let r=[...this.sw.toDraws];for(let i=0;i<r.length;i++){let a=this.options.steps[i],s=r[i];a.useTexture===o.Source?s.useSampler("iChannel",e):a.useTexture===o.Target?s.useSampler("iChannel",t):a.useTexture!==o.None&&s.useSampler("iChannel",e,t)}}delete(){for(let e of[...this.sw.toDraws])e.delete()}},t.getUniformSlides=function(e){let r=t.DefinedTransitions[e];if(r)return r.uniformSlides}},4071:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scrollToTop=t.getScrollOffset=t.getScrollDirection=t.scrollToView=t.getClosestScrollWrapper=t.getScrollbarWidth=t.isContentOverflow=void 0;const i=r(6099);t.isContentOverflow=function(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth};let a=null;function s(e){for(;e&&e.scrollWidth<=e.clientWidth&&e.scrollHeight<=e.clientHeight;)e=e.parentElement;return e}function n(e){let t="";return e.scrollHeight>e.clientHeight?t="y":e.scrollWidth>e.clientWidth&&(t="x"),t}function o(e,t,r){let i="x"===r?"offsetLeft":"offsetTop",a=e.offsetParent,s=e[i];if(a&&a!==t)if(a.contains(t))s-=t[i];else for(;a.offsetParent&&a.offsetParent!==t;)a=a.offsetParent,s+=a[i];return s}t.getScrollbarWidth=function(){if(null!==a)return a;let e=document.createElement("div");return e.style.cssText="width:100px; height:100px; overflow:scroll; position:absolute; left:-100px; top:-100px;",document.body.append(e),a=e.offsetWidth-e.clientWidth,e.remove(),a},t.getClosestScrollWrapper=s,t.scrollToView=function(e,t=0,r=0,a="ease-out"){let l=s(e);if(!l)return!1;let c=n(l);if(!c)return!1;if("y"===c){let s=l.scrollTop,n=null,d=o(e,l,c),h=d-t-s,u=d+e.offsetHeight+t-l.clientHeight-s;return h<0&&u<0?n=Math.max(h,u)+s:u>0&&h>0&&(n=Math.min(u,h)+s),null!==n&&n!==s&&(r?i.animatePropertyTo(l,"scrollTop",n,r,a):l.scrollTop=n,!0)}if("x"===c){let s=o(e,l,c),n=l.scrollLeft,d=0,h=s-t-n,u=s+e.offsetWidth+t-n-l.clientWidth;if(h<0&&u<0||e.offsetWidth>l.clientWidth?d=Math.max(0,s-t):u>0&&h>0&&(d=Math.min(l.scrollWidth,s+e.offsetWidth+t)-l.clientWidth),d!==n)return r?i.animatePropertyTo(l,"scrollLeft",d,r,a):l.scrollLeft=d,!0}return!1},t.getScrollDirection=n,t.getScrollOffset=o,t.scrollToTop=function(e,t=0,r=0,a="ease-out"){let n=s(e);if(!n)return!1;let l=o(e,n,"y"),c=n.scrollTop,d=Math.max(0,l-t);return d!==c&&(r?i.animatePropertyTo(n,"scrollTop",d,r,a):n.scrollTop=d,!0)}},4072:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FontList=void 0;const i=r(1326),a=r(2490),s=r(3863),n=r(4633),o={Thin:250,ExtraLight:275,UltraLight:275,Light:300,SemiLight:350,DemiLight:350,Regular:400,Normal:400,Book:400,Roman:400,Medium:500,SemiBold:600,DemiBold:600,Bold:700,ExtraBold:800,UltraBold:800,Black:900,Heavy:900};var l;!function(e){let t,r=new Map,l=[],c=new Map,d=new Map,h="aegl/fonts";async function u(e){r.has(e)||(d.has(e)&&await d.get(e),d.set(e,async function(e){let t=(0,s.addTimestamp)(`${h}/${e.toLowerCase()}/fonts.css`),a=(0,s.addTimestamp)(`${h}/${e.toLowerCase()}/fonts.json`);(0,i.loadStyle)(t);let n=await(await fetch(a)).json();r.set(e,n),l=[...r.values()].flat();for(let e of n){let t=c.get(e.fontFamily);t||(t=[],c.set(e.fontFamily,t)),t.push(e)}}(e)),await d.get(e),d.delete(e))}function p(e){let t=e.replace(/ ?Italic/,"")||"Regular";return Object.keys(o).includes(t)?t:"Regular"}e.configDirectory=function(e){h=e},e.ensure=async function(){t||(t=u("en-US")),await t},e.has=function(e){return l.some((t=>t.fontFamily===e))},e.get=function(e,t){let r;return t&&(r=l.find((r=>r.fontFamily===e&&r.fontSubFamily===t))),r||(r=l.find((t=>t.fontFamily===e))),r},e.getFamilyListByLanguage=async function(e){await u(e);let t=new Set,i=[];for(let a of r.get(e))t.has(a.fontFamily)||(i.push({fontFamily:a.fontFamily,localizedName:a.localizedName}),t.add(a.fontFamily));return i},e.getFontWeightList=function(e){let t=(c.get(e)||[]).filter((e=>!/ ?Italic/.test(e.fontSubFamily))).map((e=>e.fontSubFamily));return t.sort(((e,t)=>o[e]-o[t])),0===t.length?null:t},e.getFontWeight=p,e.getCSSFontWeight=function(e){let t=o[p(e)]||400;return 400===t?"normal":700===t?"bold":t.toString()},e.getCSSFontStyle=function(e){return e.includes("Italic")?"italic":"normal"},e.canOnlyBeItalic=function(e){let t=c.get(e)||[];return t.length>0&&t.every((e=>e.fontSubFamily.includes("Italic")))},e.getWebSafeFonts=function(e){let t=(0,n.isMacSystem)(),r=(0,n.isWindowsSystem)()?"win":t?"mac":"others",i=a.WebSafeFonts[e],s=[];return i.common&&s.push(...i.common),i[r]&&s.push(...i[r]),s}}(l||(t.FontList=l={}))},4074:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Switch=void 0;const a=r(1416),s=r(8240);let n=class extends a.Component{constructor(){super(...arguments),this.checked=!1}static style(){let{mainColor:e,adjust:t,focusBlurRadius:r,backgroundColor:i}=s.theme,n=t(18),o=2*n-8;return a.css`
		:host{
			display: inline-block;
			vertical-align: top;
			width: ${o}px;
			height: ${n}px;
			background: ${i.toMiddle(23.3)};
			border-radius: ${n/2}px;
			padding: 1px;
			margin: ${(t(28)-n)/2}px 0;
			transition: background-color 0.2s ${a.getEasing("ease-out-cubic")};
			cursor: pointer;

			&:hover{
				background: ${i.toMiddle(33)};
			}
			
			&:focus{
				box-shadow: 0 0 ${r}px ${e};
			}
		}
	
		.ball{
			width: ${n-2}px;
			height: ${n-2}px;
			background: ${i};
			border-radius: 50%;
			transition: margin 0.2s ${a.getEasing("ease-out-cubic")};
		}
	
		.on{		
			background: ${e};

			.ball{
				border-color: ${i};
				margin-left: calc(100% - ${n-2}px);
			}

			&:hover{
				background: ${e.darken(10)};
			}
		}
		`}render(){return a.html`
		<template
			tabindex="0"
			:class.on=${this.checked}
			@@click=${this.onClick}
			@@focus=${this.onFocus}
			@@blur=${this.onBlur}
		>
			<div class="ball"></div>
		</template>
		`}onClick(){this.checked=!this.checked,this.emit("change",this.checked)}onFocus(){a.on(document,"keydown",this.onKeyDown,this)}onKeyDown(e){"Enter"===e.key?(e.preventDefault(),this.onClick()):"ArrowLeft"===e.key?this.checked&&(e.preventDefault(),this.onClick()):"ArrowRight"===e.key&&(this.checked||(e.preventDefault(),this.onClick()))}onBlur(){a.off(document,"keydown",this.onKeyDown,this)}};n=i([a.define("f-switch")],n),t.Switch=n},4088:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoFramesExtractor=void 0;const i=r(7173),a=r(1326),s=r(5499),n=r(7928),o=r(8916),l=r(1824);class c extends s.Emitter{mediaInfo;extractAlphaChannel;imageFormat;totalFrameCount;timeOffset=1e-8;loadedFrameCount=0;videoFile;alphaFile;imageCache=new Map;groupState=[];blobDatas=[];segmentDuration=1;time=0;initializeTime=performance.now()/1e3;errorHappens=null;frameReader=null;alphaReader=null;ready;constructor(e,t="jpeg",r=!1){super(),this.extractAlphaChannel=r,this.imageFormat=t,this.ready=this.initialize(e)}async initialize(e){if(await this.initializeFF(e),window.VideoDecoder){if(this.frameReader=new u(this.videoFile.data,this.mediaInfo.video.frameRate),await this.frameReader.ready,this.extractAlphaChannel){let t=e.replace(/\.\w+$/,"-alpha$&");try{this.alphaFile=await i.ffmpeg.getFFFileFromPath(t),this.alphaReader=new u(this.alphaFile.data,this.mediaInfo.video.frameRate),await this.alphaReader.ready}catch(e){}}}else this.initializeIdleTask()}async initializeFF(e){let t=!1;if(this.extractAlphaChannel&&window.VideoDecoder){let r=e.replace(/\.\w+$/,"-yuv$&");try{this.videoFile=await i.ffmpeg.getFFFileFromPath(r)}catch(r){this.videoFile=await i.ffmpeg.getFFFileFromPath(e),t=!0}}else this.videoFile=await i.ffmpeg.getFFFileFromPath(e),t=!0;if(this.mediaInfo=await i.ffmpeg.getMediaInfo(this.videoFile),this.totalFrameCount=Math.ceil(this.mediaInfo.video.frameRate*this.mediaInfo.duration),this.extractAlphaChannel&&t){let e=this.mediaInfo.video.pixelFormat.replace(/\d+p/,"").toLowerCase();["yuv","rgb"].includes(e)&&(this.extractAlphaChannel=!1)}}initializeIdleTask(){d=d||new h;let e=this.mediaInfo.duration,t=Math.ceil(e/this.segmentDuration);for(let e=0;e<t;e+=1){let t=this.initializeTime+e*this.segmentDuration;this.groupState[e]={promise:null,done:!1},d.add(this,t,e)}}async getCurrentFrame(){return await this.getFrameAtTime(this.time)}async getFrameAtTime(e){if(e+=this.timeOffset,e=(0,s.constrain)(e,0,this.mediaInfo.duration),this.frameReader){let t=await this.frameReader.getFrameAt(e),r=await(this.alphaReader?.getFrameAt(e));if(this.loadedFrameCount+=1,this.emit("progress",this.loadedFrameCount),t)return{image:t.canvas,alpha:r?r.canvas:null}}let t=Math.min(Math.floor(e/this.segmentDuration),this.groupState.length-1);await this.ensureFrameGroupData(t);let r=this.getFrameIndexFromTime(e),i=await this.getExistedFrame(r);return this.clearStaleImages(r),r+1<this.totalFrameCount&&this.preloadFrame(r+1),i}async getFrameAtIndex(e){let t=e/this.mediaInfo.video.frameRate;return await this.getFrameAtTime(t)}async getBlobsAtTime(e){e+=this.timeOffset,e=(0,s.constrain)(e,0,this.mediaInfo.duration);let t=Math.min(Math.floor(e/this.segmentDuration),this.groupState.length-1);await this.ensureFrameGroupData(t);let r=this.getFrameIndexFromTime(e);return r=this.limitExistedFrameIndex(r),this.blobDatas[r]}async getBlobsAtIndex(e){let t=e/this.mediaInfo.video.frameRate;return await this.getBlobsAtTime(t)}async ensureFrameGroupData(e){let t=this.groupState[e];t.promise&&await t.promise,t.done||(t.promise=this.extractGroupFrameDatas(e),await t.promise,t.done=!0,t.promise=null)}async extractGroupFrameDatas(e){n.debug.verbose(`Extractor "${this.videoFile.name}" is extracting group ${e}...`);let t=e*this.segmentDuration,r=Math.min(e+1,this.mediaInfo.duration)*this.segmentDuration,a=this.getFrameIndexFromTime(t),s=[this.videoFile],o=0,l="vp9"===this.mediaInfo.video.codec?["-c:v","libvpx-vp9"]:[],c="jpeg"===this.imageFormat?["-q:v",0]:[],d=["-ss",t,"-to",r,...l,"-i",this.videoFile.name],h=[...c,`%05d.${this.imageFormat}`],u=this.extractAlphaChannel?["-vf","alphaextract,format=yuv420p",...c,`%05d-alpha.${this.imageFormat}`]:[],p=await i.ffmpeg.defaultWorkerGroup.request(),m=await p.execWithProgress(s,[...d,...h,...u],(e=>{this.loadedFrameCount+=e-o,this.emit("progress",this.loadedFrameCount),o=e})),f=this.extractAlphaChannel?m.length/2:m.length;if(this.extractAlphaChannel)for(let e=0;e<f;e++){let t=new Blob([m[2*e].data],{type:`image/${this.imageFormat}`}),r=new Blob([m[2*e+1].data],{type:`image/${this.imageFormat}`});this.blobDatas[a+e]=[t,r]}else for(let e=0;e<f;e++){let t=new Blob([m[e].data],{type:`image/${this.imageFormat}`});this.blobDatas[a+e]=[t,null]}n.debug.verbose(`Extractor ${this.videoFile.name}" extracted group ${e}`)}getFrameIndexFromTime(e){let t=this.mediaInfo.video.frameRate;return Math.floor(e*t)}async getExistedFrame(e){return e=this.limitExistedFrameIndex(e),this.imageCache.has(e)?await this.imageCache.get(e):this.blobDatas[e]?await this.parseFrameData(e):null}limitExistedFrameIndex(e){return Math.min(e,this.blobDatas.length-1)}async parseFrameData(e){let[t,r]=this.blobDatas[e],i=(0,a.preloadImage)(URL.createObjectURL(t)),s=r?(0,a.preloadImage)(URL.createObjectURL(r)):Promise.resolve(null),n=Promise.all([i,s]).then((([e,t])=>({image:e,alpha:t})));return this.imageCache.set(e,n),await n}async clearStaleImages(e){for(let t of[...this.imageCache.keys()])if(t<e){let{image:e,alpha:r}=await this.imageCache.get(t);e instanceof HTMLImageElement&&URL.revokeObjectURL(e.src),r&&r instanceof HTMLImageElement&&URL.revokeObjectURL(r.src),this.imageCache.delete(t)}}async preloadFrame(e){await this.getExistedFrame(e)}async runIdleTask(e){if(this.errorHappens)throw this.errorHappens;this.ensureFrameGroupData(e).catch((e=>{this.errorHappens||(this.errorHappens=e,this.delete())})),await(0,s.sleep)(0)}delete(){this.clearStaleImages(1/0),d?.removeAllOf(this)}}let d;t.VideoFramesExtractor=c;class h{tasks=[];running=!1;add(e,t,r){this.tasks.push({extrator:e,startTime:t,groupIndex:r}),this.tasks.sort(((e,t)=>e.startTime-t.startTime)),this.running||this.run()}async run(){for(;this.tasks.length>0;){let e=this.tasks.shift();for(;!i.ffmpeg.defaultWorkerGroup.isIdle();)await i.ffmpeg.defaultWorkerGroup.untilIdle(),await(0,s.sleep)(10);await e.extrator.runIdleTask(e.groupIndex)}this.running=!1}has(e,t){return this.tasks.some((r=>e===r.extrator&&t===r.groupIndex))}remove(e,t){(0,s.removeWhere)(this.tasks,(r=>e===r.extrator&&t===r.groupIndex))}removeAllOf(e){this.tasks=this.tasks.filter((t=>e!==t.extrator))}shift(){return this.tasks.shift()}}class u{buffer;frameRate;ready;videoTrack;videoSink;videoSinkReader=null;currentCanvas=null;firstTimestamp=0;gettingPromise=null;inLastFrame=!1;constructor(e,t){this.buffer=e,this.frameRate=t,this.ready=this.init()}async init(){let e=new o.Input({formats:[o.WEBM,o.MP4],source:new o.BufferSource(this.buffer)});this.videoTrack=await e.getPrimaryVideoTrack(),this.videoSink=new o.CanvasSink(this.videoTrack,{poolSize:1}),this.firstTimestamp=await this.videoTrack.getFirstTimestamp()}async getFrameAt(e){e=Math.max(e,this.firstTimestamp),await this.ready,this.gettingPromise&&await this.gettingPromise;let t=(0,l.promiseWithResolves)();this.gettingPromise=t.promise;let r=await this.gettingFrameAt(e);return this.currentCanvas=r,this.gettingPromise=null,t.resolve(),r}async gettingFrameAt(e){let t=this.currentCanvas;if(t&&this.isCanvasOK(t,e))return t;if(this.inLastFrame&&t&&e>=t.timestamp)return t;if(this.videoSinkReader){let t=await this.readFromVideoSinkReader(e);if(t)return t}this.videoSinkReader=this.videoSink.canvases(e),this.inLastFrame=!1;let r=await this.readFromVideoSinkReader(e);return r||(this.videoSinkReader=null,this.inLastFrame=!1,r=await this.videoSink.getCanvas(e),r)}async readFromVideoSinkReader(e){let t=await this.videoSinkReader.next();if(!t.done){let r=t.value;if(this.isCanvasOK(r,e))return r;if(e-r.timestamp>0&&e-r.timestamp<5/this.frameRate)for(;!t.done&&t.value.timestamp<e+.5/this.frameRate;){if(t=await this.videoSinkReader.next(),t.done)return this.inLastFrame=!0,r;if(r=t.value,this.isCanvasOK(r,e))return r}}return null}isCanvasOK(e,t){return Math.abs(e.timestamp-t)<=.5/this.frameRate}}},4118:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nuniform float iOpacity;\nuniform bool inverted;\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nfloat maskAlpha = texture(iChannel[0], textureCoord0).a;\nmaskAlpha = inverted ? 1.0 - maskAlpha : maskAlpha;\nvec4 color = texture(iChannel[1], textureCoord1);\ncolor *= maskAlpha;\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},4173:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ComplexKeyframesPacker=t.PropertyKeyframes=t.clearKeyframeCache=t.ensureComplexKeyframeClass=t.ensureKeyframeClass=void 0;const i=r(2154),a=r(5499);let s=new Map;t.ensureKeyframeClass=function(e){let t=s.get(e);return t||(t=new o(e),s.set(e,t)),t};let n=new Map;t.ensureComplexKeyframeClass=function(e){let t=n.get(e);return t||(t=new l(e),n.set(e,t)),t},t.clearKeyframeCache=function(){s=new Map,n=new Map};class o{keyframes;timeRange=[-1,-1];valueFn;constructor(e){this.keyframes=e}getAutoBezierEase(e){let t=Math.max(e-1,0),r=Math.min(e+1,this.keyframes.length-1),i=this.keyframes[t],a=this.keyframes[r];return this.geKeyframeSpeeds(i.value,a.value,a.time-i.time).map((e=>({speed:e,influence:33.3})))}geKeyframeSpeeds(e,t,r){return Array.isArray(e)?t.map(((t,i)=>(t-e[i])/r)):[(t-e)/r]}get(e){return(e<this.timeRange[0]||e>this.timeRange[1])&&this.updateLeftRight(e),this.valueFn(e)}updateLeftRight(e){let t=this.keyframes.findIndex((t=>t.time>=e)),r=t>=0&&t<this.keyframes.length?this.keyframes[t]:null,i=t>0?this.keyframes[t-1]:0===t?null:this.keyframes[this.keyframes.length-1];if(i&&r)if(this.timeRange=[i.time,r.time],i.outEase||r.inEase||i.autoBezier||r.autoBezier){let e=i.outEase||(i.autoBezier?this.getAutoBezierEase(t-1):void 0),a=r.inEase||(r.autoBezier?this.getAutoBezierEase(t):void 0);this.valueFn=this.createCubicBezierValueFn(i,r,e,a)}else this.valueFn=this.createLinearValueFn(i,r);else r?(this.timeRange=[-1/0,r.time],this.valueFn=()=>r.value):(this.timeRange=[i.time,1/0],this.valueFn=()=>i.value)}createCubicBezierValueFn(e,t,r,i){let a=t.time-e.time,s=e.time;if(Array.isArray(e.value)){let n=e.value,o=t.value,l=e.value.map(((e,t)=>{let s=o[t]-e,n=r?r[t]||r[0]:void 0,l=i?i[t]||i[0]:void 0;return this.createSingleCubicBezierEasing(n,l,a,s)}));return e=>{let t=(e-s)/a;return l.map((e=>e(t))).map(((e,t)=>n[t]*(1-e)+o[t]*e))}}{let n=e.value,o=t.value,l=o-n,c=r?r[0]:void 0,d=i?i[0]:void 0,h=this.createSingleCubicBezierEasing(c,d,a,l);return e=>{let t=h((e-s)/a);return n*(1-t)+o*t}}}createSingleCubicBezierEasing(e,t,r,a){let s=a/r,[n,o]=this.getBezierControlPoint(e,s,!0),[l,c]=this.getBezierControlPoint(t,s,!1);return(0,i.getCubicBezierEasingFunction)(n,o,l,c)}getBezierControlPoint(e,t,r){let i=e?e.influence/100:0,a=e&&0!==t?i*e.speed/t:0;return r?[i,a]:[1-i,1-a]}createLinearValueFn(e,t){let r=t.time-e.time,i=e.time;if(Array.isArray(e.value)){let a=e.value,s=t.value;return e=>{let t=(e-i)/r;return a.map(((e,r)=>e*(1-t)+s[r]*t))}}{let a=e.value,s=t.value;return e=>{let t=(e-i)/r;return a*(1-t)+s*t}}}}t.PropertyKeyframes=o;class l{template;propertyKeyframes;constructor(e){this.template=(0,a.deepClone)(e[0].value),this.propertyKeyframes=new o(this.packKeyFrames(e))}packKeyFrames(e){let t=[];for(let r of e){let e=this.getAllNumbers(r.value),i={time:r.time,value:e};for(let e of Object.keys(r))"time"!==e&&"value"!==e&&(i[e]=r[e]);t.push(i)}return t}getAllNumbers(e){let t=[];return this.walkObjectToFindNumbers(e,((e,r,i)=>{t.push(i)})),t}setAllNumbers(e,t){let r=0;return this.walkObjectToFindNumbers(e,((e,i,a)=>{e[i]=t[r++]})),e}walkObjectToFindNumbers(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++){let i=e[r];"number"==typeof i&&t(e,r,i),"object"==typeof i&&this.walkObjectToFindNumbers(i,t)}else if(e&&"object"==typeof e)for(let[r,i]of Object.entries(e))"number"==typeof i&&t(e,r,i),"object"==typeof i&&this.walkObjectToFindNumbers(i,t)}get(e){let t=this.propertyKeyframes.get(e);return this.setAllNumbers(this.template,t)}}t.ComplexKeyframesPacker=l},4201:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),(0,r(4062).extendTransitions)({spade:{uniformValues:{maxMaskExtandRate:3.1},mask:"spade",steps:[{fragShaderName:"mask-of-shape"}]},club:{uniformValues:{maxMaskExtandRate:4.1},mask:"club",steps:[{fragShaderName:"mask-of-shape"}]}})},4218:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loading=t.LoadingBinging=void 0;const i=r(1416),a={size:"medium",transition:"fade"};class s{constructor(e){this.value=!1,this.options=new i.Options(a),this.cover=null,this.el=e}update(e,t){this.value=e,this.options.update(t);let r=this.options.get("transition");this.value?this.cover&&(r?new i.Transition(this.cover,r).leave().then((e=>{e&&(this.cover.remove(),this.cover=null)})):(this.cover.remove(),this.cover=null)):(this.cover||(this.cover=i.render(i.html`<f-loader .size=${this.options.get("size")} .asCover />`).fragment.firstElementChild,this.el.append(this.cover)),r&&new i.Transition(this.cover,r).enter())}remove(){this.cover&&this.cover.remove()}}t.LoadingBinging=s,t.loading=i.defineBinding("loading",s)},4277:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderableShapeMaskDrawer=void 0;const i=r(1830),a=r(6376),s=r(9658),n=r(8737),o=r(6339),l=r(6412),c=r(5413),d=r(4118),h=r(4452),u=r(4557);class p extends s.Drawer{shapes;toBlendMask=null;toBlendFinalMask=null;toDrawMaskFeather=null;forClipping=!1;constructor(e,t){super(e,t),this.initializeShapesAndToDraws()}initializeShapesAndToDraws(){let e=this.data.filter((e=>e.maskMode!==u.AEMaskMode.None)),t=e.some((e=>e.maskFeather)),r=e.some((e=>e.maskMode===u.AEMaskMode.Subtract));this.forClipping=1===e.length&&!t&&!r,this.shapes=e.map((e=>this.createMaskShape(e))),this.forClipping||(this.toBlendMask=new o.ToDrawEffect({renderer:this.renderer,fragCode:c.default}),this.toBlendFinalMask=new o.ToDrawEffect({renderer:this.renderer,fragCode:d.default}),this.toDrawMaskFeather=new l.ToDrawFastBlur({renderer:this.renderer,samplingCount:this.renderer.project.options.fastBlurSamplingCount,iterateCount:this.renderer.project.options.fastBlurRenderingIterateCount}))}createMaskShape(e){let t={path:e.maskPath,fill:{color:[1,1,1,1]}},r=new n.ShapeGroupDrawer(this.renderer,t,this.forClipping);return r.initialize(),r}setTransformStat(e){super.setTransformStat(e);for(let t of this.shapes)t.setTransformStat(e)}setTime(e){super.setTime(e);for(let t of this.shapes)t.setTime(e)}setTransformStatus(e){super.setTransformStatus(e);for(let t of this.shapes)t.setTransformStatus(e)}update(){for(let e of this.shapes)e.update()}willDraw(e,t){return this.forClipping?this.willDrawClipping(e,t):this.willDrawNormalBlending(e,t)}willDrawClipping(e,t){let r=t;for(let t=0;t<this.data.length;t++){let a=this.shapes[t],s=t===this.data.length-1,n=null;if(n=this.willDrawEachClipping(a,e,r),s||!n)return n;let{mappedSampler:o,paintArea:l}=this.renderer.drawAsMappedSamplerFromFn(n,!0);if(e=o,r=i.PaintArea.cross([r,l]),!r)break}return null}willDrawEachClipping(e,t,r){return e.setMappedChannel(t),e.setMaskArea(r),()=>{let t=e.draw();return e.clearChannel(),t}}willDrawNormalBlending(e,t){let r=null,i=this.toBlendFinalMask;for(let e=0;e<this.data.length;e++){let i=this.data[e],a=this.shapes[e];r=this.drawMaskBlending(i,a,r,t)}return i.setInputPaintArea(t),i.setMappedChannel(r,e),()=>(i.draw(),i.clearChannel(),t)}drawMaskBlending(e,t,r,i){t.setMaskArea(i);let s=this.toDrawMaskFeather,n=this.toBlendMask;n.setInputPaintArea(i);let{mappedSampler:o,paintArea:l}=this.renderer.drawAsMappedSamplerFromFn((()=>t.draw()),!0);if(r?n.setSubMappedChannel(0,r):n.setSubMappedChannel(0,this.renderer.sw.textureFrameManager.getEmptyMappedSampler()),e.maskFeather){let t=(0,a.getPropertyValue)(e.maskFeather,this.time);s.setBlurRadius(this.transformStatus.projectVector(new h.Vector2(...t))),s.setInputPaintArea(l),s.setMappedChannel(o);let r=s.drawAsSampler();s.clearChannel(),n.setSubMappedChannel(1,r)}else n.setSubMappedChannel(1,o);return n.setUniform("maskMode",e.maskMode),n.setUniform("isFirst",!r),this.renderer.drawAsMappedSamplerFromFn((()=>(n.draw(),n.clearChannel(),i)),!0).mappedSampler}delete(){for(let e of this.shapes)e.delete();this.toBlendMask&&this.toBlendMask.delete(),this.toBlendFinalMask&&this.toBlendFinalMask.delete(),this.toDrawMaskFeather&&this.toDrawMaskFeather.delete()}}t.RenderableShapeMaskDrawer=p},4310:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAlignRateFromLeft=t.getLetterSpacingFronTrackingAmount=t.getLetterSpacingFronTracking=t.clearTextAnimaterPlugins=t.getTextAnimaterProperties=void 0;const i=r(6376),a=r(5305),s=r(5499),n=r(2154),o=r(4557),l=r(2854),c=r(9997),d=r(4557);t.getTextAnimaterProperties=function(e,t,r){return new h(e,t,r).generateProperties()};class h{layerData;time;charIndices;animaterPropertieValuesArray=[];animaterSelectorValuesArray=[];constructor(e,t,r){this.layerData=e,this.charIndices=r,this.time=t,this.initializeCharFreeSelectorValues()}initializeCharFreeSelectorValues(){for(let e of this.layerData.animaters){let{selectors:t,properties:r}=e,s=(0,i.getPropertyValues)(r,this.time);if(t){let e=t.map((e=>(0,i.getPropertyValues)(e,this.time,a.TextAnimaterSelecterDefaultValues)));this.animaterSelectorValuesArray.push(e)}else this.animaterSelectorValuesArray.push(null);this.animaterPropertieValuesArray.push(s)}}generateProperties(){let e=[];for(let t=0;t<this.charIndices.length;t++){let r=null;for(let e=0;e<this.layerData.animaters.length;e++){let i=this.getSingleTextAnimaterProperties(e,t);r=r?this.mergeAnimaterProperties(r,i):i}(0,s.assignIf)(r,a.TextAnimatorPropertiesDefaultValues),e.push(r)}return e}getSingleTextAnimaterProperties(e,t){let r=this.layerData.animaters[e],i=this.animaterSelectorValuesArray[e],n=this.animaterPropertieValuesArray[e],l=1,d=null;if(!i)return n;for(let e=0;e<i.length;e++){let a,h=i[e],[u,m]=this.getCharIndex(t,h.basedOn);if(1===h.randomizeOrder&&(u=(0,c.seedRandom)(0,m,(h.randomSeed||0)+u)),"EXPRESSION"===h.amount){d=p(this.layerData,r,this.time),a=d.amount(u,m)/100;for(let e of Object.keys(n))n[e]=d[e](t,this.charIndices.length)}else a=this.getSelectorInitialAmount(h,u,m),0===e&&h.mode===o.AETextAnimaterSelecterMode.Subtract&&(a=1-a),(h.easeHigh||h.easeLow)&&(a=g(a,h.easeHigh,h.easeLow)),a*=h.amount/100;l=0===e?a:this.mergeSelectorAmounts(l,a,h.mode),l=(0,s.constrain)(l,-1,1)}let h={};for(let e of Object.keys(n))h[e]=this.mixPropertyValue(n[e],a.TextAnimatorPropertiesDefaultValues[e],l);return h}getCharIndex(e,t){let r=this.charIndices[e];return t===d.AETextAnimaterSelecterBasedOn.CharactersExcludingSpaces?[r.charIndexExcludeSpace,this.charIndices[this.charIndices.length-1].charIndexExcludeSpace+1]:t===d.AETextAnimaterSelecterBasedOn.Words?[r.wordIndex,this.charIndices[this.charIndices.length-1].wordIndex+1]:t===d.AETextAnimaterSelecterBasedOn.Lines?[r.lineIndex,this.charIndices[this.charIndices.length-1].lineIndex+1]:[r.charIndex,this.charIndices[this.charIndices.length-1].charIndex+1]}getSelectorInitialAmount(e,t,r){let i=e.end-e.start,a=(t/r*i-e.offset-e.start)/i;return e.shape==o.AETextAnimaterSelecterShape.Square?this.getSquareShapeAmount(a,r,i,e.smoothness):this.getNotSquareShapeAmount(a,e.shape)}getSquareShapeAmount(e,t,r,i){let a=1.1/t*i/r;return e<0?m(-a,0,e):e>1?m(1,1+a,e):1}getNotSquareShapeAmount(e,t){let r;switch(e=(0,s.constrain)(e,0,1),t){case o.AETextAnimaterSelecterShape.RampUp:r=e;break;case o.AETextAnimaterSelecterShape.RampDown:r=1-e;break;case o.AETextAnimaterSelecterShape.Triangle:r=Math.max(1-2*Math.abs(e-.5),0);break;case o.AETextAnimaterSelecterShape.Round:r=Math.sqrt(1-Math.pow(2*e-1,2));break;case o.AETextAnimaterSelecterShape.Smooth:e=Math.max(1-2*Math.abs(e-.5),0),r=3*Math.pow(e,2)-2*Math.pow(e,3)}return r}mergeSelectorAmounts(e,t,r){switch(r){case o.AETextAnimaterSelecterMode.Add:return e+t;case o.AETextAnimaterSelecterMode.Subtract:return e*(1-t);case o.AETextAnimaterSelecterMode.Intersect:return e*t;case o.AETextAnimaterSelecterMode.Min:return Math.min(e,t);case o.AETextAnimaterSelecterMode.Max:return Math.max(e,t);case o.AETextAnimaterSelecterMode.Difference:return t-e}}mixPropertyValue(e,t,r){return"number"==typeof e?e*r+(t||0)*(1-r):Array.isArray(e)&&"number"==typeof e[0]?void 0===t?e.map((e=>e*r)):e.map(((e,i)=>e*r+t[i]*(1-r))):e}mergeAnimaterProperties(e,t){for(let r of Object.keys(t))e.hasOwnProperty(r)?e[r]=this.mergePropertyValues(r,e[r],t[r]):e[r]=t[r];return e}mergePropertyValues(e,t,r){return"opacity"===e||"scale"===e?"number"==typeof t?t*r/100:Array.isArray(t)&&"number"==typeof t[0]?t.map(((e,t)=>e*r[t]/100)):r:"number"==typeof t?t+r:Array.isArray(t)&&"number"==typeof t[0]?t.map(((e,t)=>e+r[t])):r}}let u=new Map;function p(e,t,r){let i=u.get(t);return i||(i=new((0,l.getTextAnimaterPlugin)(t.name))(e,t),i.initialize(),u.set(t,i)),i.updateTime(r),i}function m(e,t,r){return r<=e?0:r>=t?1:(r-e)/(t-e)}t.clearTextAnimaterPlugins=function(){u=new Map};const f=new Map;function g(e,t,r){let i=256*(t+100)+(r+100),a=f.get(i);if(!a){let e=r>=0?r/100:0,s=r>=0?0:-r/100,o=t>=0?1-t/100:1,l=t>=0?1:1+t/100;a=(0,n.getCubicBezierEasingFunction)(e,s,o,l),f.set(i,a)}return a(e)}t.getLetterSpacingFronTracking=function(e,t){return e*t/1100},t.getLetterSpacingFronTrackingAmount=function(e,t){return e*t/100},t.getAlignRateFromLeft=function(e){return e===d.AETextParagraphJustification.LeftJustify||e===d.AETextParagraphJustification.FullJustifyLastLineLeft?0:e===d.AETextParagraphJustification.RightJustify||e===d.AETextParagraphJustification.FullJustifyLastLineRight?1:.5}},4365:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 source = texture(iChannel[0], textureCoord0);\nvec4 dest = texture(iChannel[1], textureCoord1);\nreturn dest * (1.0 - source.a) + dest * source;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},4369:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JSONManager=void 0;const i=r(5499),a=r(6376),s=r(3863),n=r(7192);class o{static AllAspectRatios={"16x9":[1920,1080],"1x1":[1e3,1e3],"9x16":[1080,1920]};currentAspectRatios={};id;rootDirectory;json;ready;constructor(e,t="aegl"){this.id=e,this.rootDirectory=t,this.ready=this.load()}async load(){let e=(0,s.addTimestamp)(`${this.rootDirectory}/templates/${this.id}/${this.id}.json`);this.json=await(await fetch(e)).json(),this.initializeCurrentAspectRatios()}initializeCurrentAspectRatios(){if(this.json.supportsSyntheticAspectRatios||void 0===this.json.supportsSyntheticAspectRatios)this.currentAspectRatios=o.AllAspectRatios;else{let e=[];for(let t of this.json.projects){let r=(0,n.getAspectRatioFromResolution)(t.height);e.push(r)}for(let t of Object.keys(o.AllAspectRatios))e.includes(t)&&(this.currentAspectRatios[t]=o.AllAspectRatios[t])}}requestProjectData(e){let t,[r,a]=o.AllAspectRatios[e],s=this.json.projects.find((e=>e.width===r&&e.height===a));if(s)t=(0,i.deepClone)(s);else{let e=(0,i.deepClone)(this.getClosestRatioProjectData(r/a));t=this.adjustViewportSize(e,r,a)}return t.id=this.json.id,t.name=this.json.name,t.cover=this.json.cover,t.coverAtSecond=this.json.coverAtSecond,t.backCover=this.json.backCover,t}getClosestRatioProjectData(e){let t=this.json.projects.map((t=>{let r=t.width/t.height/e;return r>=1?r-1:1/r-1})),r=(0,i.minIndex)(t);return this.json.projects[r]}adjustViewportSize(e,t,r){let i=t/e.width,a=r/e.height;e.width=Math.round(e.width*i),e.height=Math.round(e.height*a);let s=[...e.layers,...e.compItems.map((e=>e.layers)).flat()];for(let e of s)this.scaleLayer(e,i,a);return e}scaleLayer(e,t,r){switch(e.width&&(e.mediaWidth=e.mediaWidth||e.width,e.width=this.scaleProperty(e.width,t,t)),e.height&&(e.mediaHeight=e.mediaHeight||e.height,e.height=this.scaleProperty(e.height,r,r)),e.type){case"camera":this.scaleCameraLayer(e,t,r);break;case"text":this.scaleTextLayer(e,t,r);break;case"shape":this.scaleShapeLayer(e,t,r)}e.transform&&this.scaleTransform(e.transform,t,r);let i=e.effects;i&&this.scaleEffects(i,t,r)}scaleCameraLayer(e,t,r){for(let i of["zoom","focusDistance"])e[i]&&(e[i]=this.scaleProperty(e[i],t,r))}scaleTextLayer(e,t,r){for(let i of["fontSize","tracking","strokeWidth"])e[i]&&(e[i]=this.scaleProperty(e[i],Math.sqrt(t*r)));for(let i of["boxTextSize"])e[i]&&(e[i]=this.scaleProperty(e[i],t,r));if(e.transform&&e.transform.position&&e.transform.position&&"number"==typeof e.fontSize&&this.moveProperty(e.transform.position,0,(1-r)*e.fontSize*.08),e.animaters)for(let i of e.animaters)i.properties&&this.scaleTransform(i.properties,Math.sqrt(t*r))}scaleShapeLayer(e,t,r){for(let i of e.contents)i.transform&&this.scaleTransform(i.transform,t,r),"rect"===i.type&&(i.size=this.scaleProperty(i.size,t,r))}scaleTransform(e,t,r=t){if(e)for(let i of["anchorPoint","position","pointOfInterest"])e[i]&&(e[i]=this.scaleProperty(e[i],t,r))}scaleEffects(e,t,r=t){for(let i of e){for(let e of["horizontalRadius"])i[e]&&(i[e]=this.scaleProperty(i[e],t));for(let e of["verticalRadius"])i[e]&&(i[e]=this.scaleProperty(i[e],r));for(let e of["anchorPoint","position","tileCenter","bulgeCenter"])i[e]&&(i[e]=this.scaleProperty(i[e],t,r));"tile"===i.type&&(i.outputWidth=i.outputHeight=Math.max(i.outputWidth||100,i.outputHeight||100))}}scaleProperty(e,t,r=t){if((0,a.isPropertyValueBeKeyFrames)(e))for(let i=0;i<e.length;i++){let a=e[i];a.value=this.scaleValue(a.value,t,r)}else e=this.scaleValue(e,t,r);return e}scaleValue(e,t,r){return Array.isArray(e)?(e.length>0&&(e[0]*=t),e.length>1&&(e[1]*=r),e.length>2&&(e[2]*=Math.max(t,r))):e*=Math.max(t,r),e}moveProperty(e,t,r){if((0,a.isPropertyValueBeKeyFrames)(e))for(let i=0;i<e.length;i++){let a=e[i];a.value=this.moveValue(a.value,t,r)}else e=this.moveValue(e,t,r);return e}moveValue(e,t,r){if(!Array.isArray(e))throw new Error(`Can't move not array type of value ${e}!`);return e.length>0&&(e[0]+=t),e.length>1&&(e[1]+=r),e}}t.JSONManager=o},4411:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.adjustLayerTimeProperties=t.scaleLayerTimePoints=t.moveLayerTimeProperties=t.moveLayerTimePoints=t.getMaxCrossLayerIndex=t.getCrossedRootLayers=t.findUnReplacableVideoLayersInside=t.findEditableTextLayersInside=t.getEditableTextDeepLayers=t.findReplacableMediaLayersInside=t.getReplacableMediaDeepLayers=void 0;const i=r(5499);function a(e,t){return n(e,t,(e=>!0===e.replaceable&&("image"===e.type||"video"===e.type)))}function s(e,t){return n(e,t,(e=>!0===e.replaceable&&"text"===e.type))}function n(e,t,r){return r(t)?[t]:"composite"===t.type?e.data.getCompLayersFromId(t.compItemId).map((t=>n(e,t,r))).flat():[]}function o(e,t){return e.outPoint>t.inPoint&&e.outPoint<=t.outPoint||e.inPoint<=t.inPoint&&e.outPoint>=t.outPoint&&"audio"!==e.type}function l(e,t){if(Array.isArray(e))for(let r of e)r.time&&(r.time=t(r.time)),l(r,t);else for(let r of Object.keys(e)){let i=e[r];"object"==typeof i&&l(i,t)}}t.getReplacableMediaDeepLayers=function(e){return e.data.layers.map((t=>{let r=a(e,t);return r.length>0?{root:t,layers:r}:null})).filter((e=>e))},t.findReplacableMediaLayersInside=a,t.getEditableTextDeepLayers=function(e){return e.data.layers.map((t=>{let r=s(e,t);return r.length>0?{root:t,layers:r}:null})).filter((e=>e))},t.findEditableTextLayersInside=s,t.findUnReplacableVideoLayersInside=function(e,t){return n(e,t,(e=>!0!==e.replaceable&&"video"===e.type))},t.getCrossedRootLayers=function(e,t,r){let i=[];for(let a of e.data.layers)r.has(a.id)||"audio"!==t.type&&o(a,t)&&i.push(a);return i},t.getMaxCrossLayerIndex=function(e,t){let r=t.map((t=>{return r=t.root,i=e.root,Math.min(r.outPoint,i.outPoint)-Math.max(r.inPoint,i.inPoint);var r,i})),a=(0,i.maxIndex)(r);return r[a]>.5?a:-1},t.moveLayerTimePoints=function(e,t){e.inPoint+=t,e.outPoint+=t,void 0!==e.startTime&&(e.startTime+=t);for(let r of Object.keys(e)){if("layers"===r)continue;let i=e[r];"object"==typeof i&&l(i,(e=>e+t))}},t.moveLayerTimeProperties=function(e,t){for(let r of Object.keys(e)){if("layers"===r)continue;let i=e[r];"object"==typeof i&&l(i,(e=>e+t))}},t.scaleLayerTimePoints=function(e,t,r){e.inPoint=(e.inPoint-r)*t+r,e.outPoint=(e.outPoint-r)*t+r,"video"===e.type&&e.timeRemap&&delete e.timeRemap;for(let i of Object.keys(e)){if("layers"===i)continue;let a=e[i];"object"==typeof a&&l(a,(e=>(e-r)*t+r))}},t.adjustLayerTimeProperties=function(e,t){for(let r of Object.keys(e)){if("layers"===r)continue;let i=e[r];"object"==typeof i&&l(i,t)}}},4436:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Weak2WayMap=void 0,t.Weak2WayMap=class{constructor(){this.lm=new WeakMap,this.rm=new WeakMap}updateFromLeft(e,t){let r=this.lm.get(e);if(r&&0!==r.size){for(let i of t)r.has(i)||this.addRightLeftMap(i,e);for(let i of r)t.has(i)||this.removeRightLeftMap(i,e)}else for(let r of t)this.addRightLeftMap(r,e);this.lm.set(e,t)}addRightLeftMap(e,t){let r=this.rm.get(e);r||(r=new Set,this.rm.set(e,r)),r.add(t)}removeRightLeftMap(e,t){let r=this.rm.get(e);r&&r.delete(t)}getFromRight(e){return this.rm.get(e)}clearFromLeft(e){let t=this.lm.get(e);if(t){for(let r of t)this.removeRightLeftMap(r,e);this.lm.delete(e)}}clearFromRight(e){let t=this.rm.get(e);if(t){for(let r of t)this.removeLeftRightMap(r,e);this.rm.delete(e)}}removeLeftRightMap(e,t){let r=this.lm.get(e);r&&r.delete(t)}}},4443:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observe=void 0;const i=r(8622);t.observe=function(e){if(e&&"object"==typeof e){return i.proxyMap.get(e)||i.observeTarget(e)}return e}},4452:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=t.Vector3=t.Vector2=void 0;class r{static fromRadians(e){return new r(Math.cos(e),Math.sin(e))}static fromAngle(e){return r.fromRadians(e/180*Math.PI)}x;y;constructor(e=0,t=0){this.x=e,this.y=t}add(e){return this.clone().addSelf(e)}addSelf(e){return this.x+=e.x,this.y+=e.y,this}minus(e){return this.clone().minusSelf(e)}minusSelf(e){return this.x-=e.x,this.y-=e.y,this}multiply(e){return this.clone().multiplySelf(e)}multiplySelf(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.clone().multiplyScalarSelf(e)}multiplyScalarSelf(e){return this.x*=e,this.y*=e,this}divide(e){return this.clone().divideSelf(e)}divideSelf(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.clone().divideScalarSelf(e)}divideScalarSelf(e){return this.x/=e,this.y/=e,this}normalize(){return this.clone().normalizeSelf()}normalizeSelf(){let e=1/this.length();return this.x*=e,this.y*=e,this}clone(){return new r(this.x,this.y)}rotate(e){return this.clone().rotateSelf(e)}rotateSelf(e){let t=Math.cos(e),r=Math.sin(e),{x:i,y:a}=this;return this.x=i*t-a*r,this.y=i*r+a*t,this}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}cross(e){return this.x*e.y-this.y*e.x}get values(){return this.xy}get xy(){return[this.x,this.y]}}t.Vector2=r;class i{x;y;z;static fromVector2(e){return new i(e.x,e.y,1)}constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}add(e){return this.clone().addSelf(e)}addSelf(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}minus(e){return this.clone().minusSelf(e)}minusSelf(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}multiply(e){return this.clone().multiplySelf(e)}multiplySelf(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.clone().minusSelf(e)}multiplyScalarSelf(e){return this.x*=e,this.y*=e,this.z*=e,this}divide(e){return this.clone().divideSelf(e)}divideSelf(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.clone().divideScalarSelf(e)}divideScalarSelf(e){return this.x/=e,this.y/=e,this.z/=e,this}normalize(){return this.clone().normalizeSelf()}normalizeSelf(){let e=1/this.length();return this.x*=e,this.y*=e,this.z*=e,this}clone(){return new i(this.x,this.y,this.z)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}cross(e){let{x:t,y:r,z:a}=this,{x:s,y:n,z:o}=e;return new i(r*o-n*a,a*s-o*t,t*n-s*r)}get values(){return this.xyz}get xy(){return[this.x,this.y]}get xyz(){return[this.x,this.y,this.z]}}t.Vector3=i;class a{x;y;z;w;static fromVector2(e){return new a(e.x,e.y,0,1)}static fromVector3(e){return new a(e.x,e.y,e.z,1)}constructor(e=0,t=0,r=0,i=1){this.x=e,this.y=t,this.z=r,this.w=i}add(e){return this.clone().addSelf(e)}addSelf(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}minus(e){return this.clone().minusSelf(e)}minusSelf(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}multiply(e){return this.clone().multiplySelf(e)}multiplySelf(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.clone().multiplySelf(e)}multiplyScalarSelf(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}divide(e){return this.clone().divideSelf(e)}divideSelf(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.clone().divideScalarSelf(e)}divideScalarSelf(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}normalize(){return this.clone().normalizeSelf()}normalizeSelf(){let e=1/this.length();return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}clone(){return new a(this.x,this.y,this.z,this.w)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}get values(){return this.xyzw}get xy(){return[this.x,this.y]}get xyz(){return[this.x,this.y,this.z]}get xyzw(){return[this.x,this.y,this.z,this.w]}}t.Vector4=a},4462:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.droppable=t.DroppableBinding=t.draggable=t.DraggableBinding=void 0;const i=r(1416),a=r(5499),s=r(8240);class n{constructor(e){this.name="",this.data=null,this.index=-1,this.el=e,this.el.setAttribute("draggable","false"),this.el.style.cursor="grab",i.on(this.el,"mousedown",this.onMouseDown,this),i.on(this.el,"mouseenter",this.onMouseEnter,this)}update(e,t,r){this.data=e,this.index=t,r&&Object.assign(this,r)}onMouseDown(e){e.preventDefault();let t=!1,r=e.clientX,a=e.clientY,s=e=>{if(!t&&(Math.abs(e.clientX-r)>5||Math.abs(e.clientY-a)>5)&&(t=!0,l.startDragging(this)),t){let t=e.clientX-r,i=e.clientY-a;l.translateDragging(t,i)}};i.on(document,"mousemove",s),i.once(document,"mouseup",(async()=>{i.off(document,"mousemove",s),l.endDragging()}))}onMouseEnter(){l.enterDraggable(this)}remove(){i.off(this.el,"mousedown",this.onMouseDown,this),i.off(this.el,"mouseenter",this.onMouseEnter,this)}}t.DraggableBinding=n,t.draggable=i.defineBinding("draggable",n);class o{constructor(e){this.name="",this.onenter=null,this.onleave=null,this.el=e,i.on(this.el,"mouseenter",this.onMouseEnter,this)}update(e,t){this.ondrop=e,t&&Object.assign(this,t)}onMouseEnter(){l.enterDroppable(this),i.once(this.el,"mouseleave",this.onMouseLeave,this)}emitEnter(e){this.onenter&&this.onenter(e.data,e.index)}onMouseLeave(){l.leaveDroppable(this)}emitLeave(e){this.onleave&&this.onleave(e.data,e.index)}emitDrop(e,t){this.ondrop&&this.ondrop(e.data,t)}remove(){i.off(this.el,"mouseenter",this.onMouseEnter,this)}}t.DroppableBinding=o,t.droppable=i.defineBinding("droppable",o);const l=new class{constructor(){this.dragging=null,this.mover=null,this.canEnterDrops=new Set,this.activeDrop=null}startDragging(e){let t;this.dragging=e;for(let e of this.canEnterDrops)if(document.contains(e.el)){if(e.name===name){t=e;break}}else this.canEnterDrops.delete(e);if(!t)throw new Error("Element with ':draggable' must be contained in a ':droppable' elemenet");t.emitEnter(this.dragging),this.activeDrop=t,this.mover=new c(this.dragging,t)}translateDragging(e,t){this.mover&&this.mover.translateDraggingElement(e,t)}enterDraggable(e){this.canSwapWith(e)&&this.mover&&this.mover.onEnterDraggable(e)}canSwapWith(e){return this.dragging&&this.dragging.name===e.name&&this.dragging!==e}enterDroppable(e){this.canEnterDrops.add(e),this.canDropTo(e)&&(e.emitEnter(this.dragging),this.activeDrop=e,this.mover.onEnterDroppable(e))}canDropTo(e){return this.dragging&&this.dragging.name===e.name}leaveDroppable(e){this.canEnterDrops.delete(e),this.activeDrop===e&&(e.emitLeave(this.dragging),this.activeDrop=null,this.mover.onLeaveDroppable(e))}endDragging(){let e=this.mover,t=this.dragging,r=this.activeDrop;e&&e.playEndDraggingAnimation().then((()=>{e.willSwapElements()&&r.emitDrop(t,e.getSwapIndex())})),this.dragging=null,this.mover=null,this.activeDrop=null}};class c{constructor(e,t){this.direction="y",this.elStyleText="",this.translate=[0,0],this.dragTo=null,this.dragToRect=null,this.dragToIndex=-1,this.movedElements=new Set,this.translatedElements=new Set,this.dropArea=null,this.placeholder=null,this.dragging=e,this.el=e.el,this.startDropArea=this.dropArea=t,this.autoLayout="absolute"!==a.getStyle(this.el,"position");let r=a.getStyleAsNumber(this.el,"marginLeft"),i=a.getStyleAsNumber(this.el,"marginRight"),s=a.getStyleAsNumber(this.el,"marginTop"),n=a.getStyleAsNumber(this.el,"marginBottom");this.width=this.el.offsetWidth+(Math.abs(r)>Math.abs(i)?r:i),this.height=this.el.offsetHeight+(Math.abs(s)>Math.abs(n)?s:n),this.initializeDirection(),this.setStartDraggingStyle(),this.giveSpaceForDraggingElement(t,!1)}initializeDirection(){if(this.el.nextElementSibling||this.el.previousElementSibling){let e=a.getRect(this.el.nextElementSibling||this.el.previousElementSibling),t=a.getRect(this.el);Math.abs(e.left-t.left)>Math.abs(e.top-t.top)?this.direction="x":this.direction="y"}}setStartDraggingStyle(){let e=a.getRect(this.el);document.body.style.cursor="grabbing",document.body.style.userSelect="none",this.elStyleText=this.el.style.cssText,this.el.style.position="fixed",this.el.style.zIndex="9999",this.el.style.width=e.width+"px",this.el.style.height=e.height+"px",this.el.style.left=e.left+"px",this.el.style.top=e.top+"px",this.el.style.boxShadow=`0 0 ${s.theme.popupShadowBlurRadius}px #888`,this.el.style.pointerEvents="none",this.el.style.opacity="1",this.el.style.willChange="transform"}getSiblingsAfter(e){let t=[];for(let r=e.nextElementSibling;r;r=r.nextElementSibling)t.push(r);return t}onEnterDroppable(e){this.giveSpaceForDraggingElement(e,!0),this.dropArea=e}giveSpaceForDraggingElement(e,t){if(this.startDropArea===e)for(let e of this.getSiblingsAfter(this.el))this.moveElement(e,1,t);this.placeholder=document.createElement("div"),this.placeholder.style.visibility="hidden","x"===this.direction?this.placeholder.style.width=this.width+"px":this.placeholder.style.height=this.height+"px",e.el.append(this.placeholder)}moveElement(e,t,r){if(e===this.el)return;let i="x"===this.direction?this.width:this.height,s=t;this.autoLayout||this.el.compareDocumentPosition(e)!==e.DOCUMENT_POSITION_FOLLOWING||(s-=1);let n=0!==s?`translate${this.direction.toUpperCase()}(${s*i}px)`:"";r?a.animateTo(e,{transform:n}):e.style.transform=n,t?this.movedElements.add(e):this.movedElements.delete(e),s?this.translatedElements.add(e):this.translatedElements.delete(e)}onEnterDraggable(e){if(!this.dropArea)return;if(a.isPlayingAnimation(e.el))return;let t=new Set([e.el,...this.getSiblingsAfter(e.el)]);t.delete(this.el),this.movedElements.has(e.el)&&t.delete(e.el);for(let e of this.movedElements)t.has(e)||this.moveElement(e,0,!0);for(let e of t)this.movedElements.has(e)||this.moveElement(e,1,!0);this.dragToIndex=this.generateDraggedToIndex(e,t.has(e.el)),this.dragTo=e,this.dragToRect=a.getRect(e.el)}generateDraggedToIndex(e,t){let r=this.startDropArea===this.dropArea,i=e.index;return r&&i>this.dragging.index?t?i-1:i:t?i:i+1}translateDraggingElement(e,t){this.translate=[e,t],this.el.style.transform=`translate(${e}px, ${t}px)`}willSwapElements(){return!!(this.dragTo||this.dropArea&&this.startDropArea!==this.dropArea)}getSwapIndex(){return this.dragToIndex}onLeaveDroppable(e){if(e===this.dropArea){for(let e of this.movedElements)this.moveElement(e,0,!0);this.dropArea=null,this.dragTo=null,this.dragToRect=null,this.dragToIndex=-1}}async playEndDraggingAnimation(){this.willSwapElements()?(await this.animateDraggingElementToDropArea(),this.el.style.transform=""):(this.dropArea!==this.startDropArea&&this.moveSiblingsToGiveSpace(!0),await a.animateTo(this.el,{transform:""})),this.restoreMovedElements(!1),this.clearDraggingStyle()}async animateDraggingElementToDropArea(){let e=a.getRect(this.el),t=this.dragToRect||a.getRect(this.placeholder),r=t.left-e.left+this.translate[0],i=t.top-e.top+this.translate[1];"x"===this.direction?this.dragging.index<this.dragToIndex&&(r=t.right-e.right+this.translate[0]):this.dragging.index<this.dragToIndex&&(i=t.bottom-e.bottom+this.translate[1]);let s=`translate(${r}px, ${i}px)`;await a.animateTo(this.el,{transform:s})}moveSiblingsToGiveSpace(e){for(let t of this.getSiblingsAfter(this.el))this.moveElement(t,1,e)}restoreMovedElements(e){for(let t of this.translatedElements)e?a.animateTo(t,{transform:""}):(a.stopAnimation(t),t.style.transform="");this.movedElements=new Set,this.translatedElements=new Set,this.placeholder&&(this.placeholder.remove(),this.placeholder=null)}clearDraggingStyle(){document.body.style.cursor="",document.body.style.userSelect="",this.el.style.cssText=this.elStyleText}}},4492:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TileEffect=void 0;const i=r(8341),a=r(6339),s=r(909);class n extends i.Effect{async initialize(){this.toDraw=new a.ToDrawEffect({renderer:this.renderer})}setTransformStatus(e){let{width:t,height:r}=this.renderer.project.data,{transformMatrix:i,samplingMatrix:a}=(0,s.getTileMatrixes)(this.data,this.time,t,r);e.mergeTransformMatrix(i),e.mergeSamplingMatrix(a),super.setTransformStatus(e)}draw(){return this.toDraw.draw(),this.toDraw.getPaintArea()}}t.TileEffect=n},4511:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(9509);Object.defineProperty(t,"NodePart",{enumerable:!0,get:function(){return i.NodePart}});var a=r(5145);Object.defineProperty(t,"Template",{enumerable:!0,get:function(){return a.Template}});var s=r(2855);Object.defineProperty(t,"TemplateResult",{enumerable:!0,get:function(){return s.TemplateResult}}),Object.defineProperty(t,"html",{enumerable:!0,get:function(){return s.html}}),Object.defineProperty(t,"css",{enumerable:!0,get:function(){return s.css}}),Object.defineProperty(t,"svg",{enumerable:!0,get:function(){return s.svg}})},4554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),r(356).defineBinding("html",class{constructor(e){this.el=e}update(e){this.el.innerHTML=null==e?"":String(e)}remove(){this.el.innerHTML=""}})},4557:(e,t)=>{var r,i,a,s,n,o,l,c,d,h,u,p,m,f,g,y,w,v,x,b,S,T,C;Object.defineProperty(t,"__esModule",{value:!0}),t.AETextAnimaterSelecterShape=t.AETextAnimaterSelecterMode=t.AETextAnimaterSelecterBasedOn=t.AETextAnimaterSelecterUnit=t.AERampShape=t.AEChannels=t.AEEffectBlendingMode=t.AEFractalNoiseOverflow=t.AENoiseType=t.AEFractalType=t.AEDisplacementMapBehavior=t.AEUseForHorizontalDisplacement=t.AEEffectAntialiasing=t.AEEffectGaussianBlurDimension=t.AEMaskMode=t.AEShapeTrimMultipleShapes=t.AEShapeFillRule=t.AEShapeStrokeLineJoin=t.AEShapeStrokeLineCap=t.AECameraIrisShape=t.AETextParagraphJustification=t.AETextAnchorPoint=t.AESamplingQuality=void 0,function(e){e[e.Nearest=1]="Nearest",e[e.BiLinear=2]="BiLinear",e[e.BiCubic=3]="BiCubic"}(r||(t.AESamplingQuality=r={})),function(e){e[e.Character=1]="Character",e[e.Word=2]="Word",e[e.Line=3]="Line",e[e.All=4]="All"}(i||(t.AETextAnchorPoint=i={})),function(e){e[e.LeftJustify=0]="LeftJustify",e[e.CenterJustify=1]="CenterJustify",e[e.RightJustify=2]="RightJustify",e[e.FullJustifyLastLineLeft=3]="FullJustifyLastLineLeft",e[e.FullJustifyLastLineRight=4]="FullJustifyLastLineRight",e[e.FullJustifyLastLineCenter=5]="FullJustifyLastLineCenter",e[e.FullJustifyLastLineFull=6]="FullJustifyLastLineFull",e[e.MultipleJustifications=7]="MultipleJustifications"}(a||(t.AETextParagraphJustification=a={})),function(e){e[e.FastRectangle=0]="FastRectangle",e[e.Triangle=1]="Triangle",e[e.Square=2]="Square",e[e.Pentagon=3]="Pentagon",e[e.Hexagon=4]="Hexagon",e[e.Heptagon=5]="Heptagon",e[e.Octagon=6]="Octagon",e[e.Nonagon=7]="Nonagon",e[e.Decagon=8]="Decagon"}(s||(t.AECameraIrisShape=s={})),function(e){e[e.Butt=1]="Butt",e[e.Round=2]="Round",e[e.Projecting=3]="Projecting"}(n||(t.AEShapeStrokeLineCap=n={})),function(e){e[e.Miter=1]="Miter",e[e.Round=2]="Round",e[e.Bevel=3]="Bevel"}(o||(t.AEShapeStrokeLineJoin=o={})),function(e){e[e.NonZero=1]="NonZero",e[e.EvenOdd=2]="EvenOdd"}(l||(t.AEShapeFillRule=l={})),function(e){e[e.Simultaneously=1]="Simultaneously",e[e.Individually=2]="Individually"}(c||(t.AEShapeTrimMultipleShapes=c={})),function(e){e[e.None=1]="None",e[e.Add=2]="Add",e[e.Subtract=3]="Subtract",e[e.Intersect=4]="Intersect",e[e.Lighten=5]="Lighten",e[e.Darken=6]="Darken",e[e.Difference=7]="Difference"}(d||(t.AEMaskMode=d={})),function(e){e[e.Both=1]="Both",e[e.Herizontal=2]="Herizontal",e[e.Vertical=3]="Vertical"}(h||(t.AEEffectGaussianBlurDimension=h={})),function(e){e[e.Low=1]="Low",e[e.High=2]="High"}(u||(t.AEEffectAntialiasing=u={})),function(e){e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Blue=3]="Blue",e[e.Alpha=4]="Alpha",e[e.Luminance=5]="Luminance",e[e.Hue=6]="Hue",e[e.Lightness=7]="Lightness",e[e.Saturation=8]="Saturation",e[e.Full=9]="Full",e[e.Half=10]="Half",e[e.Off=11]="Off"}(p||(t.AEUseForHorizontalDisplacement=p={})),function(e){e[e.CenterMap=1]="CenterMap",e[e.StretchMapToFit=2]="StretchMapToFit",e[e.TileMap=3]="TileMap"}(m||(t.AEDisplacementMapBehavior=m={})),function(e){e[e.Basic=1]="Basic",e[e.TurbelentSmooth=2]="TurbelentSmooth",e[e.TurbelentBasic=3]="TurbelentBasic",e[e.TurbelentSharp=4]="TurbelentSharp",e[e.Dynamic=5]="Dynamic",e[e.DynamicProgressive=6]="DynamicProgressive",e[e.DynamicTwist=7]="DynamicTwist",e[e.Max=8]="Max",e[e.Smeary=9]="Smeary",e[e.Swirly=10]="Swirly",e[e.Rocky=11]="Rocky",e[e.Cloudy=12]="Cloudy",e[e.Terrain=13]="Terrain",e[e.Subscale=14]="Subscale",e[e.SmallBumps=15]="SmallBumps",e[e.Strings=16]="Strings",e[e.Threads=17]="Threads"}(f||(t.AEFractalType=f={})),function(e){e[e.Block=1]="Block",e[e.Linear=2]="Linear",e[e.SoftLinear=3]="SoftLinear",e[e.Spline=4]="Spline"}(g||(t.AENoiseType=g={})),function(e){e[e.Clip=1]="Clip",e[e.SoftClamp=2]="SoftClamp",e[e.WrapBack=3]="WrapBack",e[e.AllowHDRResults=4]="AllowHDRResults"}(y||(t.AEFractalNoiseOverflow=y={})),function(e){e[e.None=1]="None",e[e.Normal=2]="Normal",e[e.Add=3]="Add",e[e.Multiply=4]="Multiply",e[e.Screen=5]="Screen",e[e.Overlay=6]="Overlay",e[e.SoftLight=7]="SoftLight",e[e.HardLight=8]="HardLight",e[e.ColorDodge=9]="ColorDodge",e[e.ColorBurn=10]="ColorBurn",e[e.Draken=11]="Draken",e[e.Lighten=12]="Lighten",e[e.Difference=13]="Difference",e[e.Exclusion=14]="Exclusion",e[e.Hue=15]="Hue",e[e.Saturation=16]="Saturation",e[e.Luminosity=17]="Luminosity"}(w||(t.AEEffectBlendingMode=w={})),function(e){e[e.RGB=1]="RGB",e[e.Red=2]="Red",e[e.Blue=3]="Blue",e[e.Green=4]="Green",e[e.Alpha=5]="Alpha"}(v||(t.AEChannels=v={})),function(e){e[e.LinearRamp=1]="LinearRamp",e[e.RadialRamp=2]="RadialRamp"}(x||(t.AERampShape=x={})),function(e){e[e.Percentage=1]="Percentage",e[e.Index=2]="Index"}(b||(t.AETextAnimaterSelecterUnit=b={})),function(e){e[e.Characters=1]="Characters",e[e.CharactersExcludingSpaces=2]="CharactersExcludingSpaces",e[e.Words=3]="Words",e[e.Lines=4]="Lines"}(S||(t.AETextAnimaterSelecterBasedOn=S={})),function(e){e[e.Add=1]="Add",e[e.Subtract=2]="Subtract",e[e.Intersect=3]="Intersect",e[e.Min=4]="Min",e[e.Max=5]="Max",e[e.Difference=6]="Difference"}(T||(t.AETextAnimaterSelecterMode=T={})),function(e){e[e.Square=1]="Square",e[e.RampUp=2]="RampUp",e[e.RampDown=3]="RampDown",e[e.Triangle=4]="Triangle",e[e.Round=5]="Round",e[e.Smooth=6]="Smooth"}(C||(t.AETextAnimaterSelecterShape=C={}))},4588:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilesFromTransfer=t.selectMultipleFolder=t.selectFolder=t.selectMultipleFile=t.selectFile=t.downloadText=t.downloadURL=void 0;const i=r(757);function a(e,t,r){return new Promise((a=>{let s=document.createElement("input");s.type="file",s.hidden=!0,s.accept=e,s.multiple=r,t&&(s.setAttribute("directory",""),s.setAttribute("webkitdirectory","")),s.onchange=()=>{s.files?a(r?[...s.files]:s.files[0]||null):a(null)},document.addEventListener("focus",(async function e(){await i.sleep(1e3),document.removeEventListener("focus",e,!1),s.onchange=null,s.remove()}),!1),document.body.appendChild(s),s.click()}))}async function s(e){let t=[];return new Promise((async(r,i)=>{if(e){if(e.isFile)e.file((i=>{i.path=i.path||e.fullPath,t.push(i),r(t)}),i);else if(e.isDirectory){let a=e.createReader();try{for(;;){let e=await n(a);if(t.push(...e),!e.length)break}}catch(e){i(e)}r(t)}}else r()}))}function n(e){return new Promise(((t,r)=>{let i=[];e.readEntries((async e=>{if(e&&e.length){try{for(let t of e)i.push(...await s(t))}catch(e){r(e)}t(i)}else t(i)}),r)}))}t.downloadURL=function(e,t){let r=document.createElement("a");r.hidden=!0,r.href=e,t&&(r.download=t),document.body.appendChild(r),r.click(),r.remove()},t.downloadText=function(e,t,r="text/plain"){let i=new Blob([t],{type:r}),a=new FileReader;a.onload=()=>{a.onload=null;let t=document.createElement("a");t.download=e,t.href=a.result,document.body.append(t),t.click(),t.remove()},a.readAsDataURL(i)},t.selectFile=function(e){return a(e,!1,!1)},t.selectMultipleFile=function(e){return a(e,!1,!0)},t.selectFolder=function(){return a("*",!0,!1)},t.selectMultipleFolder=function(){return a("*",!0,!0)},t.getFilesFromTransfer=async function(e){let t=[...e.files],r=[];if(e.items&&"function"==typeof DataTransferItem&&(DataTransferItem.prototype.hasOwnProperty("getAsEntry")||DataTransferItem.prototype.webkitGetAsEntry)){let i=[...e.items].filter((e=>"file"===e.kind));try{for(let e of i){let t=e.hasOwnProperty("getAsEntry")?e.getAsEntry():e.webkitGetAsEntry();r.push(...await s(t))}}catch(e){r=t}}else r=t;return r}},4633:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isWindowsSystem=t.isMacSystem=void 0,t.isMacSystem=function(){return/Macintosh|Mac OS X/.test(navigator.userAgent)},t.isWindowsSystem=function(){return/Windows NT|Win32|Win64/.test(navigator.userAgent)}},4644:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EasyLevelsEffect=void 0;const i=r(8341),a=r(6376),s=r(5305),n=r(6339),o=r(1047);class l extends i.Effect{async initialize(){this.toDraw=new n.ToDrawEffect({renderer:this.renderer,fragCode:o.default})}update(){super.update();let e=(0,a.getPropertyValues)(this.data,this.time,s.EffectEasyLevelsDefaultValues);this.toDraw.setUniform("channel",e.channel),this.toDraw.setUniform("inputBlack",e.inputBlack),this.toDraw.setUniform("inputWhite",e.inputWhite),this.toDraw.setUniform("gamma",e.gamma),this.toDraw.setUniform("outputBlack",e.outputBlack),this.toDraw.setUniform("outputWhite",e.outputWhite)}}t.EasyLevelsEffect=l},4684:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SharedResource=void 0;const r=new Map,i=new Map,a=new Map,s=new Map;t.SharedResource=class{id;constructor(e){if(!e)throw new Error("Please privide a valid id!");this.id=e}async unique(e,t,i){if(r.has(this.id)&&r.get(this.id).has(e)){let t=r.get(this.id).get(e);return t.usedBy.add(this),await t.promise}{let a=r.get(this.id);a||(a=new Map,r.set(this.id,a));let s=t(),n=new Set;return a.set(e,{promise:s,deleteFn:i,usedBy:n}),await s}}async deleteUnique(e){let t=r.get(this.id);if(t){let r=t.get(e);if(r&&(r.usedBy.delete(this),0===r.usedBy.size)){let i=await r.promise;if(r.usedBy.size>0)return;r.deleteFn(i),t.delete(e)}}}async syncOnce(e,t){if(i.has(this.id)&&i.get(this.id).has(e)){let t=i.get(this.id).get(e);return await t}{let r=i.get(this.id);r||(r=new Map,i.set(this.id,r));let a=t();r.set(e,a);let s=await a;return r.delete(e),s}}async syncAll(e,t){let r=a.get(this.id);r||(r=new Map,a.set(this.id,r));let i=r.get(e);return i||(i={results:[],pendingCount:0},i.promise=new Promise((e=>{i.resolve=e})),r.set(e,i)),i.pendingCount++,t().then((t=>{i.results.push(t),i.pendingCount--,0===i.pendingCount&&(i.resolve(),r.delete(e))})),await i.promise,i.results}async syncSome(e,t){let r=s.get(this.id);r||(r=new Map,s.set(this.id,r));let i=r.get(e);return i||(i={result:!1,pendingCount:0},i.promise=new Promise((e=>{i.resolve=e})),r.set(e,i)),i.pendingCount++,t().then((t=>{i.result=i.result||t,i.pendingCount--,i.result&&i.resolve(),0===i.pendingCount&&(i.resolve(),r.delete(e))})),await i.promise,i.result}async syncEvery(e,t){return!await this.syncSome(e,(async()=>!await t()))}async delete(){let e=r.get(this.id);if(e){for(let t of[...e.keys()]){let r=e.get(t);if(r.usedBy.delete(this),0===r.usedBy.size){let i=await r.promise;r.deleteFn(i),e.delete(t)}}0===e.size&&r.delete(this.id)}}}},4711:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(2854),a=r(5499),s=r(2501);class n extends s.TextACBase{isIn=!0;effectName="AC IN [KPO] Controls";initialize(){super.initialize();let e=this.animater.properties.hasOwnProperty("rotation");this.ignoreRandomStartVal=!e}calcAmount(e){let t=(this.effect.elasticity||70)/100,r=this.effect.maxBounces||10,i=[.5];for(let e=1;e<r;e++){let r=Math.pow(t,e);if(i.push(r),r<.01)break}let s=(0,a.sum)(i);i=i.map((e=>e/s));let n=0,o=0,l=0;for(let t=0;t<r;t++){let r=i[t];if(n+r>=e){o=t,l=(e-n)/r;break}n+=r}return 0===o&&(l=.5*l+.5),Math.pow(t,2*o)*(1-4*Math.pow(l-.5,2))}rotation(){return this.effect.rotation||121}position(){return this.effect.position||[0,-300,0]}scale(){return this.effect.scale||[0,0,0]}opacity(){return this.effect.opacity||0}}(0,i.registerTextAnimaterPlugin)("AC IN [KPO] Bounce",n),(0,i.registerTextAnimaterPlugin)("AC OUT [KPO] Bounce",class extends n{isIn=!1;effectName="AC OUT [KPO] 2 Controls"})},4718:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AEGLPreview=void 0;const a=r(1416),s=r(1648),n=r(4369);r(2988),r(3874);const o=r(1919),l=r(5499);let c=class extends a.Component{id=0;jsonManager;project;renderer;encoding=!1;editorUI;prepared=!1;currentAspectRatio=l.storage.get("aegl_prefered_aspect_ratio","16x9");render(){return a.html`
		<template class="preview aegl-preview">
			${this.renderCanvas()}
			${this.renderToolbar()}
			${this.renderProgress()}
			${this.renderEditor()}
		</template>
		`}renderCanvas(){return a.html`
			<div class="preview-canvas" :ref="canvasContainer">
				<canvas :ref="canvas" />
			</div>
		`}renderToolbar(){let e=!!this.renderer&&this.renderer.ended,t=!!this.renderer&&this.renderer.paused,r=this.project?Math.round(this.project.footages.getReplaceableAudioLayerData().duration):null,i=(0,o.popup)((()=>a.html`<f-menu>
				<f-list .data=${[{text:a.html`
						<div @click=${()=>this.adjustToAudioDuration()}
							:tooltip="${r} Sec"
						>
							Stretch to Audio Duration
						</div>
					`},{text:a.html`<div @click=${()=>this.resetTotalDuration()}>Reset Duration of All Scenes</div>`}]} />
			</f-menu>
			`)),s=(0,o.popup)((()=>a.html`<f-menu>
			<f-list
				.selectable
				.selected=${[this.currentAspectRatio]}
				@select=${e=>this.adjustAspectRatio(e[0])}
				.data=${Object.keys(this.jsonManager.currentAspectRatios).map((e=>({value:e,text:e})))}
			/>
		</f-menu>
		`));return a.html`
		<div class="preview-additional-toolbar" :enable=${this.prepared}>
			<f-buttongroup>
				<button @click=${this.togglePaused}>${e||t?"Play":"Pause"}</button>

				<button @click=${this.toFullscreen}>
					Fullscreen
				</button>
			</f-buttongroup>

			<f-buttongroup>
				<button @click=${this.useMyPhotos}>
					Replace Photos
				</button>

				<!-- <button>
					扫描二维码传照片
				</button> -->

				<button @click=${this.changeMusic}>
					Replace Audio
				</button>

				<button @click=${this.reset}>
					Reset
				</button>
			</f-buttongroup>

			<button ${i} :enable=${this.editorUI&&this.editorUI.editor.canAdjustSomeSceneDurations()}>
				Adjust Duration
				<f-icon .type="down" />
			</button>

			<button ${s}>
				Adjust Resolution
				<f-icon .type="down" />
			</button>

			<button @click=${this.encodeVideo} style="margin-left: auto">
				Export
			</button>
		</div>
		`}renderProgress(){let e=this.renderer?this.renderer.time:0;return a.html`
		<f-slider class="preview-progress" :ref="slider"
			.min="0"
			.max=${this.project?this.project.data.duration:0}
			.step="0.02"
			.value=${e}
			.decimalCount="2"
			@dragstart=${this.startChangingTime}
			@dragend=${this.endChangingTime}
			@change=${this.changeTime}
		/>
		`}renderEditor(){return this.project?a.html`
			<aegl-scene-editor :ref=${this.refEditor} .project=${this.project} />
		`:null}startChangingTime(){this.renderer.pause()}endChangingTime(){this.renderer.paused||this.renderer.play()}changeTime(e){this.renderer.setTime(e)}async refEditor(e){this.editorUI=await(0,a.getComponentAsync)(e)}async onReady(){await this.loadProject(),await this.adjustCanvasSize(),await(0,a.renderComplete)();let e=o.notification.unique();e.info(`Loading assets of template ${this.id} ...`),await this.editorUI.ready,await this.renderer.play(),this.prepared=!0,e.success(`Loaded assets of template ${this.id}.`,{hideDelay:3e3}),this.on("disconnected",(()=>{e.hide()}))}onConnected(){(0,a.on)(window,"resize",this.onResize,this),(0,a.on)(document,"keydown.space.prevent",this.togglePaused,this)}onDisconnected(){this.project.delete(),(0,a.off)(window,"resize",this.onResize,this),(0,a.off)(document,"keydown",this.togglePaused,this)}async loadProject(){let e=this.refs.canvas;this.jsonManager=new n.JSONManager(this.id),await this.jsonManager.ready,this.jsonManager.currentAspectRatios[this.currentAspectRatio]||(this.currentAspectRatio=Object.keys(this.jsonManager.currentAspectRatios)[0]),this.project=new s.Project(e,this.jsonManager.rootDirectory,this.jsonManager.requestProjectData(this.currentAspectRatio)),this.renderer=this.project.renderer,this.renderer.on("updatetime",(()=>this.update())),this.renderer.on("end",(()=>this.update()));let t=devicePixelRatio,r=(0,l.firstMatch)(location.href,/downsampling=([\d\.]+)/);r&&(t/=Number(r),this.renderer.setPixelRatio(t))}async onResize(){this.project&&!this.encoding&&await this.adjustCanvasSize()}async adjustCanvasSize(){let e=this.refs.canvasContainer.offsetWidth,t=1/0;t=document.fullscreen?this.refs.canvasContainer.offsetHeight:640;let[r,i]=this.getCanvasSizeInContainMode(e,t);await this.renderer.setCanvasSize(r,i)}getCanvasSizeInContainMode(e,t){let r=this.project.data.width,i=e,a=this.project.data.height/r*i;return a>t&&(i*=t/a,a=t),i=2*Math.round(i/2),a=2*Math.round(a/2),[i,a]}togglePaused(){this.prepared&&(this.renderer.ended?this.renderer.playFrom(0):this.renderer.paused?this.renderer.play():this.renderer.pause())}async toFullscreen(){this.refs.canvasContainer.requestFullscreen(),await this.adjustCanvasSize()}async useMyPhotos(){await this.editorUI.useMyPhotos()}async changeMusic(){await this.editorUI.changeMusic()}async adjustToAudioDuration(){await this.editorUI.adjustToAudioDuration()}resetTotalDuration(){this.editorUI.resetTotalDuration()}async adjustAspectRatio(e){if(e===this.currentAspectRatio)return;this.currentAspectRatio=e;let t=this.jsonManager.requestProjectData(e);this.project.data.setData(t),await this.editorUI.reloadSceneData(),await this.adjustCanvasSize(),l.storage.set("aegl_prefered_aspect_ratio",e)}async reset(){let e=this.jsonManager.requestProjectData(this.currentAspectRatio);this.project.data.setData(e),await this.editorUI.reset()}async encodeVideo(){(0,a.off)(document,"keydown.space.prevent",this.togglePaused,this),this.renderer.pause();let e=(0,a.renderComponent)(a.html`<aegl-encoding-config .project=${this.project}/>`).component;e.show(),e.on("beginexport",(()=>{this.project.clearResoures(),this.encoding=!0})),e.on("disconnected",(()=>{(0,a.on)(document,"keydown.space.prevent",this.togglePaused,this),this.encoding=!1,this.onResize()}))}};t.AEGLPreview=c,t.AEGLPreview=c=i([(0,a.define)("aegl-preview")],c)},4762:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"smoothRange",desc:"Smooth Range",min:0,max:1,step:.01,value:.1}];(0,r(4062).extendTransitions)({"mask-evaporate-painted-lines":{uniformSlides:i,mask:"evaporate-painted-lines",steps:[{fragShaderName:"mask-fade"}]},"mask-evaporate-ripple":{uniformSlides:i,mask:"evaporate-ripple",steps:[{fragShaderName:"mask-fade"}]}})},4811:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextureFrameResultBuffers=void 0;const i=r(2824);t.TextureFrameResultBuffers=class{width=0;height=0;samplerParams;sampler;sw;context;framebuffer=null;constructor(e,t,r,i){this.sw=e,this.context=e.context,this.width=t,this.height=r,this.samplerParams=i,this.framebuffer=this.context.createFramebuffer(),this.initializeSampler()}initializeSampler(){let e=new i.TextureFrameSampler(this.sw,{width:this.width,height:this.height},this.samplerParams);this.context.bindFramebuffer(this.context.FRAMEBUFFER,this.framebuffer),this.context.framebufferTexture2D(this.context.FRAMEBUFFER,this.context.COLOR_ATTACHMENT0,this.context.TEXTURE_2D,e.texture,0),this.sampler=e,this.context.bindFramebuffer(this.context.FRAMEBUFFER,null)}inUse(){return this.sampler.inUse()}setAsWriteBuffer(){this.context.bindFramebuffer(this.context.DRAW_FRAMEBUFFER,this.framebuffer)}endWrite(){this.sampler.updateMipmapIfNeed()}delete(){this.sampler.delete()}}},4850:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedTemplate=void 0;const i=r(4511),a=r(7860);t.WatchedTemplate=class{constructor(e,t,r,i){this.context=e,this.templateFn=t,this.item=r,this.index=i,this.parseAndWatchTemplate()}parseAndWatchTemplate(){let{templateFn:e}=this,t=new a.InnerWatcher((()=>e(this.item,this.index)),(e=>{if(this.template.canMergeWith(e))this.template.merge(e);else{let t=new i.Template(e,this.context);this.template.range.startNode.before(t.range.getFragment()),this.template.remove(),this.template=t}}));this.watcher=t,this.template=new i.Template(t.value,this.context),this.context?this.context.__addWatcher(t):a.globalWatcherGroup.add(t)}updateIndex(e){e!==this.index&&(this.index=e,this.watcher.__updateImmediately())}update(e,t){e===this.item&&t===this.index||(this.item=e,this.index=t,this.watcher.__updateImmediately())}remove(){this.template.remove(),this.watcher.disconnect()}}},4869:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCorrectionForChannelPreview=t.ColorCorrectionPreview=void 0;const a=r(1416),s=r(5499),n=r(1326),o=r(3568),l=r(1919),c=r(3416),d=r(3481),h=r(2824),u=r(1118);let p=class extends a.Component{name="";imageStorageKey="colorCorrectionPreviewImage";activeImage="";uniformSlides=[{name:"iPercent",desc:"Percent",min:-100,max:100,step:1,value:0}];sw;uniformValues;imageNaturalSize=[0,0];toDraw;imageDirectory="color-correction";images=["allef-vinicius-pa0vicn6dwe-unsplash.jpg","allef-vinicius-ttusgz8ulkk-unsplash.jpg","allef-vinicius-_ugpeypqiuc-unsplash.jpg","anastasia-dulgier-kokszzy9wsa-unsplash.jpg","anita-austvika-c-cdpe9shi4-unsplash.jpg","anthony-tran-mehojxixkdq-unsplash.jpg","benjamin-wong-4-ka5rdcesi-unsplash.jpg","deanna-alys-6lbbowkpzyq-unsplash.jpg","erol-ahmed-aiyfr0vbadk-unsplash.jpg","evie-s-vz3iqy0loaa-unsplash.jpg","floriane-vita-fyd3owbuxny-unsplash.jpg","icons8-team-7lnatqymzm4-unsplash.jpg","jacob-postuma-pxztwi015zi-unsplash.jpg","jake-peterson-vj4pn_psblo-unsplash.jpg","jessica-weiller-so4efi-d1nc-unsplash.jpg","joao-tzanno-g9_euqxpu4k-unsplash.jpg","newborn-1328454.jpg","quan-nguyen-sghnxezeo-q-unsplash.jpg","rachit-tank-2cfz_fb08um-unsplash.jpg","roksolana-zasiadko-3eaevlo2upi-unsplash.jpg","scott-webb--udznjsczse-unsplash.jpg","the-honest-company-aiade3prv90-unsplash.jpg","wyron-a-gy38n9wkjqi-unsplash.jpg","len_full.jpg"];render(){return a.html`
		<template class="preview">
			${this.renderToolbar()}
			${this.renderImages()}
		</template>
		`}renderToolbar(){return a.html`
		<table class="preview-toolbar">
		<tbody>
			${this.uniformSlides.map((({name:e,desc:t,min:r,max:i,step:s,value:n},o)=>{let l=this.uniformValues[o];return a.html`
				<tr>
					<td>${t}: <span class="preview-slide-value">${l}</span></td>
					<td>
						<f-slider class="preview-slider" .min=${r} .max=${i} .step=${s} .value=${l}
							@change=${t=>this.changeSliderValue(e,o,t)}
						/>
						<button class="preview-slider-button" @click=${()=>this.changeSliderValue(e,o,n)}>Reset</button>
					</td>
				</tr>
				`}))}
		</tbody>
		</table>
		`}renderImages(){return a.html`
			<div class="preview-nav">
			${this.images.map((e=>a.html`
				<div class="preview-nav-item"
					:class.active=${e===this.activeImage}
					@click=${()=>this.onClickImageNav(e)}
				>
					<img src=${(0,u.isAbsolutePath)(e)?e:`pictures/${this.imageDirectory}/${e}`}>
				</div>
			`))}
			</div>

			<div class="preview-canvas">
				<canvas :ref="canvas" />
			</div>
		`}onCreated(){c.ColorCorrectionUniforms[this.name]&&(this.uniformSlides=c.ColorCorrectionUniforms[this.name]),this.uniformValues=this.uniformSlides.map((e=>e.value)),this.activeImage=s.storage.get(this.imageStorageKey,"")}async onReady(){this.initGL();for(let e=0;e<this.uniformSlides.length;e++){let{name:t,value:r}=this.uniformSlides[e];this.sw.setUniform(t,r)}await this.createToDraw(),await this.setImage(s.storage.get(this.imageStorageKey,this.images[0]))}onConnected(){(0,a.on)(window,"resize",this.onResize,this),this.once("disconnected",(()=>{(0,a.off)(window,"resize",this.onResize,this)}))}onResize(){this.imageNaturalSize[0]>0&&(this.adjustSize(),this.drawAll())}drawAll(){this.sw.clear(),this.sw.drawAll()}adjustSize(){let[e,t]=this.imageNaturalSize,r=this.el.offsetWidth,i=Math.round(t/e*r);r>e&&(r=e,i=t),this.sw.setCanvasSize(r,i),this.sw.setUniform("iResolution",[r,i])}onClickImageNav(e){(0,u.isAbsolutePath)(e)||s.storage.set(this.imageStorageKey,e),this.setImage(e)}changeSliderValue(e,t,r){this.sw.setUniform(e,r),this.uniformValues[t]=r,this.drawAll()}async setImage(e){this.activeImage=e;let t=`pictures/${this.imageDirectory}/${e}`,r=await(0,n.preloadImage)(t);this.imageNaturalSize=[r.naturalWidth,r.naturalHeight],this.adjustSize(),this.toDraw.useSampler("iChannel",new h.PixelSampler(this.sw,r)),this.drawAll()}initGL(){let e=this.refs.canvas;this.sw=new o.SimpleWebGL(e),this.onGLReady()}async createToDraw(){let e=this.getVertexCode(),t=await this.loadCurrentFragmentCode();this.toDraw=new d.ToDraw(this.sw,{vertCode:e,fragCode:t,vertices:{data:this.getDefaultVerticesData(),count:4}})}getVertexCode(){return"#version 300 es\n\t\tprecision mediump float;\n\t\tin vec4 vPosition;\n\t\tout vec2 fTextureCoord;\n\t\tvoid main() {\n\t\t\tgl_Position = vPosition;\n\t\t\tfTextureCoord = vPosition.xy / 2.0 + 0.5;\n\t\t}\n\t\t"}getDefaultVerticesData(){return{vPosition:[-1,1,-1,-1,1,1,1,-1]}}async getDefaultFragCode(){return"#version 300 es\n\t\t#ifdef GL_ES\n\t\tprecision mediump float;\n\t\t#endif\n\t\tin vec2 fTextureCoord;\n\t\tout vec4 fragColor;\n\t\tuniform sampler2D iChannel[1];\n\t\tvec4 getFragColor() {\n\t\t\treturn texture(iChannel[0], fTextureCoord);\n\t\t}\n\t\tvoid main() {\n\t\t\tfragColor = getFragColor(); \n\t\t}\n\t"}async loadCurrentFragmentCode(){return(await fetch(`shaders/color-corrections/out/${this.name}.frag`)).text()}onGLReady(){}};t.ColorCorrectionPreview=p,t.ColorCorrectionPreview=p=i([(0,a.define)("color-correction-preview")],p);let m=class extends p{colors=["rgb(222, 56, 60)","rgb(222, 221, 60)","rgb(128, 217, 38)","rgb(60, 204, 225)","rgb(103, 103, 230)","rgb(221, 60, 221)"];activeColor="rgb(222, 56, 60)";render(){return a.html`
		<template class="preview">
			${this.renderColors()}
			${this.renderToolbar()}
			${this.renderImages()}
		</template>
		`}renderColors(){return a.html`
		<div class="preview-channels">
			${this.colors.map(((e,t)=>a.html`
				<div :style.background=${e}
					:class.active=${e===this.activeColor}
					@click=${()=>this.activeChannelInIndex(t)}
				 />
			`))}
		</div>
		`}onGLReady(){this.sw.setUniform("colorToAdjust",new l.Color(this.activeColor).getRGB())}activeChannelInIndex(e){this.activeColor=this.colors[e],this.sw.setUniform("colorToAdjust",new l.Color(this.activeColor).getRGB()),this.drawAll()}};t.ColorCorrectionForChannelPreview=m,t.ColorCorrectionForChannelPreview=m=i([(0,a.define)("color-correction-preview-for-channel")],m)},4875:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec4 fProjectedCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float effectOpacity;\nvec4 getFragColor() {\nvec2 fTextureCoord = fProjectedCoord.xy / iVideoResolution;\nfTextureCoord.y = 1.0 - fTextureCoord.y;\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord);\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},4910:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nvec4 getFragColor() {\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},4915:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Emitter=void 0,t.Emitter=class{constructor(){this.__events=new Map}__ensureEvents(e){let t=this.__events.get(e);return t||this.__events.set(e,t=[]),t}on(e,t,r){this.__ensureEvents(e).push({listener:t,scope:r,once:!1})}once(e,t,r){this.__ensureEvents(e).push({listener:t,scope:r,once:!0})}off(e,t,r){let i=this.__events.get(e);if(i)for(let e=i.length-1;e>=0;e--){let a=i[e];a.listener!==t||r&&a.scope!==r||i.splice(e,1)}}hasListener(e,t,r){let i=this.__events.get(e);if(!t)return!!i&&i.length>0;if(i&&t)for(let e=0,a=i.length;e<a;e++){let a=i[e];if(a.listener===t&&(!r||a.scope===r))return!0}return!1}emit(e,...t){let r=this.__events.get(e);if(r)for(let e=0;e<r.length;e++){let i=r[e];!0===i.once&&r.splice(e--,1),i.listener.apply(i.scope,t)}}removeAllListeners(){this.__events=new Map}}},4924:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FractalNoiseEffect=void 0;const i=r(8341),a=r(6339),s=r(2703),n=r(6376),o=r(5305),l=r(5365);class c extends i.Effect{async initialize(){this.toDraw=new a.ToDrawEffect({renderer:this.renderer,fragCode:s.default})}update(){super.update();let e=(0,n.getPropertyValues)(this.data,this.time,o.EffectFractalNoiseDefaultValues);this.toDraw.setUniform("contrast",e.contrast/100),this.toDraw.setUniform("brightness",e.brightness/100),this.toDraw.setUniform("complexity",e.complexity),this.toDraw.setUniform("subInfluence",e.subInfluence/100);let t=Object.assign({},o.TransformDefaultValues,{rotation:e.rotation,scale:e.scale,scaleWidth:e.scaleWidth,scaleHeight:e.scaleHeight,anchorPoint:[this.renderer.project.data.width/2,this.renderer.project.data.height/2,0],position:[...e.offsetTurbulence,0]}),r=Object.assign({},o.TransformDefaultValues,{rotation:e.subRotation,scaleWidth:e.subScaling,scaleHeight:e.subScaling,anchorPoint:e.centerSubscale?[this.renderer.project.data.width/2,this.renderer.project.data.height/2,0]:[0,0,0],position:[...e.subOffset,0]}),i=(0,l.getTransformFromValues)(t).inverse(),a=(0,l.getTransformFromValues)(r).inverse();this.toDraw.setUniform("noiseTransform",i.toFloat32Array()),this.toDraw.setUniform("subNoiseTransform",a.toFloat32Array())}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.FractalNoiseEffect=c},4975:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalSceneInfo=void 0;const i=r(1118);t.LocalSceneInfo=class{name="";mediaType=null;mediaPath="";mediaWidth=0;mediaHeight=0;mediaPosition=[.5,.5];mediaFrameRate;mediaDuration;duration=0;text=null;fontFamily=null;fontStyle=null;fontSize=null;fillColor=null;croppedPath="";croppedWidth=0;croppedHeight=0;thumbnailPath="";replaced=!1;touched=!1;constructor(e){e&&Object.assign(this,e)}getUserSceneInfo(){let e={name:this.name,mediaType:this.mediaType,mediaPath:this.mediaPath,mediaWidth:this.mediaWidth,mediaHeight:this.mediaHeight,mediaPosition:this.mediaPosition,duration:this.duration,text:this.text,fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontSize:this.fontSize,fillColor:this.fillColor};return"video"===this.mediaType&&(e.mediaFrameRate=this.mediaFrameRate,e.mediaDuration=this.mediaDuration),e}updateMediaPath(e){this.deleteMedia(),this.mediaPath=e}updateCroppedPath(e){(0,i.isBlobURL)(this.croppedPath)&&this.croppedPath!==this.mediaPath&&URL.revokeObjectURL(this.croppedPath),this.croppedPath=e}updateThumbnailPath(e){(0,i.isBlobURL)(this.thumbnailPath)&&URL.revokeObjectURL(this.thumbnailPath),this.thumbnailPath=e}toTouch(){this.touched=!0}delete(){this.deleteMedia()}deleteMedia(){(0,i.isBlobURL)(this.mediaPath)&&URL.revokeObjectURL(this.mediaPath),this.mediaPath="",(0,i.isBlobURL)(this.croppedPath)&&URL.revokeObjectURL(this.croppedPath),this.croppedPath="",(0,i.isBlobURL)(this.thumbnailPath)&&URL.revokeObjectURL(this.thumbnailPath),this.thumbnailPath=""}}},4983:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckboxGroup=t.Checkbox=void 0;const a=r(1416),s=r(8240),n=r(5499);let o=class extends a.Component{constructor(){super(...arguments),this.checked=!1,this.indeterminate=!1,this.value=null,this.checkboxGroup=null}static style(){let{mainColor:e,focusBlurRadius:t,adjust:r}=s.theme;return a.css`
		:host{
			display: inline-flex;
			vertical-align: top;
			align-items: center;
			cursor: pointer;

			&:hover{
				color: ${e};
			}

			&:focus{
				color: ${e};

				.icon{
					box-shadow: 0 0 ${t}px ${e};
				}
			}
		}

		.icon{
			margin-right: ${r(6)}px;
			border-radius: 4px;
		}

		.indeterminate, .checked{
			color: ${e};
		}

		.label{
			flex: 1;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		`}render(){let e=this.checked?"checkbox-checked":this.indeterminate?"checkbox-indeterminate":"checkbox-unchecked";return a.html`
			<template
				tabindex="0"
				:class.checked=${this.checked}
				:class.indeterminate=${this.indeterminate}
				@@click=${this.onClick}
				@@focus=${this.onFocus}
				@@blur=${this.onBlur}
			>
				<f-icon class="icon" .type=${e} />
				<div class="label">
					<slot />
				</div>
			</template>
		`}onCreated(){let e=a.getClosestComponent(this.el,l);e&&(this.checkboxGroup=e,this.checked=this.checkboxGroup.value===this.value,this.checkboxGroup.register(this))}onClick(){this.checked=!this.checked,this.indeterminate=!1,this.emit("change",this.checked)}onFocus(){a.on(document,"keydown.enter",this.onEnter,this)}onEnter(e){e.preventDefault(),this.onClick()}onBlur(){a.off(document,"keydown",this.onEnter,this)}};o=i([a.define("f-checkbox")],o),t.Checkbox=o;let l=class extends a.Component{constructor(){super(...arguments),this.value=[],this.ordered=!1,this.checkboxs=[]}register(e){this.checkboxs.push(e),e.on("change",this.onCheckboxChange.bind(this,e))}onCheckboxChange(e){if(e.checked?this.value.push(e.value):n.removeWhere(this.value,(t=>t==e.value)),this.ordered){let e=this.checkboxs.map((e=>e.value));n.orderBy(this.value,(t=>e.findIndex((e=>e==t))))}this.emit("change",this.value)}};l=i([a.define("f-checkboxgroup")],l),t.CheckboxGroup=l},5007:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"blurRadius",desc:"Blur Radius",min:0,max:.5,step:.01,value:.01}];(0,r(4062).extendTransitions)({heart:{polarSamplingData:[.678,.6842,.6905,.6968,.7031,.7095,.7159,.7224,.7288,.7351,.7415,.7477,.7539,.76,.766,.7719,.7776,.7831,.7885,.7937,.7987,.8034,.8078,.8119,.8158,.8193,.8226,.8256,.8283,.8307,.8328,.8346,.8361,.8373,.8383,.8389,.8393,.8393,.8391,.8386,.8378,.8368,.8354,.8338,.8319,.8297,.8272,.8244,.8214,.818,.8144,.8105,.8063,.8018,.797,.7919,.7865,.7809,.7749,.7687,.7622,.7554,.7484,.7411,.7335,.7256,.7175,.7091,.7004,.6915,.6822,.6727,.6629,.6527,.6423,.6316,.6206,.6093,.5977,.5858,.5735,.561,.5481,.535,.5215,.5077,.4939,.481,.4689,.4575,.4468,.4575,.4689,.481,.4939,.5077,.5216,.5351,.5483,.5612,.5738,.586,.5979,.6096,.6209,.6319,.6426,.653,.6631,.6729,.6824,.6916,.7005,.7092,.7176,.7257,.7335,.7411,.7484,.7554,.7622,.7687,.7749,.7809,.7865,.7919,.797,.8018,.8063,.8105,.8144,.818,.8214,.8244,.8272,.8297,.8319,.8338,.8354,.8368,.8378,.8386,.8391,.8393,.8393,.8389,.8383,.8373,.8361,.8346,.8328,.8307,.8283,.8256,.8226,.8193,.8158,.8119,.8078,.8034,.7987,.7937,.7885,.7831,.7776,.7719,.766,.76,.7539,.7477,.7415,.7351,.7288,.7224,.7159,.7095,.7031,.6968,.6905,.6842,.678,.6719,.6659,.6599,.6541,.6484,.6428,.6373,.6319,.6267,.6216,.6166,.6118,.6071,.6025,.5981,.5938,.5896,.5856,.5818,.578,.5745,.571,.5677,.5645,.5615,.5586,.5558,.5532,.5507,.5483,.5461,.544,.542,.5402,.5385,.5369,.5354,.5341,.5328,.5318,.5308,.5299,.5292,.5286,.5281,.5278,.5276,.5275,.5275,.5277,.5279,.5283,.5289,.5295,.5303,.5312,.5323,.5335,.5348,.5363,.5379,.5396,.5415,.5435,.5457,.548,.5505,.5531,.556,.5589,.5621,.5654,.5688,.5725,.5764,.5804,.5846,.5891,.5937,.5986,.6037,.609,.6146,.6204,.6264,.6327,.6393,.6462,.6534,.6608,.6534,.6462,.6394,.6328,.6265,.6205,.6147,.6091,.6038,.5987,.5939,.5892,.5848,.5805,.5765,.5726,.569,.5655,.5622,.559,.5561,.5533,.5506,.5481,.5458,.5436,.5416,.5397,.5379,.5363,.5349,.5336,.5324,.5313,.5304,.5296,.5289,.5284,.528,.5277,.5275,.5275,.5276,.5278,.5282,.5286,.5292,.53,.5308,.5318,.5329,.5341,.5354,.5369,.5385,.5402,.542,.544,.5461,.5483,.5507,.5532,.5558,.5586,.5615,.5645,.5677,.571,.5745,.578,.5818,.5856,.5896,.5938,.5981,.6025,.6071,.6118,.6166,.6216,.6267,.6319,.6373,.6428,.6484,.6541,.6599,.6659,.6719],uniformSlides:i,steps:[{fragShaderName:"mask-of-polar-sampling"}]},star:{polarSamplingData:[.6907,.6971,.7029,.7082,.7128,.7169,.7205,.7235,.726,.728,.7295,.7306,.7311,.7312,.7308,.7299,.7286,.7268,.7245,.7217,.7183,.7145,.7102,.7052,.6998,.6937,.6869,.6796,.6715,.6627,.6531,.6427,.6313,.6191,.6071,.5958,.585,.5748,.5651,.5559,.5471,.5395,.5329,.5273,.5226,.5185,.5151,.5124,.5102,.5085,.5074,.5068,.5066,.507,.5079,.5092,.5111,.5136,.5167,.5203,.5247,.5299,.5359,.5427,.5499,.5575,.5654,.5738,.5826,.5918,.6016,.6115,.6207,.6293,.6373,.6447,.6515,.6578,.6635,.6687,.6734,.6775,.6812,.6845,.6873,.6896,.6915,.693,.6941,.6947,.6949,.6947,.6941,.6931,.6916,.6897,.6874,.6847,.6814,.6778,.6736,.6689,.6638,.6581,.6518,.645,.6376,.6296,.6209,.6117,.6017,.592,.5827,.5739,.5656,.5576,.5501,.5428,.536,.5299,.5247,.5203,.5165,.5135,.511,.5091,.5077,.5068,.5065,.5066,.5072,.5084,.51,.5123,.515,.5184,.5225,.5273,.5329,.5395,.5472,.5559,.5651,.5748,.585,.5958,.6072,.6192,.6313,.6426,.6529,.6625,.6713,.6793,.6867,.6934,.6994,.7049,.7098,.7142,.718,.7213,.7242,.7265,.7283,.7297,.7306,.731,.731,.7305,.7295,.728,.726,.7235,.7205,.717,.713,.7083,.7031,.6973,.6909,.6838,.6761,.6677,.6586,.6489,.6394,.6304,.6218,.6137,.6059,.5985,.5915,.585,.5794,.5748,.571,.5679,.5655,.5637,.5626,.562,.5621,.5627,.564,.5658,.5684,.5716,.5755,.5803,.586,.5928,.6008,.6102,.6203,.631,.6422,.654,.6665,.6796,.6925,.7043,.715,.7247,.7336,.7415,.7487,.7552,.7609,.7659,.7703,.7741,.7772,.7798,.7818,.7832,.784,.7843,.784,.7832,.7817,.7798,.7772,.774,.7702,.7657,.7606,.7548,.7482,.7409,.7328,.7239,.7141,.7034,.6918,.6805,.6698,.6596,.6499,.6407,.6319,.6239,.617,.6113,.6065,.6026,.5995,.5972,.5955,.5945,.5942,.5945,.5955,.5972,.5995,.6026,.6066,.6113,.6171,.6239,.632,.6408,.65,.6597,.6699,.6806,.6919,.7035,.7142,.724,.7329,.741,.7482,.7548,.7606,.7657,.7701,.7739,.7771,.7797,.7817,.7831,.7839,.7842,.7839,.7831,.7817,.7797,.7771,.774,.7702,.7658,.7608,.755,.7486,.7414,.7334,.7246,.7148,.7041,.6923,.6795,.6663,.6538,.642,.6308,.6202,.6101,.6007,.5928,.5861,.5804,.5756,.5717,.5685,.5659,.564,.5628,.5621,.5621,.5626,.5637,.5655,.5678,.5709,.5747,.5793,.5849,.5913,.5984,.6058,.6136,.6217,.6303,.6393,.6488,.6585,.6676,.6759,.6836],uniformSlides:i,steps:[{fragShaderName:"mask-of-polar-sampling"}]}})},5042:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RectArea=void 0;const i=r(4452);class a{static union(e){if(0===e.length)return null;let t=e[0].clone();for(let r=1;r<e.length;r++)t.unionWith(e[r]);return t}static cross(e){if(0===e.length)return null;let t=e[0].clone();for(let r=1;r<e.length;r++)t.crossWith(e[r]);return t.isAvailable()?t:null}static fromCoords(e){if(0===e.length)return null;let t=1/0,r=-1/0,i=1/0,s=-1/0;for(let a=0;a<e.length;a++){let{x:n,y:o}=e[a];t=Math.min(t,n),r=Math.max(r,n),i=Math.min(i,o),s=Math.max(s,o)}return new a(t,i,r,s)}x1;y1;x2;y2;constructor(e,t,r,i){this.x1=e,this.y1=t,this.x2=r,this.y2=i}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}isAvailable(){return this.x1<this.x2&&this.y1<this.y2}clone(){let{x1:e,y1:t,x2:r,y2:i}=this;return new a(e,t,r,i)}scaleSelf(e,t=e){return this.x1*=e,this.y1*=t,this.x2*=e,this.y2*=t,this}scale(e,t=e){return this.clone().scaleSelf(e,t)}extendSelf(e,t=e){return this.x1-=e,this.y1-=t,this.x2+=e,this.y2+=t,this}extend(e,t=e){return this.clone().extendSelf(e,t)}multiplyBy(e){let t=this.getCoords().map((t=>e.transfer2(t)));return a.fromCoords(t)}translateSelf(e,t){return this.x1+=e,this.y1+=t,this.x2+=e,this.y2+=t,this}translate(e,t){return this.clone().translateSelf(e,t)}roundSelf(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}round(){return this.clone().roundSelf()}unionWith(e){return this.x1=Math.min(this.x1,e.x1),this.y1=Math.min(this.y1,e.y1),this.x2=Math.max(this.x2,e.x2),this.y2=Math.max(this.y2,e.y2),this}crossWith(e){return this.x1=Math.max(this.x1,e.x1),this.y1=Math.max(this.y1,e.y1),this.x2=Math.max(Math.min(this.x2,e.x2),this.x1),this.y2=Math.max(Math.min(this.y2,e.y2),this.y1),this}getCoords(){let{x1:e,y1:t,x2:r,y2:a}=this;return[new i.Vector2(e,t),new i.Vector2(e,a),new i.Vector2(r,t),new i.Vector2(r,a)]}getNumCoords(){let{x1:e,y1:t,x2:r,y2:i}=this;return[[e,t],[e,i],[r,t],[r,i]]}}t.RectArea=a},5043:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),(0,r(4062).extendTransitions)({"stripe-merge":{uniformSlides:[{name:"stripeHeight",desc:"Stripe Height",min:1,max:10,step:1,value:2},{name:"maxStripeLoopHeight",desc:"Stripe Loop Height",min:10,max:200,step:1,value:60},{name:"fixedYPosition",desc:"Fixed Y Position",min:0,max:1,step:.1,value:0}],steps:[{fragShaderName:"stripe-merge"}]}})},5048:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ensureDocumentComplete=t.ensureWindowLoaded=void 0,t.ensureWindowLoaded=function(){return new Promise((e=>{let t=window.performance.getEntriesByType("navigation");t.length>0&&t[0].loadEventEnd>0?e():window.addEventListener("load",(()=>e()))}))},t.ensureDocumentComplete=function(){return new Promise((e=>{let t=window.performance.getEntriesByType("navigation");t.length>0&&t[0].domContentLoadedEventEnd>0?e():document.addEventListener("DOMContentLoaded",(()=>e()),!1)}))}},5050:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayerStyleDrawOriginal=void 0;const i=r(6376),a=r(5305),s=r(8936),n=r(6339);class o extends s.LayerStyle{async initialize(){this.toDraw=new n.ToDrawEffect({renderer:this.renderer})}update(){let e=(0,i.getPropertyValues)(this.data,this.time,a.LayerStyleBlendingOptionDefaultValues);this.toDraw.setUniform("iOpacity",e.fillOpacity/100)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.LayerStyleDrawOriginal=o},5055:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Options=void 0,t.Options=class{constructor(e){this.options=null,this.updated=!1,this.default=e}update(e){this.options=e||null,this.updated=!0}get(e){if(this.options){let t=this.options[e];return void 0===t?this.default[e]:t}return this.default[e]}}},5097:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLayer=void 0;const i=r(7818),a=r(2440),s=r(2659);class n extends i.PixelLayer{async initialize(){await super.initialize(),this.toDraw=new a.ToDrawTransform({renderer:this.renderer,fragCode:s.default}),this.toDraw.setUniform("solidColor",[...this.data.color,1])}}t.SolidLayer=n},5129:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextureFrameManager=void 0;const i=r(23),a=r(2824),s=r(5042),n=r(5884),o=r(4811),l=r(1484);t.TextureFrameManager=class{sw;resultCacher;buffersCacher;emptySampler=null;constructor(e,t=10,r=50){this.sw=e,this.resultCacher=new d(e,t,r),this.buffersCacher=new h(e,t,r),this.sw.on("resize",this.clearIdle,this)}requestFull(e=!1,t=1,r={}){let i=new s.RectArea(0,0,this.sw.width,this.sw.height);return this.request(i,this.sw.width,this.sw.height,e,t,r)}requestPartial(e,t=!1,r=1,i={}){e=e.round();let{x1:a,y1:n,x2:o,y2:l}=e;a=Math.max(a,0),n=Math.max(n,0),o=Math.min(o,this.sw.width),l=Math.min(l,this.sw.height);let c=o-a,d=l-n,h=240*devicePixelRatio,u=180*devicePixelRatio;return(c<this.sw.width||d<this.sw.height)&&(c=Math.ceil(c/h)*h,d=Math.ceil(d/u)*u),c=Math.max(c,h),d=Math.max(d,u),c=Math.min(c,this.sw.width),d=Math.min(d,this.sw.height),e=new s.RectArea(a,n,a+c,n+d),this.request(e,this.sw.width,this.sw.height,t,r,i)}request(e,t,r,a,s,n){e=e.round();let{x1:o,y1:l,width:c,height:d}=e,h=new i.TextureFrame(this.sw,c,d);return h.setPartialOrigin(o,l),h.setResultBuffersRequester((()=>this.resultCacher.request(c,d,n))),h.setDrawToBuffersRequester((()=>{let e=this.buffersCacher.request(c*s,d*s,a);return e.setPartialRect(o,l,t,r,s),e})),h}clearIdle(){this.resultCacher.clearIdle(),this.buffersCacher.clearIdle()}clearAll(){this.resultCacher.clearAll(),this.buffersCacher.clearAll()}getEmptySampler(){return this.emptySampler||(this.emptySampler=new a.TextureFrameSampler(this.sw,{width:1,height:1})),this.emptySampler}getEmptyMappedSampler(){return new l.MappedSampler(this.getEmptySampler())}};class c{using=new Set;idle=new Set;maxIdleSeconds;warnWhenCountExceeded;constructor(e,t){this.maxIdleSeconds=e,this.warnWhenCountExceeded=t}request(...e){let t=this.query(...e);if(t){let{timeoutId:r,resource:i}=t;return clearTimeout(r),this.idle.delete(t),this.using.add(i),this.update(i,...e),i}{let t=this.create(...e);this.using.add(t);let r=this.using.size+this.idle.size;return r>=this.warnWhenCountExceeded&&r%10==0&&console.warn(`${r} ${this.constructor.name.replace("Cacher","")} instances exist at the same time, did you forget to release them?`),t}}release(e){if(!this.using.has(e))return;let t=setTimeout((()=>{this.delete(e)&&this.idle.delete(r)}),1e3*this.maxIdleSeconds),r={resource:e,timeoutId:t};this.idle.add(r),this.using.delete(e)}clearAll(){this.clearIdle();for(let e of this.using)this.delete(e);this.using=new Set}clearIdle(){for(let{resource:e,timeoutId:t}of this.idle)clearTimeout(t),this.delete(e);this.idle=new Set}}class d extends c{sw;constructor(e,t,r){super(t,r),this.sw=e}query(e,t){return[...this.idle].find((({resource:r})=>r.width===e&&r.height===t&&!r.inUse()))}create(e,t,r){let i=new o.TextureFrameResultBuffers(this.sw,e,t,r);return i.sampler.on("noreference",(()=>{this.release(i)})),i}update(e,t,r,i){e.sampler.updateParameters(i)}delete(e){return!e.inUse()&&(e.delete(),!0)}}class h extends c{sw;constructor(e,t,r){super(t,r),this.sw=e}query(e,t,r){return[...this.idle].find((({resource:i})=>i.width===e&&i.height===t&&i.antialias===r))}create(e,t,r){let i=new n.TextureFrameDrawToBuffers(this.sw,e,t,r);return i.on("deactive",(()=>{this.release(i)})),i}update(){}delete(e){return e.delete(),!0}}},5145:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Template=void 0;const i=r(9838),a=r(937),s=r(9509),n=r(7872),o=r(9649),l=r(2972),c=r(246),d=r(8334),h=r(9856);function u(e,t){if(!e)return t[0];let r=e[0];for(let i=0;i<e.length-1;i++){let a=t[i];r+=null==a?"":String(a),r+=e[i+1]}return r}t.Template=class{constructor(e,t){this.canUpdateParts=[],this.result=e,this.context=t;let{fragment:r,nodesInPlaces:s,places:n,hasSlots:o}=a.parse(this.result.type,this.result.strings,this.context?this.context.el:null);this.range=new i.NodeRange(r),this.parseParts(s,n),o&&this.context&&this.context.__foundSlotsWhenRendering()}parseParts(e,t){let r=this.result.values;if(e&&t)for(let h=0;h<e.length;h++){let p,m=e[h],f=t[h],g=f.strings,y=f.valueIndexes,w=u(g,y?y.map((e=>r[e])):null);switch(f.type){case a.PartType.Node:p=new s.NodePart(new i.NodeAnchor(m,i.NodeAnchorType.Next),w,this.context);break;case a.PartType.MayAttr:p=new n.MayAttrPart(m,f.name,w);break;case a.PartType.Event:p=new o.EventPart(m,f.name,w,this.context);break;case a.PartType.Attr:p=new l.AttrPart(m,f.name,w);break;case a.PartType.Property:p=new d.PropertyPart(m,f.name,w,!y);break;case a.PartType.FixedBinging:p=new c.FixedBindingPart(m,f.name,w,this.context);break;case a.PartType.Binding:p=new c.BindingPart(m,w,this.context)}p&&y&&this.canUpdateParts.push({part:p,strings:g,valueIndexes:y})}}canMergeWith(e){if(this.result.type!==e.type)return!1;if(this.result.strings.length!==e.strings.length)return!1;for(let t=0;t<this.result.strings.length;t++)if(this.result.strings[t]!==e.strings[t])return!1;return!0}merge(e){for(let{part:t,strings:r,valueIndexes:i}of this.canUpdateParts)if(i.some((t=>this.result.values[t]!==e.values[t]))){let a=u(r,i.map((t=>e.values[t])));t.update(a)}this.result=e}remove(){this.range.remove();for(let{part:e}of this.canUpdateParts)e.remove()}preRender(){let e=this.range.fragment;if(!e)return;let t,r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null);for(;t=r.nextNode();)if(t instanceof HTMLElement&&t.localName.includes("-")){let e=h.getComponentConstructor(t.localName);e&&!h.getComponent(t)&&h.createComponent(t,e).__updateImmediately(!0)}}}},5242:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.BezierFunction=t.FunctionCurve=void 0;const a=r(1416),s=r(6456),n=r(5499);let o=class extends a.Component{fn=e=>e;compiled;xRange=[0,1];width=100;render(){let[e,t]=this.xRange,r=Math.floor(this.width/(t-e)),i=Math.max(1/r,.001),o=[];for(let r=e;r<=t;r+=i){r=(0,n.toDecimal)(r,4);let e=(0,n.toDecimal)(this.compiled(r),4);o.push([r,e])}let l=o.map((e=>e[1])),c=Math.min(...l),d=Math.max(...l);c>0?c=0:d<0&&(d=0),o=(0,s.simpleSamplingCoords)(o,.001);let h=function(e){e=e.map((e=>[(0,n.toDecimal)(e[0],3),(0,n.toDecimal)(e[1],3)]));let t="";for(let r=0;r<e.length;r++){let i=e[r];t+=0===r?"M"+i[0]+" "+i[1]:" L"+i[0]+" "+i[1]}return t}(o),u=this.createAxisLines(e,t,c,d),p=this.width,m=Math.ceil((d-c)*r),f=`matrix(${r}, 0, 0, -${r}, 0, ${Math.round((d+c)*r)})`,g=Math.round(e*r)-4.5,y=Math.round(c*r)-4.5,w=6*i,v=6*i;return a.html`
		<template class="function-curve">
			<svg viewBox="${g} ${y} ${p+9} ${m+9}" width="${p+9}" height="${m+9}">
				<g style="transform: ${f}">
					${u.map((([e,t])=>a.svg`
						<line x1="${e[0]}" y1="${e[1]}" x2="${t[0]}" y2="${t[1]}"
							stroke-width=${i}
							style="stroke: #888; stroke-opacity: 0.5; stroke-dasharray: 0.05; stroke-dashoffset: 0.025"
						/>
					`))}

					<line x1="${e}" y1="0" x2="${t}" y2="0" style="stroke: #888; stroke-width: ${i}; stroke-linecap: square;"/>
					<line x1="0" y1="${c}" x2="0" y2="${d}" style="stroke: #888; stroke-width: ${i}; stroke-linecap: square;" />

					<path d="M${t+w/2} 0 l-${w} ${v/2} l0 -${v}Z" style="fill: #888;" />
					<path d="M0 ${d+w/2} l-${w/2} ${-v} l${w} 0Z" style="fill: #888;" />

					<path d=${h} style="stroke: currentColor; fill: none; stroke-width: ${2*i};" />
				</g>
			</svg>
		</template>
		`}onCreated(){this.watchImmediately((()=>this.fn),(e=>{this.compiled="string"==typeof e?new Function("x",e.replace(/^\s*y\s*=\s*/,"return ")):e}))}createAxisLines(e,t,r,i){let a=[];for(let s=Math.ceil(e);s<=t;s++)0!==s&&a.push([[s,r],[s,i]]);for(let s=Math.ceil(r);s<=i;s++)0!==s&&a.push([[e,s],[t,s]]);return a}};t.FunctionCurve=o,t.FunctionCurve=o=i([(0,a.define)("function-curve")],o);let l=class extends o{name="linear";onCreated(){this.compiled=(0,n.getEasingFunction)(this.name)}};t.BezierFunction=l,t.BezierFunction=l=i([(0,a.define)("bezier-function")],l)},5305:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaskDefaultValues=t.LayerStyleDropShadowDefaultValues=t.LayerStyleBlendingOptionDefaultValues=t.ShapeDefaultValues=t.ShapePathVertexDefaultValues=t.ShapeGroupDefaultValues=t.ShapeEllipseDefaultValues=t.ShapeRectDefaultValues=t.ShapeStrokeDefaultValues=t.ShapeFillDefaultValues=t.ShapeTrimDefaultValues=t.TextAnimatorPropertiesDefaultValues=t.TextAnimaterSelecterDefaultValues=t.TextLayerDefaultValues=t.AllEffectsDefaultValues=t.EffectRampDefaultValues=t.EffectEasyLevelsDefaultValues=t.EffectColorGradient4DefaultValues=t.EffectFractalNoiseDefaultValues=t.EffectRoughenEdgesDefaultValues=t.EffectDisplacementMapDefaultValues=t.EffectTintDefaultValues=t.EffectGammaDefaultValues=t.EffectMaskDefaultValues=t.EffectFillDefaultValues=t.EffectAnimateCharacterDefaultValues=t.EffectTileDefaultValues=t.EffectTransformDefaultValues=t.EffectBulgeDefaultValues=t.EffectBoxBlurDefaultValues=t.EffectFastBlurDefaultValues=t.EffectGaussianBlurDefaultValues=t.EffectDropShadowDefaultValues=t.EffectDefaultValues=t.CameraTransformDefaultValues=t.CameraDefaultValues=t.TransformDefaultValues=void 0,t.TransformDefaultValues={anchorPoint:[0,0,0],skew:0,skewAxis:0,orientation:[0,0,0],opacity:100},t.CameraDefaultValues={zoom:0,depthOfField:0,focusDistance:0,aperture:0,blurLevel:100,irisShape:1,irisRotation:0,irisRoundness:0,irisAspectRatio:1,irisDiffractionFringe:0,highlightGain:0,highlightThreshold:1,highlightSaturation:0},t.CameraTransformDefaultValues={pointOfInterest:[0,0,0],position:[0,0,0],orientation:[0,0,0]},t.EffectDefaultValues={effectOpacity:100},t.EffectDropShadowDefaultValues={shadowColor:[0,0,0,0],opacity:100,direction:0,distance:0,softness:0,shadowOnly:0},t.EffectGaussianBlurDefaultValues={blurriness:0,blurDimensions:1,repeatEdgePixels:0},t.EffectFastBlurDefaultValues=t.EffectGaussianBlurDefaultValues,t.EffectBoxBlurDefaultValues=t.EffectGaussianBlurDefaultValues,t.EffectBulgeDefaultValues={horizontalRadius:0,verticalRadius:0,bulgeCenter:[0,0],bulgeHeight:0,taperRadius:0,antialiasing:2,pinning:0},t.EffectTransformDefaultValues={anchorPoint:[0,0],position:[0,0],skew:0,skewAxis:0,rotation:0,xRotation:0,yRotation:0,zRotation:0,opacity:100,shutterAngle:0},t.EffectTileDefaultValues={tileCenter:[0,0],tileWidth:100,tileHeight:100,outputWidth:100,outputHeight:100,mirrorEdges:1,phase:0,horizontalPhaseShift:0},t.EffectAnimateCharacterDefaultValues={position:[0,0],rotation:0,scale:[100,100],opacity:100,delay:0,elasticity:0,maxBounces:0,reversedOrder:0,randomizedOrder:0,randomStartValueMin:0,randomStartValueMax:0,randomSeed:0},t.EffectFillDefaultValues={color:[0,0,0,0],opacity:100},t.EffectMaskDefaultValues={trackMatteType:"ALPHA"},t.EffectGammaDefaultValues={redGamma:1,redPedestal:0,redGain:1,greenGamma:1,greenPedestal:0,greenGain:1,blueGamma:1,bluePedestal:0,blueGain:1},t.EffectTintDefaultValues={mapBlackTo:[0,0,0,1],mapWhiteTo:[1,1,1,1],amountToTint:100},t.EffectDisplacementMapDefaultValues={useForHorizontalDisplacement:5,maxHorizontalDisplacement:0,useForVerticalDisplacement:5,maxVerticalDisplacement:0,displacementMapBehavior:1,edgeBehavior:1,expandOutput:1},t.EffectRoughenEdgesDefaultValues={edgeColor:[.6,.2,0,1],border:0,edgeSharpness:0,fractalInfluence:1,scale:100,stretchWidthOrHeight:0,offset:[0,0],complexity:0,evolution:0,cycleEvolution:0,cycle:0,randomSeed:0},t.EffectFractalNoiseDefaultValues={invert:0,contrast:100,brightness:0,overflow:4,rotation:0,offsetTurbulence:[0,0],perspectiveOffset:0,complexity:0,subInfluence:0,subScaling:0,subRotation:0,subOffset:[0,0],centerSubscale:0,evolution:0,cycleEvolution:0,cycle:1,randomSeed:0,opacity:100,blendingMode:1},t.EffectColorGradient4DefaultValues={color1:[0,0,0,0],color2:[0,0,0,0],color3:[0,0,0,0],color4:[0,0,0,0],point1:[0,0],point2:[0,0],point3:[0,0],point4:[0,0],blend:0,jitter:0,opacity:100,blendingMode:1},t.EffectEasyLevelsDefaultValues={channel:1,inputBlack:0,inputWhite:1,gamma:1,outputBlack:0,outputWhite:1},t.EffectRampDefaultValues={startOfRamp:[0,0],startColor:[0,0,0,0],endOfRamp:[0,0],endColor:[0,0,0,0],rampShape:0,rampScatter:0,blendWithOriginal:0},t.AllEffectsDefaultValues={dropShadow:t.EffectDropShadowDefaultValues,bulge:t.EffectBulgeDefaultValues,transform:t.EffectTransformDefaultValues,tile:t.EffectTileDefaultValues,fill:t.EffectFillDefaultValues,gamma:t.EffectGammaDefaultValues,tint:t.EffectTintDefaultValues,displacementMap:t.EffectDisplacementMapDefaultValues,roughenEdges:t.EffectRoughenEdgesDefaultValues,fractalNoise:t.EffectFractalNoiseDefaultValues,colorGradient4:t.EffectColorGradient4DefaultValues,eastLevels:t.EffectEasyLevelsDefaultValues,ramp:t.EffectRampDefaultValues,gaussianBlur:t.EffectGaussianBlurDefaultValues,fastBlur:t.EffectFastBlurDefaultValues},t.TextLayerDefaultValues={anchorPointGrouping:1,groupingAlignment:[0,0],tracking:0,justification:1,fauxBold:!1,fauxItalic:!1},t.TextAnimaterSelecterDefaultValues={start:0,end:100,offset:0,units:1,basedOn:1,mode:1,amount:100,shape:0,smoothness:0,easeHigh:0,easeLow:0,randomizeOrder:0,randomSeed:0},t.TextAnimatorPropertiesDefaultValues={anchorPoint:[0,0,0],position:[0,0,0],scale:[100,100,100],skew:0,skewAxis:0,rotation:0,xRotation:0,yRotation:0,zRotation:0,opacity:100,trackingAmount:0,blur:[0,0]},t.ShapeTrimDefaultValues={start:0,end:100,offset:0,trimMultipleShapes:1},t.ShapeFillDefaultValues={fillRule:1,color:[0,0,0,0],opacity:100},t.ShapeStrokeDefaultValues={color:[0,0,0,0],opacity:100,strokeWidth:0,lineCap:1,lineJoin:1,miterLimit:4,dashes:[],dashOffset:0},t.ShapeRectDefaultValues={shapeDirection:1,size:[0,0],position:[0,0],roundness:0},t.ShapeEllipseDefaultValues={shapeDirection:1,size:[0,0],position:[0,0]},t.ShapeGroupDefaultValues={shapeDirection:1},t.ShapePathVertexDefaultValues={closed:!1,featherInterps:[],featherRadii:[],featherRelCornerAngles:[],featherRelSegLocs:[],featherSegLocs:[],featherTensions:[],featherTypes:[]},t.ShapeDefaultValues={rect:t.ShapeRectDefaultValues,ellipse:t.ShapeEllipseDefaultValues,group:t.ShapeGroupDefaultValues},t.LayerStyleBlendingOptionDefaultValues={fillOpacity:100},t.LayerStyleDropShadowDefaultValues={color:[0,0,0,0],opacity:100,angle:0,distance:0,spread:0,size:0},t.MaskDefaultValues={maskMode:1,inverted:!1,maskPath:[],maskFeather:[0,0],maskOpacity:100,maskExpansion:0}},5323:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateNodeListTransformStat=t.generateTransformStat=t.TransformStat=void 0;const i=r(2111),a=r(6376),s=r(2824),n=r(7905);class o{rotated;hasAnimations;constructor(e=!1,t=!1){this.rotated=e,this.hasAnimations=t}mergeTransformSelf(e){(e.rotation||e.skew)&&(this.rotated=!0);for(let[t,r]of Object.entries(e))if((0,a.isPropertyValueBeKeyFrames)(r)&&"opacity"!==t&&"shutterAngle"!==t){this.hasAnimations=!0;break}}mergeCameraSelf(){this.rotated=!0,this.hasAnimations=!0}clone(){return new o(this.rotated,this.hasAnimations)}getSuggestedSamplingParameters(){return{filter:s.SamplerFilter.MipmapLinear}}getSuggestedAntialiasType(){return this.rotated||this.hasAnimations}}function l(e,t){for(let r=0;r<e.length;r++){let a=e[r];if(!(0,i.isTransformableRenderNodeType)(a.type))continue;let s=c(a.effects,t);if(a.type===i.RenderNodeType.Effect&&"motionBlur"===a.data.type&&!s.hasAnimations){let t=a.inputs;t.forEach((e=>e.effects.push(...a.effects))),e.splice(r--,1,...t),a.inputs=null}if(a.transformStat=s,a.inputs){let e=s.clone();a.type===i.RenderNodeType.Effect&&(0,n.isFullscreenEffect)(a.data.type)&&(e=new o),l(a.inputs,e)}}}function c(e,t){let r=t.clone();for(let{effect:t}of e)switch(t.type){case"transform":r.mergeTransformSelf(t);break;case"camera":r.mergeCameraSelf()}return r}t.TransformStat=o,t.generateTransformStat=function(e){l(e,new o)},t.generateNodeListTransformStat=l},5365:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTransformEffectFromLayerData=t.getTransformFromValues=t.getTransformValues=void 0;const i=r(6376),a=r(5305),s=r(2298);t.getTransformValues=function(e,t){return(0,i.getPropertyValues)(e,t,a.TransformDefaultValues)},t.getTransformFromValues=function(e){const t=Math.PI/180;let{anchorPoint:r,position:i,xPosition:a,yPosition:n,zPosition:o,scale:l,rotation:c,xRotation:d,yRotation:h,zRotation:u,skewAxis:p,skew:m,orientation:f}=e,{scaleWidth:g,scaleHeight:y}=e,w=new s.Matrix4;return r&&w.translateSelf(...r.map((e=>-e))),f&&w.rotate3DSelf(...f.map((e=>e*t))),l&&w.scaleSelf(...l.map((e=>e/100))),(g||y)&&w.scaleSelf((g||100)/100,(y||100)/100),(c||u||h||d)&&w.rotate3DSelf((d||0)*t,(h||0)*t,(c||u||0)*t),m&&p&&(w.rotateSelf(p*t),w.skewSelf(0,m*t),w.rotateSelf(-p*t)),i&&w.translateSelf(...i),(a||n||o)&&w.translateSelf(a,n,o),w},t.createTransformEffectFromLayerData=function(e){let t=Object.assign({id:e.id,type:"transform",name:"Layer Transform"},e.transform);return!("text"===e.type&&e.animaters)&&e.motionBlur&&(t.shutterAngle=180),t}},5375:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observeComTarget=void 0;const i=r(8546),a=r(8622);t.observeComTarget=function(e){let t=new Proxy(e,s);return a.proxyMap.set(e,t),a.proxyMap.set(t,t),a.targetMap.set(t,e),t};const s={get(e,t){let r=e[t];if(i.mayAddComDependency(e,t),r&&"object"==typeof r){if(a.proxyMap.has(r))return a.proxyMap.get(r);if(i.isUpdating())return a.observeTarget(r)}return r},set:(e,t,r)=>(e[t]=r,i.notifyComPropertySet(e,t),!0),has:(e,t)=>(i.mayAddComDependency(e,t),t in e),deleteProperty:(e,t)=>!e.hasOwnProperty(t)||(i.mayAddComDependency(e,t),delete e[t])}},5413:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nuniform float iOpacity;\nuniform bool inverted;\nuniform int maskMode;\nuniform bool isFirst;\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 source = texture(iChannel[0], textureCoord0);\nvec4 dest = texture(iChannel[1], textureCoord1);\nvec4 color;\nif (inverted) {\nsource = 1.0 - source;\n}\nif (maskMode == 3 && isFirst) {\nsource = vec4(1, 1, 1, 1);\n}\nswitch (maskMode) {\ncase 1:\ncolor = source;\nbreak;\ncase 2:\ncolor = source + dest;\nbreak;\ncase 3:\ncolor = source - dest;\nbreak;\ncase 4:\ncolor = max(source, dest);\nbreak;\ncase 5:\ncolor = min(source, dest);\nbreak;\ncase 6:\ncolor = abs(source - dest);\nbreak;\n}\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},5417:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.FixVideoBlackSurrounding=void 0;const a=r(1416),s=r(5499),n=r(1919),o=r(7173),l=r(4088),c=r(3568),d=r(3481),h=r(2824),u=r(1954),p=r(1118),m=r(3119),f=r(3730),g=r(1326);let y=class extends a.Component{processing=!1;drawProgress=0;encodingProgress=0;videoFiles=null;toDraws;video;mask;time=0;render(){return a.html`
		<canvas :show=${this.videoFiles} :ref="canvas" />

		<div :show=${this.videoFiles}>
			<f-slider style="width: 300px;" .min=${0} .max=${this.video?this.video.duration:0} .step=${.04}
				.value=${this.time} @change=${e=>this.drawFrameAtTime(e)}
			/>
		</div>

		<div style="margin-top: 10px"><button @click=${this.selectVideos}>选择视频和蒙版视频</button></div>

		<div style="margin-top: 10px" :show=${this.videoFiles}><button @click=${this.process}>开始处理</button></div>
		<div style="font-size: 20px; margin-top: 30px" :show=${this.processing}>绘制进度: ${(0,s.toDecimal)(100*this.drawProgress,0)}%</div>
		<div style="font-size: 20px; margin-top: 10px" :show=${this.processing}>编码进度: ${(0,s.toDecimal)(100*this.encodingProgress,0)}%</div>
		`}onReady(){this.showTestVideo()}async showTestVideo(){let e=await(0,p.getFilefromURL)("videos/1008-loop-720p-1.mp4"),t=await(0,p.getFilefromURL)("videos/1008-loop-720p-1-mask.mp4");this.videoFiles=[e,t],await this.preparePrviewVideo(),await this.drawFrameAtTime(.8)}async selectVideos(){let e=await(0,s.selectMultipleFile)("video/mp4");if(!e)return;if(2!==e.length)return void n.notification.error('请选择两个文件, 其中之一为原视频, 另一个为名称中包含 "mask" 的蒙版视频.');let t=e.find((e=>e.name.includes("mask")));if(!t)return void n.notification.error('请选择两个文件, 其中之一为原视频, 另一个为名称中包含 "mask" 的蒙版视频.');let r=e.find((e=>e!==t));this.videoFiles=[r,t],await this.preparePrviewVideo(),await this.drawFrameAtTime(0)}async preparePrviewVideo(){let[e,t]=this.videoFiles,r=URL.createObjectURL(e),i=URL.createObjectURL(t);this.video=await(0,g.preloadVideo)(r),this.mask=await(0,g.preloadVideo)(i);let a=this.refs.canvas,s=this.video.videoWidth,n=this.video.videoHeight;s>960&&(n=Math.round(960/s*n),s=960),this.toDraws=this.createToDraws(a,s,n);let[o]=this.toDraws,l=new h.PixelSampler(o.sw,this.video,{filter:h.SamplerFilter.Linear}),c=new h.PixelSampler(o.sw,this.mask,{filter:h.SamplerFilter.Linear});o.useSampler("iChannel",l,c)}async drawFrameAtTime(e){this.time=e;let[t,r]=this.toDraws,i=t.sw;this.video.currentTime=e,this.mask.currentTime=e,await(0,u.waitForVideoDecoded)(this.video),await(0,u.waitForVideoDecoded)(this.mask);let a=i.textureFrameManager.requestFull();t.getSubSampler("iChannel",0).updateData(this.video),t.getSubSampler("iChannel",1).updateData(this.mask),a.active(),t.draw(),a.deactive(),i.clear(),r.useSampler("iChannel",a.getSampler()),r.draw(),r.unuseSampler("iChannel")}async process(){let[e,t]=this.videoFiles;this.processing=!0,this.drawProgress=0,this.encodingProgress=0;let r=URL.createObjectURL(e),i=URL.createObjectURL(t),a=new l.VideoFramesExtractor(r,"png",!1),s=new l.VideoFramesExtractor(i,"png",!1);await a.ready,await s.ready;let n=a.totalFrameCount,c=a.mediaInfo.video.frameRate,d=document.createElement("canvas"),m=a.mediaInfo.video.width,f=a.mediaInfo.video.height,[g,y]=this.createToDraws(d,m,f),w=g.sw,v=[],x=[],b=new h.PixelSampler(w,(await a.getFrameAtIndex(0)).image),S=new h.PixelSampler(w,(await s.getFrameAtIndex(0)).image);g.useSampler("iChannel",b,S);for(let e=0;e<n;e++){let t=(await a.getFrameAtIndex(e)).image,r=(await s.getFrameAtIndex(e)).image,i=g.sw.textureFrameManager.requestFull();e>0&&(b.updateData(t),S.updateData(r)),i.active(),g.draw(),i.deactive(),w.clear(),y.useSampler("iChannel",i.getSampler()),y.draw(),y.unuseSampler("iChannel"),w.waitDrawingCompleted();let o=await(0,u.readCanvasAsImage)(w.canvas,"png",1),l=await(0,p.readBlobAsArrayBuffer)(o);v.push(l);let c=(await s.getBlobsAtIndex(e))[0];x.push(await(0,p.readBlobAsArrayBuffer)(c)),this.drawProgress=(e+1)/n}let T=v.map(((e,t)=>({name:String(t).padStart(5,"0")+".png",data:e}))),C=["-hide_banner","-framerate",c,"-i","%05d.png","-an","-c:v","libx264","-pix_fmt","yuv420p","-crf",18,"-vf","scale=out_color_matrix=bt709","-color_primaries","bt709","-color_trc","bt709","-colorspace","bt709",e.name],k=await o.ffmpeg.execWithProgress(T,C,(e=>{this.encodingProgress=e/n/2}));o.ffmpeg.downloadFile(k[0]),await this.processMask(x,t,c),this.processing=!1}async processMask(e,t,r){let i=e.map(((e,t)=>({name:String(t).padStart(5,"0")+".png",data:e}))),a=["-hide_banner","-framerate",r,"-i","%05d.png","-an","-c:v","libx264","-crf",18,"-pix_fmt","yuv420p","-vf","scale=out_color_matrix=bt709","-color_primaries","bt709","-color_trc","bt709","-colorspace","bt709",t.name],s=await o.ffmpeg.execWithProgress(i,a,(t=>{this.encodingProgress=.5+t/e.length/2}));o.ffmpeg.downloadFile(s[0])}createToDraws(e,t,r){let i=new c.SimpleWebGL(e,{alpha:!0}),a=this.getVertexCode();i.setCanvasSize(t,r,1),i.setClearColor([0,0,0,0]);let s=new d.ToDraw(i,{vertCode:a,fragCode:m.default,vertices:{data:this.getVerticesData(),count:4}});s.setUniform("maxSearchingFgRadius",10),s.setUniform("maxMaskErrorPixels",2),s.setUniform("iResolution",[t,r]);let n=new d.ToDraw(i,{vertCode:a,fragCode:f.default,vertices:{data:this.getVerticesData(),count:4}});return n.setUniform("blurRadius",5),n.setUniform("luminanceRadius",.05),n.setUniform("iResolution",[t,r]),[s,n]}getVertexCode(){return"#version 300 es\n\t\tprecision mediump float;\n\t\tin vec4 vPosition;\n\t\tout vec2 fTextureCoord;\n\t\tvoid main() {\n\t\t\tgl_Position = vPosition;\n\t\t\tfTextureCoord = vPosition.xy / 2.0 + 0.5;\n\t\t}\n\t\t"}getVerticesData(){return{vPosition:[-1,1,-1,-1,1,1,1,-1]}}};t.FixVideoBlackSurrounding=y,t.FixVideoBlackSurrounding=y=i([(0,a.define)("fix-video-black-surrounding")],y)},5428:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.refDirective=t.createDirectiveFromResult=t.DirectiveResult=t.defineDirective=void 0;let r=0;const i=new Map;t.defineDirective=function(e){let t=r++;return i.set(t,e),function(...e){return new a(t,...e)}};class a{constructor(e,...t){this.ref=null,this.id=e,this.args=t}}t.DirectiveResult=a,t.createDirectiveFromResult=function(e,t,r){let a=new(i.get(r.id))(e,t);return r.ref&&r.ref(a),a.merge(...r.args),a},t.refDirective=function(e,t){return e.ref=t,e}},5429:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatToShortDate=t.formatDate=t.addDurationToDate=t.cloneDate=t.getDaysOfMonth=t.getDaysOfYear=t.isLeapYear=t.isValidDate=t.setDateByUnit=t.getDateByUnit=void 0;const i=r(3549),a="yMdhms";function s(e,t){switch(t){case"y":return e.getFullYear();case"M":return e.getMonth();case"d":return e.getDate();case"h":return e.getHours();case"m":return e.getMinutes();case"s":return e.getSeconds();default:throw new Error(`"${t}" is not a valid date unit`)}}function n(e,t,r){switch(r){case"y":return e.setFullYear(t);case"M":return e.setMonth(t);case"d":return e.setDate(t);case"h":return e.setHours(t);case"m":return e.setMinutes(t);case"s":return e.setSeconds(t);default:throw new Error(`"${r}" is not a valid date unit`)}}function o(e){let t=e.getFullYear();return t%4==0&&(t%100!=0||t%400==0)}function l(e,t="yyyy-MM-dd hh:mm:ss"){return t.replace(/y+|M+|d+|h+|m+|s+/g,(t=>{let r=t[0],i=s(e,r[0]);return"M"===r&&(i+=1),String(i).padStart(t.length,"0")}))}t.getDateByUnit=s,t.setDateByUnit=n,t.isValidDate=function(e,t,r=1,i=0,a=0,s=0){let n=new Date(e,t,r,i,a,s);return e===n.getFullYear()&&t===n.getMonth()&&r===n.getDate()&&i===n.getHours()&&a===n.getMinutes()&&s===n.getSeconds()},t.isLeapYear=o,t.getDaysOfYear=function(e){return o(e)?366:365},t.getDaysOfMonth=function(e){let t=new Date(e.getTime());return t.setDate(32),32-t.getDate()},t.cloneDate=function(e=new Date,t=a){let r=[...a].map((r=>t.includes(r)?s(e,r):"d"===r?1:0));return new Date(r[0],r[1],r[2],r[3],r[4],r[5])},t.addDurationToDate=function(e,t){let r="-"===t[0];r&&(t=t.slice(1));let a=r?-1:1,o=i.parseDurationToObject(t),l=new Date(e);for(let e of Object.keys(o))n(l,s(l,e)+o[e]*a,e);return l},t.formatDate=l,t.formatToShortDate=function(e,t={y:"yyyy-MM-dd",M:"MM-dd",h:"hh:mm"}){let r=new Date,i=!1,n=Object.values(t)[0];for(let o of a)if(i=i||s(e,o)!==s(r,o),n=t[o]||n,i)break;return l(e,n)}},5466:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"shutterSizeRate",desc:"Shutter Size Rate",min:.01,max:1,step:.01,value:.1}];(0,r(4062).extendTransitions)({"shutter-herizontal":{uniformSlides:i,uniformValues:{shutterSlideOrigin:.5,beVertical:!1},steps:[{fragShaderName:"shutter"}]},"shutter-herizontal-to-top":{uniformSlides:i,uniformValues:{shutterSlideOrigin:0,beVertical:!1},steps:[{fragShaderName:"shutter"}]},"shutter-herizontal-to-bottom":{uniformSlides:i,uniformValues:{shutterSlideOrigin:1,beVertical:!1},steps:[{fragShaderName:"shutter"}]},"shutter-vertical":{uniformSlides:i,uniformValues:{shutterSlideOrigin:.5,beVertical:!0},steps:[{fragShaderName:"shutter"}]},"shutter-vertical-to-right":{uniformSlides:i,uniformValues:{shutterSlideOrigin:0,beVertical:!0},steps:[{fragShaderName:"shutter"}]},"shutter-vertical-to-left":{uniformSlides:i,uniformValues:{shutterSlideOrigin:1,beVertical:!0},steps:[{fragShaderName:"shutter"}]}})},5468:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDrawDropShadow=void 0;const i=r(3432),a=r(6412),s=r(3921),n=r(5499);class o extends a.ToDrawFastBlur{constructor(e){super(Object.assign(e,{samplingCount:(0,n.constrain)(e.samplingCount,1,e.renderer.project.options.maxDropShadowSamplingCount)}))}getFragCode(e){let t=(1===e?[{x:0,p:1}]:(0,i.generate1DGaussBlurPriorities)(e)).map((({x:e,p:t})=>`\talpha += sampling(iChannel[0], textureCoord + ${e}.0 * d).a * ${1===t?"1.0":t.toString()};`)).join("\n").replace(/\+(\s*)-/g,"-$1");return s.default.replace("float samplingCount = 1.0;",`float samplingCount = ${e}.0;`).replace("alpha += sampling(iChannel[0], textureCoord).a;",t)}getTotalIterateCount(e){return 1===this.samplingCount||0===e.x&&0===e.y?1:2*this.iterateCount}}t.ToDrawDropShadow=o},5499:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(757),t),a(r(9028),t)},5525:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(356),a=new Set;i.defineBinding("src",class{constructor(e){this.src="",this.el=e}update(e){if(this.src=e,a.has(e))this.el.src=e;else if(e){this.el.src="";let t=new Image;t.onload=()=>{a.add(e),e===this.src&&(this.el.src=e)},t.src=e}else this.el.src=""}remove(){this.el.src=""}})},5527:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GammaEffect=void 0;const i=r(8341),a=r(6376),s=r(5305),n=r(6339),o=r(5600);class l extends i.Effect{async initialize(){this.toDraw=new n.ToDrawEffect({renderer:this.renderer,fragCode:o.default})}update(){super.update();let e=(0,a.getPropertyValues)(this.data,this.time,s.EffectGammaDefaultValues);this.toDraw.setUniform("redGamma",e.redGamma),this.toDraw.setUniform("redPedestal",e.redPedestal),this.toDraw.setUniform("redGain",e.redGain),this.toDraw.setUniform("greenGamma",e.greenGamma),this.toDraw.setUniform("greenPedestal",e.greenPedestal),this.toDraw.setUniform("greenGain",e.greenGain),this.toDraw.setUniform("blueGamma",e.blueGamma),this.toDraw.setUniform("bluePedestal",e.bluePedestal),this.toDraw.setUniform("blueGain",e.blueGain)}}t.GammaEffect=l},5600:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform float redGamma;\nuniform float redPedestal;\nuniform float redGain;\nuniform float greenGamma;\nuniform float greenPedestal;\nuniform float greenGain;\nuniform float blueGamma;\nuniform float bluePedestal;\nuniform float blueGain;\nvec4 getFragColor() {\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord);\ncolor.r = pow(color.r * redGain + redPedestal, 1.0 / redGamma);\ncolor.g = pow(color.g * greenGain + greenPedestal, 1.0 / greenGamma);\ncolor.b = pow(color.b * blueGain + bluePedestal, 1.0 / blueGamma);\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},5623:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayer=void 0;const i=r(8524),a=r(9673);class s extends a.ImageVideoLayer{async initialize(){await super.initialize();let e=this.renderer.shouldLoadLayerSoon(this.data),t=(0,i.supportsDecodeImageInWorker)();if(e||!t){let e=await this.renderer.resourceLoader.loadImage(this.data);this.media=e,this.data.mediaWidth=e.naturalWidth,this.data.mediaHeight=e.naturalHeight}else{let e=await this.renderer.resourceLoader.loadDecodedImage(this.data);this.media=e,this.data.mediaWidth=e.width,this.data.mediaHeight=e.height}this.initializeMediaShared(),await this.initializeToDraw()}}t.ImageLayer=s},5685:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),(0,r(4062).extendTransitions)({fade:{steps:[{fragShaderName:"fade"}]},"fade-black":{uniformValues:{fadeToColor:[0,0,0]},steps:[{fragShaderName:"fade-color"}]},"fade-white":{uniformValues:{fadeToColor:[1,1,1]},steps:[{fragShaderName:"fade-color"}]}})},5756:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RampEffect=void 0;const i=r(8341),a=r(6376),s=r(5305),n=r(6339),o=r(7463),l=r(62);class c extends i.Effect{async initialize(){this.toDraw=new n.ToDrawEffect({renderer:this.renderer,fragCode:o.default})}update(){super.update();let e=(0,a.getPropertyValues)(this.data,this.time,s.EffectRampDefaultValues);this.toDraw.setUniform("startOfRamp",e.startOfRamp),this.toDraw.setUniform("startColor",(0,l.premultiplyColorArray)(e.startColor)),this.toDraw.setUniform("endOfRamp",e.endOfRamp),this.toDraw.setUniform("endColor",(0,l.premultiplyColorArray)(e.endColor)),this.toDraw.setUniform("endOfRamp",e.endOfRamp),this.toDraw.setUniform("rampShape",e.rampShape),this.toDraw.setUniform("blendWithOriginal",e.blendWithOriginal/100)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.RampEffect=c},5845:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=t.Debounce=t.lazilyThrottle=t.LazilyThrottle=t.throttle=t.Throttle=t.interval=t.Interval=t.timeout=t.Timeout=void 0;class r{constructor(e,t){this.id=null,this.canceled=!1,this.fn=e,this.ms=t}}class i extends r{constructor(e,t){super(e,t),this.wrapped=this.wrap(),this.wrapped.__original=e}}class a extends r{constructor(e,t){super(e,t),this.reset()}reset(){return this.id&&clearTimeout(this.id),this.id=setTimeout(this.onTimeout.bind(this),this.ms),!0}onTimeout(){this.id=null,this.fn()}flush(){return!!this.id&&(clearTimeout(this.id),this.id=null,this.fn(),!0)}cancel(){return!!this.id&&(clearTimeout(this.id),this.id=null,!0)}}t.Timeout=a,t.timeout=function(e,t=0){return new a(e,t)};class s extends r{constructor(e,t){super(e,t),this.reset()}reset(){return this.id&&clearInterval(this.id),this.id=setInterval(this.onInterval.bind(this),this.ms),!0}onInterval(){this.fn()}flush(){return!!this.id&&(this.fn(),this.reset(),!0)}cancel(){return!!this.id&&(clearInterval(this.id),this.id=null,!0)}}t.Interval=s,t.interval=function(e,t){return new s(e,t)};class n extends i{constructor(e,t=0){super(e,t)}wrap(){let e=this;return function(...t){e.canceled?e.fn.apply(this,t):e.id||(e.setThrottle(),e.fn.apply(this,t))}}setThrottle(){this.ms?this.id=setTimeout(this.onTimeout.bind(this),this.ms):this.id=requestAnimationFrame(this.onTimeout.bind(this))}onTimeout(){this.id=null}reset(){return this.id&&this.clearThrottle(),this.canceled=!1,!0}clearThrottle(){this.ms?clearTimeout(this.id):cancelAnimationFrame(this.id),this.id=null}flush(){return!1}cancel(){return!this.canceled&&(this.canceled=!0,!0)}}t.Throttle=n,t.throttle=function(e,t=0){return new n(e,t)};class o extends i{constructor(e,t){super(e,t),this.lastArgs=null,this.lastThis=null,this.wrapped=this.wrap()}wrap(){let e=this;return function(...t){e.canceled?e.fn.apply(this,t):(e.lastArgs=t,e.lastThis=this,e.id||e.setThrottle())}}setThrottle(){this.ms?this.id=setTimeout(this.onTimeout.bind(this),this.ms):this.id=requestAnimationFrame(this.onTimeout.bind(this))}onTimeout(){this.lastArgs?(this.fn.apply(this.lastThis,this.lastArgs),this.lastArgs=null,this.lastThis=null,this.setThrottle()):this.id=null}reset(){return this.id&&this.clearThrottle(),this.lastArgs=null,this.lastThis=null,this.canceled=!1,!0}flush(){return!!this.lastArgs&&(this.setThrottle(),this.fn.apply(this.lastThis,this.lastArgs),this.lastArgs=null,this.lastThis=null,!0)}clearThrottle(){this.ms?clearTimeout(this.id):cancelAnimationFrame(this.id),this.id=null}cancel(){return!this.canceled&&(this.canceled=!0,!0)}}t.LazilyThrottle=o,t.lazilyThrottle=function(e,t){return new o(e,t)};class l extends i{constructor(e,t){super(e,t),this.lastArgs=null,this.lastThis=null,this.wrapped=this.wrap()}wrap(){let e=this;return function(...t){e.canceled?e.fn.apply(this,t):(e.id&&clearTimeout(e.id),e.id=setTimeout(e.onTimeout.bind(e),e.ms),e.lastArgs=t,e.lastThis=this)}}onTimeout(){this.id=null,this.lastArgs&&(this.fn.apply(this.lastThis,this.lastArgs),this.lastArgs=null,this.lastThis=null)}reset(){return this.id&&(clearTimeout(this.id),this.id=null),this.lastArgs=null,this.lastThis=null,!0}flush(){return this.id&&(clearTimeout(this.id),this.id=0),!!this.lastArgs&&(this.fn.apply(this.lastThis,this.lastArgs),this.lastArgs=null,this.lastThis=null,!0)}cancel(){return!this.canceled&&(this.canceled=!0,!0)}}t.Debounce=l,t.debounce=function(e,t){return new l(e,t)}},5875:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTree=void 0;const i=r(2111),a=r(3075),s=r(6841),n=r(2824),o=r(555),l=r(1650),c=r(5499),d=r(1830),h=r(7905),u=r(9673),p=r(5042),m=r(2579),f={mappedSamplers:[],paintArea:null};t.RenderTree=class{sw;project;layerManager;effectManager;nodes;time=0;startSafeTime=0;currentTransformStatusRecord=null;previousTransformStatusRecord=null;constructor(e){this.sw=e.sw,this.project=e.project,this.layerManager=new a.LayerManager(e),this.effectManager=new s.EffectManager(e)}deleteLayerFromId(e){this.layerManager.deleteFromId(e)}deleteEffectFromId(e){this.effectManager.deleteFromId(e)}clear(){this.layerManager.clear(),this.effectManager.clear(),this.nodes=[]}activeCurrentLayers(){this.layerManager.activeCurrent()}deactiveCurrentLayers(){this.layerManager.deactiveCrrrent()}isLayerBeCurrent(e){return this.layerManager.isCurrentId(e.id)}updateTime(e){this.time=e}async updateLayerDatas(e,t){this.startSafeTime=t,this.nodes=(0,i.compileToRenderTree)(e),await this.layerManager.setCurrentDatas(a.LayerManager.filterLayerDatasFromRenderNodes(this.nodes)),await this.effectManager.setCurrentDatas(s.EffectManager.filterEffectDatasFromRenderNodes(this.nodes)),this.updateTransformStat(),this.currentTransformStatusRecord=null}async syncLayersTime(){await this.syncLayerNodesTime(this.nodes)}async syncLayerNodesTime(e){let t=[];for(let r of e){switch(r.type){case i.RenderNodeType.PixelLayer:case i.RenderNodeType.AudioLayer:let e=this.layerManager.getFromId(r.data.id),a=r.timeMap.mergeInnerLayer(r.data).mapAllRange(this.time);t.push(e.syncTime(a))}r.inputs&&t.push(this.syncLayerNodesTime(r.inputs))}await Promise.all(t)}updateTransformStat(){this.updateSubTransformStat(this.nodes)}updateSubTransformStat(e){for(let t of e)(0,i.isTransformableRenderNodeType)(t.type)&&(t.type===i.RenderNodeType.Effect?this.effectManager.getFromId(t.data.id).setTransformStat(t.transformStat):this.layerManager.getFromId(t.data.id).setTransformStat(t.transformStat),t.inputs&&this.updateSubTransformStat(t.inputs))}draw(){this.generateRenderNodeTransformStatus(),this.sw.clear(),this.drawNodes(this.nodes,null)}generateRenderNodeTransformStatus(){let{width:e,height:t}=this.project.data;if(this.previousTransformStatusRecord=null,this.currentTransformStatusRecord){let e=this.time-this.currentTransformStatusRecord.time,t=Math.abs(e);t<=.05&&t>=.001&&(this.previousTransformStatusRecord=this.currentTransformStatusRecord)}if(!this.previousTransformStatusRecord){let r=.01;this.time-r<this.startSafeTime&&(r=-.01),this.previousTransformStatusRecord=new o.TransformStatusRecord(this.nodes,this.time-r,e,t)}this.currentTransformStatusRecord=new o.TransformStatusRecord(this.nodes,this.time,e,t)}drawNodes(e,t){let r=[];this.orderNodes(e);for(let a of e)switch(a.type){case i.RenderNodeType.PixelLayer:r.push(this.drawPixelNode(a,t));break;case i.RenderNodeType.ShapeLayer:r.push(this.drawShapeNode(a,t));break;case i.RenderNodeType.CameraLayer:r.push(this.drawCameraNode(a,t));break;case i.RenderNodeType.AudioLayer:this.updateAudioNode(a);break;case i.RenderNodeType.CompositeLayer:r.push(this.drawCompositeNode(a,t));break;case i.RenderNodeType.PlaceholderLayer:r.push(this.drawPlaceholderNode(a,t));break;case i.RenderNodeType.Effect:r.push(this.drawEffectNode(a,t))}return r=r.filter((e=>e)),d.PaintArea.union(r)}orderNodes(e){e.sort(((e,t)=>{let r=this.getNodeDeep(e),i=this.getNodeDeep(t);return 0===r||0===i?0:r-i}))}getNodeDeep(e){if(!e.beThreeD)return 0;let t=this.currentTransformStatusRecord.get(e.id);if(!t)return 0;let r=t.layerDeep;return(0,c.toDecimal)(r,4)}updateAudioNode(e){let t=e.timeMap.map(this.time),r=this.layerManager.getFromId(e.data.id);r.setTime(t),r.update()}drawPixelNode(e,t){this.updateLayerNode(e);let r=this.layerManager.getFromId(e.data.id);return r.setMaskArea(t),r.draw()}updateLayerNode(e){let t=e.timeMap.mapAllRange(this.time),r=this.layerManager.getFromId(e.data.id),i=this.currentTransformStatusRecord.get(e.id);r.setTime(t),r.setTransformStatus(i),r.update(),r instanceof m.TextLayer&&e.data.motionBlur&&this.updateMotionBlurMatrix(r,e)}drawShapeNode(e,t){this.updateLayerNode(e);let r=this.layerManager.getFromId(e.data.id);return r.setMaskArea(t),r.draw()}drawCameraNode(e,t){let r=this.layerManager.getFromId(e.data.id);this.updateLayerNode(e);let i=this.drawNodes(e.inputs,t);return r.draw(i)}drawCompositeNode(e,t){let r=this.layerManager.getFromId(e.data.id);this.updateLayerNode(e);let{mappedSamplers:i,paintArea:a}=this.drawSingleFrameInput(e,e.inputs,t);return r.setMappedChannel(...i),r.draw(),r.clearChannel(),a}drawPlaceholderNode(e,t){return this.drawNodes(e.inputs,t)}drawEffectNode(e,t){let r,i=e.timeMap.map(this.time),a=e.data,s=e.inputs,n=this.currentTransformStatusRecord.get(e.id),o=this.effectManager.getFromId(a.id),c="mask"===a.type;o.setTime(i),o.setTransformStatus(n),o.update(),o.setMaskArea(t),o instanceof l.MotionBlurEffect&&this.updateMotionBlurMatrix(o,e),r=c?this.drawMaskFrameInputs(e,s,t):this.drawFrameInputs(e,s,t);let{mappedSamplers:d,paintArea:h}=r;if(h){o.setMappedChannel(...d);let e=o.draw(h);return o.clearChannel(),e}return null}updateMotionBlurMatrix(e,t){let r=this.previousTransformStatusRecord.get(t.id),i=this.currentTransformStatusRecord.get(t.id),a=r.getFlatProjectionMatrix(),s=i.getFlatProjectionMatrix().minus(a),n=this.currentTransformStatusRecord.time-this.previousTransformStatusRecord.time,o=s.multiplyScalar(1/n);e.setBaseMotionMatrix(o)}drawFrameInputs(e,t,r){let i,a=e.data,s=(0,h.getEffectInputCount)(a.type);if(s>1)i=this.drawMultipleFrameInputs(e,t,r);else if(1===s&&t.length>0)i=this.drawSingleFrameInput(e,t,r);else if(0===s&&t.length>0){let{width:e,height:t}=this.project.data;i={mappedSamplers:[],paintArea:new p.RectArea(0,0,e,t)}}else i=f;return i}drawMaskFrameInputs(e,t,r){let[i,a]=t,{mappedSamplers:[s],paintArea:n}=this.drawSingleFrameInput(e,[i],r),o=r;if(!n)return f;o=d.PaintArea.cross([o,n]);let{mappedSamplers:[l],paintArea:c}=this.drawSingleFrameInput(e,[a],r);return n?(o=d.PaintArea.cross([o,c]),{mappedSamplers:[s,l],paintArea:n}):f}drawMultipleFrameInputs(e,t,r){let i=[];for(let a of t)i.push(this.drawSingleFrameInput(e,[a],r));let a=i.map((e=>e.mappedSamplers)).flat(),s=i.map((e=>e.paintArea)).filter((e=>e));return{mappedSamplers:a,paintArea:d.PaintArea.union(s)}}drawSingleFrameInput(e,t,r){let a=this.extractMediaMappedSampler(e,t);if(a)return a.paintArea=d.PaintArea.cross([a.paintArea,r]),a;let s,o,l=e.data.type;e.type===i.RenderNodeType.Effect&&(0,h.isPixelToPixelEffect)(l)?(s=e.transformStat.getSuggestedAntialiasType(),o={filter:n.SamplerFilter.Linear}):(s=!1,o={filter:n.SamplerFilter.Linear});let c=t.some((e=>e.type===i.RenderNodeType.ShapeLayer||e.transformStat&&e.transformStat.getSuggestedAntialiasType()));c&&(s=!0);let u=this.sw.textureFrameManager.requestFull(s,1,o);u.active();let p=this.drawNodes(t,r);u.deactive();let m=[u.getMappedSampler()];return p||(m.forEach((e=>e.release())),m=[]),{mappedSamplers:m,paintArea:p}}extractMediaMappedSampler(e,t){let r=e.data;if((0,h.isMultiSamplingEffect)(r.type))return null;if(1!==t.length||t[0].type!==i.RenderNodeType.PixelLayer)return null;let a=this.layerManager.getFromId(t[0].data.id);if(!(a instanceof u.ImageVideoLayer))return null;this.updateLayerNode(t[0]);let{mappedSampler:s,paintArea:n}=a.drawAsMappedSampler();return n?{mappedSamplers:[s],paintArea:n}:null}async preloadResources(e,t){try{await this.layerManager.prepare(a.LayerManager.filterRenderableLayerDatas(e),t),await this.effectManager.prepare(s.EffectManager.filterRenderableEffectDatas(e),t)}catch(e){console.warn(e)}}}},5884:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextureFrameDrawToBuffers=void 0;const i=r(5499);class a extends i.Emitter{static active=null;static stack=[];sw;width=0;height=0;antialias;framebuffer;context;viewport;renderbuffer;constructor(e,t,r,i=!1){super(),this.sw=e,this.context=e.context,this.width=t,this.height=r,this.antialias=i;let a=this.context.createFramebuffer(),s=this.context.createRenderbuffer();if(this.context.bindFramebuffer(this.context.FRAMEBUFFER,a),this.context.bindRenderbuffer(this.context.RENDERBUFFER,s),this.context.framebufferRenderbuffer(this.context.FRAMEBUFFER,this.context.COLOR_ATTACHMENT0,this.context.RENDERBUFFER,s),this.antialias){let e=this.context.getParameter(this.context.MAX_SAMPLES);this.context.renderbufferStorageMultisample(this.context.RENDERBUFFER,e,this.context.RGBA8,t,r)}else this.context.renderbufferStorage(this.context.RENDERBUFFER,this.context.RGBA8,t,r);this.framebuffer=a,this.renderbuffer=s,this.context.bindFramebuffer(this.context.FRAMEBUFFER,null)}setPartialRect(e,t,r,i,a){let s=-e*a,n=-(i*a-(t*a+this.height)),o=r*a,l=i*a;this.viewport=[s,n,o,l]}applyViewport(){this.sw.setViewport(...this.viewport)}active(){a.active&&(a.active.pause(),a.stack.push(a.active)),this.context.bindFramebuffer(this.context.FRAMEBUFFER,this.framebuffer),this.context.clearBufferfv(this.context.COLOR,0,[0,0,0,0]),this.applyViewport(),a.active=this}deactive(){if(a.active!==this)throw new Error("TextureFrameDrawToBuffers must be deactived in the opposite order from been activated!");if(this.context.bindFramebuffer(this.context.FRAMEBUFFER,null),a.stack.length>0){let e=a.stack.pop();e.resume(),a.active=e}else this.sw.resetViewport(),a.active=null;this.emit("deactive")}pause(){}resume(){this.context.bindFramebuffer(this.context.FRAMEBUFFER,this.framebuffer),this.applyViewport()}setAsReadBuffer(){this.context.bindFramebuffer(this.context.READ_FRAMEBUFFER,this.framebuffer)}delete(){this.context.deleteFramebuffer(this.framebuffer),this.context.deleteRenderbuffer(this.renderbuffer)}}t.TextureFrameDrawToBuffers=a},5897:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.notification=t.UniqueNotification=t.QuickNotification=t.Notification=void 0;const a=r(1416),s=r(8240),n=r(5499);let o=class extends a.Component{constructor(){super(...arguments),this.hideDelay=1e4,this.appendTo="body",this.seed=1,this.items=[]}static style(){let{infoColor:e,adjust:t,successColor:r,errorColor:i,warningColor:n,popupBorderRadius:o,popupShadowBlurRadius:l,adjustFontSize:c,backgroundColor:d,textColor:h,popupShadowColor:u}=s.theme,p=[["info",e],["warning",n],["error",i],["success",r]];return a.css`
		:host{
			position: fixed;
			right: ${t(12)}px;
			bottom: ${t(12)}px;
			min-width: ${t(280)}px;
			max-width: ${t(480)}px;
			z-index: 1200;	// Higher than message
			font-size: ${c(13)}px;
		}

		.item{
			position: relative;
			display: flex;
			margin-top: ${t(12)}px;
			background: ${d};
			box-shadow: 0 0 ${l}px ${u};
			cursor: pointer;
			overflow: hidden;
			border-radius: ${o}px;
		}

		.stripe{
			width: 4px;
		}

		.left{
			padding: ${t(16)}px ${t(14)}px ${t(16)}px ${t(16)}px;
		}

		.type-icon{
			display: block;
			width: ${t(20)}px;
			height: ${t(20)}px;

			svg{
				width: ${t(20)}px;
				height: ${t(20)}px;
			}
		}

		.content{
			flex: 1;
			min-width: 0;
			padding: ${t(16)}px ${t(16)}px ${t(8)}px 0;
		}

		.close{
			display: flex;
			width: ${t(28)}px;
			height: ${t(28)}px;
			color: ${h};

			f-icon{
				margin: auto;
			}

			&:hover{
				color: ${h.toMiddle(10)};
			}

			&:active{
				transform: translateY(1px);
			}
		}

		.title{
			font-weight: bold;
			line-height: ${t(20)}px;
			margin-bottom: ${t(4)}px;
		}

		.message{
			flex: 1;
			min-width: 0;
			line-height: ${t(20)}px;
			margin-bottom: ${t(4)}px;
			text-align: left;
			word-wrap: break-word;

			a{
				font-weight: bold;
			}
		}

		.list{
			margin: ${t(8)}px 0;
			line-height: ${t(20)}px;
			list-style-type: square;
			padding-left: ${t(28)}px;
		}

		.actions{
			margin-top: ${t(8)}px;
		}

		.action{
			margin-right: ${t(6)}px;
			height: ${t(22)}px;
			line-height: ${20}px;
			padding: 0 ${t(8)}px;
		}

		${p.map((([e,t])=>a.css`
			.type-${e}{
				&:hover{
					background: ${t.mix(d,95)};
				}

				.stripe{
					background: ${t};
				}
			}
		`))}
		
		`}render(){return a.repeat(this.items,(e=>a.html`<div class="item"
				:class="type-${e.type}"
				@mouseenter=${()=>this.onMouseEnter(e)}
				@mouseleave=${()=>this.onMouseLeave(e)}
			>
				<div class="stripe" />

				<div class="left">
					<f-icon class="type-icon" .type=${e.type} />
				</div>

				<div class="content">
					${e.title?a.html`<div class="title">${e.title}</div>`:""}

					<div class="message">${e.message}</div>
					
					${e.list&&e.list.length>0?a.html`
						<ul class="list">
							${e.list.map((e=>a.html`<li>${e}</li>`))}
						</ul>
					`:""}

					${this.renderActions(e)}
				</div>

				<div class="close" @click=${()=>this.onClickClose(e)}>
					<f-icon .type="close" />
				</div>
			</div>`),{transition:"fade",enterAtStart:!0,onend:this.onTransitionEnd})}renderActions(e){let t=e.actions;if(t&&t.length>0){let r=t.map((t=>a.html`
				<button class="action"
					?primary=${t.primary}
					@click=${()=>this.onClickActionButton(t,e)}>
					${t.text}
				</button>
			`));return a.html`<div class="actions">${r}</div>`}return""}async onClickActionButton(e,t){e.handler&&e.handler(),this.hide(t.id)}onMouseEnter(e){e.entered=!0}onMouseLeave(e){e.entered=!1,e.timeout||this.hideLater(e)}onClickClose(e){this.hide(e.id)}onTransitionEnd(e){"leave"===e&&0===this.items.length&&this.el.remove()}show(e){if(e.id){let t=this.items.find((t=>t.id===e.id));if(t)return delete t.hideDelay,Object.assign(t,e),this.hideLater(t),e.id}let t=Object.assign({id:this.seed++,entered:!1,timeout:null},e);return this.items.unshift(t),this.hideLater(t),1===this.items.length&&document.body.append(this.el),t.id}hideLater(e){e.timeout&&e.timeout.cancel(),e.timeout=n.timeout((()=>{e.timeout=null,e.entered||this.hide(e.id)}),e.hideDelay||this.hideDelay)}hide(e){let t=this.items.find((t=>t.id===e));return!!t&&(n.remove(this.items,t),!0)}hideAll(){this.items=[],0===this.items.length&&this.el.remove()}};o=i([a.define("f-notification")],o),t.Notification=o;class l{constructor(){this.noti=null}unique(){return new c(this)}showNotification(e){return this.noti||(this.noti=a.renderComponent(a.html`<f-notification />`).component),this.noti.show(e)}info(e,t={}){return t.type="info",t.message=e,this.showNotification(t)}warn(e,t={}){return t.type="warning",t.message=e,this.showNotification(t)}error(e,t={}){return t.type="error",t.message=e,this.showNotification(t)}success(e,t={}){return t.type="success",t.message=e,this.showNotification(t)}hide(e){return this.noti.hide(e)}hideAll(){return this.noti.hideAll()}}t.QuickNotification=l;class c{constructor(e){this.id=null,this.raw=e}overwriteNotificationId(e){this.id&&(e.id=this.id)}info(e,t={}){return this.overwriteNotificationId(t),this.id=this.raw.info(e,t)}warn(e,t={}){return this.overwriteNotificationId(t),this.id=this.raw.warn(e,t)}error(e,t={}){return this.overwriteNotificationId(t),this.id=this.raw.error(e,t)}success(e,t={}){return this.overwriteNotificationId(t),this.id=this.raw.success(e,t)}hide(){return!!this.id&&this.raw.hide(this.id)}}t.UniqueNotification=c,t.notification=new l},5956:(e,t)=>{function r(e,t){return e.replace(/\$(?:([$&\d])|<(\w+)>)/g,((e,r,i)=>i?t.groups&&t.groups[i]||"":"$"===r?"$":"&"===r?t[0]:"string"==typeof t[r]?t[r]:""))}function i(e,t,r){let i=t.exec(e);return i&&i[r]||""}function a(e){return e.replace(/(^|.)([A-Z]+)/g,((e,t,r)=>t&&/[a-z ]/i.test(t)?t+"-"+r.toLowerCase():e.toLowerCase())).replace(/_/g,"-")}Object.defineProperty(t,"__esModule",{value:!0}),t.toUnderscoreCase=t.toDashCase=t.toCamerCase=t.capitalize=t.afterLast=t.beforeLast=t.after=t.before=t.format=t.subMatches=t.subMatchesAt=t.firstMatch=t.subMatchAt=t.selectAll=t.select=void 0,t.select=function(e,t,i){let a=t.exec(e);return a?r(i,a):""},t.selectAll=function(e,t,i){if(t.global){let a,s=[];for(;a=t.exec(e);)s.push(r(i,a));return s}{let a=e.match(t);return a?[r(i,a)]:[]}},t.subMatchAt=i,t.firstMatch=function(e,t){return i(e,t,1)},t.subMatchesAt=function(e,t,r){if(t.global){let i,a=[];for(;i=t.exec(e);)a.push(i[r]||"");return a}{let i=e.match(t);return i?[i[r]||""]:[]}},t.subMatches=function(e,t,r=1){if(t.global){let i,a=[];for(;i=t.exec(e);)a.push([...i].slice(r));return a}{let i=e.match(t);return i?[[...i].slice(r)]:[]}},t.format=function(e,t){return e.replace(/\{(\w+)\}/g,((e,r)=>{let i=t[r];return void 0===i&&(i=e),i}))},t.before=function(e,t,r=!1){let i=e.indexOf(t);return i<0?r?e:"":e.slice(0,i)},t.after=function(e,t,r=!1){let i=e.indexOf(t);return i<0?r?e:"":e.slice(i+t.length)},t.beforeLast=function(e,t,r=!1){let i=e.lastIndexOf(t);return i<0?r?e:"":e.slice(0,i)},t.afterLast=function(e,t,r=!1){let i=e.lastIndexOf(t);return i<0?r?e:"":e.slice(i+1)},t.capitalize=function(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()},t.toCamerCase=function(e){return e.replace(/[-_ ][a-z]/gi,(e=>e[1].toUpperCase()))},t.toDashCase=a,t.toUnderscoreCase=function(e){return a(e).replace(/-/g,"_")}},5963:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoEncodingAnalyser=t.FFVideoEncoder=void 0;const i=r(1648),a=r(5499),s=r(7173),n=r(1118),o=r(2195),l=r(1954),c=r(8916),d={"very-low":30,low:27,medium:24,high:21,"very-high":18},h={"very-low":c.QUALITY_VERY_LOW,low:c.QUALITY_LOW,medium:c.QUALITY_MEDIUM,high:c.QUALITY_HIGH,"very-high":c.QUALITY_VERY_HIGH},u={name:"",format:"mp4",frameRate:30,height:540,quality:"medium",fragmentSeconds:2,ffmpegWorkerPath:""};class p extends a.Emitter{options;width;height;project;costSeconds={encoding:0,concat:0};terminated=!1;frameCounter;constructor(e,t){super(),this.options=(0,a.assignIf)(t,u),this.options.ffmpegWorkerPath&&s.ffmpeg.configWorkerPath(this.options.ffmpegWorkerPath),this.height=2*Math.round(this.options.height/2),this.width=2*Math.round(e.data.width/e.data.height*this.height/2),this.cloneProject(e),this.initializeFrameCounter()}async cloneProject(e){let t=document.createElement("canvas"),r=e.rootDirectory,a=e.data.cloneData(),s=this.getProjectOptions();this.project=new i.Project(t,r,a,s,this),this.project.renderer.setCanvasSize(this.width,this.height)}getProjectOptions(){return{frameRate:this.options.frameRate}}initializeFrameCounter(){this.frameCounter=new f,this.frameCounter.totalFramesExtracting=this.project.footages.getTotalVideoFrames()}async encodeByFF(){let e=this.options.frameRate,t=1/e,r=this.project.data.duration,i=this.frameCounter.total=Math.round(r/t)+1,a=[],n=[],o=performance.now(),l=0,c=Math.round(i/this.options.fragmentSeconds/e),d=Math.ceil(i/c),h=Math.ceil(1.5*s.ffmpeg.defaultWorkerGroup.threadCount),u=new m(h);for(let e=0;e<i;e++){if(this.terminated){n.push(Promise.reject(new Error("Terminated")));break}try{let r=await this.drawImageAsBuffer(e*t);a.push(r)}catch(e){if(!this.terminated)throw e}if(this.frameCounter.drawn=e+1,this.updateProgress(),a.length>=d||e===i-1){let e=a.slice(0,d);a=a.slice(d);let t=this.encodeSegmentByFF(e,l++);n.push(t),u.addPromise(t).catch((()=>{})),await u.untilIdle()}}let p=await Promise.all(n),f=performance.now();this.costSeconds.encoding+=(f-o)/1e3,await this.joinVideoSegmentsByFF(p),this.project.delete()}async encodeSegmentByFF(e,t){let r=await s.ffmpeg.defaultWorkerGroup.request();return this.encodeFramesByFF(r,e,t)}updateProgress(){let{loaded:e,total:t}=this.frameCounter.getProgress();this.emit("progress",e,t)}async encodeFramesByFF(e,t,r){let{frameRate:i,quality:a}=this.options,s=d[a],n=t.map(((e,t)=>({name:String(t).padStart(4,"0")+".jpeg",data:e}))),o=["-hide_banner","-framerate",i,"-i","%04d.jpeg","-an","-c:v","libx264","-crf",s,"-pix_fmt","yuv420p","-vf","scale=out_color_matrix=bt709","-color_primaries","bt709","-color_trc","bt709","-colorspace","bt709","-preset","superfast",`${String(r).padStart(4,"0")}.mp4`];return(await e.execWithProgress(n,o,this.getProgressFn("encoded")))[0]}getProgressFn(e){let t=0;return r=>{this.frameCounter[e]+=r-t,t=r,this.updateProgress()}}getFramesExtractProgressFn(){return this.getProgressFn("framesExtracting")}async joinVideoSegmentsByFF(e){let t=s.ffmpeg.listInputFiles(e),r=this.project.footages.getReplaceableAudioLayerData(),i=this.project.resourceLoader.getLayerPath(r),a=await s.ffmpeg.getFFFileFromPath(i),n=this.project.data.duration,o=r.duration,l=performance.now();t.push(a);let c=["-hide_banner","-f","concat","-i","list.txt","-stream_loop","-1","-i",a.name,"-shortest","-map","0:v:0","-map","1:a:0","-c:v","copy"];Math.abs(o-n)<=1?c.push("-c:a","copy"):c.push("-af",`afade=t=out:st=${n-2}:d=2`),c.push(`${this.options.name}.mp4`);let d=await s.ffmpeg.execWithProgress(t,c,(e=>{this.frameCounter.concat=e,this.updateProgress()})),h=performance.now();this.costSeconds.concat+=(h-l)/1e3,s.ffmpeg.downloadFile(d[0])}async encodeByWeb(){let e=this.options.frameRate,t=1/e,r=this.project.data.duration,i=this.frameCounter.total=Math.round(r/t)+1,a=performance.now(),s=new c.Output({target:new c.BufferTarget,format:new c.Mp4OutputFormat}),n=await(0,c.getFirstEncodableVideoCodec)(s.format.getSupportedVideoCodecs(),{width:this.width,height:this.height});if(!n)throw new Error("Your browser doesn't support video encoding.");const o=new c.CanvasSource(this.project.canvas,{codec:n,bitrate:h[this.options.quality]});s.addVideoTrack(o,{frameRate:e});const l=await(0,c.getFirstEncodableAudioCodec)(s.format.getSupportedAudioCodecs(),{numberOfChannels:2,sampleRate:48e3});if(!l)throw new Error("Your browser doesn't support audio encoding, so we won't include audio in the output file.");let d=new c.AudioBufferSource({codec:l,bitrate:c.QUALITY_VERY_HIGH});s.addAudioTrack(d),await s.start();for(let e=0;e<i;e++){if(this.terminated)return Promise.reject(new Error("Terminated"));let r=e*t;try{await this.drawImageAsCanvas(e*t),await o.add(r,t)}catch(e){if(!this.terminated)throw e}this.frameCounter.drawn=e+1,this.frameCounter.encoded=e+1,this.updateProgress()}o.close();let u=this.project.footages.getReplaceableAudioLayerData(),p=this.project.resourceLoader.getLayerPath(u),m=await(await fetch(p)).arrayBuffer(),f=await(new AudioContext).decodeAudioData(m),g=new OfflineAudioContext({length:48e3*r,sampleRate:48e3,numberOfChannels:2}),y=g.createBufferSource();y.buffer=f,y.loop=!0,y.loopStart=0,y.loopEnd=f.duration,y.connect(g.destination),y.start(),d.add(await g.startRendering()),await s.finalize();let w=performance.now();this.costSeconds.encoding+=(w-a)/1e3;let v=new Blob([s.target.buffer],{type:s.format.mimeType}),x=document.createElement("a"),b=URL.createObjectURL(v);x.textContent=`${this.options.name}.mp4`,x.setAttribute("href",b),x.setAttribute("download",`${this.options.name}.mp4`),x.click()}async drawImageAsBuffer(e){let t=await this.drawImageAsCanvas(e),r=await(0,l.readCanvasAsJPEG)(t,1);return await(0,n.readBlobAsArrayBuffer)(r)}async drawImageAsCanvas(e){return await this.project.renderer.setTime(e),this.project.renderer.sw.waitDrawingCompleted(),this.project.canvas}terminate(){s.ffmpeg.defaultWorkerGroup.abort(),this.project.delete(),this.terminated=!0}}t.FFVideoEncoder=p;class m extends o.WorkQueue{create(){return{}}async addPromise(e){let t=await this.request();await e,this.delete(t)}}class f{total=0;drawn=0;encoded=0;framesExtracting=0;totalFramesExtracting=0;concat=0;rates={drawing:10,encoding:10,framesExtracting:10,concat:1};getProgress(){let{total:e,drawn:t,encoded:r,framesExtracting:i,totalFramesExtracting:a,concat:s}=this;console.log({total:e,drawn:t,encoded:r,framesExtracting:i,totalFramesExtracting:a,concat:s});let n=this.rates.framesExtracting;n*=1-t/e;let o=e*this.rates.drawing+e*this.rates.encoding+a*n+e*this.rates.concat;return{loaded:t*this.rates.drawing+r*this.rates.encoding+i*n+s*this.rates.concat,total:o}}}t.VideoEncodingAnalyser=class{storagePrefix="aegl_time_speed_of_";project;constructor(e){this.project=e}guessEncodingTimeInMinutes(e,t,r){return(0,a.toPrecision)(this.guessEncodingTimeInSeconds(e,t,r)/60,2)}guessEncodingTimeInSeconds(e,t,r){let{drawingAndEncodingTime:i,extractingFrameTime:s}=this.guessBaseEncodingTimeInSeconds(e,t,r),n=a.storage.get(this.storagePrefix+this.project.data.id),o=n?n*i:i+s;return(0,a.toPrecision)(o,2)}guessBaseEncodingTimeInSeconds(e,t,r){let i=d[r],a=this.getEncodingPixelCountInM(e),s=(-1.5*a-1)/(.14*a-.9)*this.project.data.duration*t/30*(2-i/21),n=2*this.project.footages.getTotalVideoFrames()/30,o=Math.pow(Math.max(navigator.hardwareConcurrency-2,1)/2,.5);return s/=o,n/=o,window.VideoEncoder&&(s/=10,n/=10),{drawingAndEncodingTime:s,extractingFrameTime:n}}getEncodingPixelCountInM(e){return this.project.data.width/this.project.data.height*e*e/1e6}guessExportFileSizeInM(e,t){let r=this.getVideoBitrateInM(e,t)*this.project.data.duration/8;return(0,a.toDecimal)((0,a.toPrecision)(r,2),0)}getVideoBitrateInM(e,t){let r=d[t],i=this.getEncodingPixelCountInM(e),s=(.3*i*i+2.26*i+.74)*Math.pow(2,(21-r)/6);return(0,a.toDecimal)(s,1)}saveEncodingSpeed(e){let{drawingAndEncodingTime:t}=this.guessBaseEncodingTimeInSeconds(e.options.height,e.options.frameRate,e.options.quality),r=(e.costSeconds.encoding+e.costSeconds.concat)/t;a.storage.set(this.storagePrefix+this.project.data.id,r)}}},5992:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isInViewport=t.getRect=t.getOuterHeight=t.getOuterWidth=t.getInnerHeight=t.getInnerWidth=t.getElementIndex=t.getNodeIndex=void 0;const i=r(6949);function a(e){if(e===document.documentElement){let e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;return{top:0,right:e,bottom:t,left:0,width:e,height:t}}{let t=e.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height}}}t.getNodeIndex=function(e){if(e.parentNode){let t=0;for(let r of e.parentNode.childNodes){if(r===e)return t;t++}}return-1},t.getElementIndex=function(e){if(e.parentNode){let t=0;for(let r of e.parentNode.children){if(r===e)return t;t++}}return-1},t.getInnerWidth=function(e){return e.clientWidth?e.clientWidth-i.getStyleAsNumber(e,"paddingLeft")-i.getStyleAsNumber(e,"paddingRight"):0},t.getInnerHeight=function(e){let t=e.clientHeight;return t?t-i.getStyleAsNumber(e,"paddingTop")-i.getStyleAsNumber(e,"paddingBottom"):0},t.getOuterWidth=function(e){let t=e.offsetWidth;return t?t+i.getStyleAsNumber(e,"marginLeft")+i.getStyleAsNumber(e,"marginRight"):0},t.getOuterHeight=function(e){let t=e.offsetHeight;return t?t+i.getStyleAsNumber(e,"marginTop")+i.getStyleAsNumber(e,"marginBottom"):0},t.getRect=a,t.isInViewport=function(e,t=.5){let r=document.documentElement.clientWidth,i=document.documentElement.clientHeight,s=a(e),n=Math.min(r,s.right)-Math.max(0,s.left),o=Math.min(i,s.bottom)-Math.max(0,s.top);if(n/Math.min(s.width,r)>t&&o/Math.min(s.height,i)>t){if(e.disabled)return!0;if(e.contains(document.elementFromPoint(s.left+s.width/2,s.top+s.height/2)))return!0}return!1}},6029:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MouseLeave=void 0,function(e){const t=new Set;function r(e){let r=function(e){let r=Array.isArray(e)?e:[e];for(let e of[...t].reverse())for(let t of r)if(e.els.some((e=>e.contains(t))))return e;return null}(e);return r&&r.lock(),()=>{r&&(r.unlock(),r=null)}}e.keep=r,e.inUse=function(e){for(let r of[...t].reverse())if(r.els.some((t=>t.contains(e))))return r.mouseIn;return!1},e.on=function(e,t,r){let a=new i(!1,e,t,r);return()=>a.cancel()},e.once=function(e,t,r){let a=new i(!0,e,t,r);return()=>a.cancel()};class i{constructor(e,i,a,s){this.mouseIn=!1,this.lockCount=0,this.delay=200,this.ended=!1,this.timer=null,this.isOnce=e,this.els=Array.isArray(i)?i:[i],this.callback=a,s&&Object.assign(this,s),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this);for(let e of this.els)e.addEventListener("mouseenter",this.onMouseEnter,!1),e.addEventListener("mouseleave",this.onMouseLeave,!1);this.unkeep=function(e){return r((Array.isArray(e)?e:[e]).map((e=>e.parentElement)).filter((e=>e&&e!==document.body)))}(i),t.add(this)}onMouseEnter(){this.mouseIn=!0,this.clearTimeout()}onMouseLeave(){this.mouseIn=!1,0===this.lockCount&&this.startTimeout()}startTimeout(){this.clearTimeout(),this.timer=setTimeout((()=>this.onTimeout()),this.delay)}onTimeout(){this.timer=null,this.mouseIn||this.flush()}clearTimeout(){this.timer&&(clearTimeout(this.timer),this.timer=null)}flush(){this.ended||(this.isOnce&&this.cancel(),this.callback())}cancel(){if(!this.ended){this.clearTimeout();for(let e of this.els)e.removeEventListener("mouseenter",this.onMouseEnter,!1),e.removeEventListener("mouseleave",this.onMouseLeave,!1);this.ended=!0,this.unkeep(),t.delete(this)}}lock(){this.clearTimeout(),this.lockCount++}unlock(){this.lockCount--,0===this.lockCount&&(this.mouseIn||this.flush())}}}(t.MouseLeave||(t.MouseLeave={}))},6030:(e,t)=>{function r(e){return/^\{flit:\d+\}$/.test(e)}function i(e){let t,r=/\{flit:(\d+)\}/g,i=[],a=[],s=0;for(;t=r.exec(e);)i.push(e.slice(s,t.index)),a.push(Number(t[1])),s=r.lastIndex;return i.push(e.slice(s)),{strings:i,valueIndexes:a}}Object.defineProperty(t,"__esModule",{value:!0}),t.splitByOrderedMarkers=t.parseOrderedMarkers=t.beOrderedMarker=t.containsOrderedMarker=t.joinWithOrderedMarkers=t.getStartTagOfTemplateResult=void 0,t.getStartTagOfTemplateResult=function(e){let t=e.strings[0].match(/<([\w-]+)/);return t?t[1]:null},t.joinWithOrderedMarkers=function(e,t=0){let r=e[0];for(let i=0;i<e.length-1;i++)r+=`{flit:${i+t}}`,r+=e[i+1];return r},t.containsOrderedMarker=function(e){return/\{flit:\d+\}/.test(e)},t.beOrderedMarker=r,t.parseOrderedMarkers=function(e){return r(e)?{strings:null,valueIndexes:[Number(e.match(/^\{flit:(\d+)\}$/)[1])]}:i(e)},t.splitByOrderedMarkers=i},6061:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceLoader=void 0;const i=r(1326),a=r(5499),s=r(1118),n=r(7928),o=r(3863),l=r(8524);t.ResourceLoader=class{project;resources=new Map;layerIdToPath=new Map;resourcePromises=new Map;resourceRejects=new Set;constructor(e,t){this.project=e,e.on("updatelayer",this.onUpdateLayer,this),e.on("updateproject",this.onUpdateProject,this),t.samplerManager.on("deletedata",(e=>{e instanceof Element||this.resourcePromises.delete(e)}))}onUpdateLayer(e){let t=e.id,r=e.path;r&&r!==this.layerIdToPath.get(t)&&(this.layerIdToPath.delete(t),this.validateResources())}async onUpdateProject(){this.validateResources()}async validateResources(){if(0===this.resources.size)return;let e=this.project.data.getAllPlainLayerDatas(),t=new Set;for(let r of e)r.path&&t.add(this.getLayerPath(r));for(let e of this.resources.keys())t.has(e)||(this.resources.delete(e),n.debug.verbose(`Released resource ${(0,s.getPathName)(e)}`))}getLayerPath(e){let t=e.path;if("object"==typeof t){let e=this.project.data.height,r=e*this.project.renderer.scaleRatio;"previewing"===this.project.mode&&(r=e/3);let i=Object.keys(t),s=i.map((e=>Number(e.slice(0,-1)))).map((e=>{let t=e/r;return t>=1?t-1:2*(1/t-1)}));t=t[i[(0,a.minIndex)(s)]]}return t=(0,s.isAbsolutePath)(t)?t:this.getAbsolutePath(t),this.layerIdToPath.set(e.id,t),(0,o.addTimestamp)(t)}getAbsolutePath(e){return new URL(this.project.rootDirectory+`/templates/${this.project.data.id}/${e}`,location.href).href}async loadImage(e){return this.loadResource(e,i.preloadImage)}async loadDecodedImage(e){return this.loadResource(e,l.decodeImageInWorker)}async loadVideo(e){return this.loadResource(e,i.preloadVideo)}async loadAudio(e){return this.loadResource(e,i.preloadAudio)}loadResource(e,t){return new Promise((async(r,i)=>{let a=this.getLayerPath(e);if(this.resources.has(a))return void r(this.resources.get(a));if(this.resourcePromises.has(a))return void r(this.resourcePromises.get(a));let o=t(a);this.resourcePromises.set(a,o),this.resourceRejects.add(i);let l=await o;this.resources.set(a,l),this.resourcePromises.delete(a),this.resourceRejects.delete(i),n.debug.verbose(`Loaded resource ${(0,s.getPathName)(a)}`),r(l)}))}clear(){this.resources.clear(),this.resourcePromises.clear(),this.resourceRejects.clear()}delete(){for(let e of this.resourceRejects)e("Deleted");this.clear()}}},6073:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Progress=void 0;const a=r(1416),s=r(8240),n=r(6585);let o=class extends a.Component{constructor(){super(...arguments),this.value=0,this.decimalCount=1}static style(){let{mainColor:e,adjust:t}=s.theme;return a.css`
		:host{
			display: inline-block;
			vertical-align: top;
			position: relative;
			width: ${t(200)}px;
			height: ${t(28)}px;
		}

		.groove{
			position: absolute;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			height: 1px;
			margin: auto 0;
			background: ${e.alpha(.2)};
		}

		.progress{
			height: 100%;
			background: ${e};
		}

		.tooltip{
			font-family: monospace;
		}
		`}render(){let e=n.tooltip(this.renderTooltipValue(),{alignTo:()=>this.refs.progress,alignPosition:"bc-tr",alignMargin:[8,0]});return a.html`
		<template ${e}>
			<div class="groove">
				<div class="progress" :ref="progress" :style.width.percent=${100*Math.min(this.value,1)}></div>
			</div>
		</template>
		`}renderTooltipValue(){let e=(100*Math.min(this.value,1)).toFixed(this.decimalCount)+"%";return a.html`<span class="${this.scopeClassName("tooltip")}">${e}</span>`}};o=i([a.define("f-progress")],o),t.Progress=o},6099:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPlayingAnimation=t.stopAnimation=t.animateToNextFrame=t.animateTo=t.animateFrom=t.animate=t.animateByFunction=t.animatePropertyTo=t.animatePropertyFrom=t.animateProperty=t.getEasing=t.getEasingFunction=t.defaultAnimationEasing=t.defaultAnimationDuration=void 0;const i=r(6949),a=r(774);t.defaultAnimationDuration=200,t.defaultAnimationEasing="ease-out-quad";const s=new WeakMap,n={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-quad":[.55,.085,.68,.53],"ease-in-cubic":[.55,.055,.675,.19],"ease-in-quart":[.895,.03,.685,.22],"ease-in-quint":[.755,.05,.855,.06],"ease-in-sine":[.47,0,.745,.715],"ease-in-expo":[.95,.05,.795,.035],"ease-in-circ":[.6,.04,.98,.335],"ease-in-back":[.6,-.28,.735,.045],"ease-out-quad":[.25,.46,.45,.94],"ease-out-cubic":[.215,.61,.355,1],"ease-out-quart":[.165,.84,.44,1],"ease-out-quint":[.23,1,.32,1],"ease-out-sine":[.39,.575,.565,1],"ease-out-expo":[.19,1,.22,1],"ease-out-circ":[.075,.82,.165,1],"ease-out-back":[.175,.885,.32,1.275],"ease-in-out-quad":[.455,.03,.515,.955],"ease-in-out-cubic":[.645,.045,.355,1],"ease-in-out-quart":[.77,0,.175,1],"ease-in-out-quint":[.86,0,.07,1],"ease-in-out-sine":[.445,.05,.55,.95],"ease-in-out-expo":[1,0,0,1],"ease-in-out-circ":[.785,.135,.15,.86],"ease-in-out-back":[.68,-.55,.265,1.55]},o={linear:function(e){return e}};function l(e){return"linear"===e?o[e]:o[e]=function(e){let[t,r,i,a]=n[e],s=3*t-3*i+1,o=-6*t+3*i,l=3*t,c=3*r-3*a+1,d=-6*r+3*a,h=3*r;return function(e){if(0===e)return 0;if(1===e)return 1;let t=-e,r=0,i=1,a=(r+i)/2;for(;i-r>1e-4;)((s*a+o)*a+l)*a+t<0?r=a:i=a,a=(r+i)/2;return((c*a+d)*a+h)*a}}(e)}function c(e){return n.hasOwnProperty(e)?"cubic-bezier("+n[e].join(", ")+")":e}function d(e=t.defaultAnimationDuration,r=t.defaultAnimationEasing,i,a){let s=performance.now(),n=l(r),o=0,c=()=>{o=requestAnimationFrame((t=>{let r=(t-s)/e;if(r>=1)o=0,i(1),a&&a(!0);else{let e=n(r);i(e),c()}}))};return c(),()=>{o&&(cancelAnimationFrame(o),a&&a(!1))}}function h(e,r,a,s,n,o=t.defaultAnimationEasing){let l;return{promise:new Promise((t=>{l=d(n,o,(t=>{let n=a+(s-a)*t;"scrollTop"===r||"scrollLeft"===r?e[r]=n:i.setStyle(e,r,n)}),t)})),stop:l}}function u(e,r,i,n=t.defaultAnimationDuration,o=t.defaultAnimationEasing){if(!e.animate)return Promise.resolve(!1);f(e),r=a.normativeStyleObject(r),i=a.normativeStyleObject(i);let l=c(o),d=e.animate([r,i],{easing:l,duration:n});return s.set(e,d),new Promise((t=>{d.addEventListener("finish",(()=>{s.delete(e),t(!0)}),!1),d.addEventListener("cancel",(()=>{s.delete(e),t(!1)}),!1)}))}t.getEasingFunction=l,t.getEasing=c,t.animateProperty=h,t.animatePropertyFrom=function(e,r,a,s,n=t.defaultAnimationEasing){let o;return o="scrollTop"===r||"scrollLeft"===r?e[r]:i.getStyleAsNumber(e,r),h(e,r,a,o,s,n)},t.animatePropertyTo=function(e,r,a,s,n=t.defaultAnimationEasing){let o;return o="scrollTop"===r||"scrollLeft"===r?e[r]:i.getStyleAsNumber(e,r),h(e,r,o,a,s,n)},t.animateByFunction=function(e,r,i,a,s=t.defaultAnimationEasing){let n;return{promise:new Promise((t=>{n=d(a,s,(t=>{e(r+(i-r)*t)}),t)})),stop:n}},t.animate=u;const p={transform:"none"};function m(e,r,i=t.defaultAnimationDuration,a=t.defaultAnimationEasing){let s={},n=getComputedStyle(e);for(let e in r)s[e]=n[e]||p[e]||"0";return u(e,r,s,i,a)}function f(e){let t=s.get(e);t&&(t.cancel(),s.delete(e))}t.animateFrom=m,t.animateTo=async function(e,r,a=t.defaultAnimationDuration,s=t.defaultAnimationEasing){let n={},o=getComputedStyle(e),l=Object.assign({},r);for(let e in l)""===l[e]&&(l[e]=p[e]||"0");for(let e in r)n[e]=o[e]||p[e]||"0";let c=await u(e,n,l,a,s);return c&&i.setStyle(e,r),c},t.animateToNextFrame=function(e,r,i=t.defaultAnimationDuration,a=t.defaultAnimationEasing){if(!e.animate)return Promise.resolve(!1);f(e),"string"==typeof r&&(r=[r]);let s={},n=getComputedStyle(e);for(let e of r)s[e]=n[e];return new Promise((t=>{requestAnimationFrame((()=>{m(e,s,i,a).then(t)}))}))},t.stopAnimation=f,t.isPlayingAnimation=function(e){return!!s.get(e)}},6100:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeEllipseDrawer=void 0;const i=r(9573),a=r(6376),s=r(5305),n=r(9176),o=r(3481);class l extends i.VectorShapeBaseDrawer{fillToDrawType=o.ToDrawType.TriangleFan;checkIsDataDynamic(){return!!(0,a.isPropertyValueBeKeyFrames)(this.data.size)||super.checkIsDataDynamic()}update(){this.values=(0,a.getPropertyValues)(this.data,this.time,s.ShapeRectDefaultValues),super.update()}getFillCoords(){let e=this.getVertexCoords();return{coords:[[0,0],...e,e[0]]}}getStrokCoords(){let e=this.getVertexCoords(),t=this.strokeValues.strokeWidth;return{coords:(0,n.triangulatePolygonLine)(e,t,!0)}}getVertexCoords(){let e=[],t=this.values.size[0]/2,r=this.values.size[1]/2,i=Math.max(t,r),a=2/Math.sqrt(10*i);a=Math.PI/2/Math.round(Math.PI/2/a);for(let i=0;i<6.2832;i+=a)e.push([t*Math.cos(i),r*Math.sin(i)]);return e}}t.ShapeEllipseDrawer=l},6133:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectData=void 0;const i=r(7678),a=r(5499);t.ProjectData=class{id;name;cover;coverAtSecond;backCover;supportsSyntheticAspectRatios;width;height;duration;layers;compItems;compItemMap;startCompItemIds;layerRawOrder;constructor(e){this.setData(e)}get aspectRatio(){return this.width/this.height}setData(e){Object.assign(this,e),this.initializeIds(),this.initializeMediaProperties(),this.initializeCompItemMap(),this.initializeLayerRawOrder()}cloneData(){return(0,a.deepClone)((0,a.assign)({},this,["id","name","width","height","duration","layers","compItems"]))}initializeIds(){for(let e of this.getAllPlainLayerDatas()){if(e.id||(e.id=(0,i.generateUniqueID)()),e.rawId=e.id,e.effects)for(let t of e.effects)t.id=(0,i.generateUniqueID)();if("shape"===e.type){let t=e.layerStyle;t&&t.dropShadow&&(t.dropShadow.id=(0,i.generateUniqueID)())}}}initializeMediaProperties(){for(let e of this.getAllPlainLayerDatas())"video"!==e.type&&"image"!==e.type||(e.mediaWidth||(e.mediaWidth=e.width),e.mediaHeight||(e.mediaHeight=e.height),e.mediaPosition||(e.mediaPosition=[.5,.5]))}initializeCompItemMap(){this.compItemMap=new Map,this.startCompItemIds=new Set;for(let e of this.compItems)this.compItemMap.set(e.id,e),this.startCompItemIds.add(e.id)}initializeLayerRawOrder(){this.layerRawOrder=new Map;for(let e=0;e<this.layers.length;e++){let t=this.layers[e];this.layerRawOrder.set(t.rawId,e)}}getAllPlainLayerDatas(){let e=this.compItems.map((e=>e.layers)).flat();return[...this.layers,...e]}getCompItemFromId(e){return this.compItemMap.get(e)}getCompLayersFromId(e){return this.compItemMap.get(e).layers}deepCloneLayerData(e,t,r){return this.deepCloneLayerDataRecursively(e,t,r)}deepCloneLayerDataRecursively(e,t,r){return"composite"===e.type&&this.isLayerIncludeLayers(e,t)?this.deepCloneCompLayerDatas(e,t,r):this.cloneLayerData(e,r)}isLayerIncludeLayers(e,t){return"composite"===e.type?this.getCompItemFromId(e.compItemId).layers.some((e=>this.isLayerIncludeLayers(e,t))):t.includes(e.id)}deepCloneCompLayerDatas(e,t,r){let a=this.getCompItemFromId(e.compItemId),s=this.cloneLayerData(e,r);if(r.has(a.id))return s.compItemId=r.get(a.id),s;let n=Object.assign({},a);n.id=(0,i.generateUniqueID)(),s.compItemId=n.id,r.set(a.id,n.id),n.layers=a.layers.map((e=>{let i=this.deepCloneLayerDataRecursively(e,t,r);return r.set(e.id,i.id),"composite"===i.type&&r.set(e.compItemId,i.compItemId),i}));for(let e of n.layers)e.parentId&&(e.parentId=r.get(e.parentId));return this.compItemMap.set(n.id,n),this.compItems.push(n),s}cloneLayerData(e,t){let r=(0,a.deepClone)(e);return r.id=(0,i.generateUniqueID)(),r.rawId=e.rawId,t&&t.set(e.id,r.id),r}insertRootLayerData(e){this.layers.push(e)}orderRootLayerData(){this.layers.sort(((e,t)=>{let r=this.layerRawOrder.get(e.rawId),i=this.layerRawOrder.get(t.rawId);return r===i?e.inPoint-t.inPoint:r-i}))}ensureTimeRemap(e){if(("video"===e.type||"composite"===e.type)&&!e.timeRemap){let{inPoint:t,outPoint:r}=e;e.timeRemap=[{time:t,value:0},{time:r,value:r-t}]}}clearUnReferencedCompItems(){let e=this.getAllPlainLayerDatas().filter((e=>"composite"===e.type)),t=new Set(e.map((e=>e.compItemId))),r=new Set;for(let e of this.compItemMap.keys())t.has(e)||this.startCompItemIds.has(e)||(this.compItemMap.delete(e),r.add(e));this.compItems=this.compItems.filter((e=>!r.has(e.id)))}}},6147:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"smoothRange",desc:"Smooth Range",min:0,max:1,step:.01,value:.1}];(0,r(4062).extendTransitions)({"mask-black-first":{uniformSlides:i,steps:[{fragShaderName:"mask-black-first"}]},"mask-white-first":{uniformSlides:i,steps:[{fragShaderName:"mask-white-first"}]},"mask-perlin":{uniformSlides:[...i,{name:"noiseRadius",desc:"Noise Radius",min:0,max:1,step:.01,value:.1},{name:"noiseOffset",desc:"Noise Offset",min:0,max:100,step:1,value:0}],steps:[{fragShaderName:"mask-perlin"}]}})},6169:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 source = texture(iChannel[0], textureCoord0);\nvec4 dest = texture(iChannel[1], textureCoord1);\nreturn dest * (1.0 - source.a) + (dest * source.a + source - dest * source);\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},6218:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.queueEvery=t.queueSome=t.queueMap=t.queueEach=t.Queue=t.QueueState=void 0;const i=r(8038),a=r(4915);var s;!function(e){e[e.Pending=0]="Pending",e[e.Running=1]="Running",e[e.Paused=2]="Paused",e[e.Finish=3]="Finish",e[e.Aborted=4]="Aborted"}(s=t.QueueState||(t.QueueState={}));class n extends a.Emitter{constructor(e){super(),this.key=null,this.concurrency=5,this.continueOnError=!1,this.maxRetryTimes=0,this.tasks=[],this.state=s.Pending,this.keysFound=null,this.seed=1,this.handledCount=0,this.runningItems=[],this.failedItems=[],this.resumePromise=null,this.resumeResolve=null,i.assign(this,e,Object.keys(e).filter((e=>"tasks"!==e))),this.key&&(this.keysFound=new Set),e.tasks&&this.push(...e.tasks)}getTotalCount(){return this.getHandledCount()+this.getUnhandledCount()+this.getFailedCount()}getHandledCount(){return this.handledCount}getUnhandledCount(){return this.tasks.length+this.getRunningCount()}getRunningCount(){return this.runningItems.length}getFailedCount(){return this.failedItems.length}getUnhandledTasks(){return[...this.getRunningTasks(),...this.tasks]}getRunningTasks(){return this.runningItems.map((e=>e.task))}getFailedTasks(){return this.failedItems.map((e=>e.task))}start(){return this.state===s.Paused?this.resume():this.tasks.length>0?(this.state=s.Running,this.mayHandleNextTask()):Promise.resolve().then((()=>this.onFinish())),this.state===s.Running}untilFinish(){return this.getUnhandledCount()>0?new Promise(((e,t)=>{this.once("end",(r=>r?t(r):e()))})):Promise.resolve()}pause(){return this.state===s.Running&&(this.state=s.Paused,this.resumePromise=new Promise((e=>{this.resumeResolve=()=>{this.resumeResolve=null,this.resumePromise=null,e()}})),this.emit("pause"),!0)}resume(){return this.state===s.Paused&&(this.state=s.Running,this.resumeResolve&&this.resumeResolve(),this.emit("resume"),this.mayHandleNextTask(),!0)}mayHandleNextTask(){if(this.state===s.Running){for(;this.getRunningCount()<this.concurrency&&this.tasks.length>0;){let e=this.tasks.shift();this.handleItem({id:this.seed++,task:e,retriedTimes:0,abort:null})}if(this.maxRetryTimes>0&&this.getRunningCount()<this.concurrency&&this.failedItems.length)for(let e=0;e<this.failedItems.length;e++){let t=this.failedItems[e];if(t.retriedTimes<this.maxRetryTimes&&(t.retriedTimes++,this.failedItems.splice(e--,1),this.handleItem(t),this.getRunningCount()>=this.concurrency))break}0===this.getRunningCount()&&this.onFinish()}}handleItem(e){let{task:t}=e,r=this.onItemFinish.bind(this,e),i=this.onItemError.bind(this,e);this.runningItems.push(e);let a=this.handler(t);a&&"object"==typeof a&&a.promise instanceof Promise&&"function"==typeof a.abort?(a.promise.then(r,i),e.abort=a.abort):a instanceof Promise?a.then(r,i):Promise.resolve().then((()=>r(a)))}async onItemFinish(e,t){await this.prepareItem(e),this.removeFromRunning(e)&&(this.handledCount++,this.state===s.Running&&(this.emit("taskfinish",e.task,t),this.mayHandleNextTask()))}async onItemError(e,t){await this.prepareItem(e),this.removeFromRunning(e)&&(this.failedItems.push(e),this.emit("error",e.task,t),this.continueOnError||0!==this.maxRetryTimes?this.mayHandleNextTask():this.onFatalError(t))}async prepareItem(e){e.abort=null,this.resumePromise&&await this.resumePromise}removeFromRunning(e){let t=this.runningItems.findIndex((t=>t.id===e.id));return t>-1&&(this.runningItems.splice(t,1),!0)}onFinish(){this.state!==s.Pending&&this.state!==s.Running||(this.state=s.Finish,this.emit("finish"),this.emit("end",null))}onFatalError(e){this.abort(e)}retry(){let e=this.getFailedCount()>0;return e&&(this.tasks.push(...this.getFailedTasks()),this.failedItems=[]),this.start()&&e}abort(e="manually"){return(this.state===s.Running||this.state===s.Paused)&&(this.state=s.Aborted,this.failedItems.push(...this.runningItems),this.abortRunningItems(),this.emit("abort",e),this.emit("end",e),!0)}abortRunningItems(){this.runningItems.map((e=>this.abortItem(e))),this.runningItems=[]}abortItem(e){let{task:t,abort:r}=e;r&&r(),this.emit("taskabort",t)}clear(){return this.state!==s.Aborted&&(this.state=s.Finish,this.tasks=[],this.failedItems=[],this.handledCount=0,this.abortRunningItems(),this.emit("finish"),this.emit("end"),this.resumeResolve&&this.resumeResolve(),!0)}clearNotRunning(){this.tasks=[],this.failedItems=[],this.handledCount=0}push(...e){if(this.keysFound)for(let t of e)this.keysFound.add(t[this.key]);this.tasks.push(...e),this.state===s.Finish&&this.start(),this.mayHandleNextTask()}unshift(...e){if(this.keysFound)for(let t of e)this.keysFound.add(t[this.key]);this.tasks.unshift(...e),this.state===s.Finish&&this.start(),this.mayHandleNextTask()}has(e){return!!this.keysFound&&this.keysFound.has(e[this.key])}add(...e){(e=e.filter((e=>!this.has(e)))).length>0&&this.push(...e)}addToStart(...e){(e=e.filter((e=>!this.has(e)))).length>0&&this.unshift(...e)}find(e){let t=this.runningItems.find((t=>e(t.task)));return t?t.task:(t=this.failedItems.find((t=>e(t.task))),t?t.task:this.tasks.find((t=>e(t)))||void 0)}remove(...e){let t=new Set(e);return this.removeWhere((e=>t.has(e)))}removeWhere(e){let t=[];return this.runningItems=this.runningItems.filter((r=>!e(r.task)||(t.push(r.task),!1))),this.failedItems=this.failedItems.filter((r=>!e(r.task)||(t.push(r.task),!1))),this.tasks=this.tasks.filter((r=>!e(r)||(t.push(r),!1))),this.mayHandleNextTask(),t}}function o(e,t,r){return new Promise(((i,a)=>{let s=new n({concurrency:r,tasks:e,handler:t});s.on("taskfinish",((e,t)=>{t&&(i(!0),s.clear())})),s.on("finish",(()=>i(!1))),s.on("error",a),s.start()}))}t.Queue=n,t.queueEach=function(e,t,r){return new Promise(((i,a)=>{let s=new n({concurrency:r,tasks:e,handler:t});s.on("finish",i),s.on("error",a),s.start()}))},t.queueMap=function(e,t,r){return new Promise(((i,a)=>{let s=[],o=e.map(((e,t)=>({task:e,index:t}))),l=new n({concurrency:r,tasks:o,handler:async({task:e,index:r})=>{s[r]=await t(e)}});l.on("finish",(()=>i(s))),l.on("error",a),l.start()}))},t.queueSome=o,t.queueEvery=function(e,t,r){return o(e,(async e=>!await t(e)),r).then((e=>!e))}},6268:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaskEffect=void 0;const i=r(8341),a=r(6339),s=r(4118),n=r(8712),o=r(5305);class l extends i.Effect{async initialize(){let e=this.data.trackMatteType||o.EffectMaskDefaultValues.trackMatteType,t="ALPHA_INVERTED"===e||"LUMAINANCE_INVERTED"===e;this.toDraw=new a.ToDrawEffect({renderer:this.renderer,fragCode:"ALPHA"==e?s.default:n.default}),this.toDraw.setUniform("inverted",t)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.MaskEffect=l},6269:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.alignToEvent=t.getMainAlignDirection=t.Aligner=t.align=void 0;const i=r(6949),a=r(5992),s=r(774);t.align=function(e,t,r,i={}){new n(e,t,r,i)};class n{constructor(e,t,r,i={}){this.triangleRect=null,this.x=0,this.y=0,this.el=e,this.target=t,this.triangle=i.triangle||null,this.canShrinkInY=!!i.canShrinkInY,this.fixTriangle=!!i.fixTriangle,this.triangle&&(this.triangle.style.transform="",this.triangleRect=this.triangle?a.getRect(this.triangle):null),this.rect=a.getRect(this.el),this.position=o(r),this.direction=this.getDirections(),this.margin=this.parseMargin(i.margin||0),this.targetRect=this.getExtendedRect(),this.targetInViewport=function(e){let t=document.documentElement.clientWidth,r=document.documentElement.clientHeight;return e.left<t&&e.right>0&&e.top<r&&e.bottom>0}(this.targetRect),this.canShrinkInY&&!this.triangle&&(this.rect.height=this.getNaturalHeight()),this.align()}align(){s.getClosestFixedElement(this.target)&&(this.el.style.position="fixed");let e=this.getElRelativeAnchor(),t=this.getTargetAbsoluteAnchor();if(this.y=t[1]-e[1],this.alignVertical()&&(this.rect=a.getRect(this.el),e=this.getElRelativeAnchor()),this.x=t[0]-e[0],this.alignHerizontal(),this.triangle&&this.alignTriangle(),"fixed"!==getComputedStyle(this.el).position&&this.target!==document.body&&this.target!==document.documentElement){var r=this.el.offsetParent;if(r){var i=r.getBoundingClientRect();this.x-=i.left,this.y-=i.top}}this.el.style.left=this.x+"px",this.el.style.top=this.y+"px"}getDirections(){return{top:this.position[0].includes("b")&&this.position[1].includes("t"),right:this.position[0].includes("l")&&this.position[1].includes("r"),bottom:this.position[0].includes("t")&&this.position[1].includes("b"),left:this.position[0].includes("r")&&this.position[1].includes("l")}}parseMargin(e){let t=[];return"number"==typeof e?(t[0]=this.direction.top||this.direction.bottom?e:0,t[1]=this.direction.left||this.direction.right?e:0):t.push(...e),t[0]=t[0]||0,t[1]=void 0!==t[1]?t[1]||0:t[0],t[2]=void 0!==t[2]?t[2]||0:t[0],t[3]=void 0!==t[3]?t[3]||0:t[1],this.triangleRect&&((this.direction.top||this.direction.bottom)&&(t[0]+=this.triangleRect.height,t[2]+=this.triangleRect.height),(this.direction.left||this.direction.right)&&(t[1]+=this.triangleRect.width,t[3]+=this.triangleRect.width)),t}getExtendedRect(){let e=a.getRect(this.target);return e.top-=this.margin[0],e.height+=this.margin[0]+this.margin[2],e.bottom=e.top+e.height,e.left-=this.margin[3],e.width+=this.margin[1]+this.margin[3],e.right=e.left+e.width,e}getNaturalHeight(){let e=this.rect.height,t=this.el.scrollHeight-this.el.clientHeight;return t<=(this.triangleRect?this.triangleRect.height:0)&&(t=Math.max(...[...this.el.children].map((e=>e.scrollHeight-e.clientHeight)))),t>0?e+=t:(this.el.style.height="",e=this.el.offsetHeight),e}getElRelativeAnchor(){let e=this.rect,t=this.position[0],r=t.includes("l")?0:t.includes("r")?e.width:e.width/2,i=t.includes("t")?0:t.includes("b")?e.height:e.height/2;return this.fixTriangle&&this.triangleRect&&((this.direction.top||this.direction.bottom)&&"c"===this.position[1][1]?r=this.triangleRect.left+this.triangleRect.width/2-e.left:(this.direction.left||this.direction.right)&&"c"===this.position[1][0]&&(i=this.triangleRect.top+this.triangleRect.height/2-e.top)),[r,i]}getTargetAbsoluteAnchor(){let e=this.targetRect,t=this.position[1],r=t.includes("l")?0:t.includes("r")?e.width:e.width/2,i=t.includes("t")?0:t.includes("b")?e.height:e.height/2;return r+=e.left,i+=e.top,[r,i]}alignVertical(){let e=document.documentElement.clientHeight,t=this.targetRect.top,r=e-this.targetRect.bottom,i=!1,a=this.rect.height,s=this.y;if(this.targetInViewport){if(this.direction.top||this.direction.bottom)this.direction.top&&s<0&&t<r?(s=this.targetRect.bottom,this.direction.top=!1,this.direction.bottom=!0):s+a>e&&t>r&&(s=this.targetRect.top-a,this.direction.top=!0,this.direction.bottom=!1);else{if(s+a>e){let t=this.targetRect.top+this.margin[1]+(this.triangleRect?this.triangleRect.height:0)-a;s=Math.max(e-a,t)}if(s<0){let e=this.targetRect.bottom-this.margin[2]-(this.triangleRect?this.triangleRect.height:0);s=Math.min(0,e)}}s<0?this.direction.top&&this.canShrinkInY&&(s=0,this.el.style.height=t+"px",i=!0):this.direction.bottom&&s+a>e&&this.canShrinkInY&&(this.el.style.height=r+"px",i=!0),this.y=s}return i}alignHerizontal(){let e=document.documentElement.clientWidth,t=this.targetRect.left,r=e-this.targetRect.right,i=this.rect.width,a=this.x;if(this.targetInViewport){if(this.direction.left||this.direction.right)this.direction.left&&a<0&&t<r?(a=this.targetRect.right,this.direction.left=!1,this.direction.right=!0):this.direction.right&&a>e-i&&t>r&&(a=this.targetRect.left-i,this.direction.left=!0,this.direction.right=!1);else{if(a+i>e){let t=this.targetRect.left+this.margin[3]+(this.triangleRect?this.triangleRect.width:0)-i;a=Math.max(e-i,t)}if(a<0){let e=this.targetRect.right-this.margin[1]-(this.triangleRect?this.triangleRect.width:0);a=Math.min(0,e)}}this.x=a}}alignTriangle(){let e=this.triangle,t=this.triangleRect,r=[],i=this.rect.width,a=this.rect.height;if(this.direction.top?(e.style.top="auto",e.style.bottom=-t.height+"px",r.push("rotateX(180deg)")):this.direction.bottom?(e.style.top=-t.height+"px",e.style.bottom=""):this.direction.left?(e.style.left="auto",e.style.right=-t.width+"px",r.push("rotateY(180deg)")):this.direction.right&&(e.style.left=-t.width+"px",e.style.right=""),this.direction.top||this.direction.bottom){let a,s=t.width/2;a=(i>=this.targetRect.width||this.fixTriangle)&&"c"===this.position[1][1]?this.targetRect.left+this.targetRect.width/2-this.x-s:i/2-s,a=Math.max(a,s),a=Math.min(a,this.rect.width-t.width-s),this.fixTriangle?(a-=t.left-this.rect.left,r.push(`translateX(${a}px)`)):e.style.left=a+"px",e.style.right=""}if(this.direction.left||this.direction.right){let i,s=t.height/2;i=(a>=this.targetRect.height||this.fixTriangle)&&"c"===this.position[1][0]?this.targetRect.top+this.targetRect.height/2-this.y-s:a/2-s,i=Math.max(i,s),i=Math.min(i,this.rect.height-t.height-s),this.fixTriangle?(i-=t.top-this.rect.top,r.push(`translateY(${i}px)`)):e.style.top=i+"px",e.style.bottom=""}e.style.transform=r.join(" ")}}function o(e){const t={t:"b",b:"t",c:"c",l:"r",r:"l"};if(!/^(?:[tbc][lrc]-[tbc][lrc]|[tbclr]-[tbclr]|[tbc][lrc]|[tbclr])/.test(e))throw`"${e}" is not a valid position`;1===e.length?e="tb".includes(e)?t[e]+"c-"+e+"c":"c"+t[e]+"-c"+e:2===e.length&&(e="tb".includes(e[0])?t[e[0]]+e[1]+"-"+e:e[1]+t[e[0]]+"-"+e[1]+e[0]);let r=e.split("-");return[l(r[0]),l(r[1])]}function l(e){return 1===e.length&&(e="tb".includes(e)?e+"c":"c"+e),e}t.Aligner=n,t.getMainAlignDirection=function(e){let t=e.length<5?o(e):e;return t[0].includes("b")&&t[1].includes("t")?"t":t[0].includes("l")&&t[1].includes("r")?"r":t[0].includes("t")&&t[1].includes("b")?"b":t[0].includes("r")&&t[1].includes("l")?"l":"cc"===t[0]&&"cc"===t[1]?"c":""},t.alignToEvent=function(e,t,r=[0,0]){if("fixed"!==i.getStyle(e,"position"))throw new Error('Element to call "alignToEvent" must be fixed layout');let a=document.documentElement.clientWidth,s=document.documentElement.clientHeight,n=e.offsetWidth,o=e.offsetHeight,l=t.clientX,c=t.clientY,d=l+r[0],h=c+r[1];d+n>a&&(d=a-n),h+o>s&&(h=s-o),e.style.left=Math.round(d)+"px",e.style.top=Math.round(h)+"px"}},6318:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SceneEditor=void 0;const i=r(5499),a=r(8783),s=r(4411),n=r(8470),o=r(4975),l=r(3190);t.SceneEditor=class{project;scenes=[];userAudioData=null;ready;loopScenes;layerRawIndex;constructor(e,t=null){this.project=e,this.parseScenes(),this.ready=this.initialize(t)}async initialize(e=null){e?await this.loadUserSceneData(e,!1,(()=>{})):await this.ensureSceneMediaInfoDatas((()=>{}))}parseScenes(){let e=(0,s.getReplacableMediaDeepLayers)(this.project),t=(0,s.getEditableTextDeepLayers)(this.project),r=[],a=new Set,o=new Set([...e.map((e=>e.root.id)),...t.map((e=>e.root.id))]);for(let i=0;i<e.length;i++){let l=e[i],c=(0,s.getMaxCrossLayerIndex)(l,t),d=c>=0?t[c]:null,h=(0,s.getCrossedRootLayers)(this.project,l.root,o),u=new n.Scene(this.project,l,d,h);r.push(u),d&&a.add(d)}for(let e of t)if(!a.has(e)){let t=(0,s.getCrossedRootLayers)(this.project,e.root,o),i=new n.Scene(this.project,null,e,t);r.push(i)}(0,i.orderBy)(r,(e=>e.main.root.inPoint));for(let e=1;e<r.length;e++){let t=r[e],i=r[e-1];t.marginLeft=t.main.root.inPoint-i.main.root.outPoint}if(r[1].marginLeft!==r[2].marginLeft){let e=r[2].marginLeft-r[1].marginLeft;r[1].marginLeft+=e,r[0].marginRight-=e}for(let e of r)e.initializeAfterAllScenesCreated();this.parseLoopScenes(r)}parseLoopScenes(e){let t=e.slice(1,-1),r=t.map((e=>e.clone()));e.splice(1,t.length,...r);for(let e of r)e.insertToProject();for(let e of t)e.remove();this.project.data.orderRootLayerData(),this.loopScenes=t,this.scenes=e}async ensureSceneMediaInfoDatas(e){e(0,this.scenes.length);for(let t=0;t<this.scenes.length;t++){let r=this.scenes[t];await r.ensureMediaInfoDatas(),e(t+1,this.scenes.length)}}appendScene(e){e.insertToProject(),this.scenes.splice(this.scenes.length-1,0,e),this.adjustScenesPoints(),this.adjustDuration(),this.project.data.orderRootLayerData()}adjustScenesPoints(){for(let e=1;e<this.scenes.length;e++){let t=this.scenes[e],r=this.scenes[e-1];t.moveTimeToBeAfter(r)}}adjustDuration(){let e=this.scenes[this.scenes.length-1].main.root.outPoint,t=e-this.project.data.duration,r=this.project.footages.getLoopLayerDatas();for(let i of r)i.outPoint=e,"audio"===i.type&&(0,s.moveLayerTimeProperties)(i,t);this.project.data.duration=e}getActiveSceneAtTime(e){return this.scenes.find((t=>t.main.root.inPoint<=e&&t.main.root.outPoint>=e))||null}getLayerRawIndex(e){return this.layerRawIndex.get(e.rawId)}moveSceneTo(e,t){let r=this.scenes.indexOf(e),i=Math.min(r,t),a=Math.max(r,t),s=this.scenes.slice(i,a+1),n=s.map((e=>e.info)),o=s.every((e=>e.canSetDuration));for(let e=0;e<s.length;e++){let i,a=s[e];i=r<t?(e+1+s.length)%s.length:(e-1+s.length)%s.length,a.setInfo(n[i],o)}return this.adjustScenesPoints(),s}removeScene(e){let t=this.scenes.indexOf(e),r=[];r=t===this.scenes.length-1?this.scenes.slice(this.scenes.length-2,this.scenes.length).reverse():this.scenes.slice(t,this.scenes.length-1);let i=r.map((e=>e.info));for(let e=0;e<r.length;e++){let t=r[e],a=(e+1)%r.length;t.setInfo(i[a])}let a=this.scenes[this.scenes.length-2];a.setInfo(i[0]),a.remove(),this.scenes.splice(this.scenes.length-2,1),this.adjustScenesPoints(),this.adjustDuration(),this.project.data.clearUnReferencedCompItems()}async uploadMedias(e){let t=await(0,i.selectMultipleFile)(a.Footages.GraphicFileAccepts);if(!t)return 0;e(0,t.length);let r=this.scenes[this.scenes.length-1],s=this.scenes.filter((e=>e.media&&!e.info.replaced&&e!==r)),n=r.info.replaced?this.scenes[this.scenes.length-1].info:null;for(let i=0;i<t.length;i++){let a=t[i];a=await(0,l.fixJPEGOrientation)(a);try{if(s.length>0){let e=s.shift();await e.setMediaFile(a)}else n&&(this.addSceneFromInfo(n),n=null,r.info=new o.LocalSceneInfo),i===t.length-1&&r.media?await r.setMediaFile(a):await this.addSceneFromMedia(a)}catch(e){console.error(e)}e(i+1,t.length)}return this.adjustScenesPoints(),this.adjustDuration(),t.length}async addSceneFromMedia(e){let t=this.getNextLoopScene().clone();await t.setMediaFile(e),this.appendScene(t)}async addSceneFromInfo(e){let t=this.getNextLoopScene().clone();t.setInfo(e,!1),this.appendScene(t)}getNextLoopScene(){let e=(this.scenes.length-2)%this.loopScenes.length;return this.loopScenes[e]}async changeSceneMedia(e){let t=await(0,i.selectFile)(a.Footages.GraphicFileAccepts);t&&(await e.setMediaFile(t),this.adjustScenesPoints(),this.adjustDuration())}setSceneDuration(e,t){e.setDuration(t),this.adjustScenesPoints(),this.adjustDuration()}resetSceneDuration(e){e.resetDuration(),this.adjustScenesPoints(),this.adjustDuration()}canAdjustSomeSceneDurations(){return this.scenes.slice(1,-1).some((e=>e.canSetDuration&&"video"!==e.info.mediaType))}canNeverAdjustAllSceneDurations(){return!this.scenes.every((e=>e.canSetDuration))}canAdjustAllSceneDurations(){return this.scenes.every((e=>e.canSetDuration&&"video"!==e.info.mediaType))}getAdjustableDuration(){let e=0,t=0;for(let r of this.scenes)"image"===r.info.mediaType&&r.canSetDuration&&(t++,e+=r.getDuration());return{count:t,duration:e,unAdjustableCount:this.scenes.length-t}}getAverageLoopSceneStartDuration(){return(0,i.avg)(this.loopScenes.map((e=>e.startDuration)))}getMinimumLoopSceneStartDuration(){return Math.min(...this.loopScenes.map((e=>e.startDuration)))}adjustScenesDuration(e){let t=this.project.data.duration,r=this.getAdjustableDuration().duration,a=(e-(t-r))/r;for(let e of this.scenes)if("image"===e.info.mediaType&&e.canSetDuration){let t=(0,i.toDecimal)(e.getDuration()*a,2);e.setDuration(t)}this.adjustScenesPoints(),this.adjustDuration()}resetTotalDuration(){for(let e of this.scenes)e.resetDuration();this.adjustScenesPoints(),this.adjustDuration()}async changeMusic(){let e=await(0,i.selectFile)(a.Footages.AudioFileAccepts);if(!e)return;let t=this.project.footages.getReplaceableAudioLayerData();t.name=e.name,t.path=URL.createObjectURL(e);let r=await this.project.resourceLoader.loadAudio(t);t.duration=r.duration,this.userAudioData={name:e.name,path:URL.createObjectURL(e),duration:r.duration}}setDurations(e){for(let t=0;t<this.scenes.length;t++)this.scenes[t].setDuration(e[t]);this.adjustScenesPoints(),this.adjustDuration()}async reset(e){for(let e of this.scenes)e.removeInfo();this.userAudioData=null,this.parseScenes(),await this.ensureSceneMediaInfoDatas(e)}setBunchFontFamily(e,t){for(let r of this.getBunchScenes(e))r.setFontFamily(t,r===e)}setBunchFontStyle(e,t){for(let r of this.getBunchScenes(e))r.setFontStyle(t,r===e)}setBunchFontSize(e,t){for(let r of this.getBunchScenes(e))r.setFontSize(t,r===e)}setBunchFillColor(e,t){for(let r of this.getBunchScenes(e))r.setFillColor(t,r===e)}getBunchScenes(e){let t=[...this.scenes,...this.loopScenes].filter((t=>t.startFontFamily===e.startFontFamily)).filter((t=>t===e||!t.info.touched)),r=t.indexOf(e);return t.slice(r)}async loadUserSceneData(e,t,r){let i=e.sceneInfos,a=e.audio,s=this.scenes.filter((e=>t||e.media)),n=this.scenes[this.scenes.length-1],o=n===s[s.length-1];o&&s.pop();for(let e=0;e<i.length;e++){let r=i[e];if(s.length>0)s.shift().setUserInfo(r,t);else if(e===i.length-1&&o)n.setUserInfo(r,t);else{let e=this.getNextLoopScene().clone();e.setUserInfo(r,t),this.appendScene(e)}}if(a){this.userAudioData=a;let e=this.project.footages.getReplaceableAudioLayerData();Object.assign(e,a)}await this.ensureSceneMediaInfoDatas(r),this.adjustScenesPoints(),this.adjustDuration()}extractUserSceneData(){let e=[];for(let t of this.scenes)e.push(t.info.getUserSceneInfo());return{sceneInfos:e,audio:this.userAudioData}}extractLocalSceneData(){let e=[];for(let t of this.scenes)t.info.replaced&&e.push(t.info);return{sceneInfos:e,audio:this.userAudioData}}async reloadSceneData(e){let t=this.extractUserSceneData();this.parseScenes(),await this.loadUserSceneData(t,!0,e)}}},6339:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDrawEffect=void 0;const i=r(2440);class a extends i.ToDrawTransform{initializeUniforms(){super.initializeUniforms(),this.setUniform("effectOpacity",1)}}t.ToDrawEffect=a},6376:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resetStaticPropertyValuesCache=t.StaticPropertyValuesCacher=t.getMaxPropertyValue=t.isPropertyValueBeKeyFrames=t.doesDataHaveKeyframes=t.getComplexPropertyValues=t.getPropertyValue=t.getPropertyValues=void 0;const i=r(4173);function a(e,t,r){return n(e)?(0,i.ensureKeyframeClass)(e).get(t):void 0===e?r:e}function s(e){for(let t of Object.values(e))if(n(t))return!0;return!1}function n(e){return Array.isArray(e)&&"object"==typeof e[0]&&"number"==typeof e[0].time}t.getPropertyValues=function(e,t,r){let i={};if(!e)return r;for(let r of Object.keys(e)){let s=e[r];i[r]=a(s,t)}if(r)for(let e of Object.keys(r))void 0===i[e]&&(i[e]=r[e]);return i},t.getPropertyValue=a,t.getComplexPropertyValues=function(e,t){return n(e)?(0,i.ensureComplexKeyframeClass)(e).get(t):e},t.doesDataHaveKeyframes=s,t.isPropertyValueBeKeyFrames=n,t.getMaxPropertyValue=function(e,t){if(n(e)){let t=e.map((e=>e.value)).flat();return Math.max(...t)}return void 0===e?t:e};const o=[];t.StaticPropertyValuesCacher=class{map=new Map;constructor(){o.push(this)}has(e){return!!this.map.get(e)}get(e){return this.map.get(e)}set(e,t){this.map.has(e)||(s(e)?this.map.set(e,null):this.map.set(e,t))}reset(){this.map=new Map}},t.resetStaticPropertyValuesCache=function(){for(let e of o)e.reset()}},6412:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDrawFastBlur=void 0;const i=r(4557),a=r(3432),s=r(6413),n=r(5499),o=r(6339);class l extends o.ToDrawEffect{blurRadius;blurDimension=i.AEEffectGaussianBlurDimension.Both;constructor(e){super(Object.assign(e,{samplingCount:(0,n.constrain)(e.samplingCount,1,e.renderer.project.options.fastBlurSamplingCount)}))}initializeOptions(e){let t=e.iterateCount||1,r=this.getBestSamplingCount(e.samplingCount,t);(0,n.assignIf)(e,{fragCode:this.getFragCode(r)}),super.initializeOptions(e),this.iterateCount=t,this.samplingCount=r,this.setRepeatEdgePixels(!1)}getFragCode(e){let t=(1===e?[{x:0,p:1}]:(0,a.generate1DGaussBlurPriorities)(e)).map((({x:e,p:t})=>`\tcolor += sampling(iChannel[0], textureCoord + (${e}.0 + noiseValue) * d) * ${1===t?"1.0":t.toString()};`)).join("\n").replace(/\+(\s*)-/g,"-$1");return s.default.replace("float samplingCount = 1.0;",`float samplingCount = ${e}.0;`).replace("color += sampling(iChannel[0], textureCoord + (0.0 + noiseValue) * d);",t)}getBestSamplingCount(e,t){let r=e*Math.sqrt(1/t),i=Math.round(Math.log(r)/Math.log(2));return i=Math.max(i,0),Math.pow(2,i)}setBlurRadius(e){this.blurRadius=e}setBlurDimension(e){this.blurDimension=e}setRepeatEdgePixels(e){this.setUniform("repeatEdgePixels",e)}drawAsSampler(){return this.drawBlurInner(!0)}draw(){this.drawBlurInner(!1)}setInputPaintArea(e){let t=this.transformStatus.projectVector(this.blurRadius).multiplyScalar(Math.sqrt(this.iterateCount)),r=e.extend(...t.xy);super.setInputPaintArea(r)}drawBlurInner(e){let t=this.blurRadius.multiplyScalar(Math.sqrt(1/this.iterateCount)),r=this.getTotalIterateCount(t),i=null,a=this.transformStatus;this.initializeUniforms();for(let s=0;s<r;s++){s===r-1&&this.setTransformStatus(a);let n=this.getIterateBlurRadius(t,s);this.setUniform("blurRadius",n);let o=s<r-1||e?this.renderer.sw.textureFrameManager.requestFull():null;o&&o.active(),super.draw(),o&&o.deactive(),s<r-1?this.setMappedChannel(o.getMappedSampler()):(i=o,this.clearChannel())}return i?i.getMappedSampler():null}getTotalIterateCount(e){let t=this.blurDimension===i.AEEffectGaussianBlurDimension.Both?2:1;return 1===this.samplingCount||0===e.x&&0===e.y?1:this.iterateCount*t}getIterateBlurRadius(e,t){return this.blurDimension===i.AEEffectGaussianBlurDimension.Herizontal||this.blurDimension===i.AEEffectGaussianBlurDimension.Both&&t%2==0?[e.x,0]:[0,e.y]}}t.ToDrawFastBlur=l},6413:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform mat4 iSamplingTransform;\nuniform vec2 blurRadius;\nuniform bool repeatEdgePixels;\nfloat seedRandom2(vec2 v) {\nreturn fract(sin(dot(v, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat noise2(vec2 v) {\nvec2 i = floor(v);\nvec2 f = fract(v);\nvec2 u = f * f * (3.0 - 2.0 * f);\nfloat a = seedRandom2(i);\nfloat b = seedRandom2(i + vec2(1, 0));\nfloat c = seedRandom2(i + vec2(0, 1));\nfloat d = seedRandom2(i + vec2(1, 1));\nreturn mix(a, b, u.x) +\n(c - a)* u.y * (1.0 - u.x) +\n(d - b) * u.x * u.y;\n}\nfloat stepRange(float value, float minValue, float maxValue) {\nfloat diffToCenter = abs(value - (minValue + maxValue) / 2.0);\nfloat halfRange = (maxValue - minValue) / 2.0;\nreturn 1.0 - step(halfRange, diffToCenter);\n}\nvec4 sampling(sampler2D sampler, vec2 textureCoord) {\nvec4 color = texture(sampler, textureCoord);\nif (!repeatEdgePixels) {\ncolor *= stepRange(textureCoord.x, 0.0, 1.0) * stepRange(textureCoord.y, 0.0, 1.0);\n}\nreturn color;\n}\nvec4 getFragColor() {\nfloat samplingCount = 1.0;\nvec2 d = vec4(blurRadius * 2.0 / iVideoResolution, 0, 0).xy;\nd = (iSamplingTransform * vec4(d, 0, 0)).xy;\nd = (iChannelMap[0] * vec4(d, 0, 0)).xy;\nd /= samplingCount;\nvec4 color = vec4(0);\nfloat noiseValue = noise2(gl_FragCoord.xy * 2.0);\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\ncolor += sampling(iChannel[0], textureCoord + (0.0 + noiseValue) * d);\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}"},6456:(e,t)=>{function r(e,t,r,i){let[a,s]=e[t],[n,o]=e[r],l=n-a;for(let n=t+1;n<r;n++){let[t,r]=e[n],c=(t-a)/l,d=(1-c)*s+c*o;if(Math.abs(r-d)>i)return!1}return!0}function i(e,t,i,a){let s=t,n=i;for(;n-s>1;){let i=Math.round((s+n)/2);r(e,t,i,a)?s=i:n=i}return s}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleSamplingCoords=void 0,t.simpleSamplingCoords=function(e,t){if(e.length<=2)return e;let a=0,s=1,n=2,o=[e[0]];for(;;)if(r(e,a,n,t)){if(s=n,!(n<e.length-1))break;n=a+2*(n-a),n=Math.min(n,e.length-1)}else{if(s=i(e,s,n,t),!(s<e.length-1))break;if(o.push(e[s]),a=s,s=a+1,n=a+2,n>e.length-1)break}return o.push(e[e.length-1]),o}},6530:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contextmenu=t.ContextMenuBinding=void 0;const i=r(1416),a=r(5499);class s{constructor(e,t){this.popup=null,this.unwatchRect=null,this.unkeepEl=null,this.el=e,this.context=t,i.on(this.el,"contextmenu.prevent",this.showMenu,this)}async update(e){this.renderFn=e}async showMenu(e){let t=this.renderPopup();t.applyAppendTo(),await i.renderComplete(),a.alignToEvent(t.el,e),t.el.focus(),this.unkeepEl=a.MouseLeave.keep(this.el),new i.Transition(t.el,"fade").enter(),i.on(document,"mousedown",this.onDocMouseDown,this),i.once(t.el,"click",this.hideContextMenu,this),this.unwatchRect=a.watchLayout(this.el,"rect",this.onElRectChanged.bind(this))}renderPopup(){return this.popup||(this.popup=i.renderComponent(this.renderFn,this.context).component),this.popup}onDocMouseDown(e){let t=e.target;this.popup&&!this.popup.el.contains(t)&&this.hideContextMenu()}hideContextMenu(){this.popup&&(i.off(document,"mousedown",this.onDocMouseDown,this),i.off(this.popup.el,"click",this.hideContextMenu,this),new i.Transition(this.popup.el,"fade").leave().then((e=>{e&&(this.popup.el.remove(),this.popup=null)}))),this.unkeepEl&&(this.unkeepEl(),this.unkeepEl=null),this.unwatchRect&&(this.unwatchRect(),this.unwatchRect=null)}onElRectChanged(){this.hideContextMenu()}remove(){i.off(this.el,"contextmenu",this.showMenu,this)}}t.ContextMenuBinding=s,t.contextmenu=i.defineBinding("contextmenu",s)},6540:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionGenerator=void 0;const a=r(1416),s=r(8652),n=r(5499);let o=class extends a.Component{coords=n.storage.get("functionCoords",[]);generatedFn=e=>e;generatedFnDesc="y = x";xRange=[0,1];preferQuadratic=n.storage.get("preferQuadratic",!1);unEmptyCoordsCount=0;render(){return a.html`
		<template class="function-generator">
			${[0,1,2,3,4].map((e=>{let t=this.coords[e],r=t&&null!==t[0]&&void 0!==t[0]?String(t[0]):"",i=t&&null!==t[1]&&void 0!==t[1]?String(t[1]):"";return a.html`
				<f-row .gutter="24">
					<f-col .span="6">
						<span>x${e+1}:</span>
						<f-input .value=${r} @change=${t=>this.onInputChange(e,0,t?Number(t):null)} />
					</f-col>
					<f-col .span="6">
						<span>y${e+1}:</span>
						<f-input .value=${i} @change=${t=>this.onInputChange(e,1,t?Number(t):null)} />
					</f-col>
				</f-row>
				`}))}

			<div class="function-generator-switch-container">
				<f-switch class="function-generator-switch"
					:enable=${[3,4].includes(this.unEmptyCoordsCount)}
					.checked=${this.preferQuadratic}
					@change=${this.onChangePreferQuadratic} />
				优先使用一般二次曲线 (穿过 3 个或者 4 个点时有效)
			</div>

			<code class="function-generator-desc">${this.generatedFnDesc}</code>
			<function-curve .fn=${this.generatedFn} .xRange=${this.xRange} .width="200"></function-curve>
		</template>
		`}onCreated(){this.generateFn()}onInputChange(e,t,r){this.coords[e]=this.coords[e]||[],this.coords[e][t]=r,this.generateFn(),n.storage.set("functionCoords",this.coords)}onChangePreferQuadratic(e){n.storage.set("preferQuadratic",e),this.preferQuadratic=e,this.generateFn()}generateFn(){let e=[];for(let t of this.coords)null!==t[0]&&t[0]>-1/0&&null!==t[1]&&t[1]>-1/0&&e.push(t);if(e.length>=2){let t=[Math.min(...e.map((e=>e[0]))),Math.max(...e.map((e=>e[0])))];if(t[1]-t[0]==0)return;this.xRange=t,this.unEmptyCoordsCount=e.length,!this.preferQuadratic||3!==e.length&&4!==e.length?this.generatePolynomialFn(e):this.generateQuadraticFn(e)}}generatePolynomialFn(e){let t=e.map((([t])=>{let r=[];for(let i=e.length-1;i>=0;i--)r.push(Math.pow(t,i));return r})),r=new s.Matrix(t),i=new s.Matrix(e.map((e=>[e[1]]))),a=r.inverse().multiply(i).fix().data.map((e=>e[0]));this.generatedFn=t=>{let r=0,i=0;for(let s=e.length-1;s>=0;s--,i++)r+=a[i]*Math.pow(t,s);return r};let n="y = ",o=0;for(let t=e.length-1;t>=0;t--,o++){let e=a[o];n+=t>1?`${e} * x^${t} + `:t>0?`${e} * x + `:`${e}`}this.generatedFnDesc=n.replace(/\+ -/g,"-")}generateQuadraticFn(e){3===e.length?this.generateQuadraticFnFor3Coords(e):this.generateQuadraticFnFor4Coords(e)}generateQuadraticFnFor3Coords(e){let[[t,r],[i,a],[n,o]]=e,l=[[t*r,t,r,1],[i*a,i,a,1],[n*o,n,o,1]],c=new s.Matrix(l).solveHomogeneous().fix().data[0];if(!c)return;let[d,h,u,p]=c;this.generatedFn=e=>-(h*e+p)/(d*e+u),this.generatedFnDesc=`y = (${-h} * x + ${-p}) / (${d} * x + ${u})`.replace(/\+ -/g,"- ")}generateQuadraticFnFor4Coords(e){let[[t,r],[i,a],[n,o],[l,c]]=e,d=[[t*t,t*r,t,r,1],[i*i,i*a,i,a,1],[n*n,n*o,n,o,1],[l*l,l*c,l,c,1]],h=new s.Matrix(d).solveHomogeneous().fix().data[0];if(!h)return;let[u,p,m,f,g]=h;this.generatedFn=e=>-(u*e*e+m*e+g)/(p*e+f),this.generatedFnDesc=`y = (${-u} * x^2 + ${-m} * x + ${-g}) / (${p} * x + ${f})`.replace(/\+ -/g,"- ")}};t.FunctionGenerator=o,t.FunctionGenerator=o=i([(0,a.define)("function-generator")],o)},6551:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observePlainObjectTarget=void 0;const i=r(8546),a=r(8622);t.observePlainObjectTarget=function(e){let t=new Proxy(e,s);return a.proxyMap.set(e,t),a.proxyMap.set(t,t),a.targetMap.set(t,e),t};const s={get(e,t){let r=e[t];if(i.mayAddDependency(e),r&&"object"==typeof r){if(a.proxyMap.has(r))return a.proxyMap.get(r);if(i.isUpdating())return a.observeTarget(r)}return r},set:(e,t,r)=>(e[t]=r,i.notifyObjectSet(e),!0),has:(e,t)=>(i.mayAddDependency(e),t in e),deleteProperty:(e,t)=>!e.hasOwnProperty(t)||(i.mayAddDependency(e),delete e[t])}},6585:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooltip=t.TooltipBinding=void 0;const i=r(1416),a=r(8708),s=r(5499),n={name:"tooltip",alignPosition:"r",alignMargin:3,showDelay:0,hideDelay:200,type:"default"};class o extends a.PopupBinding{constructor(){super(...arguments),this.title=""}update(e,t={}){this.title=e,t.type&&["prompt","error"].includes(t.type)&&void 0===t.name&&(t.name=""),super.update(this.getRenderFn.bind(this),this.getPopupOptions(t))}async showPopupLater(){this.title&&await super.showPopupLater()}bindTrigger(){this.shouldAlwaysKeepVisible()?s.ensureWindowLoaded().then((()=>{this.showPopupLater()})):super.bindTrigger()}shouldAlwaysKeepVisible(){return["prompt","error"].includes(this.getOption("type"))}bindLeave(){"prompt"!==this.getOption("type")&&super.bindLeave()}onNotInViewport(){this.shouldAlwaysKeepVisible()||super.onNotInViewport()}getRenderFn(){return i.html`
			<f-tooltip
				.herizontal=${this.isHerizontal()}
				.type=${this.getOption("type")}
			>
				${this.title}
			</f-tooltip>
		`}getPopupOptions(e={}){return s.assignIf(e,n)}isHerizontal(){let e=s.getMainAlignDirection(this.options.get("alignPosition"));return"l"===e||"r"===e}}t.TooltipBinding=o,t.tooltip=i.defineBinding("tooltip",o)},6640:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PageDataCacher=void 0;const i=r(6925);t.PageDataCacher=class{constructor(e){this.map={},this.requestingMap=new Map,this.pageSize=e}setDataGetter(e){this.dataGetter=e}getExistingData(e,t){let r,a=Math.floor(e/this.pageSize),s=Math.floor((t-1)/this.pageSize),n=[],o=!0;for(let l=a;l<=s;l++){let c=this.map[l],d=c?c.items:r||(r=i.repeatValue(null,this.pageSize));c&&!c.fresh&&(o=!1),l===a&&l===s?n.push(...d.slice(e-a*this.pageSize,t-s*this.pageSize)):l===a?n.push(...d.slice(e-a*this.pageSize)):l===s?n.push(...d.slice(0,t-s*this.pageSize)):n.push(...d)}return r&&(o=!1),{data:n,fresh:o}}async getFreshData(e,t){let r=Math.floor(e/this.pageSize),i=Math.floor((t-1)/this.pageSize),a=[];for(let e=r;e<=i;e++){let t=this.map[e];t&&t.fresh||a.push(this.loadPageData(e))}return await Promise.all(a),this.getExistingData(e,t).data}loadPageData(e){if(this.requestingMap.has(e))return this.requestingMap.get(e);let t=this.dataGetter(e*this.pageSize,this.pageSize);if(t instanceof Promise){let r=t.then((t=>{this.map[e]={items:[...t],fresh:!0},this.requestingMap.delete(e)}));return this.requestingMap.set(e,r),r}return this.map[e]={items:[...t],fresh:!0},Promise.resolve()}moveData(e,t){0!==t&&(t>0?this.moveDataRight(e,t):this.moveDataLeft(e,-t))}moveDataRight(e,t){let r=Math.floor(e/this.pageSize),i=Object.keys(this.map).map(Number),a=-1,s=new Set;for(let n=i.length-1;n>=0;n--){let o=i[n];if(o<r)continue;s.add(o);let l=o+Math.floor(t/this.pageSize),c=o+Math.ceil(t/this.pageSize);if(c!==a){let r=c*this.pageSize-t;this.generateNewCacheItem(c,r,e,e)&&s.delete(c)}if(l!==c){let r=l*this.pageSize-t;this.generateNewCacheItem(l,r,e,e)&&s.delete(l)}a=l}a>r&&this.generateNewCacheItem(r,r*this.pageSize-t,e,e)&&s.delete(r);for(let e of s)delete this.map[e]}generateNewCacheItem(e,t,r,a){let s,n=Math.floor(r/this.pageSize),o=t+this.pageSize>a,l=e===n&&this.map[e]&&r>n*this.pageSize;if(!o&&!l)return!1;if(s=t<a?[...i.repeatValue(null,a-t),...this.getExistingData(a,t+this.pageSize).data]:this.getExistingData(t,t+this.pageSize).data,e===n){let e=r-n*this.pageSize;s=[...this.getExistingData(n*this.pageSize,r).data,...s.slice(e)]}return!!this.hasAnyItem(s)&&(this.map[e]={items:s,fresh:this.hasNoNull(s)},!0)}moveDataLeft(e,t){let r=Math.floor(e/this.pageSize),i=Object.keys(this.map).map(Number),a=-1,s=new Set;for(let n=0;n<i.length;n++){let o=i[n];if(o<r)continue;s.add(o);let l=o-Math.ceil(t/this.pageSize),c=o-Math.floor(t/this.pageSize);if(l>=0&&l!==a){let r=l*this.pageSize+t;this.generateNewCacheItem(l,r,e,e+t)&&s.delete(l)}if(c>=0&&c!==l){let r=c*this.pageSize+t;this.generateNewCacheItem(c,r,e,e+t)&&s.delete(c)}a=c}for(let e of s)delete this.map[e]}hasNoNull(e){return e.every((e=>null!==e))}hasAnyItem(e){return e.some((e=>null!==e))}clear(){this.map={}}beStale(){for(let e of Object.values(this.map))e.fresh=!1}}},6716:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Table=void 0;const a=r(1416),s=r(8240),n=r(5499),o=r(3345);let l=class extends a.Component{constructor(){super(...arguments),this.live=!1,this.pageSize=50,this.startIndex=0,this.preRendering=!1,this.resizable=!1,this.minColumnWidth=64,this.orderColumnName=null,this.orderDirection="",this.columnWidths=null,this.resizingColumnWidths=null,this.columnResized=!1,this.cachedTotalWidth=0,this.repeatDir=null}static style(){let{adjustFontSize:e,adjust:t,mainColor:r,textColor:i,backgroundColor:o}=s.theme,l=n.getScrollbarWidth();return a.css`
		:host{
			display: flex;
			flex-direction: column;
			height: 200px;
		}

		.head{
			padding-right: ${l}px;	// Same with defined scrollbar width.
			color: ${i.toMiddle(20)};
			font-size: ${e(13)}px;
			font-weight: bold;
			user-select: none;
		}

		.columns{
			display: flex;
		}

		.column{
			position: relative;
			display: flex;
			align-items: stretch;
			padding: 0 ${t(8)}px;
			border-bottom: 1px solid ${o.toMiddle(20)};

			&:last-child{
				flex: 1;
				min-width: 0;
				padding-right: ${l}px;
				margin-right: -${l}px;
			}
		}

		.column-left{
			display: flex;
			flex: 1;
			max-width: 100%;

			&:hover .order{
				visibility: visible;
			}
		}

		.column-title{
			flex: 0 1 auto;
			min-width: 0;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.column-ordered{
			border-bottom-color: ${o.toMiddle(40)};
		}

		.resizable .column-title{
			flex: 1;
		}

		.order{
			width: ${t(16)}px;
			display: flex;
			flex: none;
			margin-right: ${t(-8)}px;	// Gives 16 - 8 = 8px as cell padding-right.
			visibility: hidden;

			f-icon{
				margin: auto;
			}

			&.current{
				visibility: visible;
			}
		}

		.resizer{
			position: relative;
			z-index: 1;
			width: 17px;
			margin-left: auto;
			margin-right: ${t(-16)}px;
			cursor: e-resize;

			&::before{
				content: '';
				position: absolute;
				left: 8px;
				top: 6px;
				bottom: 6px;
				width: 1px;
				background: ${o.toMiddle(20)};
			}
		}

		.scroller{
			flex: 1;
			overflow-y: scroll;
			overflow-x: hidden;
		}

		.body{
			flex: 1;
			overflow-y: scroll;
			overflow-x: hidden;
			position: relative;
			border-bottom: 1px solid ${o.toMiddle(13)};
		}

		.rows{
			table-layout: fixed;
			position: absolute;
			width: 100%;
		}

		tr{
			&:hover{
				background: ${r.alpha(.05)};
			}

			&.selected{
				background: ${r.alpha(.1)};
			}

			&:last-child td{
				border-bottom-color: transparent;
			}
		}

		td{
			vertical-align: middle;
			padding: ${t(3)}px ${t(8)}px;
			border-bottom: 1px solid ${o.toMiddle(13)};
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			cursor: default;
		}

		f-checkbox{
			max-width: 100%;
			height: 100%;

			f-icon{
				margin-right: ${t(10)}px;
			}
		}

		.resizing-mask{
			position: fixed;
			z-index: 9999;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			cursor: ew-resize;
		}
		`}render(){return a.html`
		<div class="head" :ref="head">
			<div class="columns" :ref="columns">
				${this.renderColumns()}
			</div>
		</div>

		<div class="body">
			<table class="rows" :ref="table">
				<colgroup :ref="colgroup">
					${this.columns.map((e=>a.html`
						<col :style.text-align=${e.align||""} />
					`))}
				</colgroup>
				${this.renderRows()}
			</table>
		</div>
		`}renderColumns(){return this.columns.map(((e,t)=>{let r=this.orderColumnName===e.name,i="right"===e.align?"flex-end":"center"===e.align?"center":"";return a.html`
			<div class="column"
				:class.column-ordered=${r}
				@click=${e=>this.doOrdering(e,t)}
			>
				<div class="column-left" :style.justify-content=${i}>
					<div class="column-title">${e.title}</div>
					${e.orderBy?a.html`
						<div class="order" :class.current=${r&&""!==this.orderDirection}>
							<f-icon .type=${this.getOrderIcon(e.name)} />
						</div>`:""}
				</div>

				${this.resizable&&t<this.columns.length-1?a.html`
					<div class="resizer" @mousedown=${e=>this.onStartResize(e,t)} />`:""}
			</div>`}))}renderRows(){return this.store instanceof o.AsyncStore?a.refDirective(a.liveAsyncRepeat({key:this.store.key,pageSize:this.pageSize,startIndex:this.startIndex,preRendering:this.preRendering,dataCount:this.store.dataCount.bind(this.store),dataGetter:this.store.dataGetter.bind(this.store),onUpdated:this.onRepeatDataUpdated.bind(this)},this.renderRow.bind(this),this.transition),this.setRepeatDirective.bind(this)):this.live?a.refDirective(a.liveRepeat({pageSize:this.pageSize,startIndex:this.startIndex,preRendering:this.preRendering,data:this.store.currentData,onUpdated:this.onRepeatDataUpdated.bind(this)},this.renderRow.bind(this),this.transition),this.setRepeatDirective.bind(this)):a.repeat(this.store.currentData,this.renderRow.bind(this),this.transition)}renderRow(e,t){let r=this.columns.map((r=>{let i=e&&r.render?r.render(e,t):" ";return a.html`<td :style.text-align=${r.align||""}>${i}</td>`}));return a.html`<tr>${r}</tr>`}setRepeatDirective(e){this.repeatDir=e,this.store instanceof o.AsyncStore&&this.store.setRepeatDirective(e)}onRepeatDataUpdated(e,t){this.emit("livedataupdated",e,t)}getOrderIcon(e){if(e===this.orderColumnName){if("asc"===this.orderDirection)return"order-asc";if("desc"===this.orderDirection)return"order-desc"}return"order-default"}onCreated(){if(this.store instanceof o.AsyncStore)for(let e of this.columns)if(e.orderBy&&"string"!=typeof e.orderBy)throw new Error('"orderBy" in "columns" configuration must be string type when using "liveStore"');this.orderColumnName=this.store.orderName,this.orderDirection=this.store.orderDirection,this.store.on("orderchanged",this.onOrderChanged,this)}onReady(){a.onRenderComplete((()=>{this.updatColumnWidths()}))}onConnected(){this.watch((()=>a.observeGetter(this,"columns")),(async()=>{this.restoreOrderedColumn(),await a.renderComplete(),this.updatColumnWidthsRoughly()})),a.onRenderComplete((()=>{let e=n.watchLayout(this.el,"size",(()=>this.updatColumnWidths()));this.once("disconnected",e)}))}doOrdering(e,t){if(e.target.closest(this.scopeClassName(".resizer")))return;let r=this.columns[t];if(!r.orderBy)return;let i="",a=r.descFirst;i=r.name===this.orderColumnName?a?""===this.orderDirection?"desc":"desc"===this.orderDirection?"asc":"desc":""===this.orderDirection?"asc":"asc"===this.orderDirection?"desc":"asc":a?"desc":"asc",this.orderStore(r,i)}orderStore(e,t){""===t?this.store.clearOrder():this.store.setNamedOrder(e.name,e.orderBy||e.render,t),this.store.reload()}onOrderChanged(e,t=""){let r=this.columns,i=-1;for(let t=0;t<r.length;t++)if(r[t].name===e){i=t;break}i>-1?(this.orderColumnName=r[i].name,this.orderDirection=t):(this.orderColumnName="",this.orderDirection="")}restoreOrderedColumn(){this.orderColumnName&&-1===this.columns.findIndex((e=>e.name===this.orderColumnName))&&(this.orderColumnName="",this.orderDirection="")}updatColumnWidths(){let e=this.refs.head.clientWidth-n.getStyleAsNumber(this.refs.head,"paddingLeft")-n.getStyleAsNumber(this.refs.head,"paddingRight");this.cachedTotalWidth=e,this.updatColumnWidthsWithTotalWidth(e)}updatColumnWidthsRoughly(){this.updatColumnWidthsWithTotalWidth(this.cachedTotalWidth)}updatColumnWidthsWithTotalWidth(e){let t=function(e,t,r){if(t<r*e.length)return n.repeatTimes(t/e.length,e.length);let i=0,a=0,s=0,o=n.repeatTimes(r,e.length),l=new Set;for(let[t,r,n]of e)i+=t,a+=r,s+=n;for(0===a&&(a=e.length,e.forEach((e=>e[1]=1))),0===s&&(s=e.length,e.forEach((e=>e[2]=1)));;){let n=(t-i)/(t>=i?a:s),c=!1;for(let s=0;s<e.length;s++){if(l.has(s))continue;let[d,h,u]=e[s],p=n>=0?h:u,m=p*n+d;m<r?(t-=r,i-=r,a-=p,l.add(s),c=!0):o[s]=m}if(!c)break}return o}(this.columns.map((({flex:e,width:t},r)=>{let i=Math.max(t||0,this.minColumnWidth),a=this.columnResized?this.columnWidths[r]:i,s=0,n=0;if("string"==typeof e){let t=e.split(/\s+/).map(Number);s=t[0]>=0?t[0]:0,n=t[1]>=0?t[1]:s}else"number"==typeof e&&e>=0&&(s=n=e);return[a,s,n]})),e,this.minColumnWidth);this.columnWidths=t,this.setColumnWidths(t)}setColumnWidths(e){let t=n.sum(e);for(let r=0;r<e.length;r++){let i=r===e.length-1,a=e[r]/t;this.refs.colgroup.children[r].style.width=100*a+"%",i||(this.refs.columns.children[r].style.width=100*a+"%")}}onStartResize(e,t){let r=e.clientX,i=e=>{e.preventDefault(),this.resizeColumnByMovementX(e.clientX-r,t)},s=a.render(a.html`<div class="resizing-mask" />`,this).fragment.firstElementChild;document.body.append(s),a.on(document,"mousemove",i),a.once(document,"mouseup",(()=>{this.resizingColumnWidths&&(this.columnWidths=this.resizingColumnWidths,this.resizingColumnWidths=null),a.off(document,"mousemove",i),s.remove(),this.columnResized=!0}))}resizeColumnByMovementX(e,t){let r=[...this.columnWidths],i=Math.abs(e),a=e<0,s=a?t+1:t;for(let e=a?t:t+1;(a?e>=0:e<this.columns.length)&&i>0;a?e--:e++){let t=r[e],a=i;t-a<this.minColumnWidth&&(a=t-this.minColumnWidth),r[e]-=a,r[s]+=a,i-=a}this.resizingColumnWidths=r,this.setColumnWidths(r)}setStartIndex(e){let t=this.live||this.store instanceof o.AsyncStore;if(this.repeatDir)this.repeatDir.setStartIndex(e);else if(!t){e=Math.min(e,this.store.data.length-1);let t=this.refs.table.rows[e];t&&n.scrollToTop(t)}}scrollToViewIndex(e){let t=this.live||this.store instanceof o.AsyncStore;if(this.repeatDir)this.repeatDir.scrollToViewIndex(e);else if(!t){e=Math.min(e,this.store.data.length-1);let t=this.refs.table.rows[e];t&&n.scrollToView(t)}}};l=i([a.define("f-table")],l),t.Table=l},6725:()=>{String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{value:function(e,t){let r=this.length,i=t.length;if(e<r||!i)return String(this);{let a=Math.floor((e-r)/i),s=t.slice(0,e-r-a*i);return t.repeat(a)+s+this}}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{value:function(e,t){let r=this.length,i=t.length;if(e<r||!i)return String(this);{let a=Math.floor((e-r)/i),s=t.slice(0,e-r-a*i);return this+t.repeat(a)+s}}}),RegExp.escape||Object.defineProperty(RegExp,"escape",{value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}})},6833:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;const a=r(1416),s=r(8240),n=r(5499);let o=class extends a.Component{constructor(){super(...arguments),this.title="",this.opened=!0,this.appendTo="body"}static style(){let{adjustFontSize:e,textColor:t,popupBorderRadius:r,popupShadowBlurRadius:i,popupBackgroundColor:n,popupShadowColor:o,adjust:l}=s.theme;return a.css`
		:host{
			position: fixed;
			display: flex;
			flex-direction: column;
			z-index: 1000;	// Same with popup
			border-radius: ${r}px;
			box-shadow: 0 0 ${i}px ${o};
			background: ${n};
			max-width: 100%;
			max-height: 100%;
			padding: ${l(8)}px ${l(16)}px;
			overflow: hidden;
		}

		.mask{
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
		}

		.header{
			display: flex;
			flex: none;
			height: ${l(34)+1}px;
			font-size: ${e(13)}px;
			padding-bottom: ${l(6)}px;
			border-bottom: 1px solid ${t.alpha(.8)};
			margin-bottom: ${l(8)}px;
		}

		.title{
			flex: 1;
			min-width: 0;
			font-weight: bold;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}

		.close{
			display: flex;
			width: ${l(28)}px;
			height: ${l(28)}px;
			margin-top: -${l(-6)}px;
			margin-right: ${l(-9)}px;
			cursor: pointer;

			&:active{
				transform: translateY(1px);
			}

			f-icon{
				margin: auto;
			}
		}

		.actions{
			margin-left: ${l(16)}px;

			button{
				margin-left: ${l(8)}px;
			}
		}

		.content{
			flex: 1;
			min-height: 0;
			display: flex;
			flex-direction: column;
			overflow-y: auto;
			margin-right: ${l(-16)}px;
			padding-right: ${l(16)}px;
		}
	`}render(){let e=!this.slots.action;return a.html`
		<template
			tabindex="0"
			${a.show(this.opened,{transition:"fade",enterAtStart:!0,onend:this.onTransitionEnd})}
		>
			<div class="mask"
				:ref="mask"
				${a.show(this.opened,{transition:"fade",enterAtStart:!0})}
			/>

			<div class="header">
				<div class="title">${this.title}</div>

				<div class="actions" :show=${this.slots.action}>
					<slot name="action" />
				</div>

				${e?a.html`
					<div class="close" @click=${this.hide}>
						<f-icon .type="close" />
					</div>
				`:""}
			</div>

			<div class="content">
				<slot />
			</div>
		</template>
		`}onTransitionEnd(e,t){"leave"===e&&t&&(this.refs.mask&&this.refs.mask.remove(),this.el.remove())}async onConnected(){await a.renderComplete(),this.refs.mask&&this.el.previousElementSibling!==this.refs.mask&&this.el.before(this.refs.mask),this.toCenter(),a.on(window,"resize",n.debounce(this.onWindowResize,200).wrapped,this)}onDisconnected(){a.off(window,"resize",this.onWindowResize,this)}onWindowResize(){this.opened&&this.toCenter()}toCenter(){n.align(this.el,document.documentElement,"c")}show(){this.opened=!0,this.appendTo&&a.appendTo(this.el,this.appendTo)}hide(){this.opened=!1}};o=i([a.define("f-modal")],o),t.Modal=o},6841:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EffectManager=void 0;const i=r(1),a=r(2111),s=r(7905),n=r(7905);class o extends i.BaseManager{static filterEffectDatasFromRenderNodes(e){let t=[];for(let r of e)r.type===a.RenderNodeType.Effect&&t.push(r.data),r.inputs&&t.push(...o.filterEffectDatasFromRenderNodes(r.inputs));return t}static filterRenderableEffectDatas(e){let t=[];for(let r of e){if(r.effects)for(let e of r.effects)(0,n.isRenderableEffect)(e.type)&&t.push(e);"composite"===r.type&&r.layers&&t.push(...this.filterRenderableEffectDatas(r.layers))}return t}active(){}deactive(){}async create(e){let t=new((0,s.getEffectClass)(e.type))(this.renderer,e);return await t.ready,t}}t.EffectManager=o},6925:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.repeatValue=t.binaryFindIndexToInsert=t.cloneAttributes=t.trim=void 0,t.trim=function(e){return e.replace(/^[\r\n\t]+|[\r\n\t]+$/g,"")},t.cloneAttributes=function(e,t){for(let{name:r,value:i}of t)"class"!==r&&"style"!==r||!e.hasAttribute(r)||("style"===r?i=e.getAttribute(r)+"; "+i:"class"===r&&(i=e.getAttribute(r)+" "+i)),e.setAttribute(r,i)},t.binaryFindIndexToInsert=function(e,t){if(0===e.length)return 0;let r=t(e[0]);if(0===r||-1===r)return 0;if(1===e.length)return 1;if(r=t(e[e.length-1]),0===r)return e.length-1;if(1===r)return e.length;let i=0,a=e.length-1;for(;a-i>1;){let r=Math.floor((a+i)/2),s=t(e[r]);if(0===s)return r;-1===s?a=r:i=r}return a},t.repeatValue=function(e,t){let r=[];for(let i=0;i<t;i++)r.push(e);return r}},6949:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setStyle=t.getStyle=t.getStyleAsNumber=void 0;const i=r(774);function a(e,t){return getComputedStyle(e)[t]}t.getStyleAsNumber=function(e,t){let r=a(e,t);return r&&parseFloat(r)||0},t.getStyle=a,t.setStyle=function e(t,r,a){if("object"==typeof r)for(let i of Object.keys(r))e(t,i,r[i]);else t.style.setProperty(r,i.normativeStyleValue(r,a))}},6981:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FillEffect=void 0;const i=r(8341),a=r(6376),s=r(5305),n=r(6339),o=r(9694),l=r(62);class c extends i.Effect{async initialize(){this.toDraw=new n.ToDrawEffect({renderer:this.renderer,fragCode:o.default})}update(){super.update();let e=(0,a.getPropertyValues)(this.data,this.time,s.EffectFillDefaultValues);this.toDraw.setUniform("fillColor",(0,l.premultiplyColorArray)(e.color)),this.toDraw.setUniform("fillOpacity",e.opacity/100)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.FillEffect=c},7153:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Footages=void 0;const i=r(5499);class a{static GraphicFileAccepts=[".mp4",".jpeg",".jpg",".png",".bmp",".webp"].join(",");static AudioFileAccepts=[".mp3",".ogg"].join(",");project;constructor(e){this.project=e}getTotalVideoFrames(){let e=this.filterFootageLayers((e=>"video"===e.type&&!e.hidden)),t=0;for(let r of e){let{frameRate:e,inPoint:i,outPoint:a}=r;t+=(a-i)*(e||30)}return t}filterFootageLayers(e){let t=new Set;return this.project.data.getAllPlainLayerDatas().filter((r=>{if(!e(r))return!1;let i=r.path;return!(!i||t.has(i)||(t.add(i),0))}))}getTemplateFootageHeight(){return this.project.data.getAllPlainLayerDatas().some((e=>!0!==e.replaceable&&("video"===e.type||"image"===e.type)))?this.project.data.height:0}getUserFootageHeight(){let e=this.filterFootageLayers((e=>!0===e.replaceable&&("video"===e.type||"image"===e.type))).map((e=>e.mediaHeight));return(0,i.avg)(e)}getTemplateVideoFrameRate(){let e=this.filterFootageLayers((e=>!0!==e.replaceable&&"video"===e.type)),t=e.map((e=>e.frameRate));return e.length>0?Math.min(...t):0}getUserVideoFrameRate(){let e=this.filterFootageLayers((e=>!0===e.replaceable&&"video"===e.type)).map((e=>e.frameRate));return(0,i.avg)(e)}getReplaceableAudioLayerData(){return this.project.data.getAllPlainLayerDatas().find((e=>"audio"===e.type&&e.replaceable))}getLoopLayerDatas(){return this.project.data.getAllPlainLayerDatas().filter((e=>"audio"===e.type&&e.replaceable||"video"===e.type&&e.loop))}getIncludedFontFamilies(){let e=this.project.data.getAllPlainLayerDatas().filter((e=>"text"===e.type));return(0,i.unique)(e.map((e=>e.fontFamily)))}getAverageAspectRatio(){let e=this.filterFootageLayers((e=>"image"===e.type||"video"===e.type)).map((e=>e.mediaWidth/e.mediaHeight));return Math.pow(Math.E,(0,i.avg)(e.map((e=>Math.log(e)))))}getCoverPath(){return this.project.data.cover?this.project.resourceLoader.getAbsolutePath(this.project.data.cover):null}getBackCoverPath(){return this.project.data.backCover?this.project.resourceLoader.getAbsolutePath(this.project.data.backCover):null}}t.Footages=a},7173:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ffmpeg=void 0;const i=r(5499),a=r(7928),s=r(1118),n=r(2195),o=r(3863);var l;!function(e){let t=document.currentScript instanceof HTMLScriptElement?(0,s.getPathParent)((0,s.getPathParent)(document.currentScript.src))+"/libs/ffmpeg-worker.js":"libs/ffmpeg-worker.js";e.configWorkerPath=function(e){t=e};class r{worker=null;onAbort=null;terminatePromise=null;terminateResolve=null;async exec(e,t,r){return t=["-hide_banner",...t.map((e=>String(e)))],new Promise((async(i,s)=>{let n=await this.getWorkerJSURL(),o=this.worker=new Worker(n);this.onAbort=()=>{l(),s("Terminated")};let l=()=>{this.onAbort=null,this.close()};o.onerror=e=>{l(),s(e)},o.onmessage=async n=>{let c=n.data;switch(c.type){case"ready":this.isWorkerFilesCrossedDomain()&&o.postMessage({type:"set_wasm_url",url:await this.getWorkerWasmURL()}),o.postMessage({type:"run",MEMFS:e,arguments:t.map((e=>String(e)))});break;case"stdout":case"stderr":c.data.includes("RuntimeError: unreachable")||(a.debug.veryVerbose(c.data),r(c.data));break;case"exit":break;case"abort":l(),s(c.data);break;case"done":l(),i(c.data.MEMFS)}}}))}async getWorkerJSURL(){if(this.isWorkerFilesCrossedDomain()){let e=(0,o.addTimestamp)(t),r=await(await fetch(e)).text();return window.URL.createObjectURL(new Blob([r],{type:"application/javascript"}))}return(0,o.addTimestamp)(t)}isWorkerFilesCrossedDomain(){return new URL(t).host!==location.host}async getWorkerWasmURL(){return(0,o.addTimestamp)(t.replace(/\.js($|\?.+)/,".wasm$1"))}async info(e){let t=[];return await this.exec([],e,(e=>{t.push(e)})),t}async execWithProgress(e,t,r){return this.exec(e,t,(e=>{let t=(0,i.firstMatch)(e,/^frame=\s*(\d+) /);t&&r(Number(t))}))}async getExecMessages(e,t){let r=[];return await this.exec(e,t,(e=>{r.push(e)})),r}close(){this.worker&&this.worker.terminate(),this.terminateResolve&&this.terminateResolve()}abort(){this.onAbort&&this.onAbort(),this.worker&&this.worker.terminate()}async waitForClose(){this.terminatePromise||(this.terminatePromise=new Promise((e=>{this.terminateResolve=e}))),await this.terminatePromise}}e.FFWorker=r;class l extends n.WorkQueue{create(){let e=new r;return e.waitForClose().then((()=>{this.delete(e)})),e}abort(){for(let e of this.workers)e.abort();this.workers=[]}}async function c(e,t){let i=new r;return await i.getExecMessages(e,t)}function d(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function h(e){let t=(0,i.subMatches)(e,/^\s*(.+?)\s*:\s*(.+)/m);return(0,i.indexBy)(t,(e=>[e[0],e[1]]))}e.WorkerGroup=l,e.defaultWorkerGroup=new l(Math.max(navigator.hardwareConcurrency-2,1)),e.info=async function(e){let t=new r;return await t.info(e)},e.exec=async function(e,t,i){let a=new r;return await a.exec(e,t,i)},e.execWithProgress=async function(e,t,i){let a=new r;return await a.execWithProgress(e,t,i)},e.getExecMessages=c,e.listInputFiles=function(e){let t="";for(let r of e)t+=`file '${r.name}'\n`;let r={name:"list.txt",data:d(t.slice(0,-1))};return[...e,r]},e.getFFFileFromPath=async function(e){let t=(0,s.getPathName)(e),r=await fetch(e);return r.ok?{name:t,data:await r.arrayBuffer()}:Promise.reject(r.status)},e.getFFFileFromFile=async function(e){return{name:(0,s.getPathName)(e.name),data:await(0,s.readBlobAsArrayBuffer)(e)}},e.getMediaInfo=async function(e){let t=(await c([e],["-i",e.name])).join("\n"),r=t.match(/^  Duration: (.+?), .+?, bitrate: (\d+) kb\/s/m),a={duration:r?(0,i.parseDurationToSeconds)(r[1]):0,bitrate:r?Number(r[2]):0,metadata:h((0,i.firstMatch)(t,/^ {2}Metadata:\n((?: {4}[\S].+\n)+)/m))},s=(0,i.firstMatch)(t,/^\s*Stream #0:\d.+?Video:(.+)/m).replace(/\(.+?\)/g,"");if(s){let e=s.split(","),r=e[0].trim(),n=e[1].trim(),[o,l]=e[2].match(/(\d+)x(\d+)/).map((e=>Number(e))).slice(1),c=Number((0,i.firstMatch)(s,/(\d+) kb\/s/))||0,d=Number((0,i.firstMatch)(s,/([\d.]+) fps/))||0,u=h((0,i.firstMatch)(t,/^\s*Stream #0:\d.+?Video:.+\n {4}Metadata:\n((?: {6}[\S].+\n))+/m));a.video={codec:r,pixelFormat:n,width:o,height:l,bitrate:c,frameRate:d,metadata:u}}let n=(0,i.firstMatch)(t,/^\s*Stream #0:\d.+?Audio:(.+)/).replace(/\(.+?\)/g,"");if(n){let e=n.split(","),r=e[0].trim(),s=Number(e[1].replace(/Hz/,"")),o=e[2].trim(),l=Number(e[4].replace(/kb\/s/,"")),c=h((0,i.firstMatch)(t,/^\s*Stream #0:\d.+?Audio:.+\n {4}Metadata:\n((?: {6}[\S].+\n))+/m));a.audio={codec:r,samplingRate:s,mode:o,bitrate:l,metadata:c}}return a},e.downloadFile=function(e){let t=new Blob([e.data]),r=document.createElement("a"),i=URL.createObjectURL(t);r.textContent=e.name,r.setAttribute("href",i),r.setAttribute("download",e.name),r.click()}}(l||(t.ffmpeg=l={}))},7181:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observeMapOrSetTarget=void 0;const i=r(8546),a=r(8622),s=["add","set","delete","clear"];t.observeMapOrSetTarget=function(e){let t=new Proxy(e,n);return a.proxyMap.set(e,t),a.proxyMap.set(t,t),a.targetMap.set(t,e),t};const n={get(e,t){let r=e[t],a=typeof r;return e.hasOwnProperty(t)||"function"!==a||(r=r.bind(e),i.mayAddDependency(e),s.includes(t)&&i.notifyObjectSet(e)),r}}},7185:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundErasePreview=void 0;const a=r(1416),s=r(4869),n=r(3481),o=r(1326),l=r(2824),c=r(1919),d=r(5499),h=r(1118);let u=class extends s.ColorCorrectionPreview{name="bg-erase";imageStorageKey="bgErasePreviewImage";toDrawBackground;toDrawBlend;toDrawBackgroundBlur;uniformSlides=[];imageDirectory="bg-erase";images=["icon_2020_07-02_11-00-22.jpg","icon_2020_07-02_14-26-40.jpg","icon_2020_07-04_15-12-08.jpg","icon_2020_07-02_11-40-10.jpg","icon_2020_07-02_14-29-04.jpg","icon_2020_07-04_15-19-37.jpg","icon_2020_07-02_11-40-35.jpg","icon_2020_07-02_14-29-23.jpg","icon_2020_07-06_02-22-34.jpg","icon_2020_07-02_11-40-56.jpg","icon_2020_07-02_16-55-26.jpg","icon_2020_07-06_03-53-09.jpg","icon_2020_07-02_11-41-19.jpg","icon_2020_07-03_04-25-59.jpg","icon_2020_07-06_04-07-41.jpg","icon_2020_07-02_11-41-28.jpg","icon_2020_07-03_17-33-47.jpg","icon_2020_07-06_07-58-31.jpg","icon_2020_07-02_11-47-17.jpg","icon_2020_07-03_22-11-24.jpg","icon_2020_07-02_11-47-21.jpg","icon_2020_07-04_08-06-32.jpg","icon_2020_07-02_12-43-35.jpg","icon_2020_07-04_10-15-31.jpg","icon_2020_07-02_12-50-06.jpg","icon_2020_07-04_13-37-20.jpg","icon_2020_07-06_17-15-52.jpg","icon3_0125.jpg","icon3_0126.jpg","icon3_0127.jpg","icon3_0138.jpg","499.jpg"].sort();imageMaskMap={};bgColors=["#000000","#ffffff","#ff3333","#33ff33","#3333ff"];activeBGColor=d.storage.get("bg_erase_active_bg_color","#000000");render(){return a.html`
		<template class="preview">
			${this.renderColors()}
			${this.renderImages()}
		</template>
		`}renderColors(){return a.html`
		<div class="preview-channels">
			<button @click=${()=>this.setBgColor("original")} style="margin-top: 12px; margin-right: 4px;">原图</button>
			<button @click=${()=>this.setBgColor("mask")} style="margin-top: 12px; margin-right: 4px;">蒙版</button>

			${this.bgColors.map((e=>a.html`
				<div :style.background=${e}
					:class.active=${e===this.activeBGColor}
					@click=${()=>this.setBgColor(e)}
				 />
			`))}

			<button @click=${this.addMoreImages} style="margin-top: 12px; margin-left: auto;">添加图片</button>
		</div>
		`}async createToDraw(){this.updateSWClearColor();let e=this.getVertexCode(),t=await(await fetch("shaders/bg-erase/bg-erase-background-filter.frag")).text(),r=await(await fetch("shaders/bg-erase/bg-erase-blur.frag")).text(),i=await(await fetch("shaders/bg-erase/bg-erase-blend.frag")).text();this.toDrawBackground=new n.ToDraw(this.sw,{vertCode:e,fragCode:t,vertices:{data:this.getDefaultVerticesData(),count:4}}),this.toDrawBackgroundBlur=new n.ToDraw(this.sw,{vertCode:e,fragCode:r,vertices:{data:this.getDefaultVerticesData(),count:4}}),this.toDrawBlend=new n.ToDraw(this.sw,{vertCode:e,fragCode:i,vertices:{data:this.getDefaultVerticesData(),count:4}}),this.toDraw=new n.ToDraw(this.sw,{vertCode:e,fragCode:await this.getDefaultFragCode(),vertices:{data:this.getDefaultVerticesData(),count:4}}),this.onGLReady()}async setImage(e){this.activeImage=e;let t=(0,h.isAbsolutePath)(e)?e:`pictures/${this.imageDirectory}/${e}`,r=this.imageMaskMap[t]||`pictures/${this.imageDirectory}/${e.replace(/\.(\w+)$/,"_v2_mask.png")}`,i=await(0,o.preloadImage)(t),a=await(0,o.preloadImage)(r);this.imageNaturalSize=[i.naturalWidth,i.naturalHeight],this.adjustSize();let s=[new l.PixelSampler(this.sw,i),new l.PixelSampler(this.sw,a)];this.toDrawBackground.useSampler("iChannel",...s),this.toDrawBlend.useSampler("iChannel",...s),this.drawAll()}setBgColor(e){this.activeBGColor=e,d.storage.set("bg_erase_active_bg_color",e),this.updateSWClearColor(),this.drawAll()}async addMoreImages(){let e=await(0,d.selectMultipleFile)("image/*");if(!e)return;if(2!==e.length)return void c.notification.error('请选择两个文件, 其中之一为原图, 另一个为名称中包含 "mask" 的蒙版图.');let t=e.find((e=>e.name.includes("mask")));if(!t)return void c.notification.error('请选择两个文件, 其中之一为原图, 另一个为名称中包含 "mask" 的蒙版图.');let r=e.find((e=>e!==t)),i=URL.createObjectURL(r),a=URL.createObjectURL(t);this.images.push(i),this.imageMaskMap[i]=a,this.setImage(i)}updateSWClearColor(){this.activeBGColor.startsWith("#")&&this.sw.setClearColor(new c.Color(this.activeBGColor).getRGBA())}drawAll(){if(this.sw.clear(),"original"===this.activeBGColor)this.toDraw.useSampler("iChannel",this.toDrawBlend.getSampler("iChannel")[0]),this.toDraw.draw(),this.toDraw.unuseSampler("iChannel");else if("mask"===this.activeBGColor)this.toDraw.useSampler("iChannel",this.toDrawBlend.getSampler("iChannel")[1]),this.toDraw.draw(),this.toDraw.unuseSampler("iChannel");else{let e=this.drawBackgroundBlur();this.toDrawBlend.useSubSampler("iChannel",2,e),this.drawBlend()}}drawBackgroundBlur(e=50,t=2,r=2){let i,a=e*Math.sqrt(1/t),s=this.sw.textureFrameManager.requestFull();s.active(),this.toDrawBackground.draw(),s.deactive(),this.toDrawBackgroundBlur.useSampler("iChannel",s.getSampler()),this.toDrawBackgroundBlur.setUniform("maxMaskErrorPixels",r);for(let e=0;e<2*t;e++){e%2==0?this.toDrawBackgroundBlur.setUniform("samplingRadius",[a,0]):this.toDrawBackgroundBlur.setUniform("samplingRadius",[0,a]);let r=this.sw.textureFrameManager.requestFull();r.active(),this.toDrawBackgroundBlur.draw(),r.deactive(),this.toDrawBackgroundBlur.unuseSampler("iChannel"),e<2*t-1?this.toDrawBackgroundBlur.useSampler("iChannel",r.getSampler()):i=r.getSampler()}return i}drawBlend(e=5,t=2){this.toDrawBlend.setUniform("maxSearchingFgRadius",e),this.toDrawBlend.setUniform("maxMaskErrorPixels",t),this.toDrawBlend.draw()}};t.BackgroundErasePreview=u,t.BackgroundErasePreview=u=i([(0,a.define)("bg-erase-preview")],u)},7192:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAspectRatioFromResolution=void 0,t.getAspectRatioFromResolution=function(e){if(1e3===e)return"1x1";if(1920===e)return"9x16";if(1080===e)return"16x9";throw new Error(`未预定义的分辨率 "${e}p"!`)}},7286:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(2824),s=r(4452),n=r(2298),o=[-1,1,1,-1,-1,1,1,1,1,1,-1,1],l=[0,1,0,0,1,1,1,0];function c(e,t,r){let i="left"===t?-1:"right"===t?1:0,a="bottom"===t?1:"top"===t?-1:0,o=new n.Matrix4;o.rotate3DSelf(a*e*Math.PI/2,i*e*Math.PI/2,0),o.translateSelf(0,0,-1*(1-Math.pow(2*e-1,2)));let l=r+1,c=n.Matrix4.lookAt(new s.Vector3(0,0,l),new s.Vector3(0,0,0));return n.Matrix4.perspective(2,2,r).multiplySelf(c).multiplySelf(o)}function d(e,t){return c(e,"right",t.perspective)}function h(e,t){return c(e,"left",t.perspective)}function u(e,t){return c(e,"top",t.perspective)}function p(e,t){return c(e,"bottom",t.perspective)}const m=[{name:"perspective",desc:"Perspective",min:1.1,max:10,step:.1,value:3}];(0,i.extendTransitions)({"cube-from-right":{sourceParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},targetParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},threeD:!0,uniformSlides:m,steps:[{useTexture:i.TextureReference.Source,vertices:o,transform:h,fragShaderName:"cube-source"},{useTexture:i.TextureReference.Target,vertices:[1,1,1,1,-1,1,1,1,-1,1,-1,-1],textureCoords:l,transform:h,fragShaderName:"cube-target"}]},"cube-from-left":{sourceParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},targetParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},threeD:!0,uniformSlides:m,steps:[{useTexture:i.TextureReference.Source,vertices:o,transform:d,fragShaderName:"cube-source"},{useTexture:i.TextureReference.Target,vertices:[-1,1,-1,-1,-1,-1,-1,1,1,-1,-1,1],textureCoords:l,transform:d,fragShaderName:"cube-target"}]},"cube-from-top":{sourceParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},targetParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},threeD:!0,uniformSlides:m,steps:[{useTexture:i.TextureReference.Source,vertices:o,transform:p,fragShaderName:"cube-source"},{useTexture:i.TextureReference.Target,vertices:[-1,1,-1,-1,1,1,1,1,-1,1,1,1],textureCoords:l,transform:p,fragShaderName:"cube-target"}]},"cube-from-bottom":{sourceParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},targetParams:{filter:a.SamplerFilter.MipmapLinear,anisotropy:!0},threeD:!0,uniformSlides:m,steps:[{useTexture:i.TextureReference.Source,vertices:o,transform:u,fragShaderName:"cube-source"},{useTexture:i.TextureReference.Target,vertices:[-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1],textureCoords:l,transform:u,fragShaderName:"cube-target"}]}})},7340:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0,t.sleep=function(e=0){return new Promise((t=>setTimeout(t,e)))}},7378:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SlotProcesser=void 0;const i=r(9838);t.SlotProcesser=class{constructor(e){this.restSlotNodeRange=null,this.hasSlotsToBeFilled=!1,this.com=e,this.initNamedSlotNodes(),this.initRestSlotRange()}initNamedSlotNodes(){let e=this.com.slots;for(let t of[...this.com.el.children]){let r=t.getAttribute("slot");if(r){let i=e[r];i||(i=e[r]=[]),i.push(t),t.remove()}}}initRestSlotRange(){let e=document.createDocumentFragment();e.append(...this.com.el.childNodes),this.restSlotNodeRange=new i.NodeRange(e)}needToFillSlotsLater(){this.hasSlotsToBeFilled=!0}mayFillSlots(){if(!this.hasSlotsToBeFilled)return;let e=this.com.slots,t=this.com.el.querySelectorAll("slot");for(let r of t){let t=r.getAttribute("name");if(t){if(e&&e[t]&&r.firstChild!==e[t][0]){for(;r.firstChild;)r.firstChild.remove();r.append(...e[t])}}else if(this.restSlotNodeRange&&r.firstChild!==this.restSlotNodeRange.startNode){for(;r.firstChild;)r.firstChild.remove();r.append(this.restSlotNodeRange.getFragment())}}this.hasSlotsToBeFilled=!1}}},7388:(e,t)=>{function r(e,t){let r=i(e,t);return-1===r?void 0:e[r]}function i(e,t){if(0===e.length)return-1;let r=t(e[0]);if(0===r)return 0;if(-1===r)return-1;if(1===e.length)return-1;if(r=t(e[e.length-1]),0===r)return e.length-1;if(1===r)return-1;let i=0,a=e.length-1;for(;a-i>1;){let r=Math.floor((a+i)/2),s=t(e[r]);if(0===s)return r;-1===s?a=r:i=r}return-1}function a(e,t){if(0===e.length)return 0;let r=t(e[0]);if(0===r||-1===r)return 0;if(1===e.length)return 1;if(r=t(e[e.length-1]),0===r)return e.length-1;if(1===r)return e.length;let i=0,a=e.length-1;for(;a-i>1;){let r=Math.floor((a+i)/2),s=t(e[r]);if(0===s)return r;-1===s?a=r:i=r}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.maxIndex=t.minIndex=t.max=t.min=t.avg=t.sum=t.count=t.aggregate=t.groupBy=t.indexBy=t.orderBy=t.Order=t.binaryFindIndexToInsert=t.binaryFindIndex=t.binaryFind=t.difference=t.intersect=t.union=t.unique=t.removeWhere=t.removeFirst=t.remove=t.add=t.repeatTimes=void 0,t.repeatTimes=function(e,t){let r=[];for(let i=0;i<t;i++)r.push(e);return r},t.add=function(e,...t){for(let r of t)e.includes(r)||e.push(r);return e},t.remove=function(e,...t){let r=[];for(let i of t){let t=e.indexOf(i);t>-1&&r.push(...e.splice(t,1))}return r},t.removeFirst=function(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r],r))return e.splice(r,1)[0]},t.removeWhere=function(e,t){let r=[];for(let i=0;i<e.length;i++)t(e[i],i)&&r.push(e.splice(i--,1)[0]);return r},t.unique=function(e){return[...new Set(e)]},t.union=function(...e){let t=new Set;for(let r of e)for(let e of r)t.add(e);return[...t]},t.intersect=function(...e){let t=[];if(!e.length)return t;let r=new Map;for(let t of e[0])r.set(t,1);for(let t of e.slice(1))for(let e of t)r.has(e)&&r.set(e,r.get(e)+1);for(let[i,a]of r.entries())a===e.length&&t.push(i);return t},t.difference=function(e,...t){let r=new Set(e);for(let e of t)for(let t of e)r.delete(t);return[...r]},t.binaryFind=r,t.binaryFindIndex=i,t.binaryFindIndexToInsert=a;class s{constructor(...e){this.orders=[];for(let t of e)if(["string","number","function"].includes(typeof t))this.orders.push([t,1]);else{if(!Array.isArray(t)||!["string","number","function"].includes(typeof t[0]))throw new Error(JSON.stringify(e)+" doesn't specify any valid key or order.");this.orders.push([t[0],-1===t[1]||"desc"===t[1]?-1:1])}}sortArray(e){e.sort(((e,t)=>this.compare(e,t)))}compare(e,t){for(let[r,i]of this.orders){let a,s;if("function"==typeof r?(a=r(e),s=r(t)):(a=e[r],s=t[r]),a<s)return-i;if(a>s)return i;if(a!==s)return null==a?-i:i}return 0}binaryFind(e,t){return r(e,(e=>this.compare(t,e)))}binaryFindIndex(e,t){return i(e,(e=>this.compare(t,e)))}binaryInsert(e,t){let r=a(e,(e=>this.compare(t,e)));return e.splice(r,0,t),e}}function n(e,t){let r={};if("function"==typeof t)for(let i=0,a=e.length;i<a;i++){let a=e[i],[s,n]=t(a,i);r[s]=n}else for(let i of e)r[i[t]]=i;return r}function o(e,t){let r={};for(let i of e){let e;e="function"==typeof t?t(i):i[t],(r[e]||(r[e]=[])).push(i)}return r}function l(e){return e.reduce(((e,t)=>e+t),0)}t.Order=s,t.orderBy=function(e,t,...r){return(t=t instanceof s?t:new s(t,...r)).sortArray(e),e},t.indexBy=n,t.groupBy=o,t.aggregate=function(e,t,r){let i=o(e,t);return n(Object.keys(i),(e=>[e,r(i[e],e)]))},t.count=function(e){return e.length},t.sum=l,t.avg=function(e){return 0===e.length?0:l(e)/e.length},t.min=function(e){return Math.min(...e)},t.max=function(e){return Math.max(...e)},t.minIndex=function(e,t){let r;r=t?e.map(t):e;let i=-1,a=1/0;for(let e=0;e<r.length;e++)r[e]<a&&(i=e,a=r[e]);return i},t.maxIndex=function(e,t){let r;r=t?e.map(t):e;let i=-1,a=-1/0;for(let e=0;e<r.length;e++)r[e]>a&&(i=e,a=r[e]);return i}},7463:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nin vec4 fRawCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform vec2 startOfRamp;\nuniform vec4 startColor;\nuniform vec2 endOfRamp;\nuniform vec4 endColor;\nuniform int rampShape;\nuniform float blendWithOriginal;\nvec4 getFragColor() {\nvec2 startToEnd = endOfRamp - startOfRamp;\nvec2 startToCurrent = fRawCoord.xy - startOfRamp;\nfloat endRate;\nif (rampShape == 1) {\nendRate = dot(startToCurrent, startToEnd) / pow(length(startToEnd), 2.0);\n}\nelse {\nendRate = length(startToCurrent) / length(startToEnd);\n}\nendRate = clamp(endRate, 0.0, 1.0);\nvec4 color = mix(startColor, endColor, endRate);\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, 1.0 - blendWithOriginal);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},7497:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.play=t.PlayDirective=void 0;const i=r(5428),a=r(4511),s=r(162);class n{constructor(e,t){this.currentTemplate=null,this.anchor=e,this.context=t,this.transition=new s.DirectiveTransition(t)}canMergeWith(e){return!0}merge(e,t){this.transition.updateOptions(t),e?this.currentTemplate&&this.currentTemplate.canMergeWith(e)?this.currentTemplate.merge(e):(this.currentTemplate&&this.playLeaveTransition(this.currentTemplate),this.initNewResult(e)):this.currentTemplate&&(this.playLeaveTransition(this.currentTemplate),this.currentTemplate=null)}async playEnterTransition(e){let t=e.range.getFirstElement();t&&await this.transition.playEnter(t)}async playLeaveTransition(e){let t=e.range.getFirstElement();t&&await this.transition.playLeave(t)&&e.range.remove()}initNewResult(e){let t=new a.Template(e,this.context),r=t.range.getFragment();this.anchor.insert(r),this.transition.shouldPlayEnter()&&this.playEnterTransition(t),this.currentTemplate=t}remove(){this.currentTemplate&&this.currentTemplate.remove()}}t.PlayDirective=n,t.play=i.defineDirective(n)},7616:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;const i=r(5499),a=r(5875),s=r(1924),n=r(7999);class o extends i.Emitter{sw;project;resourceLoader;scaleRatio=1;pixelRatio;started=!1;time=1e-8;paused=!0;ended=!1;tree;timeline;startTimeInMS=0;animationFrameId=-1;queue;clearTimeout=null;updatePromise=null;preloadingNextFramePromise=null;frameRateCalculator=new n.FrameRateCalculator;constructor(e,t){super(),this.project=e,this.resourceLoader=e.resourceLoader,this.sw=t,this.timeline=e.timeline,this.pixelRatio="previewing"===this.project.mode?devicePixelRatio:1,this.tree=new a.RenderTree(this),this.queue=new s.UpdatingQueue((e=>this.updateFromQueue(e))),this.initResolution(),e.on("updateproject",this.doUpdatingProject,this),e.on("updatetimeline",this.doUpdatingTimeline,this),e.on("updatelayer",this.doUpdatingLayer,this),e.on("updateeffect",this.doUpdatingEffect,this),e.on("update",this.doUpdating,this)}initResolution(){this.scaleRatio=this.sw.height/this.project.data.height,this.sw.setUniform("iVideoResolution",[this.project.data.width,this.project.data.height]),this.sw.setUniform("iResolution",[this.sw.width,this.sw.height])}get playing(){return!this.paused}async doUpdatingProject(){await this.waitUpdateCompleted(),this.initResolution(),this.tree.clear(),this.ended&&this.time<this.project.data.duration&&(this.ended=!1),this.time>this.project.data.duration?this.setTime(this.project.data.duration):this.started&&this.paused&&await this.enqueUpdate()}async doUpdatingTimeline(){await this.waitUpdateCompleted(),this.ended&&this.time<this.project.data.duration&&(this.ended=!1),this.time>this.project.data.duration?await this.setTime(this.project.data.duration):this.started&&this.paused&&await this.enqueUpdate()}async doUpdatingLayer(e){await this.waitUpdateCompleted(),this.tree.deleteLayerFromId(e.id),this.started&&this.paused&&await this.enqueUpdate()}async doUpdating(e){await this.waitUpdateCompleted(),this.started&&this.paused&&await this.enqueUpdate()}async doUpdatingEffect(e){await this.waitUpdateCompleted(),this.tree.deleteEffectFromId(e.id),this.started&&this.paused&&await this.enqueUpdate()}async setCanvasSize(e,t){await this.waitUpdateCompleted(),this.sw.setCanvasSize(e,t,this.pixelRatio),this.sw.setUniform("iResolution",[this.sw.width,this.sw.height]),this.scaleRatio=this.sw.height/this.project.data.height,this.emit("resize"),this.started&&this.paused&&await this.enqueUpdate()}async setPixelRatio(e=1){this.pixelRatio=e,this.started&&this.paused&&await this.enqueUpdate()}checkIfEveryThingReady(){}async play(){this.checkIfEveryThingReady(),this.endPlaying(),this.paused=!1,this.ended=!1,this.started?await this.prepareNextResources():await this.prepareAllResources(),this.animationFrameId=requestAnimationFrame((async e=>{if(this.paused)return;this.startTimeInMS=e-1e3*this.time;let t=this.latestAnimationFrameTimestampGetter(e);this.tree.activeCurrentLayers(),this.frameRateCalculator.restart(),await this.playFrame(e);let r=t();this.startTimeInMS=r-1e3*this.time})),this.emit("play")}latestAnimationFrameTimestampGetter(e){let t,r=()=>{t=requestAnimationFrame((t=>{e=t,r()}))};return r(),()=>(cancelAnimationFrame(t),e)}async playFrame(e){if(this.paused)return;this.frameRateCalculator.trigger(e);let t=e-this.startTimeInMS,r=this.project.data.duration;t>=1e3*r?(await this.enqueUpdate(r),this.pause(),this.ended=!0,this.emit("end")):(await this.enqueUpdate(t/1e3),this.animationFrameId=requestAnimationFrame((e=>this.playFrame(e))))}endPlaying(){cancelAnimationFrame(this.animationFrameId),this.playing&&!this.ended&&this.tree.deactiveCurrentLayers()}async playFrom(e){this.checkIfEveryThingReady(),this.setTimeProperty(e),await this.play()}pause(){this.playing&&(this.endPlaying(),this.paused=!0,this.emit("pause"))}async setTime(e){this.checkIfEveryThingReady(),this.ended=!1,await this.enqueUpdate(e)}async enqueUpdate(e=null){return await this.queue.enqueue(e)}async mayUpdateAfterLayerUpdated(e){this.tree.isLayerBeCurrent(e)&&this.paused&&await this.enqueUpdate()}shouldLoadLayerSoon(e){return this.tree.isLayerBeCurrent(e)||!this.started}async updateFromQueue(e){null!==e&&this.setTimeProperty(e),this.updatePromise=this.update(),await this.updatePromise,this.updatePromise=null}async waitUpdateCompleted(){this.updatePromise&&await this.updatePromise}setTimeProperty(e){this.time=(0,i.constrain)(e,0,this.project.data.duration),this.tree.updateTime(this.time),this.emit("updatetime",this.time)}async update(){this.cancelClearingResources(),await this.checkRenderTree(this.time),await this.tree.syncLayersTime(),this.draw(),this.started=!0,this.playing?this.preloadNextFrame():this.willClearResourcesLater()}async preloadNextFrame(){let e=this.frameRateCalculator.getFrameDuration();await this.checkRenderTree(this.time+e)&&await this.tree.syncLayersTime()}async checkRenderTree(e){this.preloadingNextFramePromise&&await this.preloadingNextFramePromise;let t=this.timeline.getMutatedLayerDatas(e);return t&&(this.preloadingNextFramePromise=this.updateRenderTree(t),await this.preloadingNextFramePromise,this.preloadingNextFramePromise=null,this.playing&&this.tree.activeCurrentLayers(),this.emit("updatetree",e)),!!t}async updateRenderTree(e){let t=this.timeline.getStartSafeTime();await this.tree.updateLayerDatas(e,t),(this.playing||"encoding"===this.project.mode)&&this.preloadNextResources()}async prepareAllResources(){let e=this.timeline.getMutatedPreloadLayerDatas(this.time,0,60);e&&await this.tree.preloadResources(e,!0)}async prepareNextResources(){let e=this.timeline.getMutatedPreloadLayerDatas(this.time);e&&await this.tree.preloadResources(e,!0)}preloadNextResources(){let e=this.timeline.getMutatedPreloadLayerDatas(this.time);e&&this.tree.preloadResources(e,!1)}willClearResourcesLater(){let e=this.project.options.clearResourcesAfterNoInteractionForSeconds;e&&(this.clearTimeout=setTimeout((()=>{this.project.clearResoures()}),1e3*e))}cancelClearingResources(){this.clearTimeout&&(clearTimeout(this.clearTimeout),this.clearTimeout=null)}requestPartialTextureFrame(e,t=!1,r=1,i={}){let a=e.scale(this.scaleRatio).round();return this.sw.textureFrameManager.requestPartial(a,t,r,i)}drawAsMappedSamplerFromFn(e,t=!1,r={}){let i=this.sw.textureFrameManager.requestFull(t,1,r);i.active();let a=e();i.deactive();let s=i.getMappedSampler();return a||s.release(),{mappedSampler:s,paintArea:a}}draw(){this.tree.draw()}clear(){this.cancelClearingResources(),this.endPlaying(),this.tree.clear(),this.queue.clear()}delete(){this.clear(),this.sw.loseContext()}}t.Renderer=o},7678:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.glslToVersion100=t.generateUniqueID=void 0;let r=1;t.generateUniqueID=function(){return r++},t.glslToVersion100=function(e,t){if(e=(e=/^\s*#version/.test(e)?e.replace(/^\s*#version .+/,"#version 100"):e.replace(/^/,"#version 100\n")).replace(/\btexture\b/g,"texture2D"),t)e=(e=e.replace(/\bin\b/g,"attribute")).replace(/\bout\b/g,"varying");else{let t=(e=e.replace(/\bin\b/g,"varying")).match(/out\s+vec4\s+(\w+)\s*;/)[1];e=(e=e.replace(/out\s+vec4\s+(\w+)\s*;/,"gl_FragColor = $1;")).replace(new RegExp("\\b"+t+"\\b"),"gl_FragColor")}return e}},7810:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec4 fRawCoord;\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform float horizontalRadius;\nuniform float verticalRadius;\nuniform vec2 bulgeCenter;\nuniform float bulgeHeight;\nfloat bulgeNumber(float x, float height) {\nreturn 1.0 / (1.0 + (1.0 - x) * height);\n}\nvec2 bulgeCoord(vec2 coord, float height) {\nfloat r = length(coord);\nreturn coord * bulgeNumber(r, height);\n}\nvec4 getFragColor() {\nvec2 maxRadius = vec2(horizontalRadius, verticalRadius);\nvec2 origin = bulgeCenter;\nvec2 coord = vec2(fRawCoord.x, fRawCoord.y) - origin;\nvec2 coordRelative = coord / maxRadius;\nvec2 newCoord = origin + maxRadius * bulgeCoord(coordRelative, bulgeHeight);\nvec2 mappedTextureCoord = newCoord / iVideoResolution;\nmappedTextureCoord.y = 1.0 - mappedTextureCoord.y;\nmappedTextureCoord = (iChannelMap[0] * vec4(mappedTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], mappedTextureCoord);\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},7818:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PixelLayer=void 0;const i=r(8552),a=r(2824),s=r(4557);class n extends i.RenderableLayer{toDraw;setTransformStat(e){super.setTransformStat(e);let t=e.getSuggestedSamplingParameters();this.data.samplingQuality===s.AESamplingQuality.Nearest&&(t.filter=a.SamplerFilter.Nearest),this.toDraw.setSamplingParameters(t)}setTransformStatus(e){super.setTransformStatus(e),this.setToDrawTransformStatus(e)}setToDrawTransformStatus(e){this.toDraw.setTransformStatus(e)}setMaskArea(e){this.toDraw.setMaskArea(e)}setMappedChannel(...e){this.toDraw.setMappedChannel(...e)}clearChannel(){this.toDraw.clearChannel()}drawMainContent(){return this.toDraw.draw(),this.toDraw.getPaintArea()}delete(){super.delete(),this.toDraw.delete()}}t.PixelLayer=n},7860:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.watchUntil=t.watchOnce=t.watchImmediately=t.watch=t.globalWatcherGroup=t.WatcherGroup=t.InnerWatcher=t.Watcher=void 0;const i=r(9395),a=r(8135);class s{constructor(e,t){this.connected=!0,this.fn=e,this.callback=t,this.value=this.getValue()}getValue(){i.startUpdating(this);let e=this.fn.call(null);return i.endUpdating(this),e}update(){a.enqueueWatcherToUpdate(this)}__updateImmediately(){if(!this.connected)return;let e=this.getValue();e===this.value&&"object"!=typeof e||this.callback.call(null,this.value=e)}toString(){return this.fn.toString()}disconnect(){i.clearDependencies(this),this.connected=!1}connect(){this.connected=!0,this.update()}}t.Watcher=s,t.InnerWatcher=class extends s{update(){a.enqueueInnerWatcherToUpdate(this)}};class n{constructor(){this.watchers=new Set}add(e){this.watchers.add(e)}delete(e){e.disconnect(),this.watchers.delete(e)}connect(){for(let e of this.watchers)e.connect()}disconnect(){for(let e of this.watchers)e.disconnect()}update(){if(this.watchers)for(let e of this.watchers)e.update()}watch(e,t){let r=new s(e,t);return this.add(r),()=>{this.delete(r)}}watchImmediately(e,t){let r=new s(e,t);return t.call(this,r.value),this.add(r),()=>{this.delete(r)}}watchOnce(e,t){let r=new s(e,(e=>{t(e),i()}));this.add(r);let i=()=>{this.delete(r)};return i}watchUntil(e,t){let r,i=new s(e,(e=>{e&&(t(),r())}));return i.value?(i.disconnect(),t.call(this),r=()=>{}):(this.add(i),r=()=>{this.delete(i)}),r}}t.WatcherGroup=n,t.globalWatcherGroup=new n,t.watch=function(e,r){return t.globalWatcherGroup.watch(e,r)},t.watchImmediately=function(e,r){return t.globalWatcherGroup.watchImmediately(e,r)},t.watchOnce=function(e,r){return t.globalWatcherGroup.watchOnce(e,r)},t.watchUntil=function(e,r){return t.globalWatcherGroup.watchUntil(e,r)}},7872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MayAttrPart=void 0,t.MayAttrPart=class{constructor(e,t,r){this.el=e,this.name=t,this.setValue(r)}setValue(e){e?this.el.setAttribute(this.name,""):this.el.removeAttribute(this.name)}update(e){this.setValue(e)}remove(){}}},7905:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEffectClass=t.isMultiSamplingEffect=t.isPixelToPixelEffect=t.isFullscreenEffect=t.getEffectInputCount=t.isRenderableEffect=void 0;const i=r(609),a=r(1650),s=r(1382),n=r(8962),o=r(4492),l=r(6981),c=r(6268),d=r(5527),h=r(1657),u=r(800),p=r(2130),m=r(4924),f=r(4644),g=r(5756),y=r(2146),w={bulge:i.BulgeEffect,motionBlur:a.MotionBlurEffect,gaussianBlur:y.FastBlurEffect,fastBlur:y.FastBlurEffect,dropShadow:s.DropShadowEffect,directionalBlur:n.DirectionalBlurEffect,tile:o.TileEffect,fill:l.FillEffect,mask:c.MaskEffect,gamma:d.GammaEffect,tint:h.TintEffect,displacementMap:u.DisplacementMapEffect,blend:p.BlendEffect,fractalNoise:m.FractalNoiseEffect,easyLevels:f.EasyLevelsEffect,ramp:g.RampEffect},v=new Map([["bulge",1],["motionBlur",1],["guassianBlur",1],["fastBlur",1],["boxBlur",1],["dropShadow",1],["directionalBlur",1],["tile",1],["fill",1],["mask",2],["gamma",1],["tint",1],["displacementMap",2],["blend",2],["fractalNoise",1],["easyLevels",1],["ramp",1]]),x=new Set(["bulge","tile"]),b=new Set(["displacementMap"]),S=new Set(["motionBlur","guassianBlur","fastBlur","boxBlur","dropShadow","directionalBlur"]);t.isRenderableEffect=function(e){return v.has(e)},t.getEffectInputCount=function(e){return v.get(e)},t.isFullscreenEffect=function(e){return x.has(e)},t.isPixelToPixelEffect=function(e){return!x.has(e)&&!b.has(e)&&!S.has(e)},t.isMultiSamplingEffect=function(e){return S.has(e)},t.getEffectClass=function(e){let t=w[e];if(!t)throw new Error(`"${e}" is not a registered effect class!`);return t}},7916:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;const i=r(5499);class a{constructor(e){if(!e)throw new Error('"key" must be provided when instantiate "KeyMap"!');this.key=e,this.map=new Map}has(e){return this.map.has(e[this.key])}get(e){return this.map.get(e[this.key])}add(e){this.map.set(e[this.key],e)}delete(e){this.map.delete(e[this.key])}clear(){this.map=new Map}}class s extends i.Emitter{constructor(e={}){super(),this.data=[],this.currentData=[],this.key=null,this.filter=null,this.order=null,this.orderName="",this.orderDirection="",this.lastTouchItem=null,this.selected=[],this.map=null,this.selectedMap=null,e.key&&(this.map=new a(e.key),this.selectedMap=new a(e.key));let t=e.data;delete e.data,Object.assign(this,e),this.initData(t)}initData(e){e&&this.addItems(e)}addItems(e,t=!1){if(e.length>0){if(this.map)for(let t of e)this.map.add(t);t?this.data.unshift(...e):this.data.push(...e);let r=this.filter?e.filter(this.filter):e;this.addItemsToCurrentData(r,t)}}addItemsToCurrentData(e,t=!1){if(this.order)if(e.length>1){let t=this.currentData.length>0?[...this.currentData,...e]:e;this.order.sortArray(t),this.currentData=t}else for(let t of e)this.order.binaryInsert(this.currentData,t);else t?this.currentData.unshift(...e):this.currentData.push(...e)}setNamedOrder(e,t,r){this.order=new i.Order([t,r||"asc"]),this.orderName=e,this.orderDirection=r,this.emit("orderchanged",e,r)}setOrder(e,t){this.setNamedOrder(String(e),e,t)}clearOrder(){this.order=null,this.emit("orderchanged","","")}setFilter(e){this.filter=e,this.updateCurrentData(),this.deselectAll(),this.emit("change")}clearFilter(){this.setFilter(null)}updateCurrentData(){this.clearCurrentData(),this.addItemsToCurrentData(this.filter?this.data.filter(this.filter):this.data)}clearCurrentData(){this.currentData=[]}add(...e){this.remove(...e),this.addItems(e),this.emit("change")}addToStart(...e){this.remove(...e),this.addItems(e,!0),this.emit("change")}push(...e){this.addItems(e),this.emit("change")}unshift(...e){this.addItems(e,!0),this.emit("change")}insert(e,...t){if(t.length>0){if(this.data.splice(e,0,...t),this.map)for(let e of t)this.map.add(e);this.order?this.addItemsToCurrentData(this.filter?t.filter(this.filter):t):this.updateCurrentData()}this.emit("change")}has(e){return this.map?this.map.has(e):this.data.includes(e)}get(e){return this.map?this.map.get(e):e}remove(...e){let t=new Set;if(this.map)for(let r of e)this.map.has(r)&&(t.add(this.map.get(r)),this.map.delete(r));else for(let r of e)this.data.includes(r)&&t.add(r);return t.size>0&&(this.data=this.data.filter((e=>!t.has(e))),this.map?this.currentData=this.currentData.filter((e=>this.map.has(e))):this.currentData=this.currentData.filter((e=>!t.has(e))),this.deselect(...t),this.emit("change")),[...t]}isSelected(e){return this.selectedMap?this.selectedMap.has(e):this.selected.includes(e)}isPartlySelected(){let e=this.selected.length;return e>0&&e<this.currentData.length}isSelectedAll(){let e=this.selected.length;return e>0&&e===this.currentData.length}getSelectedCount(){return this.selected.length}select(...e){if(this.selectedMap)for(let t of e)this.selectedMap.has(t)||(this.selected.push(t),this.selectedMap.add(t));else for(let t of e)this.selected.includes(t)||this.selected.push(t);this.lastTouchItem=e[0]}deselect(...e){if(e===this.selected)this.deselectAll();else{let t=new Set;if(this.selectedMap)for(let r of e)this.selectedMap.has(r)&&(t.add(this.selectedMap.get(r)),this.selectedMap.delete(r));else for(let r of e)this.selected.includes(r)&&t.add(r);t.size>0&&(this.selected=this.selected.filter((e=>!t.has(e))))}this.lastTouchItem=e[0]}toggleSelect(e){this.isSelected(e)?this.deselect(e):this.select(e),this.lastTouchItem=e}selectByKeyboardEvent(e,t){t.shiftKey?this.shiftSelect(e):this.toggleSelect(e)}shiftSelect(e){let t=Math.max(this.lastTouchItem?this.getIndex(this.lastTouchItem):0,0),r=this.getIndex(e);r>=0&&(t>r&&([t,r]=[r,t]),r+=1,this.isSelected(e)?this.deselect(...this.currentData.slice(t,r)):this.select(...this.currentData.slice(t,r)))}getIndex(e){return this.map&&!this.map.has(e)?-1:this.data.indexOf(this.get(e))}selectAll(){this.select(...this.currentData)}deselectAll(){this.selected=[],this.selectedMap&&this.selectedMap.clear()}toggleSelectAll(){this.isSelectedAll()?this.deselectAll():this.selectAll()}reload(){this.updateCurrentData(),this.emit("change")}clear(){this.data=[],this.clearCurrentData(),this.deselectAll(),this.map&&this.map.clear(),this.emit("change")}}t.Store=s},7928:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.debug=void 0;const i=r(5499);var a,s;!function(e){e[e.No=0]="No",e[e.Log=1]="Log",e[e.Verbose=2]="Verbose",e[e.VeryVerbose=3]="VeryVerbose"}(a||(a={})),function(e){e.development="localhost"===location.hostname||"127.0.0.1"===location.hostname,e.logLevel=e.development?a.Verbose:0;let t=(0,i.firstMatch)(location.search,/loglevel=(\d+)/);function r(t){e.logLevel>=a.Log&&console.log(t)}t&&(e.logLevel=Number(t)),e.verbose=function(t){e.logLevel>=a.Verbose&&console.log("%c"+t,"color: #999")},e.veryVerbose=function(t){e.logLevel>=a.VeryVerbose&&console.log("%c"+t,"color: #bbb")},e.log=r,e.warn=function(t){e.logLevel>=a.Log&&console.warn(t)},e.timeStart=function(t){let s=0;return e.logLevel>=a.Log&&(s=performance.now()),()=>{if(e.logLevel>=a.Log){let e=performance.now(),a=(0,i.toDecimal)(e-s,2),n=`${t} cost ${a} ms`;a>10?console.log("%c"+n,"color: #c80"):r(n)}}};const s=new WeakSet;e.logOnce=function(t,r){e.development&&!s.has(r)&&(console.log(t),s.add(r))},e.warnOnce=function(t,r){e.development&&!s.has(r)&&(console.warn(t),s.add(r))}}(s||(t.debug=s={}))},7947:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.GreenScreenPreview=void 0;const a=r(1416),s=r(4869),n=r(1919),o=r(3481),l=r(3568);let c=class extends s.ColorCorrectionPreview{name="green-screen";imageStorageKey="greenScreenPreviewImage";toDrawBlur;toDrawBlend;uniformSlides=[{name:"tolerance",desc:"Tolerance",min:0,max:1.5,step:.01,value:.7},{name:"kernalRadius",desc:"KernalRadius",min:0,max:4,step:1,value:1},{name:"alphaBlurRadius",desc:"AlphaBlurRadius",min:0,max:50,step:1,value:0}];imageDirectory="green-screen";images=["85,220,90.jpg","0,220,114.jpg","6,253,0.jpg","35,255,55.jpg","48,116,239.jpg","14,159,107.png","14,159,108.png"];async setImage(e){let t=n.Color.fromRGB(...e.match(/\d+,\d+,\d+/)[0].split(",").map((e=>Number(e)/255)));this.sw.setUniform("backgroundColor",t.getRGB()),super.setImage(e)}initGL(){let e=this.refs.canvas;this.sw=new l.SimpleWebGL(e,{clearColor:[1,1,1,1]}),this.onGLReady()}async createToDraw(){let e=this.getVertexCode(),t=await(await fetch("shaders/bg-erase/feather-blur.frag")).text(),r=await(await fetch("shaders/bg-erase/feather-blur-blend.frag")).text(),i=await(await fetch("shaders/bg-erase/green-screen.frag")).text();this.toDrawBlur=new o.ToDraw(this.sw,{vertCode:e,fragCode:t,vertices:{data:this.getDefaultVerticesData(),count:4}}),this.toDrawBlend=new o.ToDraw(this.sw,{vertCode:e,fragCode:r,vertices:{data:this.getDefaultVerticesData(),count:4}}),this.toDraw=new o.ToDraw(this.sw,{vertCode:e,fragCode:i,vertices:{data:this.getDefaultVerticesData(),count:4}})}drawAll(){this.sw.clear();let e=this.uniformValues[2],t=e*Math.sqrt(.5);if(0===e)return void this.toDraw.draw();let r=this.sw.textureFrameManager.requestFull();r.active(),this.toDraw.draw(),r.deactive(),this.toDrawBlur.useSampler("iChannel",r.getSampler()),this.toDrawBlend.useSampler("iChannel",r.getSampler());for(let e=0;e<4;e++){e%2==0?this.toDrawBlur.setUniform("samplingRadius",[t,0]):this.toDrawBlur.setUniform("samplingRadius",[0,t]);let r=this.sw.textureFrameManager.requestFull();r.active(),this.toDrawBlur.draw(),r.deactive(),this.toDrawBlur.unuseSampler("iChannel"),e<3?this.toDrawBlur.useSampler("iChannel",r.getSampler()):this.toDrawBlend.useSubSampler("iChannel",1,r.getSampler())}this.toDrawBlend.draw()}};t.GreenScreenPreview=c,t.GreenScreenPreview=c=i([(0,a.define)("green-screen-preview")],c)},7975:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Dropdown=void 0;const i=r(1416),a=r(8240),s=r(8708);class n extends i.Component{constructor(){super(...arguments),this.opened=!1,this.trigger="click",this.triangle=!0,this.alignPosition="b",this.alignMargin=3,this.transition="fade",this.showDelay=100,this.hideDelay=100,this.popupBinding=null}static style(){let{mainColor:e}=a.theme;return i.css`
		:host{
			display: inline-flex;
		}

		.opened{
			color: ${e};
		}

		.down-icon{
			margin-right: 6px;
		}

		.popup{
			padding: 5px 0;
		}

		.list{
			overflow-y: auto;
			max-height: 100%;
		}
		`}render(){let{trigger:e,triangle:t,alignPosition:r,alignMargin:a,transition:n,showDelay:o,hideDelay:l}=this,c=this.setOpened.bind(this),d=i.refBinding(s.popup((()=>this.renderPopup()),{trigger:e,triangle:t,alignPosition:r,alignMargin:a,transition:n,showDelay:o,hideDelay:l,onOpenedChanged:c}),(e=>{this.popupBinding=e}));return i.html`
		<template :class.opened=${this.opened} ${d}>
			<slot />
			<f-icon class="down-icon" .type="down" />
		</template>
		`}renderPopup(){return i.html`
		<f-popup
			class="popup"
			.triangle=${this.triangle}
		/>
		`}setOpened(e){this.opened=e,e&&this.onPopupOpened()}onPopupOpened(){}async showPopup(){this.popupBinding&&await this.popupBinding.showPopupLater()}hidePopup(){this.popupBinding&&this.popupBinding.hidePopupLater()}}t.Dropdown=n},7999:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FrameRateCalculator=void 0;const i=r(247);t.FrameRateCalculator=class{lastTimestamp=-1;timestampCount=0;frameRate=0;cachedFrameRates=[];restart(){this.lastTimestamp=-1,this.timestampCount=0}trigger(e){if(this.timestampCount>0){let t=1e3/(e-this.lastTimestamp);this.cachedFrameRates.push(t),this.cachedFrameRates.length>30&&this.cachedFrameRates.shift(),this.analysisFrameRate()}this.lastTimestamp=e,this.timestampCount++}analysisFrameRate(){let e=i.Stat.getCoreAverageValues(this.cachedFrameRates,1.5);this.frameRate=e}getFrameRate(){return 3*Math.ceil(this.frameRate/3)}getFrameDuration(){return 1/this.getFrameRate()}}},8038:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deepEqual=t.deepClone=t.assignIf=t.assign=void 0,t.assign=function(e,t,r=Object.keys(t)){for(let i of r){let r=t[i];void 0!==r&&(e[i]=r)}return e},t.assignIf=function(e,t,r=Object.keys(t)){for(let i of r){let r=t[i];void 0!==r&&void 0===e[i]&&(e[i]=r)}return e},t.deepClone=function e(t,r=10){if("object"!=typeof t||!t||0===r)return t;if(Array.isArray(t))return t.map((t=>"object"==typeof t&&t?e(t,r-1):t));{let i={};for(let a of Object.keys(t)){let s=t[a];i[a]=e(s,r-1)}return i}},t.deepEqual=function e(t,r,i=10){if(t===r)return!0;if(0===i)return!1;if("object"!=typeof t||"object"!=typeof r||!t||!r)return!1;if(t.constructor!==r.constructor)return!1;let a=Object.keys(t),s=Object.keys(r);if(a.length!==s.length)return!1;for(let s of a){if(!r.hasOwnProperty(s))return!1;if(!e(t[s],r[s],i-1))return!1}return!0}},8066:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDrawMultiple=void 0;const i=r(1830),a=r(2440);class s extends a.ToDrawTransform{subTransformMatrixs=null;charOpacityList=null;setSubTransformMatrixes(e){this.subTransformMatrixs=e}setSubOpacityList(e){this.charOpacityList=e}getTransformMatrixByIndex(e){return this.transformStatus.transformMatrix.multiply(this.subTransformMatrixs[e])}draw(){if(this.subTransformMatrixs)for(let e=0;e<this.subTransformMatrixs.length;e++)this.drawFromIndex(e);else super.draw()}drawFromIndex(e){let t=this.subTransformMatrixs[e],r=this.charOpacityList[e],i=this.transformStatus.transformMatrix.multiply(t);this.setUniform("iTransform",i.toFloat32Array()),this.setUniform("iOpacity",r*this.transformStatus.opacity),super.draw(4*e,4)}getPaintArea(){let e=[];for(let t=0;t<this.coords.length/4;t++)e.push(this.getPaintAreaByIndex(t));return i.PaintArea.union(e)}getPaintAreaByIndex(e){let t=this.coords.slice(4*e,4*e+4),r=this.subTransformMatrixs?this.subTransformMatrixs[e]:null;return r?this.transformStatus.getProjectedPaintAreaAfterSubTransform(t,r):this.transformStatus.getProjectedPaintArea(t)}}t.ToDrawMultiple=s},8067:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 source = texture(iChannel[0], textureCoord0);\nvec4 dest = texture(iChannel[1], textureCoord1);\nreturn source.a > 0.5\n? dest * (1.0 - source.a) + dest * source\n: dest * (1.0 - source.a) + (dest * source.a + source - dest * source);\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},8086:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nvec4 getFragColor() {\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 color = texture(iChannel[0], textureCoord);\nvec4 alphaColor = texture(iChannel[1], textureCoord);\nfloat alpha = (alphaColor.r + alphaColor.g + alphaColor.b) / 3.0;\ncolor *= alpha * iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},8135:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderComplete=t.onRenderComplete=t.enqueueInnerWatcherToUpdate=t.enqueueWatcherToUpdate=t.enqueueComponentToUpdate=void 0;let r=new Set,i=new Set,a=new Set,s=[],n=!1,o=!1,l=[],c=[],d=[],h=new Map;function u(e){s.push(e),n||p()}function p(){requestAnimationFrame(m),n=!0}async function m(){do{for(let e=0;e<l.length;e++){let t=l[e];i.delete(t);let r=h.get(t)||0;if(h.set(t,r+1),r>3)console.warn(`Watcher "${t.toString()}" may change values in the watcher callback and cause infinite updating!`);else try{t.__updateImmediately()}catch(e){console.error(e)}}l=[],o=!0;for(let e=0;e<d.length;e++){let t=d[e];r.delete(t);try{t.__updateImmediately()}catch(e){console.error(e)}}d=[],o=!1;for(let e=0;e<c.length;e++){let t=c[e];a.delete(t);let r=h.get(t)||0;if(h.set(t,r+1),r>3)console.warn(`Watcher "${t.toString()}" may change values in the watcher callback and cause infinite updating!`);else try{t.__updateImmediately()}catch(e){console.error(e)}}c=[],await Promise.resolve()}while(d.length>0||l.length>0);n=!1,h=new Map;let e=s;s=[];for(let t of e)t()}t.enqueueComponentToUpdate=function(e){if(!r.has(e)){if(o){let t=h.get(e)||0;if(h.set(e,t+1),t>3){let t=e.el.outerHTML,r=t.length>100?t.slice(0,100)+"...":t;console.warn(`Component with element "${r}" may change values in the render function and cause infinite updating!`)}}r.add(e),d.push(e)}n||p()},t.enqueueWatcherToUpdate=function(e){o?e.__updateImmediately():(i.has(e)||(i.add(e),l.push(e)),n||p())},t.enqueueInnerWatcherToUpdate=function(e){a.has(e)||(a.add(e),c.push(e)),n||p()},t.onRenderComplete=u,t.renderComplete=function(){return new Promise((e=>{u(e)}))}},8219:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(2824),s=[{name:"maxPixelSizeRate",desc:"Max Pixel Size Rate",min:.01,max:1,step:.01,value:.1}];(0,i.extendTransitions)({"cube-pixelate":{uniformSlides:s,uniformValues:{rotatedAngle:0,glassMode:!1},sourceParams:{filter:a.SamplerFilter.MipmapLinear},targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{fragShaderName:"cube-pixelate"}]},"slant-cube-pixelate":{uniformSlides:s,uniformValues:{rotatedAngle:45,glassMode:!1},sourceParams:{filter:a.SamplerFilter.MipmapLinear},targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{fragShaderName:"cube-pixelate"}]},"glass-pixelate":{uniformSlides:s,uniformValues:{rotatedAngle:45,glassMode:!0},sourceParams:{filter:a.SamplerFilter.MipmapLinear},targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{fragShaderName:"cube-pixelate"}]},"cube-pixelate-noise":{uniformSlides:s,uniformValues:{rotatedAngle:0},steps:[{fragShaderName:"cube-pixelate-noise"}]},"slant-cube-pixelate-noise":{uniformSlides:s,uniformValues:{rotatedAngle:45},steps:[{fragShaderName:"cube-pixelate-noise"}]},"hexagon-pixelate-herizontal":{uniformSlides:s,uniformValues:{rotatedAngle:0},sourceParams:{filter:a.SamplerFilter.MipmapLinear},targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{fragShaderName:"hexagon-pixelate"}]},"hexagon-pixelate-vertical":{uniformSlides:s,uniformValues:{rotatedAngle:30},sourceParams:{filter:a.SamplerFilter.MipmapLinear},targetParams:{filter:a.SamplerFilter.MipmapLinear},steps:[{fragShaderName:"hexagon-pixelate"}]},"hexagon-pixelate-noise-herizontal":{uniformSlides:s,uniformValues:{rotatedAngle:0},steps:[{fragShaderName:"hexagon-pixelate-noise"}]},"hexagon-pixelate-noise-vertical":{uniformSlides:s,uniformValues:{rotatedAngle:30},steps:[{fragShaderName:"hexagon-pixelate-noise"}]}})},8231:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getClosestComponent=t.getComponentAsync=t.getComponent=t.setComponentAtElement=void 0;const i=r(967),a=new WeakMap;function s(e){return a.get(e)}t.setComponentAtElement=function(e,t){a.set(e,t)},t.getComponent=s,t.getComponentAsync=function(e){if(e.localName.includes("-")){let t=a.get(e);return t?Promise.resolve(t):new Promise((t=>{i.onComponentCreatedAt(e,t)}))}return Promise.resolve(void 0)},t.getClosestComponent=function(e,t){let r=e;for(;r&&r instanceof HTMLElement;){if(r.localName.includes("-")){let e=s(r);if(e instanceof t)return e}r=r.parentElement}return null}},8240:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.theme=t.Theme=void 0;const i=r(1416),a=r(5499),s=r(8854);class n{constructor(){this.themeMap=new Map,this.willUpdate=!1,this.mode="light",this.options=Object.assign({},o,l)}defineTheme(e,t){this.themeMap.set(e,t)}getThemeDrakOrLightMode(e){if(e.backgroundColor){let[t,r,i]=new s.Color(e.backgroundColor).getRGBA();if(a.avg([t,r,i])<.5)return"dark"}else if(e.textColor){let[t,r,i]=new s.Color(e.textColor).getRGBA();if(a.avg([t,r,i])>.5)return"dark"}return"light"}changeTheme(...e){for(let t of e){if(!this.themeMap.has(t))throw new Error(`"${t}" is not a defined theme`);Object.assign(this.options,this.themeMap.get(t))}this.mode=this.getThemeDrakOrLightMode(this.options),this.update()}set(e,t){this.options[e]=t,this.update()}async update(){this.willUpdate||(this.willUpdate=!0,await Promise.resolve(),i.updateComponents(),i.updateStyles(),this.willUpdate=!1)}getOption(e){return this.options[e]}get adjustFontSize(){return e=>Math.max(Math.round(e*this.fontSize/l.fontSize),11)}get adjust(){return e=>Math.round(e*this.lineHeight/l.lineHeight)}get mainColor(){return new s.Color(this.getOption("mainColor"))}get backgroundColor(){return new s.Color(this.getOption("backgroundColor"))}get textColor(){return new s.Color(this.getOption("textColor"))}get successColor(){return new s.Color(this.getOption("successColor"))}get errorColor(){return new s.Color(this.getOption("errorColor"))}get warningColor(){return new s.Color(this.getOption("warningColor"))}get infoColor(){return new s.Color(this.getOption("infoColor"))}get borderColor(){return new s.Color(this.getOption("borderColor"))}get borderRadius(){return this.getOption("borderRadius")}get popupBackgroundColor(){return new s.Color(this.getOption("popupBackgroundColor"))}get popupBorderRadius(){return this.getOption("popupBorderRadius")}get popupShadowBlurRadius(){return this.getOption("popupShadowBlurRadius")}get popupShadowColor(){return new s.Color(this.getOption("popupShadowColor"))}get focusBlurRadius(){return this.getOption("focusBlurRadius")}get fontSize(){return this.getOption("fontSize")}get lineHeight(){return this.getOption("lineHeight")}}t.Theme=n;const o={mainColor:"#3a6cf6",backgroundColor:"#fff",textColor:"#000",infoColor:"#3369fa",successColor:"#29bc04",errorColor:"#e10000",warningColor:"#f3b907",borderColor:"#9b9b9b",popupBackgroundColor:"#fff",popupShadowColor:"rgba(0, 0, 0, 0.4)"},l={borderRadius:4,popupBorderRadius:4,popupShadowBlurRadius:6,focusBlurRadius:6,fontSize:14,lineHeight:28};t.theme=new n,t.theme.defineTheme("light",o),t.theme.defineTheme("dark",{mainColor:"#3a6cf6",backgroundColor:"#333",textColor:"#eee",borderColor:"#888",popupBackgroundColor:"#333",popupShadowColor:"rgba(0, 0, 0, 0.6)"}),t.theme.defineTheme("small",{fontSize:13,lineHeight:24}),t.theme.defineTheme("medium",l),t.theme.defineTheme("large",{fontSize:16,lineHeight:32}),t.theme.defineTheme("touch",{fontSize:18,lineHeight:46})},8248:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextMenu=void 0;const a=r(1416),s=r(8240),n=r(9782);let o=class extends n.Popup{constructor(){super(...arguments),this.triangle=!1}static style(){let{adjust:e}=s.theme;return a.css`
		${super.style()}
		:host{
			position: fixed;
			border-radius: 0;
			
			.option__f-list{
				padding: ${e(2)}px ${e(8)}px;
			}

			f-list{
				border-bottom: none;
			}
		}
		`.extends(super.style())}};o=i([a.define("f-contextmenu")],o),t.ContextMenu=o},8259:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.RadioGroup=t.Radio=void 0;const a=r(1416),s=r(8240);let n=class extends a.Component{constructor(){super(...arguments),this.checked=!1,this.radioGroup=null,this.value=null}static style(){let{mainColor:e,adjust:t,focusBlurRadius:r}=s.theme;return a.css`
		:host{
			display: inline-flex;
			vertical-align: top;
			align-items: center;
			cursor: pointer;

			&:hover{
				color: ${e};
			}

			&:focus{
				color: ${e};

				.icon{
					box-shadow: 0 0 ${r}px ${e};
				}
			}
		}

		.icon{
			border-radius: 50%;
			margin-right: ${t(6)}px;
		}

		.checked{
			color: ${e};
		}
	
		.label{
			flex: 1;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		`}render(){return a.html`
			<template
				tabindex="0"
				:class.checked=${this.checked}
				@@click=${this.onClick}
				@@focus=${this.onFocus}
			>
				<f-icon class="icon" .type=${this.checked?"radio-checked":"radio-unchecked"} />
				<div class="label">
					<slot />
				</div>
			</template>
		`}onCreated(){let e=a.getClosestComponent(this.el,o);e&&(this.radioGroup=e,this.checked=this.radioGroup.value==this.value,this.radioGroup.register(this))}onClick(){this.checked||(this.checked=!0,this.emit("change",!0))}onFocus(){this.checked||(a.once(this.el,"blur",this.onBlur,this),a.once(document,"keydown.enter",this.onEnter,this))}onBlur(){a.off(document,"keydown",this.onEnter,this)}onEnter(){this.onClick()}};n=i([a.define("f-radio")],n),t.Radio=n;let o=class extends a.Component{constructor(){super(...arguments),this.value=null,this.radios=[]}register(e){this.radios.push(e),e.on("change",this.onRadioChange.bind(this,e))}onRadioChange(e){for(let t of this.radios)t!==e&&(t.checked=!1);this.value=e.value,this.emit("change",this.value)}};o=i([a.define("f-radiogroup")],o),t.RadioGroup=o},8272:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextAtlasState=void 0;const i=r(641),a=r(62),s=r(5499),n=r(4072);t.TextAtlasState=class{text="";interfaceScaling;transformScaling;textSuperSamplingRate;values;idenfitier=null;canvasId=0;charPositionIdenfitier=null;contextState;renderIn;fontMeasurement;constructor(e={}){this.interfaceScaling=e.interfaceScaling||1,this.transformScaling=e.transformScaling||1,this.textSuperSamplingRate=e.textSuperSamplingRate||2}generateContextStateIdentifier(){let e=this.values;return{fontFamily:e.fontFamily,fontSize:e.fontSize,fontStyle:e.fontStyle,fauxBold:e.fauxBold,fauxItalic:e.fauxItalic,fillColor:e.fillColor,strokeColor:e.strokeWidth?e.strokeColor:void 0,strokeWidth:e.strokeColor?e.strokeWidth:void 0,scaling:this.interfaceScaling*this.transformScaling}}generateCharPositionIdentifier(){let e=this.values;return{contextStateId:this.canvasId,fontFamily:e.fontFamily,fontSize:e.fontSize,fontStyle:e.fontStyle,fauxBold:e.fauxBold,fauxItalic:e.fauxItalic,tracking:e.tracking,strokeWidth:e.strokeColor?e.strokeWidth:void 0,text:this.text,scaling:this.interfaceScaling*this.transformScaling}}shouldUpdateContextState(){let e=this.generateContextStateIdentifier(),t=!(0,s.deepEqual)(e,this.idenfitier);return t&&(this.prepareContextState(),this.idenfitier=e),t}onCanvasUpdated(){this.canvasId++}prepareContextState(){let{fillColor:e,strokeColor:t,strokeWidth:r,fontSize:s,fontFamily:n}=this.values,o=this.interfaceScaling*this.transformScaling*this.textSuperSamplingRate,l=Math.round(s*o),c={},d=this.getFontStyle();c.font=`${d||""} ${l}px "${n}"`,c.textAlign="left",c.textBaseline="alphabetic",c.lineWidth=(r||0)*o,c.fillStyle=(0,a.colorArrayToString)(e),c.strokeStyle=(0,a.colorArrayToString)(t),this.contextState=c,this.fontMeasurement=(0,i.getFontMeasurement)(n,this.values.fontStyle),this.prepareRenderInProperties(l,d)}prepareRenderInProperties(e,t){let{leftBearing:r,rightBearing:i,ascent:a,yMax:s,boxHeight:n}=this.fontMeasurement;t.includes("italic")&&(i+=.15);let o=Math.ceil(e*(this.fontMeasurement.yMax-this.fontMeasurement.yMin)),l=Math.ceil(e*r)+2,c=Math.ceil(e*i)+2;this.renderIn={fontSize:e,maxHeight:o,boxHeight:e*n,ascent:e*a,yMax:e*s,leftBearing:l,rightBearing:c}}getFontStyle(){let e=n.FontList.getCSSFontWeight(this.values.fontStyle),t=n.FontList.getCSSFontStyle(this.values.fontStyle);return this.values.fauxBold&&"normal"===e&&(e="bold"),this.values.fauxItalic&&"normal"===t&&(t=" italic"),"normal"===e&&(e=""),"normal"===t&&(t=""),(e+t).trim()}shouldUpdateCharPosition(){let e=this.generateCharPositionIdentifier(),t=!(0,s.deepEqual)(e,this.charPositionIdenfitier);return t&&(this.charPositionIdenfitier=e),t}}},8286:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 source = texture(iChannel[0], textureCoord0);\nvec4 dest = texture(iChannel[1], textureCoord1);\nreturn dest * (1.0 - source.a) + abs(dest * source.a - source);\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},8320:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),r(4711),r(9276)},8325:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.storage=void 0;class r{constructor(e){this.prefix="",this.expireSuffix="_expires_",this.supported=null,this.prefix=e}isSupported(){if(null!==this.supported)return this.supported;try{let e=this.prefix+"test_supported";return localStorage[e]=1,delete localStorage[e],!0}catch(e){return!1}}has(e){return this.isSupported()?(e=this.prefix+e)in localStorage:null}get(e,t=null){if(!this.isSupported())return null;e=this.prefix+e;let r=localStorage[e];if(void 0===r)return t;if(!r||"string"!=typeof r)return t;try{r=JSON.parse(r);let i=localStorage[e+this.expireSuffix];return i&&i<Date.now()?(delete localStorage[e],delete localStorage[e+this.expireSuffix],t):r}catch(e){return t}}set(e,t,r){return this.isSupported()?(e=this.prefix+e,localStorage[e]=JSON.stringify(t),r&&r>0&&(localStorage[e+this.expireSuffix]=Date.now()+1e3*r),!0):null}delete(e){return this.isSupported()?(e=this.prefix+e,delete localStorage[e+this.expireSuffix],delete localStorage[e]):null}group(e){return new r(this.prefix+"_"+e)}}t.storage=new r("_ff_")},8334:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyPart=void 0;const i=r(9856);t.PropertyPart=class{constructor(e,t,r,i){this.com=null,this.value=void 0,this.el=e,this.name="."===t[0]?t.slice(1):t,this.isComProperty=e.localName.includes("-")&&"."!==t[0],this.fixed=i,this.isComProperty?(this.bindCom(),this.updateComProperty(r)):this.updateElementProperty(r)}bindCom(){let e=i.getComponent(this.el);e?this.com=e:i.onComponentCreatedAt(this.el,this.onComCreated.bind(this))}onComCreated(e){this.com=e,this.setComProperty(this.value),this.value=void 0}updateComProperty(e){this.com?this.setComProperty(e):this.value=e}setComProperty(e){this.fixed?this.setFixedComProperty(e):this.com[this.name]=e}setFixedComProperty(e){let t=this.com,r=typeof t[this.name];switch("object"!==r||/^\s*(?:\{.+?\}|\[.+?\])\s*$/.test(e)||(r="string"),r){case"boolean":t[this.name]="false"!==e;break;case"number":t[this.name]=Number(e);break;case"object":t[this.name]=JSON.parse(e);break;default:"undefined"!==r?t[this.name]=e:console.warn(`Please makesure value of property "${this.name}" exist on "<${t.el.localName} />" when assigning fixed property!`)}}updateElementProperty(e){this.el[this.name]!==e&&(this.el[this.name]=e)}update(e){this.isComProperty?this.updateComProperty(e):this.updateElementProperty(e)}remove(){}}},8341:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Effect=void 0;const i=r(7905),a=r(7928),s=r(6376),n=r(5305),o=r(9658);class l extends o.Drawer{ready;toDraw;isFullscreenEffect;constructor(e,t){super(e,t),this.isFullscreenEffect=(0,i.isFullscreenEffect)(t.type),this.ready=Promise.resolve().then((()=>this.initialize())),a.debug.verbose(`${this.constructor.name} ${this.data.id} created`)}async initialize(){}setMappedChannel(...e){this.toDraw.setMappedChannel(...e)}clearChannel(){this.toDraw.clearChannel()}setTransformStatus(e){this.transformStatus=e,this.isFullscreenEffect?this.toDraw.setTransformStatus(e):this.toDraw.setTransformStatus(e.cloneOpacity())}update(){if(void 0!==this.data.effectOpacity){let e=(0,s.getPropertyValue)(this.data.effectOpacity,this.time,n.EffectDefaultValues.effectOpacity)/100;this.toDraw.setUniform("effectOpacity",e)}}setMaskArea(e){this.toDraw.setMaskArea(e)}draw(e){return this.toDraw.draw(),e}delete(){this.toDraw.delete(),a.debug.verbose(`${this.constructor.name} ${this.data.id} deleted`)}}t.Effect=l},8352:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;const a=r(1416),s=r(8240);let n=class extends a.Component{constructor(){super(...arguments),this.closable=!1}static style(){let{borderColor:e,borderRadius:t,adjust:r,adjustFontSize:i}=s.theme;return a.css`
		:host{
			display: inline-flex;
			border: 1px solid ${e};
			border-radius: ${t}px;
			font-size: ${i(13)}px;
			line-height: ${r(18)}px;
			height: ${r(20)}px;
			padding: 0 ${r(6)}px 0 ${r(6)}px;
			cursor: pointer;

			&:hover{
				opacity: 0.9;
			}

			&:active{
				opacity: 0.8;
			}
		}
	
		.icon{
			margin-left: ${r(4)}px;
			display: inline-flex;

			f-icon{
				margin: auto;
			}
		}
		`}render(){return a.html`
			<slot />
			${this.closable?a.html`<div class="icon" @@click=${this.close}><f-icon .type="close" /></div>`:""}
		`}close(){this.emit("close")}};n=i([a.define("f-tag")],n),t.Tag=n},8369:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DropShadowLayerStyle=void 0;const i=r(6376),a=r(5305),s=r(1830),n=r(555),o=r(2298),l=r(5468),c=r(3975),d=r(62),h=r(8936),u=r(6339),p=r(4452);class m extends h.LayerStyle{toBlendShadow;values;shadowTranslateMatrix;async initialize(){this.toBlendShadow=new u.ToDrawEffect({renderer:this.renderer,fragCode:c.default});let e=this.renderer.project.options.dropShadowRenderingIterateCount,t=4*(this.data.size?(0,i.getMaxPropertyValue)(this.data.size):0)*this.renderer.scaleRatio;this.toDraw=new l.ToDrawDropShadow({renderer:this.renderer,iterateCount:e,samplingCount:t})}setMappedChannel(e){this.toBlendShadow.setMappedChannel(e),this.toDraw.setMappedChannel(e)}clearChannel(){this.toDraw.clearChannel()}setTime(e){super.setTime(e),this.values=(0,i.getPropertyValues)(this.data,e,a.LayerStyleDropShadowDefaultValues)}update(){let{width:e,height:t}=this.renderer.project.data,{distance:r,angle:i}=this.values,a=this.transformStatus.projectVector(p.Vector2.fromAngle(180-i).multiplyScalarSelf(r)),s=(new o.Matrix4).translateSelf(a.x,a.y),l=this.values.opacity/100*this.transformStatus.opacity,c=new n.TransformStatus(e,t,s,l);this.shadowTranslateMatrix=s,this.toDraw.setTransformStatus(c);let h=this.transformStatus.projectVector(new p.Vector2(this.values.size/2,this.values.size/2));this.toDraw.setBlurRadius(h),this.toDraw.setUniform("shadowColor",(0,d.premultiplyColorArray)(this.values.color))}setMaskArea(e){this.toBlendShadow.setMaskArea(e),this.toDraw.setMaskArea(e)}setFillOpacity(e){this.toBlendShadow.setUniform("fillOpacity",e)}draw(e){this.toDraw.setInputPaintArea(e);let t=this.toDraw.drawAsSampler(),r=s.PaintArea.union([this.toDraw.getPaintArea(),e]);return this.toBlendShadow.setInputPaintArea(r),this.toBlendShadow.setSubMappedChannel(1,t),this.toBlendShadow.draw(),this.toBlendShadow.clearChannel(),r}delete(){super.delete(),this.toBlendShadow.delete()}}t.DropShadowLayerStyle=m},8457:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.liveRepeat=t.LiveRepeatDirective=void 0;const i=r(5428),a=r(4850),s=r(8948),n=r(7860),o=r(2736),l=r(8135),c=r(6925),d=r(9395),h=r(5055),u={pageSize:50,renderPageCount:1,preRendering:!1};class p extends o.RepeatDirective{constructor(e,t){super(e,t),this.averageItemHeight=0,this.options=new h.Options(u),this.needToApplyStartIndex=!1,this.continuousScrollDirection=null,this.continuousSliderPosition=null,this.scrollerBorderTopWidth=0,this.scrollerBorderBottomWidth=0,this.toCompleteRendering=null,this.rawData=null,this.toCompletePreRendering=null,this.preRenderStartIndex=0,this.preRendered=new Map,this.initElements()}async initElements(){if(this.slider=this.anchor.el.parentElement,this.scroller=this.slider.parentElement,!this.slider||!this.scroller||1!==this.scroller.children.length)throw new Error('"liveRepeat" must be contained in the struct like "\n\t\t\t\t<div style="overflow: auto | scroll; position: relative" title="as a scroll parent">\n\t\t\t\t\t<div title="as a scroll slider" style="position: absolute">\n\t\t\t\t\t\t${liveRepeat(...)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"');s.on(this.scroller,"scroll.passive",this.onScroll,this),l.onRenderComplete((()=>{let e=getComputedStyle(this.scroller);if(!["scroll","auto"].includes(e.overflowY))throw'The "overflow-y" value of "scroller" out of "liveRepeat" directive must be "scroll" or "auto"';if("static"===e.position)throw'The "position" value of "scroller" out of "liveRepeat" directive must not be "static"';if("absolute"!==getComputedStyle(this.slider).position)throw'The "position" value of "slider" out of "liveRepeat" directive must not be "absolute"';this.scrollerBorderTopWidth=Number(getComputedStyle(this.scroller).borderTopWidth.replace("px",""))||0,this.scrollerBorderBottomWidth=Number(getComputedStyle(this.scroller).borderBottomWidth.replace("px",""))||0}))}canMergeWith(e,t){return t.toString()===this.templateFn.toString()}merge(e,t,r){let i=!this.options.updated;if(this.options.update(e),this.templateFn=t,this.transition.updateOptions(r),void 0!==e.data){if(i&&e.data&&e.startIndex>0){let t=this.options.get("pageSize")*this.options.get("renderPageCount"),r=Math.min(e.startIndex,e.data.length-t);this.startIndex=Math.max(0,r),this.needToApplyStartIndex=!0}this.watchRawDataAndUpdate(e.data)}}watchRawDataAndUpdate(e){this.unwatchData&&(this.unwatchData(),this.unwatchData=null),e?this.unwatchData=(this.context||n.globalWatcherGroup).watchImmediately((()=>[...e].map(d.observe)),(e=>{this.rawData=e,this.update()})):this.rawData=[]}async update(){this.updateSliderPosition();let e=this.getLimitedEndIndex(),t=this.rawData?this.rawData.slice(this.startIndex,e):[];this.toCompleteRendering=this.updateData(t),await this.toCompleteRendering,this.toCompleteRendering=null,this.options.get("preRendering")&&this.checkPreRendering()}async updateData(e){super.updateData(e);let t=this.options.get("onUpdated");t&&t(this.data,this.startIndex),await l.renderComplete(),this.data.length>0&&(this.averageItemHeight||(this.measureAverageItemHeight(),this.updateSliderPosition()),this.needToApplyStartIndex&&this.averageItemHeight&&(this.scroller.scrollTop=this.averageItemHeight*this.startIndex||0,this.needToApplyStartIndex=!1))}limitStartIndex(e){let t=this.options.get("pageSize")*this.options.get("renderPageCount"),r=this.limitEndIndex(e+t);return Math.max(0,r-t)}limitEndIndex(e){let t=this.getTotalDataCount();return t>=0&&e>t&&(e=t),e}getLimitedEndIndex(){let e=this.options.get("pageSize")*this.options.get("renderPageCount");return this.limitEndIndex(this.startIndex+e)}getTotalDataCount(){return this.rawData?this.rawData.length:0}updateSliderPosition(){let e=this.startIndex,t=0,r=this.getLimitedEndIndex(),i=this.getTotalDataCount();i>=0&&(t=Math.max(0,i-r));let a=this.averageItemHeight*e;this.continuousScrollDirection&&e>0&&(a=this.continuousSliderPosition);let s=this.averageItemHeight*t;"up"===this.continuousScrollDirection&&e>0?(a<this.averageItemHeight&&(a=this.averageItemHeight),this.slider.style.top="auto",this.slider.style.bottom="-"+this.averageItemHeight*t+"px"):(this.slider.style.top="0",this.slider.style.bottom="auto"),this.slider.style.marginBottom=s+"px",this.slider.style.transform=`translateY(${a}px)`}measureAverageItemHeight(){if(0===this.data.length)return;let e=this.slider.offsetHeight;e<=0||(this.averageItemHeight=Math.round(e/this.data.length))}getElementOfIndex(e){let t=this.wtems[e-this.startIndex];return t?t.template.range.getFirstElement():null}async onScroll(){this.checkRenderedRange()}checkRenderedRange(){let e=this.scroller.getBoundingClientRect(),t=this.slider.getBoundingClientRect();e.top<t.top?this.updateToCover("up"):e.bottom>t.bottom&&this.updateToCover("down")}async updateToCover(e){let t=this.options.get("pageSize")*this.options.get("renderPageCount"),r=-1;if("up"===e){let e=this.locateLastVisibleIndex();e>-1&&(r=e+1-t)}else{let e=this.locateFirstVisibleIndex();e>-1&&(r=e)}-1===r&&(r="up"===e?Math.ceil((this.scroller.scrollTop+this.scroller.clientHeight)/this.averageItemHeight)-t:Math.floor(this.scroller.scrollTop/this.averageItemHeight)),r=this.limitStartIndex(r);let i=this.limitEndIndex(r+t);this.validateContinuousScrolling(e,r,i),this.startIndex=r,this.update()}locateFirstVisibleIndex(){return this.locateVisibleIndex(!0)}locateLastVisibleIndex(){return this.locateVisibleIndex(!1)}locateVisibleIndex(e){let t=this.scroller.getBoundingClientRect(),r=c.binaryFindIndexToInsert(this.wtems,(r=>{let i=r.template.range.getFirstElement();if(i){let r=i.getBoundingClientRect();return r.bottom<=t.top?1:r.top>=t.bottom||e?-1:1}return-1}));if(r===this.data.length&&(r-=1),-1===r)return-1;let i=this.wtems[r].template.range.getFirstElement().getBoundingClientRect();return i.bottom<=t.top?r+=1:i.top>=t.bottom&&(r-=1),r>=0&&r<this.data.length?this.startIndex+r:-1}validateContinuousScrolling(e,t,r){let i="down"===e?t:r,a=this.continuousScrollDirection===e,s=this.getElementOfIndex(i);if(null!==s)if(this.continuousScrollDirection=e,"down"===e){let e=a?this.continuousSliderPosition:this.getSliderTopPosition();e+=s.getBoundingClientRect().top-this.slider.getBoundingClientRect().top,this.continuousSliderPosition=e}else{let e=a?this.continuousSliderPosition:this.getSliderBottomPosition();e+=s.getBoundingClientRect().bottom-this.slider.getBoundingClientRect().bottom,this.continuousSliderPosition=e}else this.continuousScrollDirection=null}getSliderTopPosition(){let e=this.scroller.getBoundingClientRect().top-this.scrollerBorderTopWidth;return this.slider.getBoundingClientRect().top-e+this.scroller.scrollTop}getSliderBottomPosition(){let e=this.scroller.getBoundingClientRect().bottom+this.scrollerBorderBottomWidth;return this.slider.getBoundingClientRect().bottom-e+this.scroller.scrollTop}async checkPreRendering(){this.toCompletePreRendering||(this.toCompletePreRendering=this.doingUpdatePreRendering(),await this.toCompletePreRendering,this.toCompletePreRendering=null)}async doingUpdatePreRendering(){await m(),await this.updatePreRendering()}async updatePreRendering(){let e=this.getTotalDataCount(),t=this.options.get("pageSize")*this.options.get("renderPageCount"),r=Math.max(0,this.startIndex-t),i=Math.min(e,this.startIndex+2*t),s=performance.now(),n=await this.getDataBetweens(r,i),o=new Set(n);for(let e of this.preRendered.keys())o.has(e)||(this.preRendered.get(e).remove(),this.preRendered.delete(e));for(let e=0;e<n.length;e++){let t=n[e],i=e+r;if(!this.preRendered.has(t)){let e=new a.WatchedTemplate(this.context,this.templateFn,t,i);e.template.preRender(),this.preRendered.set(t,e)}if(e%10==0){let e=performance.now();if(e-s>10&&(s=e,await m(),this.toCompleteRendering))return}}this.preRenderStartIndex=r}async getDataBetweens(e,t){return this.rawData?this.rawData.slice(e,t):[]}shouldReuse(e){return!this.options.get("preRendering")||!this.preRendered.has(e)}reuseOne(e,t,r){this.options.get("preRendering")&&(this.preRendered.delete(e.item),this.preRendered.set(t,e)),super.reuseOne(e,t,r)}createWatchedTemplate(e,t){if(this.options.get("preRendering")){if(this.preRendered.has(e))return this.preRendered.get(e);{let r=super.createWatchedTemplate(e,t);return this.preRendered.set(r.item,r),r}}return super.createWatchedTemplate(e,t)}onWatchedTemplateNotInUse(e){this.options.get("preRendering")&&this.preRendered.delete(e.item),e.remove()}getStartIndex(){return this.startIndex}getFirstVisibleIndex(){return Math.max(0,this.locateFirstVisibleIndex())}async setStartIndex(e){this.startIndex=this.limitStartIndex(e),this.needToApplyStartIndex=!0,this.continuousScrollDirection=null,await l.renderComplete(),this.toCompleteRendering&&await this.toCompleteRendering,this.needToApplyStartIndex&&await this.update()}async scrollToViewIndex(e){if(this.isIndexRendered(e))this.scrollToViewRenderedIndex(e);else if(e<this.startIndex)await this.setStartIndex(e);else{let t=Math.max(0,e+1-Math.ceil(this.scroller.clientHeight/this.averageItemHeight));await this.setStartIndex(t),this.isIndexRendered(e)&&this.scrollToViewRenderedIndex(e)}}isIndexRendered(e){return e>=this.startIndex&&e<this.startIndex+this.data.length}scrollToViewRenderedIndex(e){let t=this.wtems[e-this.startIndex].template.range.getFirstElement().getBoundingClientRect(),r=this.scroller.getBoundingClientRect();t.bottom>r.bottom?this.scroller.scrollTop=this.scroller.scrollTop+(r.bottom-t.bottom):t.top<r.top&&(this.scroller.scrollTop=this.scroller.scrollTop+(r.top-t.top))}remove(){if(this.unwatchData&&this.unwatchData(),this.options.get("preRendering"))for(let e of this.preRendered.values())e.remove();else for(let e of this.wtems)e.remove()}}function m(){return new Promise((e=>{requestAnimationFrame(e)}))}t.LiveRepeatDirective=p,t.liveRepeat=i.defineDirective(p)},8470:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;const i=r(4411),a=r(5499),s=r(1954),n=r(1326),o=r(1118),l=r(7173),c=r(4975),d=r(1583);class h{project;main;media;info=new c.LocalSceneInfo;text;marginLeft=0;marginRight=0;includedTransitions=!1;canSetDuration=!1;startDuration;startText;startFontFamily;startFontStyle;startFontSize;startFillColor;crossed;constructor(e,t,r,i){this.project=e,this.main=t||r,this.media=t,this.text=r,this.crossed=i,this.startDuration=this.main.root.outPoint-this.main.root.inPoint,this.startText=r?r.layers[0].text:"",this.startFontSize=r?r.layers[0].fontSize:null,this.startFontFamily=r?r.layers[0].fontFamily:null,this.startFontStyle=r?r.layers[0].fauxBold?"Bold":r.layers[0].fontStyle:null,this.startFillColor=r?r.layers[0].fillColor:null,this.info.duration=this.getDuration(),this.media?this.initializeInfoFromMediaLayer():this.initializeCoverAsThumbnail()}get canBeRemoved(){return!!this.media}get canBeMoved(){return!!this.media}initializeAfterAllScenesCreated(){this.initializeSegmentClippingForLongCrossed(),this.includedTransitions=this.crossed.some((e=>(e.inPoint+.1<this.main.root.inPoint||e.outPoint>this.main.root.outPoint+.1)&&e.outPoint-e.inPoint<.8*(this.main.root.outPoint-this.main.root.inPoint)));let e=[...this.getRootLayers(),...this.crossed].some((e=>(0,i.findUnReplacableVideoLayersInside)(this.project,e).some((e=>e.outPoint-e.inPoint>.99*this.startDuration&&!(e.loop&&e.loop>1)))));this.canSetDuration=!e}getRootLayers(){let e=[this.main.root];return this.media&&this.media.root.id!==this.main.root.id&&e.push(this.media.root),this.text&&this.text.root.id!==this.main.root.id&&e.push(this.text.root),e}initializeSegmentClippingForLongCrossed(){for(let e=0;e<this.crossed.length;e++){let t=this.crossed[e],r=t.outPoint-t.inPoint,i=t.loop||1;if(r<2*this.startDuration||i>1)continue;let a=this.project.data.cloneLayerData(t);if(this.project.data.ensureTimeRemap(a),a.inPoint=this.main.root.inPoint,a.outPoint=this.main.root.outPoint,this.marginLeft>0&&(a.inPoint-=this.marginLeft),this.marginRight>0&&(a.outPoint+=this.marginRight),"video"===a.type||"composite"===a.type){let e=a.timeRemap,r=a.inPoint-t.inPoint;if(Array.isArray(e)){for(let t of e)t.time+=r,t.value+=r;if(2===e.length&&e[1].time>a.outPoint){let t=a.outPoint-e[1].time;e[1].time+=t,e[1].value+=t}}else a.timeRemap+=r}this.crossed[e]=a,this.project.data.insertRootLayerData(a)}}initializeInfoFromMediaLayer(){let e=this.media.layers[0];this.info.mediaType=e.type,this.info.mediaPath=this.project.resourceLoader.getLayerPath(e),this.info.mediaWidth=e.mediaWidth,this.info.mediaHeight=e.mediaHeight,this.info.mediaPosition=e.mediaPosition,"video"===e.type&&(this.info.mediaFrameRate=e.frameRate,this.info.mediaDuration=e.duration)}initializeCoverAsThumbnail(){this.main.root.inPoint<1?this.info.thumbnailPath=this.project.footages.getCoverPath()||"":this.info.thumbnailPath=this.project.footages.getBackCoverPath()||""}async setMediaFile(e){let t=(0,o.getPathExtension)(e.name);this.info.mediaType="mp4"===t?"video":"image",this.info.updateMediaPath(URL.createObjectURL(e));let r=await this.getCurrentMediaElement();await this.fetchInfoFromFile(e,r),await this.ensureMediaInfoDatas(r),this.canSetDuration&&this.resetDuration()}async fetchInfoFromFile(e,t){let r=this.getElementSize(t),i=this.info;if(i.name=e.name,i.mediaWidth=r.width,i.mediaHeight=r.height,i.replaced=!0,"video"===i.mediaType){let t=await l.ffmpeg.getFFFileFromFile(e),r=await l.ffmpeg.getMediaInfo(t);i.mediaFrameRate=r.video.frameRate,i.mediaDuration=r.duration}let a=await d.PicoFace.getFaces(t,25),s=d.PicoFace.getTotalFaceAlignPosition(a);return s&&(i.mediaPosition=[s.x,s.y]),i}getElementSize(e){let t,r;return e instanceof HTMLVideoElement?(t=e.videoWidth,r=e.videoHeight):(t=e.naturalWidth,r=e.naturalHeight),{width:t,height:r}}async ensureMediaInfoDatas(e){if(this.media&&(!this.info.croppedPath||!this.info.thumbnailPath)){e=e||await this.getCurrentMediaElement();let t=Math.round(this.info.croppedHeight*this.project.data.aspectRatio)===this.info.croppedWidth;this.info.croppedPath&&t||await this.updateCroppedMedia(e),this.info.thumbnailPath||await this.updateThumbnail(e)}}async getCurrentMediaElement(){return await this.getMediaElement(this.info.mediaPath,this.info.mediaType)}async getMediaElement(e,t){let r;return r="video"===t?await(0,n.preloadVideo)(e):await(0,n.preloadImage)(e),r}async updateCroppedMedia(e){if(this.shouldCropMedia()){e=e||await this.getCurrentMediaElement();let t=await(0,s.cropImageToMaximumSize)(e,this.project.data.width,this.project.data.height,this.info.mediaPosition),r=await(0,s.readCanvasAsJPEG)(t);this.info.updateCroppedPath(URL.createObjectURL(r)),this.info.croppedWidth=t.width,this.info.croppedHeight=t.height}else this.info.updateCroppedPath(this.info.mediaPath),this.info.croppedWidth=this.info.mediaWidth,this.info.croppedHeight=this.info.mediaHeight;this.applyMediaInfo()}shouldCropMedia(){if("image"!==this.info.mediaType)return!1;let e=this.info.mediaWidth,t=this.info.mediaHeight;return e>this.project.data.width||t>this.project.data.height||Math.round(t*this.project.data.aspectRatio)!==e}async updateThumbnail(e){let t;if((e=e||await this.getCurrentMediaElement())instanceof HTMLVideoElement){let r=e,i=await(0,s.extractVideoFrame)(r),a=await(0,s.readCanvasAsJPEG)(i);t=await(0,n.preloadImage)(URL.createObjectURL(a))}else t=e;let r=180*this.project.data.aspectRatio*devicePixelRatio,i=180*devicePixelRatio,a=await(0,s.createSameAspectRatioImageThumbnail)(t,r,i),o=await(0,s.readCanvasAsJPEG)(a);this.info.updateThumbnailPath(URL.createObjectURL(o))}setUserInfo(e,t=!0){e instanceof c.LocalSceneInfo?this.setInfo(e,t):this.setInfo(new c.LocalSceneInfo(e),t)}setInfo(e,t=!0){this.info=e,this.applyMediaInfo(),this.applyTextInfo(),t&&this.canSetDuration?this.setDuration(e.duration):e.duration=this.getDuration()}applyMediaInfo(){let e=this.info;this.media&&this.media.layers.forEach((t=>{t.name=e.name,t.path=e.croppedPath,t.mediaWidth=e.croppedWidth,t.mediaHeight=e.croppedHeight,t.mediaPosition=e.mediaPosition,"video"===e.mediaType?(t.type="video",t.frameRate=e.mediaFrameRate,t.duration=e.mediaDuration):(t.type="image",delete t.frameRate,delete t.duration)}))}applyTextInfo(){let e=this.info;this.text?this.text.layers.forEach((t=>{t.text=null===e.text?this.startText:e.text,t.fontFamily=null===e.fontFamily?this.startFontFamily:e.fontFamily,t.fontStyle=null===e.fontStyle?this.startFontStyle:e.fontStyle,t.fontSize=null===e.fontSize?this.startFontSize:e.fontSize,t.fillColor=null===e.fillColor?this.startFillColor:e.fillColor})):e.text=null}setText(e){this.text&&(this.text.layers.forEach((t=>{t.text=e})),this.info.text=e,this.info.toTouch())}setFontFamily(e,t=!1){this.text&&(this.text.layers.forEach((t=>{t.fontFamily=e})),this.info.fontFamily=e,t&&this.info.toTouch())}setFontStyle(e,t=!1){this.text&&(this.text.layers.forEach((t=>{t.fontStyle=e,t.fauxBold&&delete t.fauxBold})),this.info.fontStyle=e,t&&this.info.toTouch())}setFontSize(e,t=!1){this.text&&(this.text.layers.forEach((t=>{t.fontSize=e})),this.info.fontSize=e,t&&this.info.toTouch())}setFillColor(e,t=!1){this.text&&(this.text.layers.forEach((t=>{t.fillColor=e})),this.info.fillColor=e,t&&this.info.toTouch())}notifyMediaChanged(){this.media&&this.media.layers.forEach((e=>{this.project.notifyLayerUpdated(e)}))}setMediaPosition(e){this.info.mediaPosition=e,this.media.layers.forEach((t=>{t.mediaPosition=e}))}getDuration(){return this.main.root.outPoint-this.main.root.inPoint}setDuration(e){let t=this.main.root.inPoint,r=this.main.root.outPoint-t,i=e/r;if(1!==i){for(let e of this.getRootLayers())this.scaleLayerTimePoints(e,i,t);for(let e of this.crossed)e.outPoint-e.inPoint<.8*r&&e.inPoint<=t||this.scaleLayerTimePoints(e,i,t);this.info.duration=e}}scaleLayerTimePoints(e,t,r){"video"===e.type||"audio"===e.type||e.timeRemap||this.project.data.ensureTimeRemap(e),(0,i.scaleLayerTimePoints)(e,t,r)}resetDuration(){if("video"===this.info.mediaType){let e=this.media.layers[0].duration;this.setDuration(e)}else this.setDuration(this.startDuration)}willCropMedia(){let e=this.project.data.width/this.project.data.height;return Math.round(this.info.mediaHeight*e)!==this.info.mediaWidth}clone(){let e=new Map,t=null,r=null;this.media&&this.text&&this.media.root===this.text.root?[t,r]=this.cloneBothDeepLayers(e):(this.media&&(t=this.cloneDeepLayer(this.media,e)),this.text&&(r=this.cloneDeepLayer(this.text,e)));let i=[];for(let t of this.crossed){let r=this.project.data.cloneLayerData(t,e);i.push(r)}let a=[];t&&a.push(t.root),!r||t&&r.root.id===t.root.id||a.push(r.root);for(let t of[...a,...i])t.parentId&&(t.parentId=e.get(t.parentId)||t.parentId);let s=new h(this.project,t,r,i);return s.marginLeft=this.marginLeft,s.marginRight=this.marginRight,s.canSetDuration=this.canSetDuration,s}cloneBothDeepLayers(e){let t=[...this.media.layers.map((e=>e.id)),...this.text.layers.map((e=>e.id))],r=this.project.data.deepCloneLayerData(this.media.root,t,e);return[{root:r,layers:(0,i.findReplacableMediaLayersInside)(this.project,r)},{root:r,layers:(0,i.findEditableTextLayersInside)(this.project,r)}]}cloneDeepLayer(e,t){let r=e.layers.map((e=>e.id)),a=this.project.data.deepCloneLayerData(e.root,r,t);return{root:a,layers:"text"===e.layers[0].type?(0,i.findEditableTextLayersInside)(this.project,a):(0,i.findReplacableMediaLayersInside)(this.project,a)}}insertToProject(){if(this.media&&this.project.data.insertRootLayerData(this.media.root),this.crossed.length>0)for(let e=0;e<this.crossed.length;e++)this.project.data.insertRootLayerData(this.crossed[e]);this.text&&this.project.data.insertRootLayerData(this.text.root)}moveTimeToBeAfter(e){let t=e.main.root.outPoint+e.marginRight+this.marginLeft-this.main.root.inPoint;0!==t&&this.moveSceneWithTime(t)}moveSceneWithTime(e){for(let t of this.getRootLayers())(0,i.moveLayerTimePoints)(t,e);this.crossed.forEach((t=>{(0,i.moveLayerTimePoints)(t,e)}))}remove(){this.removeInfo(),this.removeLayers()}removeInfo(){this.info.delete()}removeLayers(){this.media&&this.removeLayer(this.media.root),this.text&&this.removeLayer(this.text.root),this.crossed.forEach((e=>{this.removeLayer(e)}))}removeLayer(e){(0,a.removeWhere)(this.project.data.layers,(t=>t.id===e.id))}}t.Scene=h},8516:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioLayer=void 0;const i=r(1221),a=r(6376),s=r(7928),n=r(1954);class o extends i.Layer{media;mediaVolume=1;needToPlay=!1;playing=!1;async initialize(){this.media=await this.renderer.resourceLoader.loadAudio(this.data),this.media.volume=1,this.media.loop=!0}active(){this.activated||(super.active(),this.needToPlay=!0)}deactive(){this.activated&&(super.deactive(),this.media.pause(),this.playing=!1)}async syncTime(e){let t=Math.max(e,0),r=this.media.duration;if(t>r&&(t%=r),this.media.ended&&this.activated&&(this.needToPlay=!0),!(0,n.isSameFrameTimes)(t,this.media.currentTime)&&this.needToPlay&&(this.media.currentTime=t),this.needToPlay){let e=s.debug.timeStart("Audio Playing");try{await this.media.play(),this.playing=!0}catch(e){s.debug.log(e)}e(),this.needToPlay=!1}}update(){if(this.activated){let e=(0,a.getPropertyValue)(this.data.audioLevels,this.time,[0,0]),t=Math.pow(10,e[0]/10);t!==this.mediaVolume&&(this.media.volume=t,this.mediaVolume=t)}}}t.AudioLayer=o},8524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decodeImageInWorker=t.supportsDecodeImageInWorker=void 0,t.supportsDecodeImageInWorker=function(){return!!window.OffscreenCanvas},t.decodeImageInWorker=function(e){return new Promise(((t,r)=>{let i=new Blob(["\nlet ctx = new OffscreenCanvas(1, 1).getContext('2d')\n\nonmessage = async function (e) {\n\tlet url = e.data.url\n\tlet response = await fetch(url, {mode: 'cors'})\n\tlet blob = await response.blob()\n\n\tlet bitmap = await createImageBitmap(blob, {\n\t\timageOrientation: 'none',\n\t\tpremultiplyAlpha: 'premultiply',\n\t\tcolorSpaceConversion: 'none',\n\t})\n\n\tctx.canvas.width = bitmap.width\n\tctx.canvas.height = bitmap.height\n\tctx.drawImage(bitmap, 0, 0)\n\n\tlet imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)\n\tlet data = new Uint8Array(imgData.data)\n\n\tpostMessage({\n\t\twidth: imgData.width,\n\t\theight: imgData.height,\n\t\tdata: data.buffer,\n\t}, [data.buffer])\n}\n"],{type:"application/javascript"}),a=new Worker(URL.createObjectURL(i));a.onmessage=async e=>{let{width:r,height:i,data:a}=e.data,s=new Uint8Array(a);t({width:r,height:i,data:s})},a.onerror=r,a.postMessage({url:e})}))}},8546:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.notifyObjectSet=t.notifyComPropertySet=t.mayAddComDependency=t.mayAddDependency=t.restoreAsDependency=t.clearAsDependency=t.clearDependencies=t.isUpdating=t.endUpdating=t.startUpdating=void 0;const i=r(8622),a=r(4436),s=r(9266),n=new a.Weak2WayMap,o=new s.Weak2WayPropMap;let l=null;const c=[];t.startUpdating=function(e){l&&c.push(l),l={target:e,deps:new Set,depPropMap:new Map}},t.endUpdating=function(e){l&&(n.updateFromLeft(l.target,l.deps),o.updateFromLeft(l.target,l.depPropMap),l=c.pop()||null)},t.isUpdating=function(){return!!l},t.clearDependencies=function(e){n.clearFromLeft(e),o.clearFromLeft(e)},t.clearAsDependency=function(e){let t=i.targetMap.get(e);n.clearFromRight(t),o.clearFromRight(t)},t.restoreAsDependency=function(e){let t=i.targetMap.get(e);o.restoreFromRight(t)},t.mayAddDependency=function(e){l&&l.deps.add(e)},t.mayAddComDependency=function(e,t){if(!l)return;let r=l.depPropMap.get(e);r||(r=new Set,l.depPropMap.set(e,r)),r.add(t)},t.notifyComPropertySet=function(e,t){let r=o.getFromRight(e,t);if(r)for(let e of r)e.update()},t.notifyObjectSet=function(e){let t=n.getFromRight(e);if(t)for(let e of t)e.update()}},8552:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderableLayer=void 0;const i=r(1221),a=r(3568),s=r(9584),n=r(4277);class o extends i.Layer{layerStyleDrawer=null;maskDrawer=null;async initialize(){this.data.layerStyle&&(this.layerStyleDrawer=new s.LayerStyleDrawer(this.renderer,this.data.layerStyle)),this.data.masks&&(this.maskDrawer=new n.RenderableShapeMaskDrawer(this.renderer,this.data.masks))}setTransformStat(e){super.setTransformStat(e),this.layerStyleDrawer&&this.layerStyleDrawer.setTransformStat(e),this.maskDrawer&&this.maskDrawer.setTransformStat(e)}setTime(e){super.setTime(e),this.layerStyleDrawer&&this.layerStyleDrawer.setTime(e),this.maskDrawer&&this.maskDrawer.setTime(e)}setTransformStatus(e){super.setTransformStatus(e),this.layerStyleDrawer&&this.layerStyleDrawer.setTransformStatus(e),this.maskDrawer&&this.maskDrawer.setTransformStatus(e)}update(){this.layerStyleDrawer&&this.layerStyleDrawer.update(),this.maskDrawer&&this.maskDrawer.update()}draw(){let e=()=>this.drawMainContent();if(this.layerStyleDrawer||this.maskDrawer){let{mappedSampler:t,paintArea:r}=this.renderer.drawAsMappedSamplerFromFn(e,this.getSuggestedAntialiasType());if(!r)return null;if(this.layerStyleDrawer&&(e=this.layerStyleDrawer.willDraw(t,r),e&&this.maskDrawer&&(({mappedSampler:t,paintArea:r}=this.renderer.drawAsMappedSamplerFromFn(e)),!r)))return null;e&&this.maskDrawer&&(e=this.maskDrawer.willDraw(t,r))}if(!e)return null;let t=this.data.blendingMode&&a.SimpleWebGL.supportsBlendMode(a.SimpleWebGLBlendMode[this.data.blendingMode]);t&&this.renderer.sw.setBlendMode(a.SimpleWebGLBlendMode[this.data.blendingMode]);let r=e();return t&&this.renderer.sw.resetBlendMode(),r}drawAsMappedSampler(){let e=this.layerStyleDrawer||this.maskDrawer?!!this.maskDrawer&&this.maskDrawer.forClipping:this.getSuggestedAntialiasType();return this.renderer.drawAsMappedSamplerFromFn((()=>this.draw()),e)}getSuggestedAntialiasType(){return this.transformStat.getSuggestedAntialiasType()}delete(){super.delete(),this.layerStyleDrawer&&this.layerStyleDrawer.delete(),this.maskDrawer&&this.maskDrawer.delete()}}t.RenderableLayer=o},8611:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"blurAngle",desc:"Blur Angle",min:0,max:90,step:1,value:10}];(0,r(4062).extendTransitions)({"radar-clockwise":{uniformSlides:i,uniformValues:{startDirectionAngle:90,moveDirection:1},steps:[{fragShaderName:"radar"}]},"radar-anticlockwise":{uniformSlides:i,uniformValues:{startDirectionAngle:90,moveDirection:0},steps:[{fragShaderName:"radar"}]}})},8622:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getObservedTarget=t.observeTarget=t.targetMap=t.proxyMap=void 0;const i=r(6551),a=r(9687),s=r(7181);t.proxyMap=new WeakMap,t.targetMap=new WeakMap;const n=Object.prototype.toString;t.observeTarget=function(e){let t=n.call(e);return"[object Array]"===t?a.observeArrayTarget(e):"[object Object]"===t?i.observePlainObjectTarget(e):"[object Set]"===t||"[object Map]"===t?s.observeMapOrSetTarget(e):e},t.getObservedTarget=function(e){return t.targetMap.get(e)||e}},8638:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.TransitionPreview=void 0;const a=r(1416),s=r(5499),n=r(1326),o=r(3568),l=r(4062),c=r(2824);let d=class extends a.Component{names=[];toImageIndex=1;transitionName="";sw;intervalSeconds=s.storage.get("transitionIntervalTime",5);imageNaturalSize=[0,0];endPlaying=()=>{};paused=!1;easing=s.storage.get("transitionEasing","ease-in-out");uniforms;uniformValues;linearProgress=0;transitionTimePercent=.9;progress=0;processor;easingData=[{value:"linear",text:"linear"},{value:"ease-in-out",text:"ease in out"},{value:"ease-in-out-quad",text:"ease in out quad"},{value:"ease-in-out-cubic",text:"ease in out cubic"},{value:"ease-in-out-quart",text:"ease in out quart"},{value:"ease-in-out-quint",text:"ease in out quint"},{value:"ease-in-out-sine",text:"ease in out sine"},{value:"ease-in-out-expo",text:"ease in out expo"},{value:"ease-in-out-circ",text:"ease in out circ"},{value:"ease-in-out-back",text:"ease in out back"},{value:"ease-in",text:"ease in"},{value:"ease-in-quad",text:"ease in quad"},{value:"ease-in-cubic",text:"ease in cubic"},{value:"ease-in-quart",text:"ease in quart"},{value:"ease-in-quint",text:"ease in quint"},{value:"ease-in-sine",text:"ease in sine"},{value:"ease-in-expo",text:"ease in expo"},{value:"ease-in-circ",text:"ease in circ"},{value:"ease-in-back",text:"ease in back"},{value:"ease-out",text:"ease out"},{value:"ease-out-quad",text:"ease out quad"},{value:"ease-out-cubic",text:"ease out cubic"},{value:"ease-out-quart",text:"ease out quart"},{value:"ease-out-quint",text:"ease out quint"},{value:"ease-out-sine",text:"ease out sine"},{value:"ease-out-expo",text:"ease out expo"},{value:"ease-out-circ",text:"ease out circ"},{value:"ease-out-back",text:"ease out back"}];images=["allef-vinicius-pa0vicn6dwe-unsplash.jpg","allef-vinicius-ttusgz8ulkk-unsplash.jpg","allef-vinicius-_ugpeypqiuc-unsplash.jpg","anastasia-dulgier-kokszzy9wsa-unsplash.jpg","anthony-tran-mehojxixkdq-unsplash.jpg","deanna-alys-6lbbowkpzyq-unsplash.jpg","erol-ahmed-aiyfr0vbadk-unsplash.jpg","floriane-vita-fyd3owbuxny-unsplash.jpg","icons8-team-7lnatqymzm4-unsplash.jpg","jessica-weiller-so4efi-d1nc-unsplash.jpg","newborn-1328454.jpg","quan-nguyen-sghnxezeo-q-unsplash.jpg","scott-webb--udznjsczse-unsplash.jpg"];imageDirectory="color-correction";render(){return a.html`
		<template class="preview">
			${this.renderTransitionNames()}
			${this.renderToolbar()}
			${this.renderImages()}
			${this.renderAdditionalToolbar()}
		</template>
		`}renderTransitionNames(){return this.names.length<2?"":a.html`
		<div class="preview-names">
			${this.names.map((e=>a.html`
				<div
					:class.active=${e===this.transitionName}
					@click=${()=>this.onClickTransitionName(e)}
				>
					${e}
				</div>
			`))}
		</div>
		`}renderToolbar(){return a.html`
		<table class="preview-toolbar">
		<tbody>
			<tr>
				<td>
					Duration: <span class="preview-slide-value">${this.intervalSeconds}s</span>
				</td>
				<td>
					<f-slider class="preview-slider" .min="1" .max="30" .step="1" .value=${this.intervalSeconds} @change=${this.changeIntervalTime} />
					<button class="preview-slider-button" @click=${this.togglePaused}>${this.paused?"Play":"Pause"}</button>
					<f-select class="preview-easing-select" .value=${this.easing} .data=${this.easingData} @change=${this.onChangeEasing} />
				</td>
			</tr>

			${this.uniforms.map((({name:e,desc:t,min:r,max:i,step:s,value:n},o)=>{let l=this.uniformValues[o];return a.html`
				<tr>
					<td>
						${t}: <span class="preview-slide-value">${l}</span>
					</td>
					<td>
						<f-slider class="preview-slider" .min=${r} .max=${i} .step=${s} .value=${l}
							@change=${t=>this.changeSliderValue(e,o,t)}
						/>
						<button class="preview-slider-button" @click=${()=>this.changeSliderValue(e,o,n)}>Reset</button>
					</td>
				</tr>
				`}))}
		</tbody>
		</table>
		`}renderImages(){return a.html`
			<div class="preview-nav">
			${this.images.map(((e,t)=>a.html`
				<div class="preview-nav-item"
					:class.active=${t===this.toImageIndex}
					@click=${()=>this.onClickImageInIndex(t)}
				>
					<img src="pictures/${this.imageDirectory}/${e}">
				</div>
			`))}
			</div>

			<div class="preview-canvas" :ref="canvasContainer">
				<canvas :ref="canvas" />
			</div>
		`}renderAdditionalToolbar(){return a.html`
		<div class="preview-additional-toolbar">
			<f-slider class="preview-progress" :ref="slider" .min="0" .max="1" .step="0.01" .value=${this.linearProgress}
				.renderTooltipValue=${()=>a.html`<div style="min-width: 40px; text-align: center;">${Math.round(100*this.linearProgress)}%`}
				@dragstart=${this.startChangingProgress}
				@dragend=${this.endChangingProgress}
				@change=${this.changeProgress}
			/>
			<button class="preview-slider-button" @click=${this.toFullscreen}>Fullscreen</button>
		</div>
		`}changeIntervalTime(e){this.intervalSeconds=e,s.storage.set("transitionIntervalTime",e)}changeSliderValue(e,t,r){this.sw.setUniform(e,r),this.uniformValues[t]=r,this.drawAll()}startChangingProgress(){this.endPlaying()}endChangingProgress(){this.paused||this.startPlaying()}changeProgress(e){this.updateProgress(e)}onCreated(){this.transitionName=this.names[0],this.uniforms=(0,l.getUniformSlides)(this.transitionName)||[],this.uniformValues=this.uniforms.map((e=>e.value))}async onReady(){this.initGL();for(let e=0;e<this.uniforms.length;e++){let{name:t,value:r}=this.uniforms[e];this.sw.setUniform(t,r)}await this.setTransitionName(this.transitionName),await this.setToImageIndex(this.toImageIndex),this.paused||this.startPlaying()}initGL(){let e=this.refs.canvas;this.sw=new o.SimpleWebGL(e)}onConnected(){(0,a.on)(window,"resize",this.onResize,this),(0,a.on)(document,"keydown.space.prevent",this.togglePaused,this)}onDisconnected(){this.endPlaying(),(0,a.off)(window,"resize",this.onResize,this),(0,a.off)(document,"keydown",this.togglePaused,this)}onResize(){this.imageNaturalSize[0]>0&&(this.adjustSize(),this.drawAll())}adjustSize(){let[e,t]=this.imageNaturalSize,r=this.refs.canvasContainer.offsetWidth,i=Math.round(t/e*r);r>e&&(r=e,i=t),this.sw.setCanvasSize(r,i),this.sw.setUniform("iResolution",[r,i])}togglePaused(){this.paused=!this.paused,this.paused?this.endPlaying():this.startPlaying()}toFullscreen(){this.refs.canvasContainer.requestFullscreen(),this.adjustSize()}onChangeEasing(e){this.easing=e,s.storage.set("transitionEasing",e)}async onClickImageInIndex(e){await this.setToImageIndex(e),this.restartPlaying()}async setToImageIndex(e){this.toImageIndex=e;let t=(e+this.images.length-1)%this.images.length,r=`pictures/${this.imageDirectory}/${this.images[t]}`,i=`pictures/${this.imageDirectory}/${this.images[e]}`,a=await(0,n.preloadImage)(r),s=await(0,n.preloadImage)(i);this.imageNaturalSize=[a.naturalWidth,a.naturalHeight],this.adjustSize();let o=new c.PixelSampler(this.sw,a,this.processor.getSourceParams()),l=new c.PixelSampler(this.sw,s,this.processor.getTargetParams());this.processor.useSamplers(o,l),await this.onChangeImage()}restartPlaying(){this.linearProgress=0,this.progress=0,this.startPlaying()}async onChangeImage(){}startPlaying(){if(this.endPlaying(),this.paused)return void this.drawAll();let e=performance.now(),t=0,r=0,i=!1,a=!1;this.progress>0&&(e-=this.getDuration()*this.linearProgress);let s=async()=>{if(t=performance.now()-e,t>1e3*this.intervalSeconds)return await this.setToImageIndex((this.toImageIndex+1)%this.images.length),void this.restartPlaying();a||(t<this.getDuration()?this.updateProgress(t/this.getDuration()):i||(this.updateProgress(1),i=!0),r=requestAnimationFrame(s))};s(),this.endPlaying=()=>{cancelAnimationFrame(r),a=!0}}getDuration(){return this.transitionTimePercent*this.intervalSeconds*1e3}updateProgress(e){this.linearProgress=e,this.progress=(0,s.getEasingFunction)(this.easing)(e),this.sw.setUniform("iProgress",this.progress),this.drawAll()}drawAll(){this.processor.updateProgress(this.progress),this.sw.clear(),this.sw.drawAll()}async onClickTransitionName(e){await this.setTransitionName(e),await this.setToImageIndex(this.toImageIndex),this.paused?this.startPlaying():this.restartPlaying()}async setTransitionName(e){this.transitionName=e,this.endPlaying(),await this.prepareProcessor()}async prepareProcessor(){this.processor&&this.processor.delete(),this.processor=new l.TransitionProcessor(this.transitionName,this.sw),await this.processor.ready}};t.TransitionPreview=d,t.TransitionPreview=d=i([(0,a.define)("transition-preview")],d)},8652:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix=void 0;const i=r(5499);class a{static zero(e){let t=[];for(let r=0;r<e;r++){t[r]=[];for(let i=0;i<e;i++)t[r][i]=0}return new a(t)}static I(e){let t=[];for(let r=0;r<e;r++){t[r]=[];for(let i=0;i<e;i++)t[r][i]=r===i?1:0}return new a(t)}static fromVector(e){return a.fromFlat(e.values,1)}static fromVectors(...e){return new a(e.map((e=>e.values))).transpose()}static fromFlat(e,t){let r=[],i=e.length/t;for(let a=0;a<i;a++){let i=[];r.push(i);for(let r=0;r<t;r++)i[r]=e[a*t+r]}return new a(r)}data;constructor(e){this.data=e}validate(){let e=this.data[0].length;for(let t of this.data)if(t.length!==e)throw new Error("Matrix line data have different length")}get rowCount(){return this.data.length}get columnCount(){return this.data[0]?this.data[0].length:0}print(){console.table(this.data)}clone(){return new a(this.copyData())}copyData(){let e=this.data,t=[],r=this.rowCount;for(let i=0;i<r;i++)t[i]=e[i].concat();return t}transpose(){let e=this.data,t=this.rowCount,r=this.columnCount,i=[];for(let a=0;a<r;a++){i[a]=[];for(let r=0;r<t;r++)i[a][r]=e[r][a]}return new a(i)}add(e){if(this.rowCount!==e.rowCount)throw"Matrixs has different row count and cant add";if(this.columnCount!==e.columnCount)throw"Matrixs has different column count and cant add";let t=this.data,r=e.data,i=this.rowCount,s=this.columnCount,n=[];for(let e=0;e<i;e++){let i=t[e],a=r[e];n[e]=[];for(let t=0;t<s;t++)n[e][t]=i[t]+a[t]}return new a(n)}minus(e){return this.add(e.multiplyScalar(-1))}multiplyScalar(e){let t=this.rowCount,r=this.columnCount,i=this.data,s=[];for(let a=0;a<t;a++){s[a]=[];for(let t=0;t<r;t++)s[a][t]=i[a][t]*e}return new a(s)}multiply(e){let t=this.rowCount,r=this.columnCount,i=this.data,s=e.rowCount,n=e.columnCount,o=e.data;if(r!==s)throw"Matrixs cant multiple since the column count of first matrix does not match the row count of the second matrix";let l=[];for(let e=0;e<t;e++){l[e]=[];for(let t=0;t<n;t++){let r=0;for(let a=0;a<s;a++)r+=i[e][a]*o[a][t];l[e][t]=r}}return new a(l)}transferWithFollowedMatrix(e){let t=this.rowCount,r=this.columnCount;if(e&&t!==e.rowCount)throw"Matrix cant transfer since its followed data has different row count";let i=this.copyData(),a=e?e.data:null,s=Math.min(t,r),n=e?e.columnCount:0,o=0;for(let e=0;e<s;e++){if(0===i[e][e])for(let r=e+1;r<t;r++)if(0!==i[r][e]){let t=i[e];i[e]=i[r],i[r]=t,a&&(t=a[e],a[e]=a[r],a[r]=t);break}let s=i[e][e];if(0===s)continue;o++;let l=i[e],c=a?a[e]:null;for(let o=e+1;o<t;o++){let t=i[o],d=a?a[o]:null,h=t[e];if(0!==h){t[e]=0;let i=-h/s;for(let a=e+1;a<r;a++)t[a]=t[a]+i*l[a];if(a&&d&&c)for(let e=0;e<n;e++)d[e]=d[e]+i*c[e]}}}for(let e=o-1;e>=0;e--){let t=i[e],s=a?a[e]:null,l=t[e];for(let c=e-1;c>=0;c--){let d=i[c],h=a?a[c]:null,u=d[e];if(d[e]=0,0!==u){let e=-u/l;for(let i=o;i<r;i++)d[i]=d[i]+e*t[i];if(a&&h&&s)for(let t=0;t<n;t++)h[t]=h[t]+e*s[t]}}t[e]=1;for(let e=o;e<r;e++)t[e]=t[e]/l;if(a&&s)for(let e=0;e<n;e++)s[e]=s[e]/l}return{transfer:i,follower:a,rank:o}}rank(){return this.transferWithFollowedMatrix().rank}inverse(){let e=this.rowCount;if(e!=this.columnCount)throw"Matrix cant generate reverse matrix since its row count not equals to column count";let t=a.I(e);return new a(this.transferWithFollowedMatrix(t).follower)}solveNonHomogeneous(e){let t=this.rowCount,r=this.columnCount;if(t>r)throw"Equation cant be solved since its row count less than column count";if(e.rowCount!==t)throw"Equation cant be solved since the row count of value matrix not equals to row count of current matrix";if(1!==e.columnCount)throw"Equation cant be solved since the column count of value matrix not equals to 1";let s=this.transferWithFollowedMatrix(e);if(s.rank!==t)for(let e=s.rank;e<t;e++)if(0!==(0,i.toDecimal)(s.follower[e][0],8))throw"Equation has no solution";let n=s.follower;if(n.length<r)for(let e=n.length;e<r;e++)n[e]=[0];return new a(n).transpose()}solveHomogeneous(){let e=this.rowCount,t=this.columnCount;if(e>t)throw"Equation cant be solved since its row count less than column count";let r=this.transferWithFollowedMatrix(),i=r.transfer,s=r.rank;s!==e&&(i=i.slice(0,r.rank));let n=[];for(let e=s;e<t;e++){let r=[];for(let t=0;t<s;t++)r[t]=-i[t][e];for(let i=s;i<t;i++)r[i]=i===e?1:0;n.push(r)}return new a(n)}fix(e=8){let t=this.data,r=this.rowCount,a=this.columnCount;for(let s=0;s<r;s++)for(let r=0;r<a;r++)t[s][r]=(0,i.toDecimal)(t[s][r],e);return this}rowMajorFlatten(){return this.data.flat()}columnMajorFlatten(){return this.transpose().data.flat()}}t.Matrix=a},8699:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.GotoBinding=void 0;const a=r(1416),s=r(9611);let n=class{constructor(e){this.value="",this.router=null,this.el=e,a.on(this.el,"click",this.onClick,this)}update(e){this.value=e}onClick(){this.ensureRouter(),this.router.goto(this.value)}ensureRouter(){if(!this.router&&(this.router=a.getClosestComponent(this.el.parentElement,s.Router),!this.router))throw new Error('":goto" must be contained in a extended component of "Router"')}remove(){}};n=i([a.defineBinding("goto")],n),t.GotoBinding=n},8708:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.popup=t.PopupBinding=void 0;const i=r(1416),a=r(5499),s=new Map,n=new Map,o={trigger:"hover",alignPosition:"b",alignMargin:4,showDelay:0,hideDelay:200,triangle:!0,fixTriangle:!1,transition:"fade",onOpenedChanged:()=>{}};class l{constructor(e,t){this.options=new i.Options(o),this.opened=!1,this.showTimeout=null,this.hideTimeout=null,this.unwatchRect=null,this.unwatchLeave=null,this.unwatchResult=null,this.popupTemplate=null,this.popup=null,this.el=e,this.context=t}update(e,t){let r=!this.options.updated;this.renderFn=e,this.options.update(t),r?this.bindTrigger():this.updatePopup()}getOption(e){let t;return this.popup&&this.popup.defaultPopupOptions&&(t=this.popup.defaultPopupOptions[e]),void 0===t&&(t=this.options.get(e)),t}bindTrigger(){let e=this.getOption("trigger");"hover"===e?i.on(this.el,"mouseenter",this.showPopupLater,this):"click"===e?i.on(this.el,"click",this.toggleOpened,this):i.on(this.el,e,this.showPopupLater,this)}remove(){i.off(this.el,"mouseenter",this.showPopupLater,this),this.popup&&this.popup.el.remove()}toggleOpened(){this.opened?this.hidePopup():this.showPopup()}async showPopupLater(){if(this.showTimeout)return;if(this.clearHideTimeout(),this.opened)return;let e=this.getOption("trigger"),t=this.getOption("showDelay");"hover"===e||"focus"===e?(this.showTimeout=a.timeout((()=>{this.showTimeout=null,this.showPopup()}),t),"hover"===e?i.once(this.el,"mouseleave",this.hidePopupLater,this):"focus"===e&&i.once(this.el,"blur",this.hidePopupLater,this)):this.showPopup()}showPopup(){if(this.opened)return;let{popup:e,inUse:t}=this.getPopup();e.applyAppendTo(),e.el.style.visibility="hidden",this.setOpened(!0),i.onRenderComplete((()=>{if(!this.isPopupInControl())return;this.alignPopup(),e.el.style.visibility="",this.mayFocus(),t?i.clearTransition(e.el):new i.Transition(e.el,this.getOption("transition")).enter();let r=this.getOption("trigger");"hover"===r?i.off(this.el,"mouseleave",this.hidePopupLater,this):"focus"===r&&i.off(this.el,"blur",this.hidePopupLater,this),this.bindLeave(),this.unwatchRect=a.watchLayout(this.el,"rect",this.onElRectChanged.bind(this))}))}mayFocus(){let e=this.getOption("trigger");"hover"!==e&&"focus"!==e&&this.el.tabIndex>=0&&this.el.focus()}bindLeave(){let e=this.getOption("trigger");"hover"===e?this.unwatchLeave=a.MouseLeave.on([this.el,this.popup.el],this.hidePopupLater.bind(this),{delay:this.getOption("hideDelay"),mouseIn:!0}):"click"!==e&&"contextmenu"!==e||i.on(document,"mousedown",this.onDocMouseDown,this)}setOpened(e){this.opened=e;let t=this.getOption("onOpenedChanged");t&&t(e)}isPopupInControl(){return!!this.popup&&(!this.getOption("name")||n.get(this.popup)===this)}clearHideTimeout(){this.hideTimeout&&(this.hideTimeout.cancel(),this.hideTimeout=null)}getPopup(){let e=this.renderFn(),t=this.getOption("name"),r=null,o=null,l=!1;if(e instanceof i.TemplateResult||(e=i.html`${e}`),t){let i=function(e){let t=s.get(e);if(t){let e=t.popup;return a.MouseLeave.inUse(e.el)?null:t}return null}(t);i&&(({popup:r,template:o}=i),l=n.has(r),o.canMergeWith(e)?o.merge(e):(r.el.remove(),r=null))}if(!r){let a=i.renderComponent(e,this.context);o=a.template,r=a.component,t&&s.set(t,{popup:r,template:o})}return t&&n.set(r,this),this.popup=r,this.popupTemplate=o,r.setPopupBinding(this),{popup:r,inUse:l}}async updatePopup(){if(this.isPopupInControl()){let e=this.renderFn(),t=this.getOption("name"),r=this.popup,a=this.popupTemplate;if(e instanceof i.TemplateResult||(e=i.html`${e}`),a.canMergeWith(e))a.merge(e);else{r.el.remove();let n=i.renderComponent(e,this.context);a=this.popupTemplate=n.template,r=n.component,t&&s.set(t,{popup:r,template:a})}await i.renderComplete(),this.alignPopup()}}onMouseLeave(){this.hidePopupLater()}onDocMouseDown(e){let t=e.target;this.el.contains(t)||this.popup.el.contains(t)||this.hidePopupLater()}onElRectChanged(){a.isInViewport(this.el)?this.popup&&this.alignPopup():this.onNotInViewport()}onNotInViewport(){this.hidePopupLater()}alignPopup(){let e=this.popup,t=this.getOption("alignTo"),r=t?t(this.el):this.el,i=this.popup.refs.triangle;a.align(e.el,r,this.getOption("alignPosition"),{margin:this.getOption("alignMargin"),canShrinkInY:!0,triangle:i,fixTriangle:this.getOption("fixTriangle")})}hidePopupLater(){if(this.hideTimeout)return;if(this.clearShowTimeout(),!this.opened)return;let e=this.getOption("trigger"),t="hover"===e?0:this.getOption("hideDelay");("hover"===e||"focus"===e)&&t>0?this.hideTimeout=a.timeout((()=>{this.hideTimeout=null,this.hidePopup()}),t):this.hidePopup()}clearShowTimeout(){this.showTimeout&&(this.showTimeout.cancel(),this.showTimeout=null)}hidePopup(){if(!this.opened)return;this.unwatch();let e=this.getOption("name"),t=this.popup.el;this.isPopupInControl()&&(e&&n.delete(this.popup),new i.Transition(t,this.getOption("transition")).leave().then((e=>{e&&t.remove()}))),this.setOpened(!1),this.popup=null,this.popupTemplate=null}unwatch(){let e=this.getOption("trigger");this.unwatchRect&&(this.unwatchRect(),this.unwatchRect=null),this.unwatchLeave&&(this.unwatchLeave(),this.unwatchLeave=null),this.unwatchResult&&(this.unwatchResult(),this.unwatchResult=null),"click"!==e&&"contextmenu"!==e||i.off(document,"mousedown",this.onDocMouseDown,this)}}t.PopupBinding=l,t.popup=i.defineBinding("popup",l)},8712:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[2];\nuniform mat4 iChannelMap[2];\nuniform float iOpacity;\nuniform bool inverted;\nvec4 getFragColor() {\nvec2 textureCoord0 = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nvec2 textureCoord1 = (iChannelMap[1] * vec4(fTextureCoord, 0, 1)).xy;\nvec4 maskColor = texture(iChannel[0], textureCoord0);\nfloat luminance = 0.299 * maskColor.r + 0.587 * maskColor.g + 0.114 * maskColor.b;\nluminance = inverted ? 1.0 - luminance : luminance;\nvec4 color = texture(iChannel[1], textureCoord1);\ncolor *= luminance;\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},8718:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.liveAsyncRepeat=t.LiveAsyncRepeatDirective=void 0;const i=r(5428),a=r(4511),s=r(8457),n=r(6640),o=r(9395);class l extends s.LiveRepeatDirective{constructor(){super(...arguments),this.key=null,this.knownDataCount=-1,this.needToUpdateSliderPositionAfterDataCountKnown=!1,this.updateId=0}merge(e,t,r){let i=!this.options.updated;i&&e.startIndex>0&&(this.startIndex=e.startIndex),this.options.update(e),this.templateFn=t,this.transition.updateOptions(r),i&&(this.validateTemplateFn(t),this.dataCacher=new n.PageDataCacher(e.pageSize)),this.dataCacher.setDataGetter(e.dataGetter),i?e.startIndex>0?this.updateDataCount().then((()=>{this.startIndex=this.limitStartIndex(e.startIndex),this.needToApplyStartIndex=!0,this.update()})):(this.updateDataCount(),this.update()):this.update()}validateTemplateFn(e){try{if(!(e(null,0)instanceof a.TemplateResult))throw new Error}catch(t){throw new Error(`Please makesure "${e.toString()}" can render "null" value`)}}updateRenderOptions(e){e.averageItemHeight&&(this.averageItemHeight=e.averageItemHeight)}async updateDataCount(){let e,t=this.options.get("dataCount");t&&(this.knownDataCount=-1,e="function"==typeof t?t():t,this.knownDataCount=e instanceof Promise?await e:e,this.needToUpdateSliderPositionAfterDataCountKnown&&this.updateSliderPosition())}async update(e=!0){this.updateSliderPosition();let t,r,i=this.options.get("pageSize")*this.options.get("renderPageCount"),a=this.limitEndIndex(this.startIndex+i),s=!e;if(e){let{data:e,fresh:r}=this.dataCacher.getExistingData(this.startIndex,a);t=this.updateData(e),s=!r}let n=this.updateId+=1;s&&(r=this.dataCacher.getFreshData(this.startIndex,a).then((e=>n===this.updateId?this.updateData(e):Promise.resolve()))),t&&await t,r&&await r}async updateData(e){this.key&&(e=this.uniqueData(e)),e=e.map(o.observe),await super.updateData(e)}uniqueData(e){let t=new Set;return e.filter((e=>{if(e){let r=e[this.key];if(t.has(r))return!1;t.add(r)}return!0}))}updateSliderPosition(){-1===this.knownDataCount&&(this.needToUpdateSliderPositionAfterDataCountKnown=!0),super.updateSliderPosition()}getTotalDataCount(){return this.knownDataCount}async getDataBetweens(e,t){return await this.dataCacher.getFreshData(e,t)}async reload(){this.dataCacher.beStale(),this.updateDataCount(),await this.update(!1)}async reset(e=0){this.dataCacher.clear(),this.updateDataCount(),await this.setStartIndex(e)}getItem(e){return this.dataCacher.getExistingData(e,e+1).data[0]}getRenderedItem(e){return e>=this.startIndex&&e<this.startIndex+this.data.length?this.data[e-this.startIndex]:null}notifyAdded(e,t=1){this.dataCacher.moveData(e,t),this.update()}notifyDeleted(e,t=1){this.dataCacher.moveData(e,-t),this.update()}}t.LiveAsyncRepeatDirective=l,t.liveAsyncRepeat=i.defineDirective(l)},8737:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeGroupDrawer=void 0;const i=r(9573),a=r(6376),s=r(9176),n=r(5305),o=r(3481);class l extends i.VectorShapeBaseDrawer{fillToDrawType=o.ToDrawType.TriangleFan;strokeToDrawType=o.ToDrawType.TriangleStrip;pathValues;checkIsDataDynamic(){return!!(0,a.isPropertyValueBeKeyFrames)(this.data.path)||super.checkIsDataDynamic()}update(){this.values=(0,a.getPropertyValues)(this.data,this.time,n.ShapeGroupDefaultValues),this.pathValues=(0,a.getComplexPropertyValues)(this.data.path,this.time),super.update()}getFillCoords(){return{coords:this.pathValues.vertices}}getStrokCoords(){let e=this.pathValues.vertices,t=this.strokeValues.strokeWidth;return{coords:(0,s.triangulatePolygonLine)(e,t,this.pathValues.closed)}}}t.ShapeGroupDrawer=l},8759:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hide=t.show=void 0;const i=r(356),a=r(162);class s{constructor(e,t){this.value=void 0,this.el=e,this.transition=new a.DirectiveTransition(t)}update(e,t){e=!!e,this.transition.updateOptions(t),e!==this.value&&(e?(this.el.hidden=!1,this.transition.shouldPlayEnter()&&this.transition.playEnter(this.el)):this.transition.shouldPlayLeave()?this.transition.playLeave(this.el).then((e=>{e&&(this.el.hidden=!0)})):this.el.hidden=!0,this.value=e)}remove(){this.el.hidden=!1}}t.show=i.defineBinding("show",s),t.hide=i.defineBinding("hide",class extends s{update(e,t){super.update(!e,t)}})},8783:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateList=t.ResourceLoader=t.Footages=t.ProjectData=t.FontList=t.VideoEncodingAnalyser=t.VideoEncoder=t.VideoEncoderOptions=t.ProjectAspectRatio=t.JSONManager=t.ProjectRenderOptions=t.ProjectEvents=t.Project=t.Renderer=void 0;var i=r(7616);Object.defineProperty(t,"Renderer",{enumerable:!0,get:function(){return i.Renderer}});var a=r(1648);Object.defineProperty(t,"Project",{enumerable:!0,get:function(){return a.Project}}),Object.defineProperty(t,"ProjectEvents",{enumerable:!0,get:function(){return a.ProjectEvents}}),Object.defineProperty(t,"ProjectRenderOptions",{enumerable:!0,get:function(){return a.ProjectRenderOptions}});var s=r(4369);Object.defineProperty(t,"JSONManager",{enumerable:!0,get:function(){return s.JSONManager}}),Object.defineProperty(t,"ProjectAspectRatio",{enumerable:!0,get:function(){return s.ProjectAspectRatio}});var n=r(5963);Object.defineProperty(t,"VideoEncoderOptions",{enumerable:!0,get:function(){return n.VideoEncoderOptions}}),Object.defineProperty(t,"VideoEncoder",{enumerable:!0,get:function(){return n.FFVideoEncoder}}),Object.defineProperty(t,"VideoEncodingAnalyser",{enumerable:!0,get:function(){return n.VideoEncodingAnalyser}});var o=r(4072);Object.defineProperty(t,"FontList",{enumerable:!0,get:function(){return o.FontList}});var l=r(6133);Object.defineProperty(t,"ProjectData",{enumerable:!0,get:function(){return l.ProjectData}});var c=r(7153);Object.defineProperty(t,"Footages",{enumerable:!0,get:function(){return c.Footages}});var d=r(6061);Object.defineProperty(t,"ResourceLoader",{enumerable:!0,get:function(){return d.ResourceLoader}});var h=r(1324);Object.defineProperty(t,"TemplateList",{enumerable:!0,get:function(){return h.TemplateList}})},8854:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;const i=r(5499);class a{constructor(e){this.value=e.trim()}static fromRGBA(e,t,r,s){return e=Math.max(Math.min(e,1),0),t=Math.max(Math.min(t,1),0),r=Math.max(Math.min(r,1),0),s=Math.max(Math.min(s,1),0),new a(1===s?"#"+Math.round(255*e).toString(16).padStart(2,"0")+Math.round(255*t).toString(16).padStart(2,"0")+Math.round(255*r).toString(16).padStart(2,"0"):"rgba("+Math.round(255*e).toString()+", "+Math.round(255*t).toString()+", "+Math.round(255*r).toString()+", "+i.toPower(s,-2)+")")}static fromRGB(e,t,r){return a.fromRGBA(e,t,r,1)}toString(){return this.value}getRGBA(){if(/^#[0-9a-fA-F]{3,6}$/.test(this.value))return[...this.parseNormalColor(this.value),1];let e=this.value.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);if(e)return[Number(e[1])/255,Number(e[2])/255,Number(e[3])/255,1];if(e=this.value.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)$/),e)return[Number(e[1])/255,Number(e[2])/255,Number(e[3])/255,Number(e[4])];if(e=this.value.match(/^rgba\(\s*(#[0-9a-fA-F]{3,6})\s*,\s*([\d.]+)\s*\)$/),e)return[...this.parseNormalColor(e[1]),Number(e[2])];throw new Error(`"${this.value}" is not a valid RGB color`)}getRGB(){return this.getRGBA().slice(0,3)}parseNormalColor(e){return 4===e.length?[17*parseInt(e[1],16)/255,17*parseInt(e[2],16)/255,17*parseInt(e[3],16)/255]:[parseInt(e.slice(1,3),16)/255,parseInt(e.slice(3,5),16)/255,parseInt(e.slice(5,7),16)/255]}darken(e){return this.lighten(-e)}lighten(e){let[t,r,i,s]=this.getRGBA(),n=e/100;return t+=n,r+=n,i+=n,a.fromRGBA(t,r,i,s)}toMiddle(e){return this.getLightness()<.5?this.lighten(e):this.darken(e)}getLightness(){let[e,t,r]=this.getRGBA();return i.avg([e,t,r])}alpha(e){let[t,r,i]=this.getRGBA();return a.fromRGBA(t,r,i,e)}mix(e,t){let[r,i,s,n]=this.getRGBA();"string"==typeof e&&(e=new a(e));let[o,l,c,d]=e.getRGBA(),h=t/100;return r=r*(1-h)+o*h,i=i*(1-h)+l*h,s=s*(1-h)+c*h,n=n*(1-h)+d*h,a.fromRGBA(r,i,s,n)}}t.Color=a},8916:e=>{var t=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,a={};function s(e){if(!e)throw new Error("Assertion failed.")}((t,r)=>{for(var i in r)e(t,i,{get:r[i],enumerable:!0})})(a,{ALL_FORMATS:()=>Ys,ALL_TRACK_TYPES:()=>ts,AUDIO_CODECS:()=>le,AudioBufferSink:()=>ua,AudioBufferSource:()=>Ha,AudioSample:()=>qi,AudioSampleSink:()=>ha,AudioSampleSource:()=>Wa,AudioSource:()=>Va,BaseMediaSampleSink:()=>aa,BlobSource:()=>os,BufferSource:()=>ss,BufferTarget:()=>Zr,CanvasSink:()=>la,CanvasSource:()=>ja,Conversion:()=>tn,CustomAudioDecoder:()=>Y,CustomAudioEncoder:()=>J,CustomVideoDecoder:()=>Q,CustomVideoEncoder:()=>X,EncodedAudioPacketSource:()=>$a,EncodedPacket:()=>Ni,EncodedPacketSink:()=>ra,EncodedVideoPacketSource:()=>Aa,Input:()=>Xs,InputAudioTrack:()=>fa,InputFormat:()=>As,InputTrack:()=>pa,InputVideoTrack:()=>ma,IsobmffInputFormat:()=>Os,IsobmffOutputFormat:()=>Ca,MATROSKA:()=>Hs,MP3:()=>qs,MP4:()=>Ns,MatroskaInputFormat:()=>js,MediaSource:()=>Ia,MediaStreamAudioTrackSource:()=>Ga,MediaStreamVideoTrackSource:()=>za,MkvOutputFormat:()=>Ma,MovOutputFormat:()=>Pa,Mp3InputFormat:()=>Vs,Mp3OutputFormat:()=>Da,Mp4InputFormat:()=>Ls,Mp4OutputFormat:()=>ka,NON_PCM_AUDIO_CODECS:()=>oe,OGG:()=>Qs,OggInputFormat:()=>Us,OggOutputFormat:()=>Ea,Output:()=>is,OutputFormat:()=>Ta,PCM_AUDIO_CODECS:()=>ne,QTFF:()=>Ws,QUALITY_HIGH:()=>Ee,QUALITY_LOW:()=>De,QUALITY_MEDIUM:()=>_e,QUALITY_VERY_HIGH:()=>Ie,QUALITY_VERY_LOW:()=>Re,Quality:()=>Me,QuickTimeInputFormat:()=>Bs,SUBTITLE_CODECS:()=>ce,Source:()=>as,StreamSource:()=>ns,StreamTarget:()=>ei,SubtitleSource:()=>Za,Target:()=>Jr,TextSubtitleSource:()=>es,UrlSource:()=>ls,VIDEO_CODECS:()=>se,VideoSample:()=>Wi,VideoSampleSink:()=>oa,VideoSampleSource:()=>Ba,VideoSource:()=>Fa,WAVE:()=>Ks,WEBM:()=>Gs,WavOutputFormat:()=>_a,WaveInputFormat:()=>$s,WebMInputFormat:()=>zs,WebMOutputFormat:()=>Ra,canEncode:()=>Ue,canEncodeAudio:()=>We,canEncodeSubtitles:()=>He,canEncodeVideo:()=>Ne,getEncodableAudioCodecs:()=>Ke,getEncodableCodecs:()=>Ge,getEncodableSubtitleCodecs:()=>Qe,getEncodableVideoCodecs:()=>qe,getFirstEncodableAudioCodec:()=>Xe,getFirstEncodableSubtitleCodec:()=>Je,getFirstEncodableVideoCodec:()=>Ye,registerDecoder:()=>ie,registerEncoder:()=>ae});var n=e=>{const t=(e%360+360)%360;if(0===t||90===t||180===t||270===t)return t;throw new Error(`Invalid rotation ${e}.`)},o=e=>e&&e[e.length-1],l=e=>e>=0&&e<2**32,c=class e{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){const e=Math.floor(this.pos/8),t=this.bytes[e]??0,r=7-(7&this.pos),i=(t&1<<r)>>r;return this.pos++,i}readBits(e){if(1===e)return this.readBit();let t=0;for(let r=0;r<e;r++)t<<=1,t|=this.readBit();return t}readAlignedByte(){if(this.pos%8!=0)throw new Error("Bitstream is not byte-aligned.");const e=this.pos/8,t=this.bytes[e]??0;return this.pos+=8,t}skipBits(e){this.pos+=e}getBitsLeft(){return 8*this.bytes.length-this.pos}clone(){const t=new e(this.bytes);return t.pos=this.pos,t}},d=e=>{let t=0;for(;0===e.readBits(1)&&t<32;)t++;if(t>=32)throw new Error("Invalid exponential-Golomb code.");return(1<<t)-1+e.readBits(t)},h=e=>{const t=d(e);return 1&t?t+1>>1:-(t>>1)},u=e=>e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength),p=e=>e instanceof DataView?e:e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),m=new TextEncoder,f=e=>Object.fromEntries(Object.entries(e).map((([e,t])=>[t,e]))),g={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},y=f(g),w={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pg:16,hlg:18},v=f(w),x={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},b=f(x),S=e=>!!(e&&e.primaries&&e.transfer&&e.matrix&&void 0!==e.fullRange),T=e=>e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer||ArrayBuffer.isView(e),C=class{constructor(){this.currentPromise=Promise.resolve()}async acquire(){let e;const t=new Promise((t=>{e=t})),r=this.currentPromise;return this.currentPromise=t,await r,e}},k=e=>[...e].map((e=>e.toString(16).padStart(2,"0"))).join(""),P=e=>(e=(e=(e=(e=(e=e>>1&1431655765|(1431655765&e)<<1)>>2&858993459|(858993459&e)<<2)>>4&252645135|(252645135&e)<<4)>>8&16711935|(16711935&e)<<8)>>16&65535|(65535&e)<<16)>>>0,M=(e,t,r)=>{let i=0,a=e.length-1,s=-1;for(;i<=a;){const n=i+a>>1,o=r(e[n]);o===t?(s=n,a=n-1):o<t?i=n+1:a=n-1}return s},R=(e,t,r)=>{let i=0,a=e.length-1,s=-1;for(;i<=a;){const n=i+(a-i+1)/2|0;r(e[n])<=t?(s=n,i=n+1):a=n-1}return s},D=(e,t,r)=>{const i=R(e,r(t),r);e.splice(i+1,0,t)},_=()=>{let e,t;return{promise:new Promise(((r,i)=>{e=r,t=i})),resolve:e,reject:t}},E=(e,t)=>{for(let r=e.length-1;r>=0;r--)if(t(e[r]))return e[r]},I=(e,t)=>{for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return-1},F=e=>{throw new Error(`Unexpected value: ${e}`)},A=(e,t,r)=>{const i=e.getUint8(t),a=e.getUint8(t+1),s=e.getUint8(t+2);return r?i|a<<8|s<<16:i<<16|a<<8|s},O=(e,t,r,i)=>{r>>>=0,r&=16777215,i?(e.setUint8(t,255&r),e.setUint8(t+1,r>>>8&255),e.setUint8(t+2,r>>>16&255)):(e.setUint8(t,r>>>16&255),e.setUint8(t+1,r>>>8&255),e.setUint8(t+2,255&r))},L=(e,t)=>({async next(){const r=await e.next();return r.done?{value:void 0,done:!0}:{value:t(r.value),done:!1}},return:()=>e.return(),throw:t=>e.throw(t),[Symbol.asyncIterator](){return this}}),B=(e,t,r)=>Math.max(t,Math.min(r,e)),j="und",z=(e,t)=>{const r=10**t;return Math.round(e*r)/r},V=(e,t)=>Math.round(e/t)*t,$=/^[a-z]{3}$/,U=e=>$.test(e),N=1e6*(1+Number.EPSILON),W=(e,t)=>{const r={...e};for(const i in t)"object"==typeof e[i]&&null!==e[i]&&"object"==typeof t[i]&&null!==t[i]?r[i]=W(e[i],t[i]):r[i]=t[i];return r},H=async(e,t,r)=>{let i=0;for(;;)try{return await fetch(e,t)}catch(e){i++;const t=r(i);if(null===t)throw e;if(console.error("Retrying failed fetch. Error:",e),!Number.isFinite(t)||t<0)throw new TypeError("Retry delay must be a non-negative finite number.");t>0&&await new Promise((e=>setTimeout(e,1e3*t)))}},G=class{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}},q=null,K=()=>{if(null!==q)return q;const e=!("undefined"==typeof navigator||!navigator.vendor?.match(/apple/i)||navigator.userAgent?.match(/crios/i)||navigator.userAgent?.match(/fxios/i)||navigator.userAgent?.match(/Opera|OPT\//));return q=e,e},Q=class{static supports(e,t){return!1}},Y=class{static supports(e,t){return!1}},X=class{static supports(e,t){return!1}},J=class{static supports(e,t){return!1}},Z=[],ee=[],te=[],re=[],ie=e=>{if(e.prototype instanceof Q){const t=e;if(Z.includes(t))return void console.warn("Video decoder already registered.");Z.push(t)}else{if(!(e.prototype instanceof Y))throw new TypeError("Decoder must be a CustomVideoDecoder or CustomAudioDecoder.");{const t=e;if(ee.includes(t))return void console.warn("Audio decoder already registered.");ee.push(t)}}},ae=e=>{if(e.prototype instanceof X){const t=e;if(te.includes(t))return void console.warn("Video encoder already registered.");te.push(t)}else{if(!(e.prototype instanceof J))throw new TypeError("Encoder must be a CustomVideoEncoder or CustomAudioEncoder.");{const t=e;if(re.includes(t))return void console.warn("Audio encoder already registered.");re.push(t)}}},se=["avc","hevc","vp9","av1","vp8"],ne=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],oe=["aac","opus","mp3","vorbis","flac"],le=[...oe,...ne],ce=["webvtt"],de=[{maxMacroblocks:99,maxBitrate:64e3,level:10},{maxMacroblocks:396,maxBitrate:192e3,level:11},{maxMacroblocks:396,maxBitrate:384e3,level:12},{maxMacroblocks:396,maxBitrate:768e3,level:13},{maxMacroblocks:396,maxBitrate:2e6,level:20},{maxMacroblocks:792,maxBitrate:4e6,level:21},{maxMacroblocks:1620,maxBitrate:4e6,level:22},{maxMacroblocks:1620,maxBitrate:1e7,level:30},{maxMacroblocks:3600,maxBitrate:14e6,level:31},{maxMacroblocks:5120,maxBitrate:2e7,level:32},{maxMacroblocks:8192,maxBitrate:2e7,level:40},{maxMacroblocks:8192,maxBitrate:5e7,level:41},{maxMacroblocks:8704,maxBitrate:5e7,level:42},{maxMacroblocks:22080,maxBitrate:135e6,level:50},{maxMacroblocks:36864,maxBitrate:24e7,level:51},{maxMacroblocks:36864,maxBitrate:24e7,level:52},{maxMacroblocks:139264,maxBitrate:24e7,level:60},{maxMacroblocks:139264,maxBitrate:48e7,level:61},{maxMacroblocks:139264,maxBitrate:8e8,level:62}],he=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:35651584,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:35651584,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:35651584,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:186}],ue=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:35651584,maxBitrate:18e7,level:60},{maxPictureSize:35651584,maxBitrate:24e7,level:61},{maxPictureSize:35651584,maxBitrate:48e7,level:62}],pe=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:35651584,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:19}],me=(e,t,r,i)=>{if("avc"===e){const e=100,a=Math.ceil(t/16)*Math.ceil(r/16),s=de.find((e=>a<=e.maxMacroblocks&&i<=e.maxBitrate))??o(de),n=s?s.level:0;return`avc1.${e.toString(16).padStart(2,"0")}00${n.toString(16).padStart(2,"0")}`}if("hevc"===e){const e="",a=1,s="6",n=t*r,l=he.find((e=>n<=e.maxPictureSize&&i<=e.maxBitrate))??o(he),c="B0";return`hev1.${e}${a}.${s}.${l.tier}${l.level}.${c}`}if("vp8"===e)return"vp8";if("vp9"===e){const e=t*r,a="08";return`vp09.00.${(ue.find((t=>e<=t.maxPictureSize&&i<=t.maxBitrate))??o(ue)).level.toString().padStart(2,"0")}.${a}`}if("av1"===e){const e=0,a=t*r,s=pe.find((e=>a<=e.maxPictureSize&&i<=e.maxBitrate))??o(pe),n="08";return`av01.${e}.${s.level.toString().padStart(2,"0")}${s.tier}.${n}`}throw new TypeError(`Unhandled codec '${e}'.`)},fe=e=>{const t=e.split(".");return[1,1,Number(t[1]),2,1,Number(t[2]),3,1,Number(t[3]),4,1,t[4]?Number(t[4]):1]},ge=e=>{const t=e.split("."),r=Number(t[1]),i=t[2];return[129,(r<<5)+Number(i.slice(0,-1)),(("H"===i.slice(-1)?1:0)<<7)+((8===Number(t[3])?0:1)<<6)+0+((t[4]?Number(t[4]):0)<<4)+((t[5]?Number(t[5][0]):1)<<3)+((t[5]?Number(t[5][1]):1)<<2)+(t[5]?Number(t[5][2]):0),0]},ye=e=>{const{codec:t,codecDescription:r,colorSpace:i,avcCodecInfo:a,hevcCodecInfo:s,vp9CodecInfo:n,av1CodecInfo:l}=e;if("avc"===t){if(a){const e=new Uint8Array([a.avcProfileIndication,a.profileCompatibility,a.avcLevelIndication]);return`avc1.${k(e)}`}if(!r||r.byteLength<4)throw new TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc1.${k(r.subarray(1,4))}`}if("hevc"===t){let e,t,i,a,n,o;if(s)e=s.generalProfileSpace,t=s.generalProfileIdc,i=P(s.generalProfileCompatibilityFlags),a=s.generalTierFlag,n=s.generalLevelIdc,o=[...s.generalConstraintIndicatorFlags];else{if(!r||r.byteLength<23)throw new TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");const s=p(r),l=s.getUint8(1);e=l>>6&3,t=31&l,i=P(s.getUint32(2)),a=l>>5&1,n=s.getUint8(12),o=[];for(let e=0;e<6;e++)o.push(s.getUint8(6+e))}let l="hev1.";for(l+=["","A","B","C"][e]+t,l+=".",l+=i.toString(16).toUpperCase(),l+=".",l+=0===a?"L":"H",l+=n;o.length>0&&0===o[o.length-1];)o.pop();return o.length>0&&(l+=".",l+=o.map((e=>e.toString(16).toUpperCase())).join(".")),l}if("vp8"===t)return"vp8";if("vp9"===t){if(!n){const t=e.width*e.height;let r=o(ue).level;for(const e of ue)if(t<=e.maxPictureSize){r=e.level;break}return`vp09.00.${r.toString().padStart(2,"0")}.08`}let t=`vp09.${n.profile.toString().padStart(2,"0")}.${n.level.toString().padStart(2,"0")}.${n.bitDepth.toString().padStart(2,"0")}.${n.chromaSubsampling.toString().padStart(2,"0")}`;return t+=`.${n.colourPrimaries.toString().padStart(2,"0")}.${n.transferCharacteristics.toString().padStart(2,"0")}.${n.matrixCoefficients.toString().padStart(2,"0")}.${n.videoFullRangeFlag.toString().padStart(2,"0")}`,t.endsWith(".01.01.01.01.00")&&(t=t.slice(0,-15)),t}if("av1"===t){if(!l){const t=e.width*e.height;let r=o(ue).level;for(const e of ue)if(t<=e.maxPictureSize){r=e.level;break}return`av01.0.${r.toString().padStart(2,"0")}M.08`}const t=l.profile,r=l.level.toString().padStart(2,"0"),a=l.tier?"H":"M",s=l.bitDepth.toString().padStart(2,"0"),n=l.monochrome?"1":"0",c=100*l.chromaSubsamplingX+10*l.chromaSubsamplingY+1*(l.chromaSubsamplingX&&l.chromaSubsamplingY?l.chromaSamplePosition:0),d=i?.primaries?g[i.primaries]:1,h=i?.transfer?w[i.transfer]:1,u=i?.matrix?x[i.matrix]:1,p=i?.fullRange?1:0;let m=`av01.${t}.${r}${a}.${s}`;return m+=`.${n}.${c.toString().padStart(3,"0")}`,m+=`.${d.toString().padStart(2,"0")}`,m+=`.${h.toString().padStart(2,"0")}`,m+=`.${u.toString().padStart(2,"0")}`,m+=`.${p}`,m.endsWith(".0.110.01.01.01.0")&&(m=m.slice(0,-17)),m}throw new TypeError(`Unhandled codec '${t}'.`)},we=(e,t,r)=>{if("aac"===e)return t>=2&&r<=24e3?"mp4a.40.29":r<=24e3?"mp4a.40.5":"mp4a.40.2";if("mp3"===e)return"mp3";if("opus"===e)return"opus";if("vorbis"===e)return"vorbis";if("flac"===e)return"flac";if(ne.includes(e))return e;throw new TypeError(`Unhandled codec '${e}'.`)},ve=e=>{const{codec:t,codecDescription:r,aacCodecInfo:i}=e;if("aac"===t){if(!i)throw new TypeError("AAC codec info must be provided.");return i.isMpeg2?"mp4a.67":`mp4a.40.${xe(r).objectType}`}if("mp3"===t)return"mp3";if("opus"===t)return"opus";if("vorbis"===t)return"vorbis";if("flac"===t)return"flac";if(t&&ne.includes(t))return t;throw new TypeError(`Unhandled codec '${t}'.`)},xe=e=>{if(!e||e.byteLength<2)throw new TypeError("AAC description must be at least 2 bytes long.");const t=new c(e);let r=t.readBits(5);31===r&&(r=32+t.readBits(6));const i=t.readBits(4);let a=null;if(15===i)a=t.readBits(24);else{const e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i<e.length&&(a=e[i])}const s=t.readBits(4);let n=null;return s>=1&&s<=7&&(n={1:1,2:2,3:3,4:4,5:5,6:6,7:8}[s]),{objectType:r,frequencyIndex:i,sampleRate:a,channelConfiguration:s,numberOfChannels:n}},be=48e3,Se=/^pcm-([usf])(\d+)+(be)?$/,Te=e=>{if(s(ne.includes(e)),"ulaw"===e)return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if("alaw"===e)return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};const t=Se.exec(e);let r;return s(t),r="u"===t[1]?"unsigned":"s"===t[1]?"signed":"float",{dataType:r,sampleSize:Number(t[2])/8,littleEndian:"be"!==t[3],silentValue:"pcm-u8"===e?128:0}},Ce=e=>e.startsWith("avc1")||e.startsWith("avc3")?"avc":e.startsWith("hev1")||e.startsWith("hvc1")?"hevc":"vp8"===e?"vp8":e.startsWith("vp09")?"vp9":e.startsWith("av01")?"av1":e.startsWith("mp4a.40")||"mp4a.67"===e?"aac":"mp3"===e||"mp4a.69"===e||"mp4a.6B"===e||"mp4a.6b"===e?"mp3":"opus"===e?"opus":"vorbis"===e?"vorbis":"flac"===e?"flac":"ulaw"===e?"ulaw":"alaw"===e?"alaw":Se.test(e)?e:"webvtt"===e?"webvtt":null,ke=e=>"avc"===e?{avc:{format:"avc"}}:"hevc"===e?{hevc:{format:"hevc"}}:{},Pe=e=>"aac"===e?{aac:{format:"aac"}}:"opus"===e?{opus:{format:"opus"}}:{},Me=class{constructor(e){this._factor=e}_toVideoBitrate(e,t,r){const i=t*r,a=3e6*Math.pow(i/2073600,.95)*{avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2}[e]*this._factor;return 1e3*Math.ceil(a/1e3)}_toAudioBitrate(e){if(ne.includes(e)||"flac"===e)return;const t={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!t)throw new Error(`Unhandled codec: ${e}`);let r=t*this._factor;return"aac"===e?r=[96e3,128e3,16e4,192e3].reduce(((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e)):"opus"===e||"vorbis"===e?r=Math.max(6e3,r):"mp3"===e&&(r=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce(((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e))),1e3*Math.round(r/1e3)}},Re=new Me(.3),De=new Me(.6),_e=new Me(1),Ee=new Me(2),Ie=new Me(4),Fe=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],Ae=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,Oe=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,Le=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,Be=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,je=e=>{if(!e)throw new TypeError("Video chunk metadata must be provided.");if("object"!=typeof e)throw new TypeError("Video chunk metadata must be an object.");if(!e.decoderConfig)throw new TypeError("Video chunk metadata must include a decoder configuration.");if("object"!=typeof e.decoderConfig)throw new TypeError("Video chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw new TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!Fe.some((t=>e.decoderConfig.codec.startsWith(t))))throw new TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.codedWidth)||e.decoderConfig.codedWidth<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(e.decoderConfig.codedHeight)||e.decoderConfig.codedHeight<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(void 0!==e.decoderConfig.description&&!T(e.decoderConfig.description))throw new TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(void 0!==e.decoderConfig.colorSpace){const{colorSpace:t}=e.decoderConfig;if("object"!=typeof t)throw new TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");const r=Object.keys(g);if(null!=t.primaries&&!r.includes(t.primaries))throw new TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${r.join(", ")}.`);const i=Object.keys(w);if(null!=t.transfer&&!i.includes(t.transfer))throw new TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${i.join(", ")}.`);const a=Object.keys(x);if(null!=t.matrix&&!a.includes(t.matrix))throw new TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${a.join(", ")}.`);if(null!=t.fullRange&&"boolean"!=typeof t.fullRange)throw new TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(e.decoderConfig.codec.startsWith("avc1")||e.decoderConfig.codec.startsWith("avc3")){if(!Ae.test(e.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(e.decoderConfig.codec.startsWith("hev1")||e.decoderConfig.codec.startsWith("hvc1")){if(!Oe.test(e.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(e.decoderConfig.codec.startsWith("vp8")){if("vp8"!==e.decoderConfig.codec)throw new TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(e.decoderConfig.codec.startsWith("vp09")){if(!Le.test(e.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(e.decoderConfig.codec.startsWith("av01")&&!Be.test(e.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},ze=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],Ve=e=>{if(!e)throw new TypeError("Audio chunk metadata must be provided.");if("object"!=typeof e)throw new TypeError("Audio chunk metadata must be an object.");if(!e.decoderConfig)throw new TypeError("Audio chunk metadata must include a decoder configuration.");if("object"!=typeof e.decoderConfig)throw new TypeError("Audio chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw new TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!ze.some((t=>e.decoderConfig.codec.startsWith(t))))throw new TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.sampleRate)||e.decoderConfig.sampleRate<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(e.decoderConfig.numberOfChannels)||e.decoderConfig.numberOfChannels<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(void 0!==e.decoderConfig.description&&!T(e.decoderConfig.description))throw new TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(e.decoderConfig.codec.startsWith("mp4a")&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(e.decoderConfig.codec))throw new TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.");if(!e.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for AAC must include a description, which is expected to be an AudioSpecificConfig as specified in ISO 14496-3.")}else if(e.decoderConfig.codec.startsWith("mp3")||e.decoderConfig.codec.startsWith("mp4a")){if("mp3"!==e.decoderConfig.codec&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(e.decoderConfig.codec.startsWith("opus")){if("opus"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(e.decoderConfig.description&&e.decoderConfig.description.byteLength<18)throw new TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(e.decoderConfig.codec.startsWith("vorbis")){if("vorbis"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!e.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(e.decoderConfig.codec.startsWith("flac")){if("flac"!==e.decoderConfig.codec)throw new TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');const t=42;if(!e.decoderConfig.description||e.decoderConfig.description.byteLength<t)throw new TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((e.decoderConfig.codec.startsWith("pcm")||e.decoderConfig.codec.startsWith("ulaw")||e.decoderConfig.codec.startsWith("alaw"))&&!ne.includes(e.decoderConfig.codec))throw new TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${ne.join(", ")}).`)},$e=e=>{if(!e)throw new TypeError("Subtitle metadata must be provided.");if("object"!=typeof e)throw new TypeError("Subtitle metadata must be an object.");if(!e.config)throw new TypeError("Subtitle metadata must include a config object.");if("object"!=typeof e.config)throw new TypeError("Subtitle metadata config must be an object.");if("string"!=typeof e.config.description)throw new TypeError("Subtitle metadata config description must be a string.")},Ue=e=>{if(se.includes(e))return Ne(e);if(le.includes(e))return We(e);if(ce.includes(e))return He(e);throw new TypeError(`Unknown codec '${e}'.`)},Ne=async(e,{width:t=1280,height:r=720,bitrate:i=1e6}={})=>{if(!se.includes(e))return!1;if(!Number.isInteger(t)||t<=0)throw new TypeError("width must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("height must be a positive integer.");if(!(i instanceof Me)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer or a quality.");const a=i instanceof Me?i._toVideoBitrate(e,t,r):i;if(te.length>0){const i={codec:me(e,t,r,a),width:t,height:r,bitrate:a,...ke(e)};if(te.some((t=>t.supports(e,i))))return!0}return"undefined"!=typeof VideoEncoder&&!0===(await VideoEncoder.isConfigSupported({codec:me(e,t,r,a),width:t,height:r,bitrate:a,...ke(e)})).supported},We=async(e,{numberOfChannels:t=2,sampleRate:r=48e3,bitrate:i=128e3}={})=>{if(!le.includes(e))return!1;if(!Number.isInteger(t)||t<=0)throw new TypeError("numberOfChannels must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("sampleRate must be a positive integer.");if(!(i instanceof Me)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer.");const a=i instanceof Me?i._toAudioBitrate(e):i;if(re.length>0){const i={codec:we(e,t,r),numberOfChannels:t,sampleRate:r,bitrate:a,...Pe(e)};if(re.some((t=>t.supports(e,i))))return!0}return!!ne.includes(e)||"undefined"!=typeof AudioEncoder&&!0===(await AudioEncoder.isConfigSupported({codec:we(e,t,r),numberOfChannels:t,sampleRate:r,bitrate:a,...Pe(e)})).supported},He=async e=>!!ce.includes(e),Ge=async()=>{const[e,t,r]=await Promise.all([qe(),Ke(),Qe()]);return[...e,...t,...r]},qe=async(e=se,t)=>{const r=await Promise.all(e.map((e=>Ne(e,t))));return e.filter(((e,t)=>r[t]))},Ke=async(e=le,t)=>{const r=await Promise.all(e.map((e=>We(e,t))));return e.filter(((e,t)=>r[t]))},Qe=async(e=ce)=>{const t=await Promise.all(e.map(He));return e.filter(((e,r)=>t[r]))},Ye=async(e,t)=>{for(const r of e)if(await Ne(r,t))return r;return null},Xe=async(e,t)=>{for(const r of e)if(await We(r,t))return r;return null},Je=async e=>{for(const t of e)if(await He(t))return t;return null},Ze=/(?:(.+?)\n)?((?:\d{2}:)?\d{2}:\d{2}.\d{3})\s+-->\s+((?:\d{2}:)?\d{2}:\d{2}.\d{3})/g,et=/^WEBVTT(.|\n)*?\n{2}/,tt=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,rt=class{constructor(e){this.preambleText=null,this.preambleEmitted=!1,this.options=e}parse(e){let t;if(e=e.replaceAll("\r\n","\n").replaceAll("\r","\n"),Ze.lastIndex=0,!this.preambleText){if(!et.test(e))throw new Error("WebVTT preamble incorrect.");t=Ze.exec(e);const r=e.slice(0,t?.index??e.length).trimEnd();if(!r)throw new Error("No WebVTT preamble provided.");this.preambleText=r,t&&(e=e.slice(t.index),Ze.lastIndex=0)}for(;t=Ze.exec(e);){const r=e.slice(0,t.index),i=t[1],a=t.index+t[0].length,s=e.indexOf("\n",a)+1,n=e.slice(a,s).trim();let o=e.indexOf("\n\n",a);-1===o&&(o=e.length);const l=at(t[2]),c=at(t[3])-l,d=e.slice(s,o).trim();e=e.slice(o).trimStart(),Ze.lastIndex=0;const h={timestamp:l/1e3,duration:c/1e3,text:d,identifier:i,settings:n,notes:r},u={};this.preambleEmitted||(u.config={description:this.preambleText},this.preambleEmitted=!0),this.options.output(h,u)}}},it=/(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})/,at=e=>{const t=it.exec(e);if(!t)throw new Error("Expected match.");return 36e5*Number(t[1]||"0")+6e4*Number(t[2])+1e3*Number(t[3])+Number(t[4])},st=e=>{const t=Math.floor(e/36e5),r=Math.floor(e%36e5/6e4),i=Math.floor(e%6e4/1e3),a=e%1e3;return t.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")+"."+a.toString().padStart(3,"0")},nt=e=>{const t=[];let r=0;for(;r<e.length;){let i=-1,a=0;for(let t=r;t<e.length-3;t++){if(0===e[t]&&0===e[t+1]&&1===e[t+2]){i=t,a=3;break}if(t<e.length-4&&0===e[t]&&0===e[t+1]&&0===e[t+2]&&1===e[t+3]){i=t,a=4;break}}if(-1===i)break;if(r>0&&i>r){const a=e.subarray(r,i);a.length>0&&t.push(a)}r=i+a}if(r<e.length){const i=e.subarray(r);i.length>0&&t.push(i)}return t},ot=(e,t)=>{const r=[];let i=0;const a=new DataView(e.buffer,e.byteOffset,e.byteLength);for(;i+t<=e.length;){let n;1===t?n=a.getUint8(i):2===t?n=a.getUint16(i,!1):3===t?n=(a.getUint16(i,!1)<<8)+a.getUint8(i+2):4===t?n=a.getUint32(i,!1):(F(t),s(!1)),i+=t;const o=e.subarray(i,i+n);r.push(o),i+=n}return r},lt=e=>{const t=[],r=e.length;for(let i=0;i<r;i++)i+2<r&&0===e[i]&&0===e[i+1]&&3===e[i+2]?(t.push(0,0),i+=2):t.push(e[i]);return new Uint8Array(t)},ct=e=>31&e[0],dt=e=>{try{const t=nt(e),r=t.filter((e=>7===ct(e))),i=t.filter((e=>8===ct(e))),a=t.filter((e=>13===ct(e)));if(0===r.length)return null;if(0===i.length)return null;const s=r[0],n=new c(lt(s));if(n.skipBits(1),n.skipBits(2),7!==n.readBits(5))return console.error("Invalid SPS NAL unit type"),null;const o=n.readAlignedByte(),l={configurationVersion:1,avcProfileIndication:o,profileCompatibility:n.readAlignedByte(),avcLevelIndication:n.readAlignedByte(),lengthSizeMinusOne:3,sequenceParameterSets:r,pictureParameterSets:i,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if(100===o||110===o||122===o||144===o){d(n);const e=d(n);3===e&&n.skipBits(1);const t=d(n),r=d(n);l.chromaFormat=e,l.bitDepthLumaMinus8=t,l.bitDepthChromaMinus8=r,l.sequenceParameterSetExt=a}return l}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},ht=e=>e[0]>>1&63,ut=e=>{try{const t=nt(e),r=t.filter((e=>32===ht(e))),i=t.filter((e=>33===ht(e))),a=t.filter((e=>34===ht(e))),s=t.filter((e=>39===ht(e)||40===ht(e)));if(0===i.length||0===a.length)return null;const n=i[0],o=new c(lt(n));o.skipBits(16),o.readBits(4);const l=o.readBits(3),u=o.readBits(1),{general_profile_space:p,general_tier_flag:m,general_profile_idc:f,general_profile_compatibility_flags:g,general_constraint_indicator_flags:y,general_level_idc:w}=pt(o,l);d(o);const v=d(o);3===v&&o.skipBits(1),d(o),d(o),o.readBits(1)&&(d(o),d(o),d(o),d(o));const x=d(o),b=d(o);d(o);for(let e=o.readBits(1)?0:l;e<=l;e++)d(o),d(o),d(o);d(o),d(o),d(o),d(o),d(o),d(o),o.readBits(1)&&o.readBits(1)&&mt(o),o.skipBits(1),o.skipBits(1),o.readBits(1)&&(o.skipBits(4),o.skipBits(4),d(o),d(o),o.skipBits(1));const S=d(o);if(ft(o,S),o.readBits(1)){const e=d(o);for(let t=0;t<e;t++)d(o),o.skipBits(1)}o.skipBits(1),o.skipBits(1);let T=0;o.readBits(1)&&(T=yt(o,l));let C=0;if(a.length>0){const e=a[0],t=new c(lt(e));t.skipBits(16),d(t),d(t),t.skipBits(1),t.skipBits(1),t.skipBits(3),t.skipBits(1),t.skipBits(1),d(t),d(t),h(t),t.skipBits(1),t.skipBits(1),t.readBits(1)&&d(t),h(t),h(t),t.skipBits(1),t.skipBits(1),t.skipBits(1),t.skipBits(1);const r=t.readBits(1),i=t.readBits(1);C=r||i?r&&!i?2:!r&&i?3:0:0}return{configurationVersion:1,generalProfileSpace:p,generalTierFlag:m,generalProfileIdc:f,generalProfileCompatibilityFlags:g,generalConstraintIndicatorFlags:y,generalLevelIdc:w,minSpatialSegmentationIdc:T,parallelismType:C,chromaFormatIdc:v,bitDepthLumaMinus8:x,bitDepthChromaMinus8:b,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:l+1,temporalIdNested:u,lengthSizeMinusOne:3,arrays:[...r.length?[{arrayCompleteness:1,nalUnitType:32,nalUnits:r}]:[],...i.length?[{arrayCompleteness:1,nalUnitType:33,nalUnits:i}]:[],...a.length?[{arrayCompleteness:1,nalUnitType:34,nalUnits:a}]:[],...s.length?[{arrayCompleteness:1,nalUnitType:ht(s[0]),nalUnits:s}]:[]]}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},pt=(e,t)=>{const r=e.readBits(2),i=e.readBits(1),a=e.readBits(5);let s=0;for(let t=0;t<32;t++)s=s<<1|e.readBits(1);const n=new Uint8Array(6);for(let t=0;t<6;t++)n[t]=e.readBits(8);const o=e.readBits(8),l=[],c=[];for(let r=0;r<t;r++)l.push(e.readBits(1)),c.push(e.readBits(1));if(t>0)for(let r=t;r<8;r++)e.skipBits(2);for(let r=0;r<t;r++)l[r]&&e.skipBits(88),c[r]&&e.skipBits(8);return{general_profile_space:r,general_tier_flag:i,general_profile_idc:a,general_profile_compatibility_flags:s,general_constraint_indicator_flags:n,general_level_idc:o}},mt=e=>{for(let t=0;t<4;t++)for(let r=0;r<(3===t?2:6);r++)if(e.readBits(1)){const r=Math.min(64,1<<4+(t<<1));t>1&&h(e);for(let t=0;t<r;t++)h(e)}else d(e)},ft=(e,t)=>{const r=[];for(let i=0;i<t;i++)r[i]=gt(e,i,t,r)},gt=(e,t,r,i)=>{let a=0,s=0,n=0;if(0!==t&&(s=e.readBits(1)),s){n=t===r?t-(d(e)+1):t-1,e.readBits(1),d(e);const s=i[n]??0;for(let t=0;t<=s;t++)e.readBits(1)||e.readBits(1);a=i[n]}else{const t=d(e),r=d(e);for(let r=0;r<t;r++)d(e),e.readBits(1);for(let t=0;t<r;t++)d(e),e.readBits(1);a=t+r}return a},yt=(e,t)=>{if(e.readBits(1)&&255===e.readBits(8)&&(e.readBits(16),e.readBits(16)),e.readBits(1)&&e.readBits(1),e.readBits(1)&&(e.readBits(3),e.readBits(1),e.readBits(1)&&(e.readBits(8),e.readBits(8),e.readBits(8))),e.readBits(1)&&(d(e),d(e)),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(1)&&(d(e),d(e),d(e),d(e)),e.readBits(1)&&(e.readBits(32),e.readBits(32),e.readBits(1)&&d(e),e.readBits(1)&&wt(e,!0,t)),e.readBits(1)){e.readBits(1),e.readBits(1),e.readBits(1);const t=d(e);return d(e),d(e),d(e),d(e),t}return 0},wt=(e,t,r)=>{let i=!1,a=!1,s=!1;t&&(i=1===e.readBits(1),a=1===e.readBits(1),(i||a)&&(s=1===e.readBits(1),s&&(e.readBits(8),e.readBits(5),e.readBits(1),e.readBits(5)),e.readBits(4),e.readBits(4),s&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5)));for(let t=0;t<=r;t++){let t=!0;1===e.readBits(1)||(t=1===e.readBits(1));let r=!1;t?d(e):r=1===e.readBits(1);let n=1;r||(n=d(e)+1),i&&vt(e,n,s),a&&vt(e,n,s)}},vt=(e,t,r)=>{for(let i=0;i<t;i++)d(e),d(e),r&&(d(e),d(e)),e.readBits(1)},xt=e=>{const t=new c(e);if(2!==t.readBits(2))return null;const r=t.readBits(1),i=(t.readBits(1)<<1)+r;if(3===i&&t.skipBits(1),1===t.readBits(1))return null;if(0!==t.readBits(1))return null;if(t.skipBits(2),4817730!==t.readBits(24))return null;let a=8;i>=2&&(a=t.readBits(1)?12:10);const s=t.readBits(3);let n=0,l=0;if(7!==s)if(l=t.readBits(1),1===i||3===i){const e=t.readBits(1),r=t.readBits(1);n=e||r?e&&!r?2:1:3,t.skipBits(1)}else n=1;else n=3,l=1;const d=(t.readBits(16)+1)*(t.readBits(16)+1);let h=o(ue).level;for(const e of ue)if(d<=e.maxPictureSize){h=e.level;break}return{profile:i,level:h,bitDepth:a,chromaSubsampling:n,videoFullRangeFlag:l,colourPrimaries:2===s?1:1===s?6:2,transferCharacteristics:2===s?1:1===s?6:2,matrixCoefficients:7===s?0:2===s?1:1===s?6:2}};function*bt(e){const t=new c(e),r=()=>{let e=0;for(let r=0;r<8;r++){const i=t.readAlignedByte();if(e|=(127&i)<<7*r,!(128&i))break;if(7===r&&128&i)return null}return e>=2**32-1?null:e};for(;t.getBitsLeft()>=8;){t.skipBits(1);const i=t.readBits(4),a=t.readBits(1),n=t.readBits(1);let o;if(t.skipBits(1),a&&t.skipBits(8),n){const e=r();if(null===e)return;o=e}else o=Math.floor(t.getBitsLeft()/8);s(t.pos%8==0),yield{type:i,data:e.subarray(t.pos/8,t.pos/8+o)},t.skipBits(8*o)}}var St=e=>{for(const{type:t,data:r}of bt(e)){if(1!==t)continue;const e=new c(r),i=e.readBits(3);e.readBits(1);let a=0,s=0,n=0;if(e.readBits(1))a=e.readBits(5);else{if(e.readBits(1)&&(e.skipBits(32),e.skipBits(32),e.readBits(1)))return null;const t=e.readBits(1);t&&(n=e.readBits(5),e.skipBits(32),e.skipBits(5),e.skipBits(5));const r=e.readBits(5);for(let i=0;i<=r;i++){e.skipBits(12);const r=e.readBits(5);if(0===i&&(a=r),r>7){const t=e.readBits(1);0===i&&(s=t)}if(t&&e.readBits(1)){const t=n+1;e.skipBits(t),e.skipBits(t),e.skipBits(1)}e.readBits(1)&&e.skipBits(4)}}const o=e.readBits(1);let l=8;2===i&&o?l=e.readBits(1)?12:10:i<=2&&(l=o?10:8);let d=0;1!==i&&(d=e.readBits(1));let h=1,u=1,p=0;return d||(0===i?(h=1,u=1):1===i?(h=0,u=0):12===l&&(h=e.readBits(1),h&&(u=e.readBits(1))),h&&u&&(p=e.readBits(2))),{profile:i,level:a,tier:s,bitDepth:l,monochrome:d,chromaSubsamplingX:h,chromaSubsamplingY:u,chromaSamplePosition:p}}return null},Tt=e=>{const t=p(e),r=t.getUint8(9),i=t.getUint16(10,!0),a=t.getUint32(12,!0),s=t.getInt16(16,!0),n=t.getUint8(18);let o=null;return n&&(o=e.subarray(19,21+r)),{outputChannelCount:r,preSkip:i,inputSampleRate:a,outputGain:s,channelMappingFamily:n,channelMappingTable:o}},Ct=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],kt=e=>{if(e.length<7)throw new Error("Setup header is too short.");if(5!==e[0])throw new Error("Wrong packet type in Setup header.");if("vorbis"!==String.fromCharCode(...e.slice(1,7)))throw new Error("Invalid packet signature in Setup header.");const t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e[t-1-i];const i=new c(r);let a=0;for(;i.getBitsLeft()>97;)if(1===i.readBits(1)){a=i.pos;break}if(0===a)throw new Error("Invalid Setup header: framing bit not found.");let s=0,n=!1,o=0;for(;i.getBitsLeft()>=97;){const e=i.pos,t=i.readBits(8),r=i.readBits(16),a=i.readBits(16);if(t>63||0!==r||0!==a){i.pos=e;break}if(i.skipBits(1),s++,s>64)break;i.clone().readBits(6)+1===s&&(n=!0,o=s)}if(!n)throw new Error("Invalid Setup header: mode header not found.");if(o>63)throw new Error(`Unsupported mode count: ${o}.`);const l=o;i.pos=0,i.skipBits(a);const d=Array(l).fill(0);for(let e=l-1;e>=0;e--)i.skipBits(40),d[e]=i.readBits(1);return{modeBlockflags:d}},Pt=class{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/2**32),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)this.helperView.setUint8(t%8,e.charCodeAt(t)),t%8==7&&this.writer.write(this.helper);e.length%8!=0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{const t=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(const t of e.children)t&&this.writeBox(t);const r=this.writer.getPos(),i=e.size??r-t;this.writer.seek(t),this.writeBoxHeader(e,i),this.writer.seek(r)}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){const t=this.offsets.get(e);s(void 0!==t);const r=this.writer.getPos();this.writer.seek(t),this.writeBox(e),this.writer.seek(r)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let t=this.measureBoxHeader(e);if(e.contents&&(t+=e.contents.byteLength),e.children)for(const r of e.children)r&&(t+=this.measureBox(r));return t}}},Mt=new Uint8Array(8),Rt=new DataView(Mt.buffer),Dt=e=>[(e%256+256)%256],_t=e=>(Rt.setUint16(0,e,!1),[Mt[0],Mt[1]]),Et=e=>(Rt.setInt16(0,e,!1),[Mt[0],Mt[1]]),It=e=>(Rt.setUint32(0,e,!1),[Mt[1],Mt[2],Mt[3]]),Ft=e=>(Rt.setUint32(0,e,!1),[Mt[0],Mt[1],Mt[2],Mt[3]]),At=e=>(Rt.setInt32(0,e,!1),[Mt[0],Mt[1],Mt[2],Mt[3]]),Ot=e=>(Rt.setUint32(0,Math.floor(e/2**32),!1),Rt.setUint32(4,e,!1),[Mt[0],Mt[1],Mt[2],Mt[3],Mt[4],Mt[5],Mt[6],Mt[7]]),Lt=e=>(Rt.setInt16(0,256*e,!1),[Mt[0],Mt[1]]),Bt=e=>(Rt.setInt32(0,65536*e,!1),[Mt[0],Mt[1],Mt[2],Mt[3]]),jt=e=>(Rt.setInt32(0,2**30*e,!1),[Mt[0],Mt[1],Mt[2],Mt[3]]),zt=(e,t)=>{const r=[];let i=e;do{let e=127&i;i>>=7,r.length>0&&(e|=128),r.push(e),void 0!==t&&t--}while(i>0||t);return r.reverse()},Vt=(e,t=!1)=>{const r=Array(e.length).fill(null).map(((t,r)=>e.charCodeAt(r)));return t&&r.push(0),r},$t=e=>{let t=null;for(const r of e)(!t||r.timestamp>t.timestamp)&&(t=r);return t},Ut=e=>{const t=e*(Math.PI/180),r=Math.round(Math.cos(t)),i=Math.round(Math.sin(t));return[r,i,0,-i,r,0,0,0,1]},Nt=Ut(0),Wt=e=>[Bt(e[0]),Bt(e[1]),jt(e[2]),Bt(e[3]),Bt(e[4]),jt(e[5]),Bt(e[6]),Bt(e[7]),jt(e[8])],Ht=(e,t,r)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:r}),Gt=(e,t,r,i,a)=>Ht(e,[Dt(t),It(r),i??[]],a),qt=e=>({type:"mdat",largeSize:e}),Kt=(e,t,r=!1)=>Ht("moov",void 0,[Qt(t,e),...e.map((e=>Yt(e,t))),r?Dr(e):null]),Qt=(e,t)=>{const r=ai(Math.max(0,...t.filter((e=>e.samples.length>0)).map((e=>{const t=$t(e.samples);return t.timestamp+t.duration}))),ii),i=Math.max(0,...t.map((e=>e.track.id)))+1,a=!l(e)||!l(r),s=a?Ot:Ft;return Gt("mvhd",+a,0,[s(e),s(e),Ft(ii),s(r),Bt(1),Lt(1),Array(10).fill(0),Wt(Nt),Array(24).fill(0),Ft(i)])},Yt=(e,t)=>Ht("trak",void 0,[Xt(e,t),Jt(e,t)]),Xt=(e,t)=>{const r=$t(e.samples),i=ai(r?r.timestamp+r.duration:0,ii),a=!l(t)||!l(i),s=a?Ot:Ft;let n;if("video"===e.type){const t=e.track.metadata.rotation;n=Ut(t??0)}else n=Nt;return Gt("tkhd",+a,3,[s(t),s(t),Ft(e.track.id),Ft(0),s(i),Array(8).fill(0),_t(0),_t(e.track.id),Lt("audio"===e.type?1:0),_t(0),Wt(n),Bt("video"===e.type?e.info.width:0),Bt("video"===e.type?e.info.height:0)])},Jt=(e,t)=>Ht("mdia",void 0,[Zt(e,t),rr(e),ir(e)]),Zt=(e,t)=>{const r=$t(e.samples),i=ai(r?r.timestamp+r.duration:0,e.timescale),a=!l(t)||!l(i),s=a?Ot:Ft;let n=0;for(const t of e.track.metadata.languageCode??j)n<<=5,n+=t.charCodeAt(0)-96;return Gt("mdhd",+a,0,[s(t),s(t),Ft(e.timescale),s(i),_t(n),_t(0)])},er={video:"vide",audio:"soun",subtitle:"text"},tr={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},rr=e=>Gt("hdlr",0,0,[Vt("mhlr"),Vt(er[e.type]),Ft(0),Ft(0),Ft(0),Vt(tr[e.type],!0)]),ir=e=>Ht("minf",void 0,[ar[e.type](),sr(),lr(e)]),ar={video:()=>Gt("vmhd",0,1,[_t(0),_t(0),_t(0),_t(0)]),audio:()=>Gt("smhd",0,0,[_t(0),_t(0)]),subtitle:()=>Gt("nmhd",0,0)},sr=()=>Ht("dinf",void 0,[nr()]),nr=()=>Gt("dref",0,0,[Ft(1)],[or()]),or=()=>Gt("url ",0,1),lr=e=>{const t=e.compositionTimeOffsetTable.length>1||e.compositionTimeOffsetTable.some((e=>0!==e.sampleCompositionTimeOffset));return Ht("stbl",void 0,[cr(e),Sr(e),t?Mr(e):null,t?Rr(e):null,Cr(e),kr(e),Pr(e),Tr(e)])},cr=e=>{let t;if("video"===e.type)t=dr(Vr[e.track.source._codec],e);else if("audio"===e.type){const r=Ur(e.track.source._codec,e.muxer.isQuickTime);s(r),t=pr(r,e)}else"subtitle"===e.type&&(t=br(Wr[e.track.source._codec],e));return s(t),Gt("stsd",0,0,[Ft(1)],[t])},dr=(e,t)=>Ht(e,[Array(6).fill(0),_t(1),_t(0),_t(0),Array(12).fill(0),_t(t.info.width),_t(t.info.height),Ft(4718592),Ft(4718592),Ft(0),_t(1),Array(32).fill(0),_t(24),Et(65535)],[$r[t.track.source._codec](t),S(t.info.decoderConfig.colorSpace)?hr(t):null]),hr=e=>Ht("colr",[Vt("nclx"),_t(g[e.info.decoderConfig.colorSpace.primaries]),_t(w[e.info.decoderConfig.colorSpace.transfer]),_t(x[e.info.decoderConfig.colorSpace.matrix]),Dt((e.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),ur=e=>{if(!e.info.decoderConfig)return null;const t=e.info.decoderConfig,r=t.codec.split("."),i=Number(r[1]),a=Number(r[2]),s=(Number(r[3])<<4)+((r[4]?Number(r[4]):1)<<1)+(r[8]?Number(r[8]):Number(t.colorSpace?.fullRange??0)),n=r[5]?Number(r[5]):t.colorSpace?.primaries?g[t.colorSpace.primaries]:2,o=r[6]?Number(r[6]):t.colorSpace?.transfer?w[t.colorSpace.transfer]:2,l=r[7]?Number(r[7]):t.colorSpace?.matrix?x[t.colorSpace.matrix]:2;return Gt("vpcC",1,0,[Dt(i),Dt(a),Dt(s),Dt(n),Dt(o),Dt(l),_t(0)])},pr=(e,t)=>{let r,i=0,a=16;if(ne.includes(t.track.source._codec)){const e=t.track.source._codec,{sampleSize:r}=Te(e);a=8*r,a>16&&(i=1)}return r=0===i?[Array(6).fill(0),_t(1),_t(i),_t(0),Ft(0),_t(t.info.numberOfChannels),_t(a),_t(0),_t(0),_t(t.info.sampleRate<65536?t.info.sampleRate:0),_t(0)]:[Array(6).fill(0),_t(1),_t(i),_t(0),Ft(0),_t(t.info.numberOfChannels),_t(Math.min(a,16)),_t(0),_t(0),_t(t.info.sampleRate<65536?t.info.sampleRate:0),_t(0),Ft(1),Ft(a/8),Ft(t.info.numberOfChannels*a/8),Ft(2)],Ht(e,r,[Nr(t.track.source._codec,t.muxer.isQuickTime)?.(t)??null])},mr=e=>{let t;switch(e.track.source._codec){case"aac":t=64;break;case"mp3":t=107;break;case"vorbis":t=221;break;default:throw new Error(`Unhandled audio codec: ${e.track.source._codec}`)}let r=[...Dt(t),...Dt(21),...It(0),...Ft(0),...Ft(0)];if(e.info.decoderConfig.description){const t=u(e.info.decoderConfig.description);r=[...r,...Dt(5),...zt(t.byteLength),...t]}return r=[..._t(1),...Dt(0),...Dt(4),...zt(r.length),...r,...Dt(6),...Dt(1),...Dt(2)],r=[...Dt(3),...zt(r.length),...r],Gt("esds",0,0,r)},fr=e=>Ht("wave",void 0,[gr(e),yr(e),Ht("\0\0\0\0")]),gr=e=>Ht("frma",[Vt(Ur(e.track.source._codec,e.muxer.isQuickTime))]),yr=e=>{const{littleEndian:t}=Te(e.track.source._codec);return Ht("enda",[_t(+t)])},wr=e=>{let t=e.info.numberOfChannels,r=3840,i=e.info.sampleRate,a=0,n=0,o=new Uint8Array(0);const l=e.info.decoderConfig?.description;if(l){s(l.byteLength>=18);const e=u(l),c=Tt(e);t=c.outputChannelCount,r=c.preSkip,i=c.inputSampleRate,a=c.outputGain,n=c.channelMappingFamily,c.channelMappingTable&&(o=c.channelMappingTable)}return Ht("dOps",[Dt(0),Dt(t),_t(r),Ft(i),Et(a),Dt(n),...o])},vr=e=>{const t=e.info.decoderConfig?.description;s(t);const r=u(t);return Gt("dfLa",0,0,[...r.subarray(4)])},xr=e=>{const{littleEndian:t,sampleSize:r}=Te(e.track.source._codec);return Gt("pcmC",0,0,[Dt(+t),Dt(8*r)])},br=(e,t)=>Ht(e,[Array(6).fill(0),_t(1)],[Hr[t.track.source._codec](t)]),Sr=e=>Gt("stts",0,0,[Ft(e.timeToSampleTable.length),e.timeToSampleTable.map((e=>[Ft(e.sampleCount),Ft(e.sampleDelta)]))]),Tr=e=>{if(e.samples.every((e=>"key"===e.type)))return null;const t=[...e.samples.entries()].filter((([,e])=>"key"===e.type));return Gt("stss",0,0,[Ft(t.length),t.map((([e])=>Ft(e+1)))])},Cr=e=>Gt("stsc",0,0,[Ft(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map((e=>[Ft(e.firstChunk),Ft(e.samplesPerChunk),Ft(1)]))]),kr=e=>{if("audio"===e.type&&e.info.requiresPcmTransformation){const{sampleSize:t}=Te(e.track.source._codec);return Gt("stsz",0,0,[Ft(t*e.info.numberOfChannels),Ft(e.samples.reduce(((t,r)=>t+ai(r.duration,e.timescale)),0))])}return Gt("stsz",0,0,[Ft(0),Ft(e.samples.length),e.samples.map((e=>Ft(e.size)))])},Pr=e=>e.finalizedChunks.length>0&&o(e.finalizedChunks).offset>=2**32?Gt("co64",0,0,[Ft(e.finalizedChunks.length),e.finalizedChunks.map((e=>Ot(e.offset)))]):Gt("stco",0,0,[Ft(e.finalizedChunks.length),e.finalizedChunks.map((e=>Ft(e.offset)))]),Mr=e=>Gt("ctts",1,0,[Ft(e.compositionTimeOffsetTable.length),e.compositionTimeOffsetTable.map((e=>[Ft(e.sampleCount),At(e.sampleCompositionTimeOffset)]))]),Rr=e=>{let t=1/0,r=-1/0,i=1/0,a=-1/0;s(e.compositionTimeOffsetTable.length>0),s(e.samples.length>0);for(let i=0;i<e.compositionTimeOffsetTable.length;i++){const a=e.compositionTimeOffsetTable[i];t=Math.min(t,a.sampleCompositionTimeOffset),r=Math.max(r,a.sampleCompositionTimeOffset)}for(let t=0;t<e.samples.length;t++){const r=e.samples[t];i=Math.min(i,ai(r.timestamp,e.timescale)),a=Math.max(a,ai(r.timestamp+r.duration,e.timescale))}const n=Math.max(-t,0);return a>=2**31?null:Gt("cslg",0,0,[At(n),At(t),At(r),At(i),At(a)])},Dr=e=>Ht("mvex",void 0,e.map(_r)),_r=e=>Gt("trex",0,0,[Ft(e.track.id),Ft(1),Ft(0),Ft(0),Ft(0)]),Er=(e,t)=>Ht("moof",void 0,[Ir(e),...t.map(Ar)]),Ir=e=>Gt("mfhd",0,0,[Ft(e)]),Fr=e=>{let t=0,r=0;const i="delta"===e.type;return r|=+i,t|=i?1:2,t<<24|r<<16},Ar=e=>Ht("traf",void 0,[Or(e),Lr(e),Br(e)]),Or=e=>{s(e.currentChunk);let t=0;t|=8,t|=16,t|=32,t|=131072;const r=e.currentChunk.samples[1]??e.currentChunk.samples[0],i={duration:r.timescaleUnitsToNextSample,size:r.size,flags:Fr(r)};return Gt("tfhd",0,131128,[Ft(e.track.id),Ft(i.duration),Ft(i.size),Ft(i.flags)])},Lr=e=>(s(e.currentChunk),Gt("tfdt",1,0,[Ot(ai(e.currentChunk.startTimestamp,e.timescale))])),Br=e=>{s(e.currentChunk);const t=e.currentChunk.samples.map((e=>e.timescaleUnitsToNextSample)),r=e.currentChunk.samples.map((e=>e.size)),i=e.currentChunk.samples.map(Fr),a=e.currentChunk.samples.map((t=>ai(t.timestamp-t.decodeTimestamp,e.timescale))),n=new Set(t),o=new Set(r),l=new Set(i),c=new Set(a),d=2===l.size&&i[0]!==i[1],h=n.size>1,u=o.size>1,p=!d&&l.size>1,m=c.size>1||[...c].some((e=>0!==e));let f=0;return f|=1,f|=4*+d,f|=256*+h,f|=512*+u,f|=1024*+p,f|=2048*+m,Gt("trun",1,f,[Ft(e.currentChunk.samples.length),Ft(e.currentChunk.offset-e.currentChunk.moofOffset||0),d?Ft(i[0]):[],e.currentChunk.samples.map(((e,s)=>[h?Ft(t[s]):[],u?Ft(r[s]):[],p?Ft(i[s]):[],m?At(a[s]):[]]))])},jr=(e,t)=>Gt("tfra",1,0,[Ft(e.track.id),Ft(63),Ft(e.finalizedChunks.length),e.finalizedChunks.map((r=>[Ot(ai(r.samples[0].timestamp,e.timescale)),Ot(r.moofOffset),Ft(t+1),Ft(1),Ft(1)]))]),zr=(e,t,r,i,a)=>Ht("vttc",void 0,[null!==a?Ht("vsid",[At(a)]):null,null!==r?Ht("iden",[...m.encode(r)]):null,null!==t?Ht("ctim",[...m.encode(st(t))]):null,null!==i?Ht("sttg",[...m.encode(i)]):null,Ht("payl",[...m.encode(e)])]),Vr={avc:"avc1",hevc:"hvc1",vp8:"vp08",vp9:"vp09",av1:"av01"},$r={avc:e=>e.info.decoderConfig&&Ht("avcC",[...u(e.info.decoderConfig.description)]),hevc:e=>e.info.decoderConfig&&Ht("hvcC",[...u(e.info.decoderConfig.description)]),vp8:ur,vp9:ur,av1:e=>Ht("av1C",ge(e.info.decoderConfig.codec))},Ur=(e,t)=>{switch(e){case"aac":case"mp3":case"vorbis":return"mp4a";case"opus":return"Opus";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(t)switch(e){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":case"pcm-s24be":return"in24";case"pcm-s32":case"pcm-s32be":return"in32";case"pcm-f32":case"pcm-f32be":return"fl32";case"pcm-f64":case"pcm-f64be":return"fl64"}else switch(e){case"pcm-s16":case"pcm-s16be":case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":return"ipcm";case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return"fpcm"}},Nr=(e,t)=>{switch(e){case"aac":case"mp3":case"vorbis":return mr;case"opus":return wr;case"flac":return vr}if(t)switch(e){case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return fr}else switch(e){case"pcm-s16":case"pcm-s16be":case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return xr}return null},Wr={webvtt:"wvtt"},Hr={webvtt:e=>Ht("vttC",[...m.encode(e.info.config.description)])},Gr=class{constructor(e){this.mutex=new C,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,t,r){t+=e.source._timestampOffset;let i=this.trackTimestampInfo.get(e);if(!i){if(!r)throw new Error("First frame must be a key frame.");i={maxTimestamp:t,maxTimestampBeforeLastKeyFrame:t},this.trackTimestampInfo.set(e,i)}if(t<0)throw new Error(`Timestamps must be non-negative (got ${t}s).`);if(r&&(i.maxTimestampBeforeLastKeyFrame=i.maxTimestamp),t<i.maxTimestampBeforeLastKeyFrame)throw new Error(`Timestamps cannot be smaller than the highest timestamp of the previous run (a run begins with a key frame and ends right before the next key frame). Got ${t}s, but highest timestamp is ${i.maxTimestampBeforeLastKeyFrame}s.`);return i.maxTimestamp=Math.max(i.maxTimestamp,t),t}},qr=class{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let t=this.getPos();if(t<this.trackedStart){if(t+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-t),t=0}const r=t+e.byteLength-this.trackedStart;let i=this.trackedWrites.byteLength;for(;i<r;)i*=2;if(i!==this.trackedWrites.byteLength){const e=new Uint8Array(i);e.set(this.trackedWrites,0),this.trackedWrites=e}this.trackedWrites.set(e,t-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,t+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(1024),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw new Error("Internal error: Can't get tracked writes since nothing was tracked.");const e={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,e}},Kr=65536,Qr=2**32,Yr=class extends qr{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(Kr,{maxByteLength:Qr})}catch{this.buffer=new ArrayBuffer(Kr),this.supportsResize=!1}else this.buffer=new ArrayBuffer(Kr);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let t=this.buffer.byteLength;for(;t<e;)t*=2;if(t!==this.buffer.byteLength){if(t>Qr)throw new Error("ArrayBuffer exceeded maximum size of 4294967296 bytes. Please consider using another target.");if(this.supportsResize)this.buffer.resize(t);else{const e=new ArrayBuffer(t),r=new Uint8Array(e);r.set(this.bytes,0),this.buffer=e,this.bytes=r}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,t){return this.bytes.slice(e,t)}},Xr=class extends qr{constructor(e){super(),this.pos=0,this.sections=[],this.lastWriteEnd=0,this.lastFlushEnd=0,this.writer=null,this.chunks=[],this.target=e,this.chunked=e._options.chunked??!1,this.chunkSize=e._options.chunkSize??16777216}start(){this.writer=this.target._writable.getWriter()}write(e){if(this.pos>this.lastWriteEnd){const e=this.pos-this.lastWriteEnd;this.pos=this.lastWriteEnd,this.write(new Uint8Array(e))}this.maybeTrackWrites(e),this.sections.push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength,this.lastWriteEnd=Math.max(this.lastWriteEnd,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){if(this.pos>this.lastWriteEnd){const e=this.pos-this.lastWriteEnd;this.pos=this.lastWriteEnd,this.write(new Uint8Array(e))}if(s(this.writer),0===this.sections.length)return;const e=[],t=[...this.sections].sort(((e,t)=>e.start-t.start));e.push({start:t[0].start,size:t[0].data.byteLength});for(let r=1;r<t.length;r++){const i=e[e.length-1],a=t[r];a.start<=i.start+i.size?i.size=Math.max(i.size,a.start+a.data.byteLength-i.start):e.push({start:a.start,size:a.data.byteLength})}for(const t of e){t.data=new Uint8Array(t.size);for(const e of this.sections)t.start<=e.start&&e.start<t.start+t.size&&t.data.set(e.data,e.start-t.start);if(null!==this.writer.desiredSize&&this.writer.desiredSize<=0&&await this.writer.ready,this.chunked)this.writeDataIntoChunks(t.data,t.start),this.tryToFlushChunks();else{if(this.ensureMonotonicity&&t.start!==this.lastFlushEnd)throw new Error("Internal error: Monotonicity violation.");this.writer.write({type:"write",data:t.data,position:t.start}),this.lastFlushEnd=t.start+t.data.byteLength}}this.sections.length=0}writeDataIntoChunks(e,t){let r=this.chunks.findIndex((e=>e.start<=t&&t<e.start+this.chunkSize));-1===r&&(r=this.createChunk(t));const i=this.chunks[r],a=t-i.start,s=e.subarray(0,Math.min(this.chunkSize-a,e.byteLength));i.data.set(s,a);const n={start:a,end:a+s.byteLength};if(this.insertSectionIntoChunk(i,n),0===i.written[0].start&&i.written[0].end===this.chunkSize&&(i.shouldFlush=!0),this.chunks.length>2){for(let e=0;e<this.chunks.length-1;e++)this.chunks[e].shouldFlush=!0;this.tryToFlushChunks()}s.byteLength<e.byteLength&&this.writeDataIntoChunks(e.subarray(s.byteLength),t+s.byteLength)}insertSectionIntoChunk(e,t){let r=0,i=e.written.length-1,a=-1;for(;r<=i;){const s=Math.floor(r+(i-r+1)/2);e.written[s].start<=t.start?(r=s+1,a=s):i=s-1}for(e.written.splice(a+1,0,t),(-1===a||e.written[a].end<t.start)&&a++;a<e.written.length-1&&e.written[a].end>=e.written[a+1].start;)e.written[a].end=Math.max(e.written[a].end,e.written[a+1].end),e.written.splice(a+1,1)}createChunk(e){const t={start:Math.floor(e/this.chunkSize)*this.chunkSize,data:new Uint8Array(this.chunkSize),written:[],shouldFlush:!1};return this.chunks.push(t),this.chunks.sort(((e,t)=>e.start-t.start)),this.chunks.indexOf(t)}tryToFlushChunks(e=!1){s(this.writer);for(let t=0;t<this.chunks.length;t++){const r=this.chunks[t];if(r.shouldFlush||e){for(const e of r.written){const t=r.start+e.start;if(this.ensureMonotonicity&&t!==this.lastFlushEnd)throw new Error("Internal error: Monotonicity violation.");this.writer.write({type:"write",data:r.data.subarray(e.start,e.end),position:t}),this.lastFlushEnd=r.start+e.end}this.chunks.splice(t--,1)}}}finalize(){return this.chunked&&this.tryToFlushChunks(!0),s(this.writer),this.writer.close()}async close(){return this.writer?.close()}},Jr=class{constructor(){this._output=null}},Zr=class extends Jr{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new Yr(this)}},ei=class extends Jr{constructor(e,t={}){if(super(),!(e instanceof WritableStream))throw new TypeError("StreamTarget requires a WritableStream instance.");if(null!=t&&"object"!=typeof t)throw new TypeError("StreamTarget options, when provided, must be an object.");if(void 0!==t.chunked&&"boolean"!=typeof t.chunked)throw new TypeError("options.chunked, when provided, must be a boolean.");if(void 0!==t.chunkSize&&(!Number.isInteger(t.chunkSize)||t.chunkSize<1024))throw new TypeError("options.chunkSize, when provided, must be an integer and not smaller than 1024.");this._writable=e,this._options=t}_createWriter(){return new Xr(this)}},ti=e=>{let t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isQuickTime?"quicktime":"mp4");return e.codecStrings.length>0&&(t+=`; codecs="${[...new Set(e.codecStrings)].join(", ")}"`),t},ri=class{constructor(e){this.reader=e,this.pos=0}readBytes(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU8(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1);return this.pos++,e.getUint8(t)}readU16(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getUint16(t,!1)}readI16(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getInt16(t,!1)}readU24(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+3);return this.pos+=3,256*e.getUint16(t,!1)+e.getUint8(t+2)}readU32(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,!1)}readI32(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getInt32(t,!1)}readU64(){return 4294967296*this.readU32()+this.readU32()}readI64(){return 4294967296*this.readI32()+this.readU32()}readF64(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+8);return this.pos+=8,e.getFloat64(t,!1)}readFixed_16_16(){return this.readI32()/65536}readFixed_2_30(){return this.readI32()/1073741824}readAscii(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let i="";for(let a=0;a<e;a++)i+=String.fromCharCode(t.getUint8(r+a));return i}readIsomVariableInteger(){let e=0;for(let t=0;t<4;t++){e<<=7;const t=this.readU8();if(e|=127&t,!(128&t))break}return e}readBoxHeader(){let e=this.readU32();const t=this.readAscii(4);let r=8;return 1===e&&(e=this.readU64(),r=16),{name:t,totalSize:e,headerSize:r,contentSize:e-r}}},ii=1e3,ai=(e,t,r=!0)=>{const i=e*t;return r?Math.round(i):i},si=class extends Gr{constructor(e,t){super(e),this.auxTarget=new Zr,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new Pt(this.auxWriter),this.mdat=null,this.trackDatas=[],this.allTracksKnown=_(),this.creationTime=Math.floor(Date.now()/1e3)+2082844800,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=t,this.writer=e._writer,this.boxWriter=new Pt(this.writer),this.isQuickTime=t instanceof Pa;const r=this.writer instanceof Yr&&"in-memory";this.fastStart=t._options.fastStart??r,this.isFragmented="fragmented"===this.fastStart,("in-memory"===this.fastStart||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=t._options.minimumFragmentDuration??1}async start(){const e=await this.mutex.acquire(),t=this.output._tracks.some((e=>"video"===e.type&&"avc"===e.source._codec));if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox((r={isQuickTime:this.isQuickTime,holdsAvc:t,fragmented:this.isFragmented}).isQuickTime?Ht("ftyp",[Vt("qt  "),Ft(512),Vt("qt  ")]):Ht("ftyp",r.fragmented?[Vt("iso5"),Ft(512),Vt("iso5"),Vt("iso6"),Vt("mp41")]:[Vt("isom"),Ft(512),Vt("isom"),r.holdsAvc?Vt("avc1"):[],Vt("mp41")])),this.format._options.onFtyp){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onFtyp(e,t)}var r;"in-memory"===this.fastStart?this.mdat=qt(!1):this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=qt(!0),this.boxWriter.writeBox(this.mdat)),await this.writer.flush(),e()}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some((t=>t.track===e)))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map((e=>"video"===e.type||"audio"===e.type?e.info.decoderConfig.codec:{webvtt:"wvtt"}[e.track.source._codec]));return ti({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some((e=>"video"===e.type)),hasAudio:this.trackDatas.some((e=>"audio"===e.type)),codecStrings:e})}getVideoTrackData(e,t,r){const i=this.trackDatas.find((t=>t.track===e));if(i)return i;je(r),s(r),s(r.decoderConfig);const a={...r.decoderConfig};s(void 0!==a.codedWidth),s(void 0!==a.codedHeight);let n=!1;if("avc"!==e.source._codec||a.description){if("hevc"===e.source._codec&&!a.description){const e=ut(t.data);if(!e)throw new Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");a.description=(e=>{const t=[];t.push(e.configurationVersion),t.push((3&e.generalProfileSpace)<<6|(1&e.generalTierFlag)<<5|31&e.generalProfileIdc),t.push(e.generalProfileCompatibilityFlags>>>24&255),t.push(e.generalProfileCompatibilityFlags>>>16&255),t.push(e.generalProfileCompatibilityFlags>>>8&255),t.push(255&e.generalProfileCompatibilityFlags),t.push(...e.generalConstraintIndicatorFlags),t.push(255&e.generalLevelIdc),t.push(240|e.minSpatialSegmentationIdc>>8&15),t.push(255&e.minSpatialSegmentationIdc),t.push(252|3&e.parallelismType),t.push(252|3&e.chromaFormatIdc),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.avgFrameRate>>8&255),t.push(255&e.avgFrameRate),t.push((3&e.constantFrameRate)<<6|(7&e.numTemporalLayers)<<3|(1&e.temporalIdNested)<<2|3&e.lengthSizeMinusOne),t.push(255&e.arrays.length);for(const r of e.arrays){t.push((1&r.arrayCompleteness)<<7|63&r.nalUnitType),t.push(r.nalUnits.length>>8&255),t.push(255&r.nalUnits.length);for(const e of r.nalUnits){t.push(e.length>>8&255),t.push(255&e.length);for(let r=0;r<e.length;r++)t.push(e[r])}}return new Uint8Array(t)})(e),n=!0}}else{const e=dt(t.data);if(!e)throw new Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");a.description=(e=>{const t=[];t.push(e.configurationVersion),t.push(e.avcProfileIndication),t.push(e.profileCompatibility),t.push(e.avcLevelIndication),t.push(252|3&e.lengthSizeMinusOne),t.push(224|31&e.sequenceParameterSets.length);for(const r of e.sequenceParameterSets){const e=r.byteLength;t.push(e>>8),t.push(255&e);for(let i=0;i<e;i++)t.push(r[i])}t.push(e.pictureParameterSets.length);for(const r of e.pictureParameterSets){const e=r.byteLength;t.push(e>>8),t.push(255&e);for(let i=0;i<e;i++)t.push(r[i])}if(100===e.avcProfileIndication||110===e.avcProfileIndication||122===e.avcProfileIndication||144===e.avcProfileIndication){s(null!==e.chromaFormat),s(null!==e.bitDepthLumaMinus8),s(null!==e.bitDepthChromaMinus8),s(null!==e.sequenceParameterSetExt),t.push(252|3&e.chromaFormat),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.sequenceParameterSetExt.length);for(const r of e.sequenceParameterSetExt){const e=r.byteLength;t.push(e>>8),t.push(255&e);for(let i=0;i<e;i++)t.push(r[i])}}return new Uint8Array(t)})(e),n=!0}const o=(e=>{const t=e<0?-1:1;let r=0,i=1,a=1,s=0,n=e=Math.abs(e);for(;;){const e=Math.floor(n),o=e*a+r,l=e*s+i;if(l>1e6)return{numerator:t*a,denominator:s};if(r=a,i=s,a=o,s=l,n=1/(n-e),!isFinite(n))break}return{numerator:t*a,denominator:s}})(1/(e.metadata.frameRate??57600)).denominator,l={muxer:this,track:e,type:"video",info:{width:a.codedWidth,height:a.codedHeight,decoderConfig:a,requiresAnnexBTransformation:n},timescale:o,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(l),this.trackDatas.sort(((e,t)=>e.track.id-t.track.id)),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),l}getAudioTrackData(e,t){const r=this.trackDatas.find((t=>t.track===e));if(r)return r;Ve(t),s(t),s(t.decoderConfig);const i={muxer:this,track:e,type:"audio",info:{numberOfChannels:t.decoderConfig.numberOfChannels,sampleRate:t.decoderConfig.sampleRate,decoderConfig:t.decoderConfig,requiresPcmTransformation:!this.isFragmented&&ne.includes(e.source._codec)},timescale:t.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(i),this.trackDatas.sort(((e,t)=>e.track.id-t.track.id)),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}getSubtitleTrackData(e,t){const r=this.trackDatas.find((t=>t.track===e));if(r)return r;$e(t),s(t),s(t.config);const i={muxer:this,track:e,type:"subtitle",info:{config:t.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(i),this.trackDatas.sort(((e,t)=>e.track.id-t.track.id)),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}async addEncodedVideoPacket(e,t,r){const i=await this.mutex.acquire();try{const i=this.getVideoTrackData(e,t,r);let a=t.data;if(i.info.requiresAnnexBTransformation){const e=(e=>{const t=nt(e);if(0===t.length)return null;let r=0;for(const e of t)r+=4+e.byteLength;const i=new Uint8Array(r),a=new DataView(i.buffer);let s=0;for(const e of t){const t=e.byteLength;a.setUint32(s,t,!1),s+=4,i.set(e,s),s+=e.byteLength}return i})(a);if(!e)throw new Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");a=e}const s=this.validateAndNormalizeTimestamp(i.track,t.timestamp,"key"===t.type),n=this.createSampleForTrack(i,a,s,t.duration,t.type);await this.registerSample(i,n)}finally{i()}}async addEncodedAudioPacket(e,t,r){const i=await this.mutex.acquire();try{const i=this.getAudioTrackData(e,r),a=this.validateAndNormalizeTimestamp(i.track,t.timestamp,"key"===t.type),s=this.createSampleForTrack(i,t.data,a,t.duration,t.type);i.info.requiresPcmTransformation&&await this.maybePadWithSilence(i,a),await this.registerSample(i,s)}finally{i()}}async maybePadWithSilence(e,t){const r=o(e.samples),i=r?r.timestamp+r.duration:0,a=t-i,s=ai(a,e.timescale);if(s>0){const{sampleSize:t,silentValue:r}=Te(e.info.decoderConfig.codec),n=s*e.info.numberOfChannels,o=new Uint8Array(t*n).fill(r),l=this.createSampleForTrack(e,new Uint8Array(o.buffer),i,a,"key");await this.registerSample(e,l)}}async addSubtitleCue(e,t,r){const i=await this.mutex.acquire();try{const i=this.getSubtitleTrackData(e,r);this.validateAndNormalizeTimestamp(i.track,t.timestamp,!0),"webvtt"===e.source._codec&&(i.cueQueue.push(t),await this.processWebVTTCues(i,t.timestamp))}finally{i()}}async processWebVTTCues(e,t){for(;e.cueQueue.length>0;){const i=new Set([]);for(const r of e.cueQueue)s(r.timestamp<=t),s(e.lastCueEndTimestamp<=r.timestamp+r.duration),i.add(Math.max(r.timestamp,e.lastCueEndTimestamp)),i.add(r.timestamp+r.duration);const a=[...i].sort(((e,t)=>e-t)),n=a[0],o=a[1]??n;if(t<o)break;if(e.lastCueEndTimestamp<n){this.auxWriter.seek(0);const t=Ht("vtte");this.auxBoxWriter.writeBox(t);const r=this.auxWriter.getSlice(0,this.auxWriter.getPos()),i=this.createSampleForTrack(e,r,e.lastCueEndTimestamp,n-e.lastCueEndTimestamp,"key");await this.registerSample(e,i),e.lastCueEndTimestamp=n}this.auxWriter.seek(0);for(let t=0;t<e.cueQueue.length;t++){const i=e.cueQueue[t];if(i.timestamp>=o)break;tt.lastIndex=0;const a=tt.test(i.text),s=i.timestamp+i.duration;let l=e.cueToSourceId.get(i);if(void 0===l&&o<s&&(l=e.nextSourceId++,e.cueToSourceId.set(i,l)),i.notes){const e=(r=i.notes,Ht("vtta",[...m.encode(r)]));this.auxBoxWriter.writeBox(e)}const c=zr(i.text,a?n:null,i.identifier??null,i.settings??null,l??null);this.auxBoxWriter.writeBox(c),s===o&&e.cueQueue.splice(t--,1)}const l=this.auxWriter.getSlice(0,this.auxWriter.getPos()),c=this.createSampleForTrack(e,l,n,o-n,"key");await this.registerSample(e,c),e.lastCueEndTimestamp=o}var r}createSampleForTrack(e,t,r,i,a){return{timestamp:r,decodeTimestamp:r,duration:i,data:t,size:t.byteLength,type:a,timescaleUnitsToNextSample:ai(i,e.timescale)}}processTimestamps(e,t){if(0===e.timestampProcessingQueue.length)return;if("audio"===e.type&&e.info.requiresPcmTransformation){let t=0;for(let r=0;r<e.timestampProcessingQueue.length;r++){const i=e.timestampProcessingQueue[r];t+=ai(i.duration,e.timescale)}return 0===e.timeToSampleTable.length?e.timeToSampleTable.push({sampleCount:t,sampleDelta:1}):o(e.timeToSampleTable).sampleCount+=t,void(e.timestampProcessingQueue.length=0)}const r=e.timestampProcessingQueue.map((e=>e.timestamp)).sort(((e,t)=>e-t));for(let t=0;t<e.timestampProcessingQueue.length;t++){const i=e.timestampProcessingQueue[t];i.decodeTimestamp=r[t],this.isFragmented||null!==e.lastTimescaleUnits||(i.decodeTimestamp=0);const a=ai(i.timestamp-i.decodeTimestamp,e.timescale),n=ai(i.duration,e.timescale);if(null!==e.lastTimescaleUnits){s(e.lastSample);const t=ai(i.decodeTimestamp,e.timescale,!1),r=Math.round(t-e.lastTimescaleUnits);if(s(r>=0),e.lastTimescaleUnits+=r,e.lastSample.timescaleUnitsToNextSample=r,!this.isFragmented){let t=o(e.timeToSampleTable);if(s(t),1===t.sampleCount){t.sampleDelta=r;const i=e.timeToSampleTable[e.timeToSampleTable.length-2];i&&i.sampleDelta===r&&(i.sampleCount++,e.timeToSampleTable.pop(),t=i)}else t.sampleDelta!==r&&(t.sampleCount--,e.timeToSampleTable.push(t={sampleCount:1,sampleDelta:r}));t.sampleDelta===n?t.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:n});const i=o(e.compositionTimeOffsetTable);s(i),i.sampleCompositionTimeOffset===a?i.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:a})}}else e.lastTimescaleUnits=ai(i.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:n}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:a}));e.lastSample=i}if(e.timestampProcessingQueue.length=0,s(e.lastSample),s(null!==e.lastTimescaleUnits),void 0!==t&&0===e.lastSample.timescaleUnitsToNextSample){s("key"===t.type);const r=ai(t.timestamp,e.timescale,!1),i=Math.round(r-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=i}}async registerSample(e,t){"key"===t.type&&this.processTimestamps(e,t),e.timestampProcessingQueue.push(t),this.isFragmented?(e.sampleQueue.push(t),await this.interleaveSamples()):await this.addSampleToTrack(e,t)}async addSampleToTrack(e,t){this.isFragmented||e.samples.push(t);let r=!1;if(e.currentChunk){e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,t.timestamp);const i=t.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){const a=this.trackDatas.every((r=>{if(e===r)return"key"===t.type;const i=r.sampleQueue[0];return i?"key"===i.type:r.track.source._closed}));i>=this.minimumFragmentDuration&&a&&t.timestamp>this.maxWrittenTimestamp&&(r=!0,await this.finalizeFragment())}else r=i>=.5}else r=!0;r&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:t.timestamp,samples:[],offset:null,moofOffset:null}),s(e.currentChunk),e.currentChunk.samples.push(t),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,t.timestamp))}async finalizeCurrentChunk(e){if(s(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let t=e.currentChunk.samples.length;if("audio"===e.type&&e.info.requiresPcmTransformation&&(t=e.currentChunk.samples.reduce(((t,r)=>t+ai(r.duration,e.timescale)),0)),0!==e.compactlyCodedChunkTable.length&&o(e.compactlyCodedChunkTable).samplesPerChunk===t||e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:t}),"in-memory"!==this.fastStart){e.currentChunk.offset=this.writer.getPos();for(const t of e.currentChunk.samples)s(t.data),this.writer.write(t.data),t.data=null;await this.writer.flush()}else e.currentChunk.offset=0}async interleaveSamples(e=!1){if(s(this.isFragmented),e||this.allTracksAreKnown())e:for(;;){let t=null,r=1/0;for(const i of this.trackDatas){if(!e&&0===i.sampleQueue.length&&!i.track.source._closed)break e;i.sampleQueue.length>0&&i.sampleQueue[0].timestamp<r&&(t=i,r=i.sampleQueue[0].timestamp)}if(!t)break;const i=t.sampleQueue.shift();await this.addSampleToTrack(t,i)}}async finalizeFragment(e=!0){s(this.isFragmented);const t=this.nextFragmentNumber++;if(1===t){this.format._options.onMoov&&this.writer.startTrackingWrites();const e=Kt(this.trackDatas,this.creationTime,!0);if(this.boxWriter.writeBox(e),this.format._options.onMoov){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}}const r=this.trackDatas.filter((e=>e.currentChunk)),i=Er(t,r),a=this.writer.getPos(),n=a+this.boxWriter.measureBox(i);let o=n+8,l=1/0;for(const e of r){e.currentChunk.offset=o,e.currentChunk.moofOffset=a;for(const t of e.currentChunk.samples)o+=t.size;l=Math.min(l,e.currentChunk.startTimestamp)}const c=o-n,d=c>=2**32;if(d)for(const e of r)e.currentChunk.offset+=8;this.format._options.onMoof&&this.writer.startTrackingWrites();const h=Er(t,r);if(this.boxWriter.writeBox(h),this.format._options.onMoof){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoof(e,t,l)}s(this.writer.getPos()===n),this.format._options.onMdat&&this.writer.startTrackingWrites();const u=qt(d);u.size=c,this.boxWriter.writeBox(u),this.writer.seek(n+(d?16:8));for(const e of r)for(const t of e.currentChunk.samples)this.writer.write(t.data),t.data=null;if(this.format._options.onMdat){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}for(const e of r)e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk),e.currentChunk=null;e&&await this.writer.flush()}async onTrackClose(e){const t=await this.mutex.acquire();if("subtitle"===e.type&&"webvtt"===e.source._codec){const t=this.trackDatas.find((t=>t.track===e));t&&await this.processWebVTTCues(t,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),t()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve();for(const e of this.trackDatas)"subtitle"===e.type&&"webvtt"===e.track.source._codec&&await this.processWebVTTCues(e,1/0);if(this.isFragmented){await this.interleaveSamples(!0);for(const e of this.trackDatas)this.processTimestamps(e);await this.finalizeFragment(!1)}else for(const e of this.trackDatas)this.processTimestamps(e),await this.finalizeCurrentChunk(e);if("in-memory"===this.fastStart){let e;s(this.mdat);for(let t=0;t<2;t++){const t=Kt(this.trackDatas,this.creationTime),r=this.boxWriter.measureBox(t);e=this.boxWriter.measureBox(this.mdat);let i=this.writer.getPos()+r+e;for(const t of this.finalizedChunks){t.offset=i;for(const{data:r}of t.samples)s(r),i+=r.byteLength,e+=r.byteLength}if(i<2**32)break;e>=2**32&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();const t=Kt(this.trackDatas,this.creationTime);if(this.boxWriter.writeBox(t),this.format._options.onMoov){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=e,this.boxWriter.writeBox(this.mdat);for(const e of this.finalizedChunks)for(const t of e.samples)s(t.data),this.writer.write(t.data),t.data=null;if(this.format._options.onMdat){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}}else if(this.isFragmented){const e=this.writer.getPos(),r=(t=this.trackDatas,Ht("mfra",void 0,[...t.map(jr),Gt("mfro",0,0,[Ft(0)])]));this.boxWriter.writeBox(r);const i=this.writer.getPos()-e;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(i)}else{s(this.mdat);const e=this.boxWriter.offsets.get(this.mdat);s(void 0!==e);const t=this.writer.getPos()-e;if(this.mdat.size=t,this.mdat.largeSize=t>=2**32,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}this.format._options.onMoov&&this.writer.startTrackingWrites();const r=Kt(this.trackDatas,this.creationTime);if(this.boxWriter.writeBox(r),this.format._options.onMoov){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}}var t;e()}},ni=class{constructor(e){this.value=e}},oi=class{constructor(e){this.value=e}},li=class{constructor(e){this.value=e}},ci=[440786851,408125543,17138,17139,290298740,357149030,524531317,374648427,475249515,423732329,272869232,307544935],di=e=>e<256?1:e<65536?2:e<1<<24?3:e<2**32?4:e<2**40?5:6,hi=e=>e>=-64&&e<64?1:e>=-8192&&e<8192?2:e>=-1048576&&e<1<<20?3:e>=-(1<<27)&&e<1<<27?4:e>=-(2**34)&&e<2**34?5:6,ui=class{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}writeByte(e){this.helperView.setUint8(0,e),this.writer.write(this.helper.subarray(0,1))}writeFloat32(e){this.helperView.setFloat32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeFloat64(e){this.helperView.setFloat64(0,e,!1),this.writer.write(this.helper)}writeUnsignedInt(e,t=di(e)){let r=0;switch(t){case 6:this.helperView.setUint8(r++,e/2**40|0);case 5:this.helperView.setUint8(r++,e/2**32|0);case 4:this.helperView.setUint8(r++,e>>24);case 3:this.helperView.setUint8(r++,e>>16);case 2:this.helperView.setUint8(r++,e>>8);case 1:this.helperView.setUint8(r++,e);break;default:throw new Error("Bad unsigned int size "+t)}this.writer.write(this.helper.subarray(0,r))}writeSignedInt(e,t=hi(e)){e<0&&(e+=2**(8*t)),this.writeUnsignedInt(e,t)}writeVarInt(e,t=(e=>{if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<268435455)return 4;if(e<2**35-1)return 5;if(e<2**42-1)return 6;throw new Error("EBML varint size not supported "+e)})(e)){let r=0;switch(t){case 1:this.helperView.setUint8(r++,128|e);break;case 2:this.helperView.setUint8(r++,64|e>>8),this.helperView.setUint8(r++,e);break;case 3:this.helperView.setUint8(r++,32|e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 4:this.helperView.setUint8(r++,16|e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 5:this.helperView.setUint8(r++,8|e/2**32&7),this.helperView.setUint8(r++,e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 6:this.helperView.setUint8(r++,4|e/2**40&3),this.helperView.setUint8(r++,e/2**32|0),this.helperView.setUint8(r++,e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;default:throw new Error("Bad EBML varint size "+t)}this.writer.write(this.helper.subarray(0,r))}writeString(e){this.writer.write(new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))))}writeEBML(e){if(null!==e)if(e instanceof Uint8Array)this.writer.write(e);else if(Array.isArray(e))for(const t of e)this.writeEBML(t);else if(this.offsets.set(e,this.writer.getPos()),this.writeUnsignedInt(e.id),Array.isArray(e.data)){const t=this.writer.getPos(),r=-1===e.size?1:e.size??4;-1===e.size?this.writeByte(255):this.writer.seek(this.writer.getPos()+r);const i=this.writer.getPos();if(this.dataOffsets.set(e,i),this.writeEBML(e.data),-1!==e.size){const e=this.writer.getPos()-i,a=this.writer.getPos();this.writer.seek(t),this.writeVarInt(e,r),this.writer.seek(a)}}else if("number"==typeof e.data){const t=e.size??di(e.data);this.writeVarInt(t),this.writeUnsignedInt(e.data,t)}else if("string"==typeof e.data)this.writeVarInt(e.data.length),this.writeString(e.data);else if(e.data instanceof Uint8Array)this.writeVarInt(e.data.byteLength,e.size),this.writer.write(e.data);else if(e.data instanceof ni)this.writeVarInt(4),this.writeFloat32(e.data.value);else if(e.data instanceof oi)this.writeVarInt(8),this.writeFloat64(e.data.value);else if(e.data instanceof li){const t=e.size??hi(e.data.value);this.writeVarInt(t),this.writeSignedInt(e.data.value,t)}}},pi=12,mi=class{constructor(e){this.reader=e,this.pos=0}readBytes(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU8(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1);return this.pos++,e.getUint8(t)}readS16(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getInt16(t,!1)}readVarIntSize(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1),r=e.getUint8(t);let i=1,a=128;for(;!(r&a)&&i<8;)i++,a>>=1;return i}readVarInt(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1),r=e.getUint8(t);let i=1,a=128;for(;!(r&a)&&i<8;)i++,a>>=1;const{view:s,offset:n}=this.reader.getViewAndOffset(this.pos,this.pos+i);let o=r&a-1;for(let e=1;e<i;e++)o*=256,o+=s.getUint8(n+e);return this.pos+=i,o}readUnsignedInt(e){if(e<1||e>8)throw new Error("Bad unsigned int size "+e);const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);let i=0;for(let a=0;a<e;a++)i*=256,i+=t.getUint8(r+a);return this.pos+=e,i}readSignedInt(e){let t=this.readUnsignedInt(e);return t&1<<8*e-1&&(t-=2**(8*e)),t}readFloat(e){if(0===e)return 0;if(4!==e&&8!==e)throw new Error("Bad float size "+e);const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e),i=4===e?t.getFloat32(r,!1):t.getFloat64(r,!1);return this.pos+=e,i}readString(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let i=0;for(;i<e&&0!==t.getUint8(r+i);)i+=1;return String.fromCharCode(...new Uint8Array(t.buffer,r,i))}readElementId(){const e=this.readVarIntSize();return this.readUnsignedInt(e)}readElementSize(){let e=this.readU8();return 255===e?e=null:(this.pos--,e=this.readVarInt(),72057594037927940===e&&(e=null)),e}readElementHeader(){return{id:this.readElementId(),size:this.readElementSize()}}async searchForNextElementId(e,t){const r=new Set(e);for(;this.pos<t-pi;){this.reader.rangeIsLoaded(this.pos,this.pos+pi)||await this.reader.loadRange(this.pos,Math.min(this.pos+1048576,t));const e=this.pos,i=this.readElementHeader();if(r.has(i.id))return e;yi(i.size),this.pos+=i.size}return null}},fi={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC","pcm-u8":"A_PCM/INT/LIT","pcm-s16":"A_PCM/INT/LIT","pcm-s16be":"A_PCM/INT/BIG","pcm-s24":"A_PCM/INT/LIT","pcm-s24be":"A_PCM/INT/BIG","pcm-s32":"A_PCM/INT/LIT","pcm-s32be":"A_PCM/INT/BIG","pcm-f32":"A_PCM/FLOAT/IEEE","pcm-f64":"A_PCM/FLOAT/IEEE",webvtt:"S_TEXT/WEBVTT"},gi=(e,t)=>{if(t>=e.length)throw new Error("Offset out of bounds.");const r=e[t];let i=1,a=128;for(;!(r&a)&&i<8;)i++,a>>=1;if(t+i>e.length)throw new Error("VarInt extends beyond data bounds.");let s=r&a-1;for(let r=1;r<i;r++)s*=256,s+=e[t+r];return{value:s,width:i}};function yi(e){if(null===e)throw new Error("Undefined element size is used in a place where it is not supported.")}var wi=e=>{let t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isWebM?"webm":"x-matroska");return e.codecStrings.length>0&&(t+=`; codecs="${[...new Set(e.codecStrings.filter(Boolean))].join(", ")}"`),t},vi="https://github.com/Vanilagy/mediabunny",xi={video:1,audio:2,subtitle:17},bi=class extends Gr{constructor(e,t){super(e),this.trackDatas=[],this.allTracksKnown=_(),this.segment=null,this.segmentInfo=null,this.seekHead=null,this.tracksElement=null,this.segmentDuration=null,this.cues=null,this.currentCluster=null,this.currentClusterStartMsTimestamp=null,this.currentClusterMaxMsTimestamp=null,this.trackDatasInCurrentCluster=new Map,this.duration=0,this.writer=e._writer,this.format=t,this.ebmlWriter=new ui(this.writer),this.format._options.appendOnly&&(this.writer.ensureMonotonicity=!0)}async start(){const e=await this.mutex.acquire();this.writeEBMLHeader(),this.format._options.appendOnly||this.createSeekHead(),this.createSegmentInfo(),this.createCues(),await this.writer.flush(),e()}writeEBMLHeader(){this.format._options.onEbmlHeader&&this.writer.startTrackingWrites();const e={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:this.format instanceof Ra?"webm":"matroska"},{id:17031,data:2},{id:17029,data:2}]};if(this.ebmlWriter.writeEBML(e),this.format._options.onEbmlHeader){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onEbmlHeader(e,t)}}createSeekHead(){const e={id:290298740,data:[{id:19899,data:[{id:21419,data:new Uint8Array([28,83,187,107])},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:new Uint8Array([21,73,169,102])},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:new Uint8Array([22,84,174,107])},{id:21420,size:5,data:0}]}]};this.seekHead=e}createSegmentInfo(){const e={id:17545,data:new oi(0)};this.segmentDuration=e;const t={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:vi},{id:22337,data:vi},this.format._options.appendOnly?null:e]};this.segmentInfo=t}createTracks(){const e={id:374648427,data:[]};this.tracksElement=e;for(const t of this.trackDatas){const r=fi[t.track.source._codec];s(r);let i=0;if("audio"===t.type&&"opus"===t.track.source._codec){i=8e7;const e=t.info.decoderConfig.description;if(e){const t=u(e),r=Tt(t);i=Math.round(r.preSkip/be*1e9)}}e.data.push({id:174,data:[{id:215,data:t.track.id},{id:29637,data:t.track.id},{id:131,data:xi[t.type]},{id:156,data:0},{id:2274716,data:t.track.metadata.languageCode??j},{id:134,data:r},{id:22186,data:0},{id:22203,data:i},"video"===t.type?this.videoSpecificTrackInfo(t):null,"audio"===t.type?this.audioSpecificTrackInfo(t):null,"subtitle"===t.type?this.subtitleSpecificTrackInfo(t):null]})}}videoSpecificTrackInfo(e){const{frameRate:t,rotation:r}=e.track.metadata,i=[e.info.decoderConfig.description?{id:25506,data:u(e.info.decoderConfig.description)}:null,t?{id:2352003,data:1e9/t}:null],a=r?n(-r):0,s=e.info.decoderConfig.colorSpace,o={id:224,data:[{id:176,data:e.info.width},{id:186,data:e.info.height},S(s)?{id:21936,data:[{id:21937,data:x[s.matrix]},{id:21946,data:w[s.transfer]},{id:21947,data:g[s.primaries]},{id:21945,data:s.fullRange?2:1}]}:null,a?{id:30320,data:[{id:30321,data:0},{id:30325,data:new ni((a+180)%360-180)}]}:null]};return i.push(o),i}audioSpecificTrackInfo(e){const t=ne.includes(e.track.source._codec)?Te(e.track.source._codec):null;return[e.info.decoderConfig.description?{id:25506,data:u(e.info.decoderConfig.description)}:null,{id:225,data:[{id:181,data:new ni(e.info.sampleRate)},{id:159,data:e.info.numberOfChannels},t?{id:25188,data:8*t.sampleSize}:null]}]}subtitleSpecificTrackInfo(e){return[{id:25506,data:m.encode(e.info.config.description)}]}createSegment(){const e={id:408125543,size:this.format._options.appendOnly?-1:6,data:[this.format._options.appendOnly?null:this.seekHead,this.segmentInfo,this.tracksElement]};if(this.segment=e,this.format._options.onSegmentHeader&&this.writer.startTrackingWrites(),this.ebmlWriter.writeEBML(e),this.format._options.onSegmentHeader){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onSegmentHeader(e,t)}}createCues(){this.cues={id:475249515,data:[]}}get segmentDataOffset(){return s(this.segment),this.ebmlWriter.dataOffsets.get(this.segment)}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some((t=>t.track===e)))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map((e=>"video"===e.type||"audio"===e.type?e.info.decoderConfig.codec:{webvtt:"wvtt"}[e.track.source._codec]));return wi({isWebM:this.format instanceof Ra,hasVideo:this.trackDatas.some((e=>"video"===e.type)),hasAudio:this.trackDatas.some((e=>"audio"===e.type)),codecStrings:e})}getVideoTrackData(e,t){const r=this.trackDatas.find((t=>t.track===e));if(r)return r;je(t),s(t),s(t.decoderConfig),s(void 0!==t.decoderConfig.codedWidth),s(void 0!==t.decoderConfig.codedHeight);const i={track:e,type:"video",info:{width:t.decoderConfig.codedWidth,height:t.decoderConfig.codedHeight,decoderConfig:t.decoderConfig},chunkQueue:[],lastWrittenMsTimestamp:null};return"vp9"===e.source._codec?i.info.decoderConfig={...i.info.decoderConfig,description:new Uint8Array(fe(i.info.decoderConfig.codec))}:"av1"===e.source._codec&&(i.info.decoderConfig={...i.info.decoderConfig,description:new Uint8Array(ge(i.info.decoderConfig.codec))}),this.trackDatas.push(i),this.trackDatas.sort(((e,t)=>e.track.id-t.track.id)),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}getAudioTrackData(e,t){const r=this.trackDatas.find((t=>t.track===e));if(r)return r;Ve(t),s(t),s(t.decoderConfig);const i={track:e,type:"audio",info:{numberOfChannels:t.decoderConfig.numberOfChannels,sampleRate:t.decoderConfig.sampleRate,decoderConfig:t.decoderConfig},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(i),this.trackDatas.sort(((e,t)=>e.track.id-t.track.id)),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}getSubtitleTrackData(e,t){const r=this.trackDatas.find((t=>t.track===e));if(r)return r;$e(t),s(t),s(t.config);const i={track:e,type:"subtitle",info:{config:t.config},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(i),this.trackDatas.sort(((e,t)=>e.track.id-t.track.id)),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}async addEncodedVideoPacket(e,t,r){const i=await this.mutex.acquire();try{const i=this.getVideoTrackData(e,r),a="key"===t.type;let s=this.validateAndNormalizeTimestamp(i.track,t.timestamp,a),n=t.duration;void 0!==e.metadata.frameRate&&(s=V(s,1/e.metadata.frameRate),n=V(n,1/e.metadata.frameRate));const o=this.createInternalChunk(t.data,s,n,t.type);"vp9"===e.source._codec&&this.fixVP9ColorSpace(i,o),i.chunkQueue.push(o),await this.interleaveChunks()}finally{i()}}async addEncodedAudioPacket(e,t,r){const i=await this.mutex.acquire();try{const i=this.getAudioTrackData(e,r),a="key"===t.type,s=this.validateAndNormalizeTimestamp(i.track,t.timestamp,a),n=this.createInternalChunk(t.data,s,t.duration,t.type);i.chunkQueue.push(n),await this.interleaveChunks()}finally{i()}}async addSubtitleCue(e,t,r){const i=await this.mutex.acquire();try{const i=this.getSubtitleTrackData(e,r),a=this.validateAndNormalizeTimestamp(i.track,t.timestamp,!0);let s=t.text;const n=Math.round(1e3*a);tt.lastIndex=0,s=s.replace(tt,(e=>{const t=at(e.slice(1,-1));return`<${st(t-n)}>`}));const o=m.encode(s),l=`${t.settings??""}\n${t.identifier??""}\n${t.notes??""}`,c=this.createInternalChunk(o,a,t.duration,"key",l.trim()?m.encode(l):null);i.chunkQueue.push(c),await this.interleaveChunks()}finally{i()}}async interleaveChunks(e=!1){if(e||this.allTracksAreKnown()){e:for(;;){let t=null,r=1/0;for(const i of this.trackDatas){if(!e&&0===i.chunkQueue.length&&!i.track.source._closed)break e;i.chunkQueue.length>0&&i.chunkQueue[0].timestamp<r&&(t=i,r=i.chunkQueue[0].timestamp)}if(!t)break;const i=t.chunkQueue.shift();this.writeBlock(t,i)}e||await this.writer.flush()}}fixVP9ColorSpace(e,t){if("key"!==t.type)return;if(!e.info.decoderConfig.colorSpace||!e.info.decoderConfig.colorSpace.matrix)return;const r=new c(t.data);r.skipBits(2);const i=r.readBits(1),a=(r.readBits(1)<<1)+i;if(3===a&&r.skipBits(1),r.readBits(1))return;if(0!==r.readBits(1))return;if(r.skipBits(2),4817730!==r.readBits(24))return;a>=2&&r.skipBits(1);const s={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e.info.decoderConfig.colorSpace.matrix];((e,t,r,i)=>{for(let a=t;a<r;a++){const t=Math.floor(a/8);let s=e[t];const n=7-(7&a);s&=~(1<<n),s|=(i&1<<r-a-1)>>r-a-1<<n,e[t]=s}})(t.data,r.pos,r.pos+3,s)}createInternalChunk(e,t,r,i,a=null){return{data:e,type:i,timestamp:t,duration:r,additions:a}}writeBlock(e,t){this.segment||(this.createTracks(),this.createSegment());const r=Math.round(1e3*t.timestamp),i=this.trackDatas.every((r=>{if(e===r)return"key"===t.type;const i=r.chunkQueue[0];return i?"key"===i.type:r.track.source._closed}));let a=!1;if(this.currentCluster){s(null!==this.currentClusterStartMsTimestamp),s(null!==this.currentClusterMaxMsTimestamp);const e=r-this.currentClusterStartMsTimestamp;a=i&&r>this.currentClusterMaxMsTimestamp&&e>=1e3*(this.format._options.minimumClusterDuration??1)||e>32767}else a=!0;a&&this.createNewCluster(r);const n=r-this.currentClusterStartMsTimestamp;if(n<-32768)return;const o=new Uint8Array(4),l=new DataView(o.buffer);l.setUint8(0,128|e.track.id),l.setInt16(1,n,!1);const c=Math.round(1e3*t.duration);if(0!==c||t.additions){const i={id:160,data:[{id:161,data:[o,t.data]},"delta"===t.type?{id:251,data:new li(e.lastWrittenMsTimestamp-r)}:null,t.additions?{id:30113,data:[{id:166,data:[{id:165,data:t.additions},{id:238,data:1}]}]}:null,c>0?{id:155,data:c}:null]};this.ebmlWriter.writeEBML(i)}else{l.setUint8(3,Number("key"===t.type)<<7);const e={id:163,data:[o,t.data]};this.ebmlWriter.writeEBML(e)}this.duration=Math.max(this.duration,r+c),e.lastWrittenMsTimestamp=r,this.trackDatasInCurrentCluster.has(e)||this.trackDatasInCurrentCluster.set(e,{firstMsTimestamp:r}),this.currentClusterMaxMsTimestamp=Math.max(this.currentClusterMaxMsTimestamp,r)}createNewCluster(e){this.currentCluster&&this.finalizeCurrentCluster(),this.format._options.onCluster&&this.writer.startTrackingWrites(),this.currentCluster={id:524531317,size:this.format._options.appendOnly?-1:5,data:[{id:231,data:e}]},this.ebmlWriter.writeEBML(this.currentCluster),this.currentClusterStartMsTimestamp=e,this.currentClusterMaxMsTimestamp=e,this.trackDatasInCurrentCluster.clear()}finalizeCurrentCluster(){if(s(this.currentCluster),!this.format._options.appendOnly){const e=this.writer.getPos()-this.ebmlWriter.dataOffsets.get(this.currentCluster),t=this.writer.getPos();this.writer.seek(this.ebmlWriter.offsets.get(this.currentCluster)+4),this.ebmlWriter.writeVarInt(e,5),this.writer.seek(t)}if(this.format._options.onCluster){s(null!==this.currentClusterStartMsTimestamp);const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onCluster(e,t,this.currentClusterStartMsTimestamp/1e3)}const e=this.ebmlWriter.offsets.get(this.currentCluster)-this.segmentDataOffset,t=new Map;for(const[e,{firstMsTimestamp:r}]of this.trackDatasInCurrentCluster)t.has(r)||t.set(r,[]),t.get(r).push(e);const r=[...t.entries()].sort(((e,t)=>e[0]-t[0]));for(const[t,i]of r)s(this.cues),this.cues.data.push({id:187,data:[{id:179,data:t},...i.map((t=>({id:183,data:[{id:247,data:t.track.id},{id:241,data:e}]})))]})}async onTrackClose(){const e=await this.mutex.acquire();this.allTracksAreKnown()&&this.allTracksKnown.resolve(),await this.interleaveChunks(),e()}async finalize(){const e=await this.mutex.acquire();if(this.allTracksKnown.resolve(),this.segment||(this.createTracks(),this.createSegment()),await this.interleaveChunks(!0),this.currentCluster&&this.finalizeCurrentCluster(),s(this.cues),this.ebmlWriter.writeEBML(this.cues),!this.format._options.appendOnly){const e=this.writer.getPos(),t=this.writer.getPos()-this.segmentDataOffset;this.writer.seek(this.ebmlWriter.offsets.get(this.segment)+4),this.ebmlWriter.writeVarInt(t,6),this.segmentDuration.data=new oi(this.duration),this.writer.seek(this.ebmlWriter.offsets.get(this.segmentDuration)),this.ebmlWriter.writeEBML(this.segmentDuration),this.seekHead.data[0].data[1].data=this.ebmlWriter.offsets.get(this.cues)-this.segmentDataOffset,this.seekHead.data[1].data[1].data=this.ebmlWriter.offsets.get(this.segmentInfo)-this.segmentDataOffset,this.seekHead.data[2].data[1].data=this.ebmlWriter.offsets.get(this.tracksElement)-this.segmentDataOffset,this.writer.seek(this.ebmlWriter.offsets.get(this.seekHead)),this.ebmlWriter.writeEBML(this.seekHead),this.writer.seek(e)}e()}},Si={1:[-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],2:[-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],3:[-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1]},Ti={1:[-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],2:[-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],3:[-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1]},Ci={0:[11025,12e3,8e3,-1],2:[22050,24e3,16e3,-1],3:[44100,48e3,32e3,-1]},ki=1483304551,Pi=1231971951,Mi=(e,t,r,i)=>3===e?Math.floor(4*(12*t/r+i)):Math.floor(144*t/r+i),Ri=(e,t)=>3===e?3===t?21:36:3===t?13:21,Di=(e,t)=>{const r=t.pos,i=e>>>24,a=e>>>16&255,s=e>>>8&255,n=255&e;if(255!==i&&255!==a&&255!==s&&255!==n)return t.pos+=4,null;if(t.pos+=1,255!==i)return null;if(224&~a)return null;const o=a>>3&3,l=a>>1&3,c=s>>4&15,d=s>>2&3,h=s>>1&1,u=n>>6&3,p=n>>4&3,m=n>>3&1,f=n>>2&1,g=3&n,y=3===o?Si[l]?.[c]:Ti[l]?.[c];if(!y||-1===y)return null;const w=1e3*y,v=Ci[o]?.[d];if(!v||-1===v)return null;const x=Mi(l,w,v,h);if(null!==t.fileSize&&t.fileSize-r<x)return null;let b;return b=3===o?3===l?384:1152:3===l?384:2===l?1152:576,{startPos:r,totalSize:x,mpegVersionId:o,layer:l,bitrate:w,frequencyIndex:d,sampleRate:v,channel:u,modeExtension:p,copyright:m,original:f,emphasis:g,audioSamplesInFrame:b}},_i=class{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer)}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeXingFrame(e){const t=this.writer.getPos(),r=224|e.mpegVersionId<<3|e.layer<<1,i=3===e.mpegVersionId?Si:Ti,a=i?.[e.layer];if(!a)throw new Error("Invalid MPEG version and layer combination.");const s=Ci[e.mpegVersionId]?.[e.frequencyIndex];if(!s||-1===s)throw new Error("Invalid MPEG version and frequency index combination.");const n=a.findIndex((t=>Mi(e.layer,1e3*t,s,0)>=155));if(-1===n)throw new Error("No suitable bitrate found.");const o=n<<4|e.frequencyIndex<<2,l=e.channel<<6|e.modeExtension<<4|e.copyright<<3|e.original<<2|e.emphasis;this.helper[0]=255,this.helper[1]=r,this.helper[2]=o,this.helper[3]=l,this.writer.write(this.helper.subarray(0,4));const c=Ri(e.mpegVersionId,e.channel);this.writer.seek(t+c),this.writeU32(ki);let d=0;null!==e.frameCount&&(d|=1),null!==e.fileSize&&(d|=2),null!==e.toc&&(d|=4),this.writeU32(d),this.writeU32(e.frameCount??0),this.writeU32(e.fileSize??0),this.writer.write(e.toc??new Uint8Array(100));const h=Mi(e.layer,1e3*a[n],s,0);this.writer.seek(t+h)}},Ei=class extends Gr{constructor(e,t){super(e),this.xingFrameData=null,this.frameCount=0,this.framePositions=[],this.format=t,this.writer=e._writer,this.mp3Writer=new _i(e._writer)}async start(){}async getMimeType(){return"audio/mpeg"}async addEncodedVideoPacket(){throw new Error("MP3 does not support video.")}async addEncodedAudioPacket(e,t){const r=await this.mutex.acquire();try{const r=!1!==this.format._options.xingHeader;if(!this.xingFrameData&&r){const e=p(t.data);if(e.byteLength<4)throw new Error("Invalid MP3 header in sample.");const r=e.getUint32(0,!1),i=Di(r,{pos:0,fileSize:null});if(!i)throw new Error("Invalid MP3 header in sample.");const a=Ri(i.mpegVersionId,i.channel);if(e.byteLength>=a+4){const t=e.getUint32(a,!1);if(t===ki||t===Pi)return}this.xingFrameData={mpegVersionId:i.mpegVersionId,layer:i.layer,frequencyIndex:i.frequencyIndex,channel:i.channel,modeExtension:i.modeExtension,copyright:i.copyright,original:i.original,emphasis:i.emphasis,frameCount:null,fileSize:null,toc:null},this.mp3Writer.writeXingFrame(this.xingFrameData),this.frameCount++}this.validateAndNormalizeTimestamp(e,t.timestamp,"key"===t.type),this.writer.write(t.data),this.frameCount++,await this.writer.flush(),r&&this.framePositions.push(this.writer.getPos())}finally{r()}}async addSubtitleCue(){throw new Error("MP3 does not support subtitles.")}async finalize(){if(!this.xingFrameData)return;const e=await this.mutex.acquire(),t=this.writer.getPos();this.writer.seek(0);const r=new Uint8Array(100);for(let e=0;e<100;e++){const i=Math.floor(this.framePositions.length*(e/100));s(-1!==i&&i<this.framePositions.length);const a=this.framePositions[i];r[e]=a/t*256}if(this.xingFrameData.frameCount=this.frameCount,this.xingFrameData.fileSize=t,this.xingFrameData.toc=r,this.format._options.onXingFrame&&this.writer.startTrackingWrites(),this.mp3Writer.writeXingFrame(this.xingFrameData),this.format._options.onXingFrame){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onXingFrame(e,t)}this.writer.seek(t),e()}},Ii=1399285583,Fi=new Uint32Array(256);for(let e=0;e<256;e++){let t=e<<24;for(let e=0;e<8;e++)t=2147483648&t?t<<1^79764919:t<<1;Fi[e]=t>>>0&4294967295}var Ai,Oi=e=>{const t=p(e),r=t.getUint32(22,!0);t.setUint32(22,0,!0);let i=0;for(let t=0;t<e.length;t++){const r=e[t];i=(i<<8^Fi[i>>>24^r])>>>0}return t.setUint32(22,r,!0),i},Li=(e,t,r)=>{let i=0,a=null;if(e.length>0)if("vorbis"===t.codec){s(t.vorbisInfo);const n=(1<<(e=>{let t=0;for(;e;)t++,e>>=1;return t})(t.vorbisInfo.modeBlockflags.length-1))-1<<1,o=(e[0]&n)>>1;if(o>=t.vorbisInfo.modeBlockflags.length)throw new Error("Invalid mode number.");let l=r;const c=t.vorbisInfo.modeBlockflags[o];if(a=t.vorbisInfo.blocksizes[c],1===c){const r=1+(1|n),i=e[0]&r?1:0;l=t.vorbisInfo.blocksizes[i]}i=null!==l?l+a>>2:0}else"opus"===t.codec&&(i=(e=>{const t=e[0]>>3;return{durationInSamples:Ct[t]}})(e).durationInSamples);return{durationInSamples:i,vorbisBlockSize:a}},Bi=e=>{let t="audio/ogg";return e.codecStrings&&(t+=`; codecs="${[...new Set(e.codecStrings)].join(", ")}"`),t},ji=282,zi=class{constructor(e){this.reader=e,this.pos=0}readBytes(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU8(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1);return this.pos+=1,e.getUint8(t)}readU32(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,!0)}readI32(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getInt32(t,!0)}readI64(){const e=this.readU32();return 4294967296*this.readI32()+e}readAscii(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let i="";for(let a=0;a<e;a++)i+=String.fromCharCode(t.getUint8(r+a));return i}readPageHeader(){const e=this.pos;if(this.readU32()!==Ii)return null;this.pos+=1;const t=this.readU8(),r=this.readI64(),i=this.readU32(),a=this.readU32(),s=this.readU32(),n=this.readU8(),o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=this.readU8();const l=27+n,c=o.reduce(((e,t)=>e+t),0);return{headerStartPos:e,totalSize:l+c,dataStartPos:e+l,dataSize:c,headerType:t,granulePosition:r,serialNumber:i,sequenceNumber:a,checksum:s,lacingValues:o}}findNextPageHeader(e){for(;this.pos<e-3;){const e=this.readU32(),t=79;if((255&e)===t||(e>>>8&255)===t||(e>>>16&255)===t||(e>>>24&255)===t){if(this.pos-=4,e===Ii)return!0;this.pos+=1}}return!1}},Vi=class extends Gr{constructor(e,t){super(e),this.trackDatas=[],this.bosPagesWritten=!1,this.allTracksKnown=_(),this.pageBytes=new Uint8Array(65307),this.pageView=new DataView(this.pageBytes.buffer),this.format=t,this.writer=e._writer,this.writer.ensureMonotonicity=!0}async start(){}async getMimeType(){return await this.allTracksKnown.promise,Bi({codecStrings:this.trackDatas.map((e=>e.codecInfo.codec))})}addEncodedVideoPacket(){throw new Error("Video tracks are not supported.")}getTrackData(e,t){const r=this.trackDatas.find((t=>t.track===e));if(r)return r;let i;do{i=Math.floor(2**32*Math.random())}while(this.trackDatas.some((e=>e.serialNumber===i)));s("vorbis"===e.source._codec||"opus"===e.source._codec),Ve(t),s(t),s(t.decoderConfig);const a={track:e,serialNumber:i,internalSampleRate:"opus"===e.source._codec?be:t.decoderConfig.sampleRate,codecInfo:{codec:e.source._codec,vorbisInfo:null,opusInfo:null},vorbisLastBlocksize:null,packetQueue:[],currentTimestampInSamples:0,pagesWritten:0,currentGranulePosition:0,currentLacingValues:[],currentPageData:[],currentPageSize:27,currentPageStartsWithFreshPacket:!0};return this.queueHeaderPackets(a,t),this.trackDatas.push(a),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),a}queueHeaderPackets(e,t){if(s(t.decoderConfig),"vorbis"===e.track.source._codec){s(t.decoderConfig.description);const r=u(t.decoderConfig.description);if(2!==r[0])throw new TypeError("First byte of Vorbis decoder description must be 2.");let i=1;const a=()=>{let e=0;for(;;){const t=r[i++];if(void 0===t)throw new TypeError("Vorbis decoder description is too short.");if(e+=t,t<255)return e}},n=a(),o=a();if(r.length-i<=0)throw new TypeError("Vorbis decoder description is too short.");const l=r.subarray(i,i+=n),c=r.subarray(i,i+=o),d=r.subarray(i);e.packetQueue.push({data:l,endGranulePosition:0,timestamp:0,forcePageFlush:!0},{data:c,endGranulePosition:0,timestamp:0,forcePageFlush:!1},{data:d,endGranulePosition:0,timestamp:0,forcePageFlush:!0});const h=p(l).getUint8(28);e.codecInfo.vorbisInfo={blocksizes:[1<<(15&h),1<<(h>>4)],modeBlockflags:kt(d).modeBlockflags}}else if("opus"===e.track.source._codec){if(!t.decoderConfig.description)throw new TypeError("For Ogg, Opus decoder description is required.");const r=u(t.decoderConfig.description),i=new Uint8Array(16),a=new DataView(i.buffer);a.setUint32(0,1332770163,!1),a.setUint32(4,1415669619,!1),a.setUint32(8,0,!0),a.setUint32(12,0,!0),e.packetQueue.push({data:r,endGranulePosition:0,timestamp:0,forcePageFlush:!0},{data:i,endGranulePosition:0,timestamp:0,forcePageFlush:!0}),e.codecInfo.opusInfo={preSkip:Tt(r).preSkip}}}async addEncodedAudioPacket(e,t,r){const i=await this.mutex.acquire();try{const i=this.getTrackData(e,r);this.validateAndNormalizeTimestamp(i.track,t.timestamp,"key"===t.type);const a=i.currentTimestampInSamples,{durationInSamples:s,vorbisBlockSize:n}=Li(t.data,i.codecInfo,i.vorbisLastBlocksize);i.currentTimestampInSamples+=s,i.vorbisLastBlocksize=n,i.packetQueue.push({data:t.data,endGranulePosition:i.currentTimestampInSamples,timestamp:a/i.internalSampleRate,forcePageFlush:!1}),await this.interleavePages()}finally{i()}}addSubtitleCue(){throw new Error("Subtitle tracks are not supported.")}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some((t=>t.track===e)))return!1;return!0}async interleavePages(e=!1){if(!this.bosPagesWritten){if(!this.allTracksAreKnown())return;for(const e of this.trackDatas)for(;e.packetQueue.length>0;){const t=e.packetQueue.shift();if(this.writePacket(e,t,!1),t.forcePageFlush)break}this.bosPagesWritten=!0}e:for(;;){let t=null,r=1/0;for(const i of this.trackDatas){if(!e&&i.packetQueue.length<=1&&!i.track.source._closed)break e;i.packetQueue.length>0&&i.packetQueue[0].timestamp<r&&(t=i,r=i.packetQueue[0].timestamp)}if(!t)break;const i=t.packetQueue.shift(),a=0===t.packetQueue.length;this.writePacket(t,i,a)}e||await this.writer.flush()}writePacket(e,t,r){let i=t.data.length,a=0,s=0;for(;;){0===e.currentLacingValues.length&&a>0&&(e.currentPageStartsWithFreshPacket=!1);const n=Math.min(255,i);e.currentLacingValues.push(n),e.currentPageSize++,s+=n;const o=i<255;if(255===e.currentLacingValues.length){const i=t.data.subarray(a,s);if(a=s,e.currentPageData.push(i),e.currentPageSize+=i.length,this.writePage(e,r&&o),o)return}if(o)break;i-=255}const n=t.data.subarray(a);e.currentPageData.push(n),e.currentPageSize+=n.length,e.currentGranulePosition=t.endGranulePosition,(e.currentPageSize>=8192||t.forcePageFlush)&&this.writePage(e,r)}writePage(e,t){this.pageView.setUint32(0,Ii,!0),this.pageView.setUint8(4,0);let r=0;e.currentPageStartsWithFreshPacket||(r|=1),0===e.pagesWritten&&(r|=2),t&&(r|=4),this.pageView.setUint8(5,r);var i,a;a=e.currentLacingValues.every((e=>255===e))?-1:e.currentGranulePosition,(i=this.pageView).setUint32(6,a,!0),i.setInt32(10,Math.floor(a/2**32),!0),this.pageView.setUint32(14,e.serialNumber,!0),this.pageView.setUint32(18,e.pagesWritten,!0),this.pageView.setUint32(22,0,!0),this.pageView.setUint8(26,e.currentLacingValues.length),this.pageBytes.set(e.currentLacingValues,27);let s=27+e.currentLacingValues.length;for(const t of e.currentPageData)this.pageBytes.set(t,s),s+=t.length;const n=this.pageBytes.subarray(0,s),o=Oi(n);if(this.pageView.setUint32(22,o,!0),e.pagesWritten++,e.currentLacingValues.length=0,e.currentPageData.length=0,e.currentPageSize=27,e.currentPageStartsWithFreshPacket=!0,this.format._options.onPage&&this.writer.startTrackingWrites(),this.writer.write(n),this.format._options.onPage){const{data:t,start:r}=this.writer.stopTrackingWrites();this.format._options.onPage(t,r,e.track.source)}}async onTrackClose(){const e=await this.mutex.acquire();this.allTracksAreKnown()&&this.allTracksKnown.resolve(),await this.interleavePages(),e()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve(),await this.interleavePages(!0);for(const e of this.trackDatas)e.currentLacingValues.length>0&&this.writePage(e,!0);e()}},$i=class{constructor(e){this.input=e}},Ui=new Uint8Array(0),Ni=class e{constructor(e,t,r,i,a=-1,s){if(this.data=e,this.type=t,this.timestamp=r,this.duration=i,this.sequenceNumber=a,e===Ui&&void 0===s)throw new Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(void 0===s&&(s=e.byteLength),!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError('type must be either "key" or "delta".');if(!Number.isFinite(r))throw new TypeError("timestamp must be a number.");if(!Number.isFinite(i)||i<0)throw new TypeError("duration must be a non-negative number.");if(!Number.isFinite(a))throw new TypeError("sequenceNumber must be a number.");if(!Number.isInteger(s)||s<0)throw new TypeError("byteLength must be a non-negative integer.");this.byteLength=s}get isMetadataOnly(){return this.data===Ui}get microsecondTimestamp(){return Math.trunc(N*this.timestamp)}get microsecondDuration(){return Math.trunc(N*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if("undefined"==typeof EncodedVideoChunk)throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to an audio chunk.");if("undefined"==typeof EncodedAudioChunk)throw new Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(t){if(!(t instanceof EncodedVideoChunk||t instanceof EncodedAudioChunk))throw new TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");const r=new Uint8Array(t.byteLength);return t.copyTo(r),new e(r,t.type,t.timestamp/1e6,(t.duration??0)/1e6)}clone(t){if(void 0!==t&&("object"!=typeof t||null===t))throw new TypeError("options, when provided, must be an object.");if(void 0!==t?.timestamp&&!Number.isFinite(t.timestamp))throw new TypeError("options.timestamp, when provided, must be a number.");if(void 0!==t?.duration&&!Number.isFinite(t.duration))throw new TypeError("options.duration, when provided, must be a number.");return new e(this.data,this.type,t?.timestamp??this.timestamp,t?.duration??this.duration,this.sequenceNumber,this.byteLength)}},Wi=class e{constructor(t,r){if(this._closed=!1,t instanceof ArrayBuffer||ArrayBuffer.isView(t)){if(!r||"object"!=typeof r)throw new TypeError("init must be an object.");if(!("format"in r)||"string"!=typeof r.format)throw new TypeError("init.format must be a string.");if(!Number.isInteger(r.codedWidth)||r.codedWidth<=0)throw new TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(r.codedHeight)||r.codedHeight<=0)throw new TypeError("init.codedHeight must be a positive integer.");if(void 0!==r.rotation&&![0,90,180,270].includes(r.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(r.timestamp))throw new TypeError("init.timestamp must be a number.");if(void 0!==r.duration&&(!Number.isFinite(r.duration)||r.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=u(t).slice(),this.format=r.format,this.codedWidth=r.codedWidth,this.codedHeight=r.codedHeight,this.rotation=r.rotation??0,this.timestamp=r.timestamp,this.duration=r.duration??0,this.colorSpace=new VideoColorSpace(r.colorSpace)}else if("undefined"!=typeof VideoFrame&&t instanceof VideoFrame){if(void 0!==r?.rotation&&![0,90,180,270].includes(r.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(void 0!==r?.timestamp&&!Number.isFinite(r?.timestamp))throw new TypeError("init.timestamp, when provided, must be a number.");if(void 0!==r?.duration&&(!Number.isFinite(r.duration)||r.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=t,this.format=t.format,this.codedWidth=t.codedWidth,this.codedHeight=t.codedHeight,this.rotation=r?.rotation??0,this.timestamp=r?.timestamp??t.timestamp/1e6,this.duration=r?.duration??(t.duration??0)/1e6,this.colorSpace=t.colorSpace}else{if(!("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof SVGImageElement&&t instanceof SVGImageElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas))throw new TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.");{if(!r||"object"!=typeof r)throw new TypeError("init must be an object.");if(void 0!==r.rotation&&![0,90,180,270].includes(r.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(r.timestamp))throw new TypeError("init.timestamp must be a number.");if(void 0!==r.duration&&(!Number.isFinite(r.duration)||r.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");if("undefined"!=typeof VideoFrame)return new e(new VideoFrame(t,{timestamp:Math.trunc(r.timestamp*N),duration:Math.trunc((r.duration??0)*N)}),r);let i=0,a=0;if("naturalWidth"in t?(i=t.naturalWidth,a=t.naturalHeight):"videoWidth"in t?(i=t.videoWidth,a=t.videoHeight):"width"in t&&(i=Number(t.width),a=Number(t.height)),!i||!a)throw new TypeError("Could not determine dimensions.");const n=new OffscreenCanvas(i,a),o=n.getContext("2d",{alpha:!1,willReadFrequently:!0});s(o),o.drawImage(t,0,0),this._data=n,this.format="RGBX",this.codedWidth=i,this.codedHeight=a,this.rotation=r.rotation??0,this.timestamp=r.timestamp,this.duration=r.duration??0,this.colorSpace=new VideoColorSpace({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}}}get displayWidth(){return this.rotation%180==0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180==0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(N*this.timestamp)}get microsecondDuration(){return Math.trunc(N*this.duration)}clone(){if(this._closed)throw new Error("VideoSample is closed.");return s(null!==this._data),Hi(this._data)?new e(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?new e(this._data.slice(),{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation}):new e(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(Hi(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(){if(this._closed)throw new Error("VideoSample is closed.");return s(null!==this._data),Hi(this._data)?this._data.allocationSize():this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e){if(!T(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(this._closed)throw new Error("VideoSample is closed.");if(s(null!==this._data),Hi(this._data))await this._data.copyTo(e);else if(this._data instanceof Uint8Array)u(e).set(this._data);else{const t=this._data.getContext("2d",{alpha:!1});s(t);const r=t.getImageData(0,0,this.codedWidth,this.codedHeight);u(e).set(r.data)}}toVideoFrame(){if(this._closed)throw new Error("VideoSample is closed.");return s(null!==this._data),Hi(this._data)?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}draw(e,t,r,i,a,s,n,o,l){let c=0,d=0,h=this.displayWidth,u=this.displayHeight,p=0,m=0,f=this.displayWidth,g=this.displayHeight;if(void 0!==s?(c=t,d=r,h=i,u=a,p=s,m=n,void 0!==o?(f=o,g=l):(f=h,g=u)):(p=t,m=r,void 0!==i&&(f=i,g=a)),!("undefined"!=typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof OffscreenCanvasRenderingContext2D&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(c))throw new TypeError("sx must be a number.");if(!Number.isFinite(d))throw new TypeError("sy must be a number.");if(!Number.isFinite(h)||h<0)throw new TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(u)||u<0)throw new TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(p))throw new TypeError("dx must be a number.");if(!Number.isFinite(m))throw new TypeError("dy must be a number.");if(!Number.isFinite(f)||f<0)throw new TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(g)||g<0)throw new TypeError("dHeight must be a non-negative number.");if(this._closed)throw new Error("VideoSample is closed.");90===this.rotation?[c,d,h,u]=[d,this.codedHeight-c-h,u,h]:180===this.rotation?[c,d]=[this.codedWidth-c-h,this.codedHeight-d-u]:270===this.rotation&&([c,d,h,u]=[this.codedWidth-d-u,c,u,h]);const y=this.toCanvasImageSource();e.save();const w=p+f/2,v=m+g/2;e.translate(w,v),e.rotate(this.rotation*Math.PI/180);const x=this.rotation%180==0?1:f/g;e.scale(1/x,x),e.drawImage(y,c,d,h,u,-f/2,-g/2,f,g),e.restore()}toCanvasImageSource(){if(this._closed)throw new Error("VideoSample is closed.");if(s(null!==this._data),this._data instanceof Uint8Array){const e=this.toVideoFrame();return queueMicrotask((()=>e.close())),e}return this._data}setRotation(e){if(![0,90,180,270].includes(e))throw new TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw new TypeError("newDuration must be a non-negative number.");this.duration=e}},Hi=e=>"undefined"!=typeof VideoFrame&&e instanceof VideoFrame,Gi=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]),qi=class e{constructor(e){if(this._closed=!1,Ji(e)){if(null===e.format)throw new TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{if(!e||"object"!=typeof e)throw new TypeError("Invalid AudioDataInit: must be an object.");if(!Gi.has(e.format))throw new TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw new TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||0===e.numberOfChannels)throw new TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw new TypeError("init.timestamp must be a number.");const t=e.data.byteLength/(Ki(e.format)*e.numberOfChannels);if(!Number.isInteger(t))throw new TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");let r;if(this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=t,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=t/e.sampleRate,e.data instanceof ArrayBuffer)r=new Uint8Array(e.data);else{if(!ArrayBuffer.isView(e.data))throw new TypeError("Invalid AudioDataInit: data is not a BufferSource.");r=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength)}const i=this.numberOfFrames*this.numberOfChannels*Ki(this.format);if(r.byteLength<i)throw new TypeError("Invalid AudioDataInit: insufficient data size.");this._data=r}}get microsecondTimestamp(){return Math.trunc(N*this.timestamp)}get microsecondDuration(){return Math.trunc(N*this.duration)}allocationSize(e){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(void 0!==e.format&&!Gi.has(e.format))throw new TypeError("Invalid format.");if(void 0!==e.frameOffset&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(void 0!==e.frameCount&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const t=e.format??this.format,r=e.frameOffset??0;if(r>=this.numberOfFrames)throw new RangeError("frameOffset out of range");const i=void 0!==e.frameCount?e.frameCount:this.numberOfFrames-r;if(i>this.numberOfFrames-r)throw new RangeError("frameCount out of range");const a=Ki(t),s=Qi(t);if(s&&e.planeIndex>=this.numberOfChannels)throw new RangeError("planeIndex out of range");if(!s&&0!==e.planeIndex)throw new RangeError("planeIndex out of range");return(s?i:i*this.numberOfChannels)*a}copyTo(e,t){if(!T(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!t||"object"!=typeof t)throw new TypeError("options must be an object.");if(!Number.isInteger(t.planeIndex)||t.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(void 0!==t.format&&!Gi.has(t.format))throw new TypeError("Invalid format.");if(void 0!==t.frameOffset&&(!Number.isInteger(t.frameOffset)||t.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(void 0!==t.frameCount&&(!Number.isInteger(t.frameCount)||t.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const{planeIndex:r,format:i,frameCount:a,frameOffset:s}=t,n=i??this.format;if(!n)throw new Error("Destination format not determined");const o=this.numberOfFrames,l=this.numberOfChannels,c=s??0;if(c>=o)throw new RangeError("frameOffset out of range");const d=void 0!==a?a:o-c;if(d>o-c)throw new RangeError("frameCount out of range");const h=Ki(n),u=Qi(n);if(u&&r>=l)throw new RangeError("planeIndex out of range");if(!u&&0!==r)throw new RangeError("planeIndex out of range");const m=(u?d:d*l)*h;if(e.byteLength<m)throw new RangeError("Destination buffer is too small");const f=p(e),g=Xi(n);if(Ji(this._data))if(u)if("f32-planar"===n)this._data.copyTo(e,{planeIndex:r,frameOffset:c,frameCount:d,format:"f32-planar"});else{const e=new ArrayBuffer(4*d),t=new Float32Array(e);this._data.copyTo(t,{planeIndex:r,frameOffset:c,frameCount:d,format:"f32-planar"});const i=new DataView(e);for(let e=0;e<d;e++)g(f,e*h,i.getFloat32(4*e,!0))}else{const e=l,t=new Float32Array(d);for(let r=0;r<e;r++){this._data.copyTo(t,{planeIndex:r,frameOffset:c,frameCount:d,format:"f32-planar"});for(let i=0;i<d;i++)g(f,(i*e+r)*h,t[i])}}else{const e=this._data,t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=this.format,a=Yi(i),s=Ki(i),n=Qi(i);for(let e=0;e<d;e++)if(u){let i;i=n?(r*o+(e+c))*s:((e+c)*l+r)*s,g(f,e*h,a(t,i))}else for(let r=0;r<l;r++){let i;i=n?(r*o+(e+c))*s:((e+c)*l+r)*s,g(f,(e*l+r)*h,a(t,i))}}}clone(){if(this._closed)throw new Error("AudioSample is closed.");if(Ji(this._data)){const t=new e(this._data.clone());return t.setTimestamp(this.timestamp),t}return new e({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data})}close(){this._closed||(Ji(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw new Error("AudioSample is closed.");if(Ji(this._data)){if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(Qi(this.format)){const e=this.allocationSize({planeIndex:0,format:this.format}),t=new ArrayBuffer(e*this.numberOfChannels);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(new Uint8Array(t,r*e,e),{planeIndex:r,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:t})}{const e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data})}toAudioBuffer(){if(this._closed)throw new Error("AudioSample is closed.");const e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),t=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(t,{planeIndex:r,format:"f32-planar"}),e.copyToChannel(t,r);return e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}static fromAudioBuffer(t,r){if(!(t instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const i=t.numberOfChannels,a=t.sampleRate,s=t.length,n=Math.floor(67108864/i);let o=0,l=s;const c=[];for(;l>0;){const s=Math.min(n,l),d=new Float32Array(i*s);for(let e=0;e<i;e++)t.copyFromChannel(d.subarray(e*s,e*s+s),e,o);const h=new e({format:"f32-planar",sampleRate:a,numberOfFrames:s,numberOfChannels:i,timestamp:r+o/a,data:d});c.push(h),o+=s,l-=s}return c}},Ki=e=>{switch(e){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":case"f32":case"f32-planar":return 4;default:throw new Error("Unknown AudioSampleFormat")}},Qi=e=>{switch(e){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},Yi=e=>{switch(e){case"u8":case"u8-planar":return(e,t)=>(e.getUint8(t)-128)/128;case"s16":case"s16-planar":return(e,t)=>e.getInt16(t,!0)/32768;case"s32":case"s32-planar":return(e,t)=>e.getInt32(t,!0)/2147483648;case"f32":case"f32-planar":return(e,t)=>e.getFloat32(t,!0)}},Xi=e=>{switch(e){case"u8":case"u8-planar":return(e,t,r)=>e.setUint8(t,B(127.5*(r+1),0,255));case"s16":case"s16-planar":return(e,t,r)=>e.setInt16(t,B(Math.round(32767*r),-32768,32767),!0);case"s32":case"s32-planar":return(e,t,r)=>e.setInt32(t,B(Math.round(2147483647*r),-2147483648,2147483647),!0);case"f32":case"f32-planar":return(e,t,r)=>e.setFloat32(t,r,!0)}},Ji=e=>"undefined"!=typeof AudioData&&e instanceof AudioData,Zi=e=>{if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.metadataOnly&&"boolean"!=typeof e.metadataOnly)throw new TypeError("options.metadataOnly, when defined, must be a boolean.");if(void 0!==e.verifyKeyPackets&&"boolean"!=typeof e.verifyKeyPackets)throw new TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(e.verifyKeyPackets&&e.metadataOnly)throw new TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},ea=e=>{if("number"!=typeof e||Number.isNaN(e))throw new TypeError("timestamp must be a number.")},ta=(e,t,r)=>r.verifyKeyPackets?t.then((async t=>{if(!t||"delta"===t.type)return t;const r=await e.determinePacketType(t);return r&&(t.type=r),t})):t,ra=class{constructor(e){if(!(e instanceof pa))throw new TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){return Zi(e),ta(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,t={}){return ea(e),Zi(t),ta(this._track,this._track._backing.getPacket(e,t),t)}getNextPacket(e,t={}){if(!(e instanceof Ni))throw new TypeError("packet must be an EncodedPacket.");return Zi(t),ta(this._track,this._track._backing.getNextPacket(e,t),t)}async getKeyPacket(e,t={}){if(ea(e),Zi(t),!t.verifyKeyPackets)return this._track._backing.getKeyPacket(e,t);const r=await this._track._backing.getKeyPacket(e,t);return r&&"delta"!==r.type&&"delta"===await this._track.determinePacketType(r)?this.getKeyPacket(r.timestamp-1/this._track.timeResolution,t):r}async getNextKeyPacket(e,t={}){if(!(e instanceof Ni))throw new TypeError("packet must be an EncodedPacket.");if(Zi(t),!t.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,t);const r=await this._track._backing.getNextKeyPacket(e,t);return r&&"delta"!==r.type&&"delta"===await this._track.determinePacketType(r)?this.getNextKeyPacket(r,t):r}packets(e,t,r={}){if(void 0!==e&&!(e instanceof Ni))throw new TypeError("startPacket must be an EncodedPacket.");if(void 0!==e&&e.isMetadataOnly&&!r?.metadataOnly)throw new TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(void 0!==t&&!(t instanceof Ni))throw new TypeError("endPacket must be an EncodedPacket.");Zi(r);const i=[];let{promise:a,resolve:s}=_(),{promise:n,resolve:o}=_(),l=!1,c=!1,d=null;const h=[];return(async()=>{let d=e??await this.getFirstPacket(r);for(;d&&!c&&!(t&&d.sequenceNumber>=t?.sequenceNumber);)i.length>Math.max(2,h.length)?(({promise:n,resolve:o}=_()),await n):(i.push(d),s(),({promise:a,resolve:s}=_()),d=await this.getNextPacket(d,r));l=!0,s()})().catch((e=>{d||(d=e,s())})),{async next(){for(;;){if(c)return{value:void 0,done:!0};if(d)throw d;if(i.length>0){const e=i.shift(),t=performance.now();for(h.push(t);h.length>0&&t-h[0]>=1e3;)h.shift();return o(),{value:e,done:!1}}if(l)return{value:void 0,done:!0};await a}},return:async()=>(c=!0,o(),s(),{value:void 0,done:!0}),async throw(e){throw e},[Symbol.asyncIterator](){return this}}}},ia=class{constructor(e,t){this.onSample=e,this.onError=t}},aa=class{mediaSamplesInRange(e=0,t=1/0){ea(e),ea(t);const r=[];let i=!1,a=null,{promise:s,resolve:n}=_(),{promise:o,resolve:l}=_(),c=!1,d=!1,h=!1,u=null;return(async()=>{const p=new Error,m=await this._createDecoder((o=>{l(),o.timestamp>=t&&(d=!0),d?o.close():(a&&(o.timestamp>e?(r.push(a),i=!0):a.close()),o.timestamp>=e&&(r.push(o),i=!0),a=i?null:o,r.length>0&&(n(),({promise:s,resolve:n}=_())))}),(e=>{u||(e.stack=p.stack,u=e,n())})),f=this._createPacketSink(),g=await f.getKeyPacket(e,{verifyKeyPackets:!0})??await f.getFirstPacket();if(!g)return;let y,w=g;if(t<1/0){const e=await f.getPacket(t),r=e?"key"===e.type&&e.timestamp===t?e:await f.getNextKeyPacket(e,{verifyKeyPackets:!0}):null;r&&(y=r)}const v=f.packets(g,y);for(await v.next();w&&!d;){const e=sa(r.length);if(r.length+m.getDecodeQueueSize()>e){({promise:o,resolve:l}=_()),await o;continue}m.decode(w);const t=await v.next();if(t.done)break;w=t.value}await v.return(),h||await m.flush(),m.close(),!i&&a&&r.push(a),c=!0,n()})().catch((e=>{u||(u=e,n())})),{async next(){for(;;){if(h)return{value:void 0,done:!0};if(u)throw u;if(r.length>0){const e=r.shift();return l(),{value:e,done:!1}}if(c)return{value:void 0,done:!0};await s}},async return(){h=!0,d=!0,l(),n(),a?.close();for(const e of r)e.close();return{value:void 0,done:!0}},async throw(e){throw e},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){(e=>{if(!(Symbol.iterator in e)&&!(Symbol.asyncIterator in e))throw new TypeError("Argument must be an iterable or async iterable.")})(e);const t=async function*(e){Symbol.iterator in e?yield*e[Symbol.iterator]():yield*e[Symbol.asyncIterator]()}(e),r=[],i=[];let{promise:a,resolve:n}=_(),{promise:o,resolve:l}=_(),c=!1,d=!1,h=null;const u=e=>{i.push(e),n(),({promise:a,resolve:n}=_())};return(async()=>{const e=new Error,a=await this._createDecoder((e=>{if(l(),d)return void e.close();let t=0;for(;r.length>0&&e.timestamp-r[0]>-1e-10;)t++,r.shift();if(t>0)for(let r=0;r<t;r++)u(r<t-1?e.clone():e);else e.close()}),(t=>{h||(t.stack=e.stack,h=t,n())})),p=this._createPacketSink();let m=null,f=null,g=-1;const y=async()=>{s(f);let e=f;for(a.decode(e);e.sequenceNumber<g;){const t=sa(i.length);for(;i.length+a.getDecodeQueueSize()>t&&!d;)({promise:o,resolve:l}=_()),await o;if(d)break;const r=await p.getNextPacket(e);s(r),e=r,a.decode(r)}g=-1},w=async()=>{await a.flush();for(let e=0;e<r.length;e++)u(null);r.length=0};for await(const e of t){if(ea(e),d)break;const t=await p.getPacket(e),i=t&&await p.getKeyPacket(e,{verifyKeyPackets:!0});i?(m&&(i.sequenceNumber!==f.sequenceNumber||t.timestamp<m.timestamp)&&(await y(),await w()),r.push(t.timestamp),g=Math.max(t.sequenceNumber,g),m=t,f=i):(-1!==g&&(await y(),await w()),u(null),m=null)}d||(-1!==g&&await y(),await w()),a.close(),c=!0,n()})().catch((e=>{h||(h=e,n())})),{async next(){for(;;){if(d)return{value:void 0,done:!0};if(h)throw h;if(i.length>0){const e=i.shift();return s(void 0!==e),l(),{value:e,done:!1}}if(c)return{value:void 0,done:!0};await a}},async return(){d=!0,l(),n();for(const e of i)e?.close();return{value:void 0,done:!0}},async throw(e){throw e},[Symbol.asyncIterator](){return this}}}},sa=e=>0===e?40:8,na=class extends ia{constructor(e,t,r,i,a,n){super(e,t),this.rotation=a,this.timeResolution=n,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new G,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[];const l=Z.find((e=>e.supports(r,i)));if(l)this.customDecoder=new l,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=e=>{if(!(e instanceof Wi))throw new TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(e)},this.customDecoderCallSerializer.call((()=>this.customDecoder.init()));else{const e=e=>{if(K()){if(this.sampleQueue.length>0&&e.timestamp>=o(this.sampleQueue).timestamp){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}D(this.sampleQueue,e,(e=>e.timestamp))}else{const t=this.inputTimestamps.shift();s(void 0!==t),e.setTimestamp(t),this.finalizeAndEmitSample(e)}};this.decoder=new VideoDecoder({output:t=>e(new Wi(t)),error:t}),this.decoder.configure(i)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(s(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call((()=>this.customDecoder.decode(e))).then((()=>this.customDecoderQueueSize--))):(s(this.decoder),K()||D(this.inputTimestamps,e.timestamp,(e=>e)),this.decoder.decode(e.toEncodedVideoChunk()))}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call((()=>this.customDecoder.flush())):(s(this.decoder),await this.decoder.flush()),K()){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}}close(){this.customDecoder?this.customDecoderCallSerializer.call((()=>this.customDecoder.close())):(s(this.decoder),this.decoder.close());for(const e of this.sampleQueue)e.close();this.sampleQueue.length=0}},oa=class extends aa{constructor(e){if(!(e instanceof ma))throw new TypeError("videoTrack must be an InputVideoTrack.");super(),this._videoTrack=e}async _createDecoder(e,t){if(!await this._videoTrack.canDecode())throw new Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._videoTrack.codec,i=this._videoTrack.rotation,a=await this._videoTrack.getDecoderConfig(),n=this._videoTrack.timeResolution;return s(r&&a),new na(e,t,r,a,i,n)}_createPacketSink(){return new ra(this._videoTrack)}async getSample(e){ea(e);for await(const t of this.mediaSamplesAtTimestamps([e]))return t;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,t=1/0){return this.mediaSamplesInRange(e,t)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}},la=class{constructor(e,t={}){if(this._nextCanvasIndex=0,!(e instanceof ma))throw new TypeError("videoTrack must be an InputVideoTrack.");if(t&&"object"!=typeof t)throw new TypeError("options must be an object.");if(void 0!==t.width&&(!Number.isInteger(t.width)||t.width<=0))throw new TypeError("options.width, when defined, must be a positive integer.");if(void 0!==t.height&&(!Number.isInteger(t.height)||t.height<=0))throw new TypeError("options.height, when defined, must be a positive integer.");if(void 0!==t.fit&&!["fill","contain","cover"].includes(t.fit))throw new TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(void 0!==t.width&&void 0!==t.height&&void 0===t.fit)throw new TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(void 0!==t.poolSize&&("number"!=typeof t.poolSize||!Number.isInteger(t.poolSize)||t.poolSize<0))throw new TypeError("poolSize must be a non-negative integer.");const r=t.rotation??e.rotation;let[i,a]=r%180==0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth];const s=i/a;void 0!==t.width&&void 0===t.height?(i=t.width,a=Math.round(i/s)):void 0===t.width&&void 0!==t.height?(a=t.height,i=Math.round(a*s)):void 0!==t.width&&void 0!==t.height&&(i=t.width,a=t.height),this._videoTrack=e,this._width=i,this._height=a,this._rotation=r,this._fit=t.fit??"fill",this._videoSampleSink=new oa(e),this._canvasPool=Array.from({length:t.poolSize??0},(()=>null))}_videoSampleToWrappedCanvas(e){let t=this._canvasPool[this._nextCanvasIndex];t||("undefined"!=typeof document?(t=document.createElement("canvas"),t.width=this._width,t.height=this._height):t=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=t)),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);const r=t.getContext("2d",{alpha:!1});let i,a,n,o;if(s(r),r.resetTransform(),"fill"===this._fit)i=0,a=0,n=this._width,o=this._height;else{const[t,r]=this._rotation%180==0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],s="contain"===this._fit?Math.min(this._width/t,this._height/r):Math.max(this._width/t,this._height/r);n=t*s,o=r*s,i=(this._width-n)/2,a=(this._height-o)/2}const l=this._rotation%180==0?1:n/o;r.translate(this._width/2,this._height/2),r.rotate(this._rotation*Math.PI/180),r.scale(1/l,l),r.translate(-this._width/2,-this._height/2),r.drawImage(e.toCanvasImageSource(),i,a,n,o);const c={canvas:t,timestamp:e.timestamp,duration:e.duration};return e.close(),c}async getCanvas(e){ea(e);const t=await this._videoSampleSink.getSample(e);return t&&this._videoSampleToWrappedCanvas(t)}canvases(e=0,t=1/0){return L(this._videoSampleSink.samples(e,t),(e=>this._videoSampleToWrappedCanvas(e)))}canvasesAtTimestamps(e){return L(this._videoSampleSink.samplesAtTimestamps(e),(e=>e&&this._videoSampleToWrappedCanvas(e)))}},ca=class extends ia{constructor(e,t,r,i){super(e,t),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new G,this.customDecoderQueueSize=0;const a=t=>{const r=i.sampleRate;t.setTimestamp(Math.round(t.timestamp*r)/r),e(t)},s=ee.find((e=>e.supports(r,i)));s?(this.customDecoder=new s,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=e=>{if(!(e instanceof qi))throw new TypeError("The argument passed to onSample must be an AudioSample.");a(e)},this.customDecoderCallSerializer.call((()=>this.customDecoder.init()))):(this.decoder=new AudioDecoder({output:e=>a(new qi(e)),error:t}),this.decoder.configure(i))}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(s(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call((()=>this.customDecoder.decode(e))).then((()=>this.customDecoderQueueSize--))):(s(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call((()=>this.customDecoder.flush())):(s(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call((()=>this.customDecoder.close())):(s(this.decoder),this.decoder.close())}},da=class extends ia{constructor(e,t,r){super(e,t),this.decoderConfig=r,this.currentTimestamp=null,s(ne.includes(r.codec)),this.codec=r.codec;const{dataType:i,sampleSize:a,littleEndian:n}=Te(this.codec);switch(this.inputSampleSize=a,a){case 1:"unsigned"===i?this.readInputValue=(e,t)=>e.getUint8(t)-128:"signed"===i?this.readInputValue=(e,t)=>e.getInt8(t):"ulaw"===i?this.readInputValue=(e,t)=>(e=>{let t=0,r=0,i=~e;128&i&&(i&=-129,t=-1),r=5+((240&i)>>4);const a=(1<<r|(15&i)<<r-4|1<<r-5)-33;return 0===t?a:-a})(e.getUint8(t)):"alaw"===i?this.readInputValue=(e,t)=>(e=>{let t=0,r=0,i=85^e;128&i&&(i&=-129,t=-1),r=4+((240&i)>>4);let a=0;return a=4!==r?1<<r|(15&i)<<r-4|1<<r-5:i<<1|1,0===t?a:-a})(e.getUint8(t)):s(!1);break;case 2:"unsigned"===i?this.readInputValue=(e,t)=>e.getUint16(t,n)-32768:"signed"===i?this.readInputValue=(e,t)=>e.getInt16(t,n):s(!1);break;case 3:"unsigned"===i?this.readInputValue=(e,t)=>A(e,t,n)-2**23:"signed"===i?this.readInputValue=(e,t)=>((e,t,r)=>A(e,t,r)<<8>>8)(e,t,n):s(!1);break;case 4:"unsigned"===i?this.readInputValue=(e,t)=>e.getUint32(t,n)-2**31:"signed"===i?this.readInputValue=(e,t)=>e.getInt32(t,n):"float"===i?this.readInputValue=(e,t)=>e.getFloat32(t,n):s(!1);break;case 8:"float"===i?this.readInputValue=(e,t)=>e.getFloat64(t,n):s(!1);break;default:F(a),s(!1)}switch(a){case 1:"ulaw"===i||"alaw"===i?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(e,t,r)=>e.setInt16(t,r,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(e,t,r)=>e.setUint8(t,r+128));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(e,t,r)=>e.setInt16(t,r,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(e,t,r)=>e.setInt32(t,r<<8,!0);break;case 4:this.outputSampleSize=4,"float"===i?(this.outputFormat="f32",this.writeOutputValue=(e,t,r)=>e.setFloat32(t,r,!0)):(this.outputFormat="s32",this.writeOutputValue=(e,t,r)=>e.setInt32(t,r,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(e,t,r)=>e.setFloat32(t,r,!0);break;default:F(a),s(!1)}}getDecodeQueueSize(){return 0}decode(e){const t=p(e.data),r=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,i=r*this.decoderConfig.numberOfChannels*this.outputSampleSize,a=new ArrayBuffer(i),s=new DataView(a);for(let e=0;e<r*this.decoderConfig.numberOfChannels;e++){const r=e*this.inputSampleSize,i=e*this.outputSampleSize,a=this.readInputValue(t,r);this.writeOutputValue(s,i,a)}const n=r/this.decoderConfig.sampleRate;(null===this.currentTimestamp||Math.abs(e.timestamp-this.currentTimestamp)>=n)&&(this.currentTimestamp=e.timestamp);const o=this.currentTimestamp;this.currentTimestamp+=n;const l=new qi({format:this.outputFormat,data:a,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:r,timestamp:o});this.onSample(l)}async flush(){}close(){}},ha=class extends aa{constructor(e){if(!(e instanceof fa))throw new TypeError("audioTrack must be an InputAudioTrack.");super(),this._audioTrack=e}async _createDecoder(e,t){if(!await this._audioTrack.canDecode())throw new Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._audioTrack.codec,i=await this._audioTrack.getDecoderConfig();return s(r&&i),ne.includes(i.codec)?new da(e,t,i):new ca(e,t,r,i)}_createPacketSink(){return new ra(this._audioTrack)}async getSample(e){ea(e);for await(const t of this.mediaSamplesAtTimestamps([e]))return t;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,t=1/0){return this.mediaSamplesInRange(e,t)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}},ua=class{constructor(e){if(!(e instanceof fa))throw new TypeError("audioTrack must be an InputAudioTrack.");this._audioSampleSink=new ha(e)}_audioSampleToWrappedArrayBuffer(e){return{buffer:e.toAudioBuffer(),timestamp:e.timestamp,duration:e.duration}}async getBuffer(e){ea(e);const t=await this._audioSampleSink.getSample(e);return t&&this._audioSampleToWrappedArrayBuffer(t)}buffers(e=0,t=1/0){return L(this._audioSampleSink.samples(e,t),(e=>this._audioSampleToWrappedArrayBuffer(e)))}buffersAtTimestamps(e){return L(this._audioSampleSink.samplesAtTimestamps(e),(e=>e&&this._audioSampleToWrappedArrayBuffer(e)))}},pa=class{constructor(e){this._backing=e}isVideoTrack(){return this instanceof ma}isAudioTrack(){return this instanceof fa}get id(){return this._backing.getId()}get languageCode(){return this._backing.getLanguageCode()}get timeResolution(){return this._backing.getTimeResolution()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){const t=new ra(this);let r=1/0,i=-1/0,a=0,s=0;for await(const n of t.packets(void 0,void 0,{metadataOnly:!0})){if(a>=e&&n.timestamp>=i)break;r=Math.min(r,n.timestamp),i=Math.max(i,n.timestamp+n.duration),a++,s+=n.byteLength}return{packetCount:a,averagePacketRate:a?Number((a/(i-r)).toPrecision(16)):0,averageBitrate:a?Number((8*s/(i-r)).toPrecision(16)):0}}},ma=class extends pa{constructor(e){super(e),this._backing=e}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180==0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180==0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){const e=await this._backing.getColorSpace();return"bt2020"===e.primaries||"smpte432"===e.primaries||"pg"===e.transfer||"hlg"===e.transfer||"bt2020-ncl"===e.matrix}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){const e=await this._backing.getDecoderConfig();return e?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const t=this._backing.getCodec();return s(null!==t),Z.some((r=>r.supports(t,e)))?!0:"undefined"!=typeof VideoDecoder&&!0===(await VideoDecoder.isConfigSupported(e)).supported}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Ni))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("packet must not be metadata-only to determine its type.");return null===this.codec?null:(async(e,t)=>{switch(s(e.codec),e.codec){case"avc":{const r=await e.getDecoderConfig();let i;if(s(r),r.description){const e=1+(3&u(r.description)[4]);i=ot(t.data,e)}else i=nt(t.data);return i.some((e=>5===ct(e)))?"key":"delta"}case"hevc":{const r=await e.getDecoderConfig();let i;if(s(r),r.description){const e=1+(3&u(r.description)[21]);i=ot(t.data,e)}else i=nt(t.data);return i.some((e=>{const t=ht(e);return 16<=t&&t<=23}))?"key":"delta"}case"vp8":return 1&t.data[0]?"delta":"key";case"vp9":{const e=new c(t.data);if(2!==e.readBits(2))return null;const r=e.readBits(1);return 3===(e.readBits(1)<<1)+r&&e.skipBits(1),e.readBits(1)?null:0===e.readBits(1)?"key":"delta"}case"av1":{let e=!1;for(const{type:r,data:i}of bt(t.data))if(1===r){const t=new c(i);t.skipBits(4),e=!!t.readBits(1)}else if(3===r||6===r||7===r){if(e)return"key";const t=new c(i);return t.readBits(1)?null:0===t.readBits(2)?"key":"delta"}return null}default:F(e.codec),s(!1)}})(this,e)}},fa=class extends pa{constructor(e){super(e),this._backing=e}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){const e=await this._backing.getDecoderConfig();return e?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const t=this._backing.getCodec();return s(null!==t),ee.some((r=>r.supports(t,e)))?!0:!!e.codec.startsWith("pcm-")||"undefined"!=typeof AudioDecoder&&!0===(await AudioDecoder.isConfigSupported(e)).supported}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Ni))throw new TypeError("packet must be an EncodedPacket.");return null===this.codec?null:"key"}},ga=class{constructor(e,t=1/0){this.source=e,this.maxStorableBytes=t,this.loadedSegments=[],this.loadingSegments=[],this.sourceSizePromise=null,this.nextAge=0,this.totalStoredBytes=0}async loadRange(e,t){if(t=Math.min(t,await this.source.getSize()),e>=t)return;const r=this.loadingSegments.find((r=>r.start<=e&&r.end>=t));if(r)return void await r.promise;const i=R(this.loadedSegments,e,(e=>e.start));if(-1!==i)for(let r=i;r<this.loadedSegments.length;r++){const i=this.loadedSegments[r];if(i.start>e)break;if(i.end>=t)return}this.source.onread?.(e,t);const a=this.source._read(e,t),s={start:e,end:t,promise:a};this.loadingSegments.push(s);const n=await a;((e,t)=>{const r=e.indexOf(t);-1!==r&&e.splice(r,1)})(this.loadingSegments,s),this.insertIntoLoadedSegments(e,n)}rangeIsLoaded(e,t){if(t<=e)return!0;const r=R(this.loadedSegments,e,(e=>e.start));if(-1===r)return!1;for(let i=r;i<this.loadedSegments.length;i++){const r=this.loadedSegments[i];if(r.start>e)break;if(r.end>=t)return!0}return!1}insertIntoLoadedSegments(e,t){const r={start:e,end:e+t.byteLength,bytes:t,view:new DataView(t.buffer),age:this.nextAge++};let i=R(this.loadedSegments,e,(e=>e.start));(-1===i||this.loadedSegments[i].start<r.start)&&i++,this.loadedSegments.splice(i,0,r),this.totalStoredBytes+=t.byteLength;for(let e=i+1;e<this.loadedSegments.length;e++){const t=this.loadedSegments[e];if(t.start>=r.end)break;r.start<=t.start&&t.end<=r.end&&(this.loadedSegments.splice(e,1),e--)}for(;this.totalStoredBytes>this.maxStorableBytes&&this.loadedSegments.length>1;){let e=null,t=-1;for(let r=0;r<this.loadedSegments.length;r++){const i=this.loadedSegments[r];(!e||i.age<e.age)&&(e=i,t=r)}s(e),this.totalStoredBytes-=e.bytes.byteLength,this.loadedSegments.splice(t,1)}}getViewAndOffset(e,t){const r=R(this.loadedSegments,e,(e=>e.start));let i=null;if(-1!==r)for(let a=r;a<this.loadedSegments.length;a++){const r=this.loadedSegments[a];if(r.start>e)break;if(t<=r.end){i=r;break}}if(!i)throw new Error(`No segment loaded for range [${e}, ${t}).`);return i.age=this.nextAge++,{view:i.view,offset:i.bytes.byteOffset+e-i.start}}forgetRange(e,t){if(t<=e)return;const r=R(this.loadedSegments,e,(e=>e.start));if(-1===r)return;const i=this.loadedSegments[r];i.start===e&&i.end===t&&(this.loadedSegments.splice(r,1),this.totalStoredBytes-=i.bytes.byteLength)}},ya=class{constructor(e){this.reader=e,this.pos=0,this.littleEndian=!0}readBytes(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU16(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getUint16(t,this.littleEndian)}readU32(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,this.littleEndian)}readU64(){let e,t;return this.littleEndian?(e=this.readU32(),t=this.readU32()):(t=this.readU32(),e=this.readU32()),4294967296*t+e}readAscii(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let i="";for(let a=0;a<e;a++)i+=String.fromCharCode(t.getUint8(r+a));return i}},wa=class extends $i{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.metadataReader=new ya(e._mainReader),this.chunkReader=new ya(new ga(e.source,67108864))}async readMetadata(){return this.metadataPromise??=(async()=>{const e=await this.metadataReader.reader.source.getSize(),t=this.metadataReader.readAscii(4);this.metadataReader.littleEndian="RIFX"!==t;const r="RF64"===t,i=this.metadataReader.readU32();let a=r?e:Math.min(i+8,e);if("WAVE"!==this.metadataReader.readAscii(4))throw new Error("Invalid WAVE file - wrong format");this.metadataReader.pos=12;let s=0,n=null;for(;this.metadataReader.pos<a;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+8);const t=this.metadataReader.readAscii(4),i=this.metadataReader.readU32(),o=this.metadataReader.pos;if(r&&0===s&&"ds64"!==t)throw new Error('Invalid RF64 file: First chunk must be "ds64".');if("fmt "===t)await this.parseFmtChunk(i);else if("data"===t)n??=i,this.dataStart=this.metadataReader.pos,this.dataSize=Math.min(n,a-this.dataStart);else if("ds64"===t){const t=this.metadataReader.readU64();n=this.metadataReader.readU64(),a=Math.min(t+8,e)}this.metadataReader.pos=o+i+(1&i),s++}if(!this.audioInfo)throw new Error('Invalid WAVE file - missing "fmt " chunk');if(-1===this.dataStart)throw new Error('Invalid WAVE file - missing "data" chunk');const o=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/o)*o,this.tracks.push(new fa(new xa(this)))})()}async parseFmtChunk(e){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+e);let t=this.metadataReader.readU16();const r=this.metadataReader.readU16(),i=this.metadataReader.readU32();this.metadataReader.pos+=4;const a=this.metadataReader.readU16();let s;if(s=14===e?8:this.metadataReader.readU16(),e>=18&&357!==t){const r=this.metadataReader.readU16(),i=e-18;if(Math.min(i,r)>=22&&65534===t){this.metadataReader.pos+=6;const e=this.metadataReader.readBytes(16);t=e[0]|e[1]<<8}}7!==t&&6!==t||(s=8),this.audioInfo={format:t,numberOfChannels:r,sampleRate:i,sampleSizeInBytes:Math.ceil(s/8),blockSizeInBytes:a}}getCodec(){if(s(this.audioInfo),7===this.audioInfo.format)return"ulaw";if(6===this.audioInfo.format)return"alaw";if(1===this.audioInfo.format){if(1===this.audioInfo.sampleSizeInBytes)return"pcm-u8";if(2===this.audioInfo.sampleSizeInBytes)return"pcm-s16";if(3===this.audioInfo.sampleSizeInBytes)return"pcm-s24";if(4===this.audioInfo.sampleSizeInBytes)return"pcm-s32"}return 3===this.audioInfo.format&&4===this.audioInfo.sampleSizeInBytes?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){return await this.readMetadata(),s(this.audioInfo),this.dataSize/this.audioInfo.blockSizeInBytes/this.audioInfo.sampleRate}async getTracks(){return await this.readMetadata(),this.tracks}},va=2048,xa=class{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}async getDecoderConfig(){const e=this.demuxer.getCodec();return e?(s(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}computeDuration(){return this.demuxer.computeDuration()}getNumberOfChannels(){return s(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return s(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return s(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getLanguageCode(){return j}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,t){s(this.demuxer.audioInfo);const r=e*va*this.demuxer.audioInfo.blockSizeInBytes;if(r>=this.demuxer.dataSize)return null;const i=Math.min(va*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-r);let a;if(t.metadataOnly)a=Ui;else{const e=va*this.demuxer.audioInfo.blockSizeInBytes,t=Math.ceil(2**19/e)*e,s=Math.floor(r/t)*t,n=s+t;await this.demuxer.chunkReader.reader.loadRange(this.demuxer.dataStart+s,this.demuxer.dataStart+n),this.demuxer.chunkReader.pos=this.demuxer.dataStart+r,a=this.demuxer.chunkReader.readBytes(i)}const n=e*va/this.demuxer.audioInfo.sampleRate,o=i/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return new Ni(a,"key",n,o,e,i)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}getPacket(e,t){s(this.demuxer.audioInfo);const r=Math.floor(e*this.demuxer.audioInfo.sampleRate/va);return this.getPacketAtIndex(r,t)}getNextPacket(e,t){s(this.demuxer.audioInfo);const r=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/va);return this.getPacketAtIndex(r+1,t)}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}},ba=class{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer)}writeU16(e){this.helperView.setUint16(0,e,!0),this.writer.write(this.helper.subarray(0,2))}writeU32(e){this.helperView.setUint32(0,e,!0),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,e,!0),this.helperView.setUint32(4,Math.floor(e/2**32),!0),this.writer.write(this.helper)}writeAscii(e){this.writer.write((new TextEncoder).encode(e))}},Sa=class extends Gr{constructor(e,t){super(e),this.headerWritten=!1,this.dataSize=0,this.sampleRate=null,this.sampleCount=0,this.format=t,this.writer=e._writer,this.riffWriter=new ba(e._writer),this.isRf64=!!t._options.large}async start(){}async getMimeType(){return"audio/wav"}async addEncodedVideoPacket(){throw new Error("WAVE does not support video.")}async addEncodedAudioPacket(e,t,r){const i=await this.mutex.acquire();try{if(this.headerWritten||(Ve(r),s(r),s(r.decoderConfig),this.writeHeader(e,r.decoderConfig),this.sampleRate=r.decoderConfig.sampleRate,this.headerWritten=!0),this.validateAndNormalizeTimestamp(e,t.timestamp,"key"===t.type),!this.isRf64&&this.writer.getPos()+t.data.byteLength>=2**32)throw new Error("Adding more audio data would exceed the maximum RIFF size of 4 GiB. To write larger files, use RF64 by setting `large: true` in the WavOutputFormatOptions.");this.writer.write(t.data),this.dataSize+=t.data.byteLength,this.sampleCount+=Math.round(t.duration*this.sampleRate),await this.writer.flush()}finally{i()}}async addSubtitleCue(){throw new Error("WAVE does not support subtitles.")}writeHeader(e,t){let r;this.format._options.onHeader&&this.writer.startTrackingWrites();const i=e.source._codec,a=Te(i);r="ulaw"===a.dataType?7:"alaw"===a.dataType?6:"float"===a.dataType?3:1;const s=t.numberOfChannels,n=t.sampleRate,o=a.sampleSize*s;if(this.riffWriter.writeAscii(this.isRf64?"RF64":"RIFF"),this.isRf64?this.riffWriter.writeU32(4294967295):this.riffWriter.writeU32(0),this.riffWriter.writeAscii("WAVE"),this.isRf64&&(this.riffWriter.writeAscii("ds64"),this.riffWriter.writeU32(28),this.riffWriter.writeU64(0),this.riffWriter.writeU64(0),this.riffWriter.writeU64(0),this.riffWriter.writeU32(0)),this.riffWriter.writeAscii("fmt "),this.riffWriter.writeU32(16),this.riffWriter.writeU16(r),this.riffWriter.writeU16(s),this.riffWriter.writeU32(n),this.riffWriter.writeU32(n*o),this.riffWriter.writeU16(o),this.riffWriter.writeU16(8*a.sampleSize),this.riffWriter.writeAscii("data"),this.isRf64?this.riffWriter.writeU32(4294967295):this.riffWriter.writeU32(0),this.format._options.onHeader){const{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onHeader(e,t)}}async finalize(){const e=await this.mutex.acquire(),t=this.writer.getPos();this.isRf64?(this.writer.seek(20),this.riffWriter.writeU64(t-8),this.writer.seek(28),this.riffWriter.writeU64(this.dataSize),this.writer.seek(36),this.riffWriter.writeU64(this.sampleCount)):(this.writer.seek(4),this.riffWriter.writeU32(t-8),this.writer.seek(40),this.riffWriter.writeU32(this.dataSize)),this.writer.seek(t),e()}},Ta=class{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter((e=>se.includes(e)))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter((e=>le.includes(e)))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter((e=>ce.includes(e)))}_codecUnsupportedHint(e){return""}},Ca=class extends Ta{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.fastStart&&![!1,"in-memory","fragmented"].includes(e.fastStart))throw new TypeError('options.fastStart, when provided, must be false, "in-memory", or "fragmented".');if(void 0!==e.minimumFragmentDuration&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw new TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(void 0!==e.onFtyp&&"function"!=typeof e.onFtyp)throw new TypeError("options.onFtyp, when provided, must be a function.");if(void 0!==e.onMoov&&"function"!=typeof e.onMoov)throw new TypeError("options.onMoov, when provided, must be a function.");if(void 0!==e.onMdat&&"function"!=typeof e.onMdat)throw new TypeError("options.onMdat, when provided, must be a function.");if(void 0!==e.onMoof&&"function"!=typeof e.onMoof)throw new TypeError("options.onMoof, when provided, must be a function.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:2**32-1}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new si(e,this)}},ka=class extends Ca{get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...se,...oe,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...ce]}_codecUnsupportedHint(e){return(new Pa).getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}},Pa=class extends Ca{get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...se,...le]}_codecUnsupportedHint(e){return(new ka).getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}},Ma=class extends Ta{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.appendOnly&&"boolean"!=typeof e.appendOnly)throw new TypeError("options.appendOnly, when provided, must be a boolean.");if(void 0!==e.minimumClusterDuration&&(!Number.isFinite(e.minimumClusterDuration)||e.minimumClusterDuration<0))throw new TypeError("options.minimumClusterDuration, when provided, must be a non-negative number.");if(void 0!==e.onEbmlHeader&&"function"!=typeof e.onEbmlHeader)throw new TypeError("options.onEbmlHeader, when provided, must be a function.");if(void 0!==e.onSegmentHeader&&"function"!=typeof e.onSegmentHeader)throw new TypeError("options.onHeader, when provided, must be a function.");if(void 0!==e.onCluster&&"function"!=typeof e.onCluster)throw new TypeError("options.onCluster, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new bi(e,this)}get _name(){return"Matroska"}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:127}}}get fileExtension(){return".mkv"}get mimeType(){return"video/x-matroska"}getSupportedCodecs(){return[...se,...oe,...ne.filter((e=>!["pcm-s8","pcm-f32be","pcm-f64be","ulaw","alaw"].includes(e))),...ce]}get supportsVideoRotationMetadata(){return!1}},Ra=class extends Ma{getSupportedCodecs(){return[...se.filter((e=>["vp8","vp9","av1"].includes(e))),...le.filter((e=>["opus","vorbis"].includes(e))),...ce]}get _name(){return"WebM"}get fileExtension(){return".webm"}get mimeType(){return"video/webm"}_codecUnsupportedHint(e){return(new Ma).getSupportedCodecs().includes(e)?" Switching to MKV will grant support for this codec.":""}},Da=class extends Ta{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.xingHeader&&"boolean"!=typeof e.xingHeader)throw new TypeError("options.xingHeader, when provided, must be a boolean.");if(void 0!==e.onXingFrame&&"function"!=typeof e.onXingFrame)throw new TypeError("options.onXingFrame, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new Ei(e,this)}get _name(){return"MP3"}getSupportedTrackCounts(){return{video:{min:0,max:0},audio:{min:1,max:1},subtitle:{min:0,max:0},total:{min:1,max:1}}}get fileExtension(){return".mp3"}get mimeType(){return"audio/mpeg"}getSupportedCodecs(){return["mp3"]}get supportsVideoRotationMetadata(){return!1}},_a=class extends Ta{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.large&&"boolean"!=typeof e.large)throw new TypeError("options.large, when provided, must be a boolean.");if(void 0!==e.onHeader&&"function"!=typeof e.onHeader)throw new TypeError("options.onHeader, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new Sa(e,this)}get _name(){return"WAVE"}getSupportedTrackCounts(){return{video:{min:0,max:0},audio:{min:1,max:1},subtitle:{min:0,max:0},total:{min:1,max:1}}}get fileExtension(){return".wav"}get mimeType(){return"audio/wav"}getSupportedCodecs(){return[...ne.filter((e=>["pcm-s16","pcm-s24","pcm-s32","pcm-f32","pcm-u8","ulaw","alaw"].includes(e)))]}get supportsVideoRotationMetadata(){return!1}},Ea=class extends Ta{constructor(e={}){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(void 0!==e.onPage&&"function"!=typeof e.onPage)throw new TypeError("options.onPage, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new Vi(e,this)}get _name(){return"Ogg"}getSupportedTrackCounts(){return{video:{min:0,max:0},audio:{min:0,max:1/0},subtitle:{min:0,max:0},total:{min:1,max:2**32}}}get fileExtension(){return".ogg"}get mimeType(){return"application/ogg"}getSupportedCodecs(){return[...le.filter((e=>["vorbis","opus"].includes(e)))]}get supportsVideoRotationMetadata(){return!1}},Ia=class{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw new Error("Source is not connected to an output track.");if("canceled"===this._connectedTrack.output.state)throw new Error("Output has been canceled.");if("finalizing"===this._connectedTrack.output.state||"finalized"===this._connectedTrack.output.state)throw new Error("Output has been finalized.");if("pending"===this._connectedTrack.output.state)throw new Error("Output has not started.");if(this._closed)throw new Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;const e=this._connectedTrack;if(!e)throw new Error("Cannot call close without connecting the source to an output track.");if("pending"===e.output.state)throw new Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,"finalizing"!==e.output.state&&"finalized"!==e.output.state&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise?this._closingPromise:this._flushAndClose(e)}},Fa=class extends Ia{constructor(e){if(super(),this._connectedTrack=null,!se.includes(e))throw new TypeError(`Invalid video codec '${e}'. Must be one of: ${se.join(", ")}.`);this._codec=e}},Aa=class extends Fa{constructor(e){super(e)}add(e,t){if(!(e instanceof Ni))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedVideoPacket(this._connectedTrack,e,t)}},Oa=e=>{if(!e||"object"!=typeof e)throw new TypeError("Encoding config must be an object.");if(!se.includes(e.codec))throw new TypeError(`Invalid video codec '${e.codec}'. Must be one of: ${se.join(", ")}.`);if(!(e.bitrate instanceof Me)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("config.bitrate must be a positive integer or a quality.");if(void 0!==e.latencyMode&&!["quality","realtime"].includes(e.latencyMode))throw new TypeError("config.latencyMode, when provided, must be 'quality' or 'realtime'.");if(void 0!==e.keyFrameInterval&&(!Number.isFinite(e.keyFrameInterval)||e.keyFrameInterval<0))throw new TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(void 0!==e.fullCodecString&&"string"!=typeof e.fullCodecString)throw new TypeError("config.fullCodecString, when provided, must be a string.");if(void 0!==e.fullCodecString&&Ce(e.fullCodecString)!==e.codec)throw new TypeError(`config.fullCodecString, when provided, must be a string that matches the specified codec (${e.codec}).`);if(void 0!==e.onEncodedPacket&&"function"!=typeof e.onEncodedPacket)throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(void 0!==e.onEncoderConfig&&"function"!=typeof e.onEncoderConfig)throw new TypeError("config.onEncoderConfig, when provided, must be a function.")},La=class{constructor(e,t){this.source=e,this.encodingConfig=t,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.lastWidth=null,this.lastHeight=null,this.customEncoder=null,this.customEncoderCallSerializer=new G,this.customEncoderQueueSize=0,this.encoderError=null}async add(e,t,r){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),null!==this.lastWidth&&null!==this.lastHeight){if(e.codedWidth!==this.lastWidth||e.codedHeight!==this.lastHeight)throw new Error(`Video sample size must remain constant. Expected ${this.lastWidth}x${this.lastHeight}, got ${e.codedWidth}x${e.codedHeight}.`)}else this.lastWidth=e.codedWidth,this.lastHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),s(this.encoderInitialized);const i=this.encodingConfig.keyFrameInterval??5,a=Math.floor(e.timestamp/i),n={...r,keyFrame:r?.keyFrame||0===i||a!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=a,this.customEncoder){this.customEncoderQueueSize++;const r=this.customEncoderCallSerializer.call((()=>this.customEncoder.encode(e,n))).then((()=>{this.customEncoderQueueSize--,t&&e.close()})).catch((e=>{this.encoderError??=e}));this.customEncoderQueueSize>=4&&await r}else{s(this.encoder);const r=e.toVideoFrame();this.encoder.encode(r,n),r.close(),t&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise((e=>this.encoder.addEventListener("dequeue",e,{once:!0})))}await this.muxer.mutex.currentPromise}finally{t&&e.close()}}async ensureEncoder(e){if(!this.encoder)return this.ensureEncoderPromise=(async()=>{const t=e.codedWidth,r=e.codedHeight,i=this.encodingConfig.bitrate instanceof Me?this.encodingConfig.bitrate._toVideoBitrate(this.encodingConfig.codec,t,r):this.encodingConfig.bitrate,a={codec:this.encodingConfig.fullCodecString??me(this.encodingConfig.codec,t,r,i),width:t,height:r,bitrate:i,framerate:this.source._connectedTrack?.metadata.frameRate,latencyMode:this.encodingConfig.latencyMode,...ke(this.encodingConfig.codec)};this.encodingConfig.onEncoderConfig?.(a);const n=te.find((e=>e.supports(this.encodingConfig.codec,a)));if(n)this.customEncoder=new n,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=a,this.customEncoder.onPacket=(e,t)=>{if(!(e instanceof Ni))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(e,t),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,e,t)},await this.customEncoder.init();else{if("undefined"==typeof VideoEncoder)throw new Error("VideoEncoder is not supported by this browser.");if(!(await VideoEncoder.isConfigSupported(a)).supported)throw new Error(`This specific encoder configuration (${a.codec}, ${a.bitrate} bps, ${a.width}x${a.height}) is not supported by this browser. Consider using another codec or changing your video parameters.`);this.encoder=new VideoEncoder({output:(e,t)=>{const r=Ni.fromEncodedChunk(e);this.encodingConfig.onEncodedPacket?.(r,t),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,r,t)},error:e=>{this.encoderError??=e}}),this.encoder.configure(a)}s(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call((()=>this.customEncoder.flush())),await this.customEncoderCallSerializer.call((()=>this.customEncoder.close()))):this.encoder&&(e||await this.encoder.flush(),this.encoder.close()),this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.encoderError)throw this.encoderError.stack=(new Error).stack,this.encoderError}},Ba=class extends Fa{constructor(e){Oa(e),super(e.codec),this._encoder=new La(this,e)}add(e,t){if(!(e instanceof Wi))throw new TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,t)}_flushAndClose(e){return this._encoder.flushAndClose(e)}},ja=class extends Fa{constructor(e,t){if(!("undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new TypeError("canvas must be an HTMLCanvasElement or OffscreenCanvas.");Oa(t),super(t.codec),this._encoder=new La(this,t),this._canvas=e}add(e,t=0,r){if(!Number.isFinite(e)||e<0)throw new TypeError("timestamp must be a non-negative number.");if(!Number.isFinite(t)||t<0)throw new TypeError("duration must be a non-negative number.");const i=new Wi(this._canvas,{timestamp:e,duration:t});return this._encoder.add(i,!0,r)}_flushAndClose(e){return this._encoder.flushAndClose(e)}},za=class extends Fa{constructor(e,t){if(!(e instanceof MediaStreamTrack)||"video"!==e.kind)throw new TypeError("track must be a video MediaStreamTrack.");Oa(t),super((t={...t,latencyMode:"realtime"}).codec),this._abortController=null,this._workerTrackId=null,this._workerListener=null,this._promiseWithResolvers=_(),this._errorPromiseAccessed=!1,this._encoder=new La(this,t),this._track=e}get errorPromise(){return this._errorPromiseAccessed=!0,this._promiseWithResolvers.promise}async _start(){this._errorPromiseAccessed||console.warn("Make sure not to ignore the `errorPromise` field on MediaStreamVideoTrackSource, so that any internal errors get bubbled up properly."),this._abortController=new AbortController;let e=null,t=!1;const r=r=>{if(t)r.close();else{if(null===e){e=r.timestamp/1e6;const t=this._connectedTrack.output._muxer;null===t.firstMediaStreamTimestamp?(t.firstMediaStreamTimestamp=performance.now()/1e3,this._timestampOffset=-e):this._timestampOffset=performance.now()/1e3-t.firstMediaStreamTimestamp-e}this._encoder.getQueueSize()>=4?r.close():this._encoder.add(new Wi(r),!0).catch((e=>{t=!0,this._abortController?.abort(),this._promiseWithResolvers.reject(e),null!==this._workerTrackId&&Ja({type:"stopTrack",trackId:this._workerTrackId})}))}};if("undefined"!=typeof MediaStreamTrackProcessor){const e=new MediaStreamTrackProcessor({track:this._track}),t=new WritableStream({write:r});e.readable.pipeTo(t,{signal:this._abortController.signal}).catch((e=>{e instanceof DOMException&&"AbortError"===e.name||this._promiseWithResolvers.reject(e)}))}else{if(!await Xa())throw new Error("MediaStreamTrackProcessor is required but not supported by this browser.");this._workerTrackId=Ka++,Ja({type:"videoTrack",trackId:this._workerTrackId,track:this._track},[this._track]),this._workerListener=e=>{const t=e.data;"videoFrame"===t.type&&t.trackId===this._workerTrackId?r(t.videoFrame):"error"===t.type&&t.trackId===this._workerTrackId&&this._promiseWithResolvers.reject(t.error)},Qa.addEventListener("message",this._workerListener)}}async _flushAndClose(e){this._abortController&&(this._abortController.abort(),this._abortController=null),null!==this._workerTrackId&&(s(this._workerListener),Ja({type:"stopTrack",trackId:this._workerTrackId}),await new Promise((e=>{const t=r=>{const i=r.data;"trackStopped"===i.type&&i.trackId===this._workerTrackId&&(s(this._workerListener),Qa.removeEventListener("message",this._workerListener),Qa.removeEventListener("message",t),e())};Qa.addEventListener("message",t)}))),await this._encoder.flushAndClose(e)}},Va=class extends Ia{constructor(e){if(super(),this._connectedTrack=null,!le.includes(e))throw new TypeError(`Invalid audio codec '${e}'. Must be one of: ${le.join(", ")}.`);this._codec=e}},$a=class extends Va{constructor(e){super(e)}add(e,t){if(!(e instanceof Ni))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedAudioPacket(this._connectedTrack,e,t)}},Ua=e=>{if(!e||"object"!=typeof e)throw new TypeError("Encoding config must be an object.");if(!le.includes(e.codec))throw new TypeError(`Invalid audio codec '${e.codec}'. Must be one of: ${le.join(", ")}.`);if(void 0===e.bitrate&&(!ne.includes(e.codec)||"flac"===e.codec))throw new TypeError("config.bitrate must be provided for compressed audio codecs.");if(void 0!==e.bitrate&&!(e.bitrate instanceof Me)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(void 0!==e.fullCodecString&&"string"!=typeof e.fullCodecString)throw new TypeError("config.fullCodecString, when provided, must be a string.");if(void 0!==e.fullCodecString&&Ce(e.fullCodecString)!==e.codec)throw new TypeError(`config.fullCodecString, when provided, must be a string that matches the specified codec (${e.codec}).`);if(void 0!==e.onEncodedPacket&&"function"!=typeof e.onEncodedPacket)throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(void 0!==e.onEncoderConfig&&"function"!=typeof e.onEncoderConfig)throw new TypeError("config.onEncoderConfig, when provided, must be a function.")},Na=class{constructor(e,t){this.source=e,this.encodingConfig=t,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new G,this.customEncoderQueueSize=0,this.encoderError=null}async add(e,t){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),null!==this.lastNumberOfChannels&&null!==this.lastSampleRate){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw new Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;if(this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),s(this.encoderInitialized),this.customEncoder){this.customEncoderQueueSize++;const r=this.customEncoderCallSerializer.call((()=>this.customEncoder.encode(e))).then((()=>{this.customEncoderQueueSize--,t&&e.close()})).catch((e=>{this.encoderError??=e}));this.customEncoderQueueSize>=4&&await r,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,t);else{s(this.encoder);const r=e.toAudioData();this.encoder.encode(r),r.close(),t&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise((e=>this.encoder.addEventListener("dequeue",e,{once:!0}))),await this.muxer.mutex.currentPromise}}finally{t&&e.close()}}async doPcmEncoding(e,t){s(this.outputSampleSize),s(this.writeOutputValue);const{numberOfChannels:r,numberOfFrames:i,sampleRate:a,timestamp:n}=e,o=2048,l=[];for(let t=0;t<i;t+=o){const i=Math.min(o,e.numberOfFrames-t),a=i*r*this.outputSampleSize,s=new ArrayBuffer(a),n=new DataView(s);l.push({frameCount:i,view:n})}const c=e.allocationSize({planeIndex:0,format:"f32-planar"}),d=new Float32Array(c/Float32Array.BYTES_PER_ELEMENT);for(let t=0;t<r;t++){e.copyTo(d,{planeIndex:t,format:"f32-planar"});for(let e=0;e<l.length;e++){const{frameCount:i,view:a}=l[e];for(let s=0;s<i;s++)this.writeOutputValue(a,(s*r+t)*this.outputSampleSize,d[e*o+s])}}t&&e.close();const h={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:r,sampleRate:a}};for(let e=0;e<l.length;e++){const{frameCount:t,view:r}=l[e],i=r.buffer,s=e*o,c=new Ni(new Uint8Array(i),"key",n+s/a,t/a);this.encodingConfig.onEncodedPacket?.(c,h),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,c,h)}}ensureEncoder(e){if(!this.encoderInitialized)return this.ensureEncoderPromise=(async()=>{const{numberOfChannels:t,sampleRate:r}=e,i=this.encodingConfig.bitrate instanceof Me?this.encodingConfig.bitrate._toAudioBitrate(this.encodingConfig.codec):this.encodingConfig.bitrate,a={codec:this.encodingConfig.fullCodecString??we(this.encodingConfig.codec,t,r),numberOfChannels:t,sampleRate:r,bitrate:i,...Pe(this.encodingConfig.codec)};this.encodingConfig.onEncoderConfig?.(a);const n=re.find((e=>e.supports(this.encodingConfig.codec,a)));if(n)this.customEncoder=new n,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=a,this.customEncoder.onPacket=(e,t)=>{if(!(e instanceof Ni))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(void 0!==t&&(!t||"object"!=typeof t))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(e,t),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,e,t)},await this.customEncoder.init();else if(ne.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if("undefined"==typeof AudioEncoder)throw new Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(a)).supported)throw new Error(`This specific encoder configuration (${a.codec}, ${a.bitrate} bps, ${a.numberOfChannels} channels, ${a.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(e,t)=>{const r=Ni.fromEncodedChunk(e);this.encodingConfig.onEncodedPacket?.(r,t),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,r,t)},error:e=>{this.encoderError??=e}}),this.encoder.configure(a)}s(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;const e=this.encodingConfig.codec,{dataType:t,sampleSize:r,littleEndian:i}=Te(e);switch(this.outputSampleSize=r,r){case 1:"unsigned"===t?this.writeOutputValue=(e,t,r)=>e.setUint8(t,B(127.5*(r+1),0,255)):"signed"===t?this.writeOutputValue=(e,t,r)=>{e.setInt8(t,B(Math.round(128*r),-128,127))}:"ulaw"===t?this.writeOutputValue=(e,t,r)=>{const i=B(Math.floor(32767*r),-32768,32767);e.setUint8(t,(e=>{let t=e,r=4096,i=0,a=12,s=0;for(t<0&&(t=-t,i=128),t+=33,t>8191&&(t=8191);(t&r)!==r&&a>=5;)r>>=1,a--;return s=t>>a-4&15,255&~(i|a-5<<4|s)})(i))}:"alaw"===t?this.writeOutputValue=(e,t,r)=>{const i=B(Math.floor(32767*r),-32768,32767);e.setUint8(t,(e=>{let t=2048,r=0,i=11,a=0,s=e;for(s<0&&(s=-s,r=128),s>4095&&(s=4095);(s&t)!==t&&i>=5;)t>>=1,i--;return a=s>>(4===i?1:i-4)&15,85^(r|i-4<<4|a)})(i))}:s(!1);break;case 2:"unsigned"===t?this.writeOutputValue=(e,t,r)=>e.setUint16(t,B(32767.5*(r+1),0,65535),i):"signed"===t?this.writeOutputValue=(e,t,r)=>e.setInt16(t,B(Math.round(32767*r),-32768,32767),i):s(!1);break;case 3:"unsigned"===t?this.writeOutputValue=(e,t,r)=>O(e,t,B(8388607.5*(r+1),0,16777215),i):"signed"===t?this.writeOutputValue=(e,t,r)=>((e,t,r,i)=>{(r=B(r,-8388608,8388607))<0&&(r=r+16777216&16777215),O(e,t,r,i)})(e,t,B(Math.round(8388607*r),-8388608,8388607),i):s(!1);break;case 4:"unsigned"===t?this.writeOutputValue=(e,t,r)=>e.setUint32(t,B(2147483647.5*(r+1),0,4294967295),i):"signed"===t?this.writeOutputValue=(e,t,r)=>e.setInt32(t,B(Math.round(2147483647*r),-2147483648,2147483647),i):"float"===t?this.writeOutputValue=(e,t,r)=>e.setFloat32(t,r,i):s(!1);break;case 8:"float"===t?this.writeOutputValue=(e,t,r)=>e.setFloat64(t,r,i):s(!1);break;default:F(r),s(!1)}}async flushAndClose(e){this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call((()=>this.customEncoder.flush())),await this.customEncoderCallSerializer.call((()=>this.customEncoder.close()))):this.encoder&&(e||await this.encoder.flush(),this.encoder.close()),this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.encoderError)throw this.encoderError.stack=(new Error).stack,this.encoderError}},Wa=class extends Va{constructor(e){Ua(e),super(e.codec),this._encoder=new Na(this,e)}add(e){if(!(e instanceof qi))throw new TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}},Ha=class extends Va{constructor(e){Ua(e),super(e.codec),this._accumulatedTime=0,this._encoder=new Na(this,e)}add(e){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const t=qi.fromAudioBuffer(e,this._accumulatedTime).map((e=>this._encoder.add(e,!0)));return this._accumulatedTime+=e.duration,Promise.all(t)}_flushAndClose(e){return this._encoder.flushAndClose(e)}},Ga=class extends Va{constructor(e,t){if(!(e instanceof MediaStreamTrack)||"audio"!==e.kind)throw new TypeError("track must be an audio MediaStreamTrack.");Ua(t),super(t.codec),this._abortController=null,this._audioContext=null,this._scriptProcessorNode=null,this._promiseWithResolvers=_(),this._errorPromiseAccessed=!1,this._encoder=new Na(this,t),this._track=e}get errorPromise(){return this._errorPromiseAccessed=!0,this._promiseWithResolvers.promise}async _start(){if(this._errorPromiseAccessed||console.warn("Make sure not to ignore the `errorPromise` field on MediaStreamVideoTrackSource, so that any internal errors get bubbled up properly."),this._abortController=new AbortController,"undefined"!=typeof MediaStreamTrackProcessor){let e=null;const t=new MediaStreamTrackProcessor({track:this._track}),r=new WritableStream({write:t=>{if(null===e){e=t.timestamp/1e6;const r=this._connectedTrack.output._muxer;null===r.firstMediaStreamTimestamp?(r.firstMediaStreamTimestamp=performance.now()/1e3,this._timestampOffset=-e):this._timestampOffset=performance.now()/1e3-r.firstMediaStreamTimestamp-e}this._encoder.getQueueSize()>=4?t.close():this._encoder.add(new qi(t),!0).catch((e=>{this._abortController?.abort(),this._promiseWithResolvers.reject(e)}))}});t.readable.pipeTo(r,{signal:this._abortController.signal}).catch((e=>{e instanceof DOMException&&"AbortError"===e.name||this._promiseWithResolvers.reject(e)}))}else{const e=window.AudioContext||window.webkitAudioContext;this._audioContext=new e({sampleRate:this._track.getSettings().sampleRate});const t=this._audioContext.createMediaStreamSource(new MediaStream([this._track]));this._scriptProcessorNode=this._audioContext.createScriptProcessor(4096),"suspended"===this._audioContext.state&&await this._audioContext.resume(),t.connect(this._scriptProcessorNode),this._scriptProcessorNode.connect(this._audioContext.destination);let r=!1,i=0;this._scriptProcessorNode.onaudioprocess=e=>{const t=qi.fromAudioBuffer(e.inputBuffer,i);i+=e.inputBuffer.duration;for(const e of t){if(!r){r=!0;const e=this._connectedTrack.output._muxer;null===e.firstMediaStreamTimestamp?e.firstMediaStreamTimestamp=performance.now()/1e3:this._timestampOffset=performance.now()/1e3-e.firstMediaStreamTimestamp}this._encoder.getQueueSize()>=4?e.close():this._encoder.add(e,!0).catch((e=>{this._audioContext.suspend(),this._promiseWithResolvers.reject(e)}))}}}}async _flushAndClose(e){this._abortController&&(this._abortController.abort(),this._abortController=null),this._audioContext&&(s(this._scriptProcessorNode),this._scriptProcessorNode.disconnect(),await this._audioContext.suspend()),await this._encoder.flushAndClose(e)}},qa=()=>{const e=(e,t)=>{t?self.postMessage(e,{transfer:t}):self.postMessage(e)};e({type:"support",supported:"undefined"!=typeof MediaStreamTrackProcessor});const t=new Map,r=new Set;self.addEventListener("message",(i=>{const a=i.data;switch(a.type){case"videoTrack":{const i=new MediaStreamTrackProcessor({track:a.track}),s=new WritableStream({write:t=>{r.has(a.trackId)?t.close():e({type:"videoFrame",trackId:a.trackId,videoFrame:t},[t])}}),n=new AbortController;t.set(a.trackId,n),i.readable.pipeTo(s,{signal:n.signal}).catch((t=>{t instanceof DOMException&&"AbortError"===t.name||e({type:"error",trackId:a.trackId,error:t})}))}break;case"stopTrack":{const i=t.get(a.trackId);i&&(i.abort(),t.delete(a.trackId)),r.add(a.trackId),e({type:"trackStopped",trackId:a.trackId})}break;default:F(a)}}))},Ka=0,Qa=null,Ya=null,Xa=async()=>null!==Ya?Ya:(Qa||(()=>{const e=new Blob([`(${qa.toString()})()`],{type:"application/javascript"}),t=URL.createObjectURL(e);Qa=new Worker(t)})(),new Promise((e=>{s(Qa);const t=r=>{const i=r.data;"support"===i.type&&(Ya=i.supported,Qa.removeEventListener("message",t),e(i.supported))};Qa.addEventListener("message",t)}))),Ja=(e,t)=>{s(Qa),t?Qa.postMessage(e,t):Qa.postMessage(e)},Za=class extends Ia{constructor(e){if(super(),this._connectedTrack=null,!ce.includes(e))throw new TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${ce.join(", ")}.`);this._codec=e}},es=class extends Za{constructor(e){super(e),this._parser=new rt({codec:e,output:(e,t)=>this._connectedTrack?.output._muxer.addSubtitleCue(this._connectedTrack,e,t)})}add(e){if("string"!=typeof e)throw new TypeError("text must be a string.");return this._ensureValidAdd(),this._parser.parse(e),this._connectedTrack.output._muxer.mutex.currentPromise}},ts=["video","audio","subtitle"],rs=e=>{if(!e||"object"!=typeof e)throw new TypeError("metadata must be an object.");if(void 0!==e.languageCode&&!U(e.languageCode))throw new TypeError("metadata.languageCode must be a three-letter, ISO 639-2/T language code.")},is=class{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new C,!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!(e.format instanceof Ta))throw new TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof Jr))throw new TypeError("options.target must be a Target.");if(e.target._output)throw new Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,t={}){if(!(e instanceof Fa))throw new TypeError("source must be a VideoSource.");if(rs(t),void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw new TypeError(`Invalid video rotation: ${t.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&t.rotation)throw new Error(`${this.format._name} does not support video rotation metadata.`);if(void 0!==t.frameRate&&(!Number.isFinite(t.frameRate)||t.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${t.frameRate}. Must be a positive number.`);this._addTrack("video",e,t)}addAudioTrack(e,t={}){if(!(e instanceof Va))throw new TypeError("source must be an AudioSource.");rs(t),this._addTrack("audio",e,t)}addSubtitleTrack(e,t={}){if(!(e instanceof Za))throw new TypeError("source must be a SubtitleSource.");rs(t),this._addTrack("subtitle",e,t)}_addTrack(e,t,r){if("pending"!==this.state)throw new Error("Cannot add track after output has been started or canceled.");if(t._connectedTrack)throw new Error("Source is already used for a track.");const i=this.format.getSupportedTrackCounts(),a=this._tracks.reduce(((t,r)=>t+(r.type===e?1:0)),0),s=i[e].max;if(a===s)throw new Error(0===s?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${s} ${e} track${1===s?"":"s"}.`);const n=i.total.max;if(this._tracks.length===n)throw new Error(`${this.format._name} does not support more than ${n} tracks${1===n?"":"s"} in total.`);const o={id:this._tracks.length+1,output:this,type:e,source:t,metadata:r};if("video"===o.type){const e=this.format.getSupportedVideoCodecs();if(0===e.length)throw new Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw new Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${e.map((e=>`'${e}'`)).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}else if("audio"===o.type){const e=this.format.getSupportedAudioCodecs();if(0===e.length)throw new Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw new Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${e.map((e=>`'${e}'`)).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}else if("subtitle"===o.type){const e=this.format.getSupportedSubtitleCodecs();if(0===e.length)throw new Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw new Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${e.map((e=>`'${e}'`)).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}this._tracks.push(o),t._connectedTrack=o}async start(){const e=this.format.getSupportedTrackCounts();for(const t of ts){const r=this._tracks.reduce(((e,r)=>e+(r.type===t?1:0)),0),i=e[t].min;if(r<i)throw new Error(i===e[t].max?`${this.format._name} requires exactly ${i} ${t} track${1===i?"":"s"}.`:`${this.format._name} requires at least ${i} ${t} track${1===i?"":"s"}.`)}const t=e.total.min;if(this._tracks.length<t)throw new Error(t===e.total.max?`${this.format._name} requires exactly ${t} track${1===t?"":"s"}.`:`${this.format._name} requires at least ${t} track${1===t?"":"s"}.`);if("canceled"===this.state)throw new Error("Output has been canceled.");return this._startPromise?(console.warn("Output has already been started."),this._startPromise):this._startPromise=(async()=>{this.state="started",this._writer.start();const e=await this._mutex.acquire();await this._muxer.start();const t=this._tracks.map((e=>e.source._start()));await Promise.all(t),e()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){return this._cancelPromise?(console.warn("Output has already been canceled."),this._cancelPromise):"finalizing"!==this.state&&"finalized"!==this.state?this._cancelPromise=(async()=>{this.state="canceled";const e=await this._mutex.acquire(),t=this._tracks.map((e=>e.source._flushOrWaitForOngoingClose(!0)));await Promise.all(t),await this._writer.close(),e()})():void console.warn("Output has already been finalized.")}async finalize(){if("pending"===this.state)throw new Error("Cannot finalize before starting.");if("canceled"===this.state)throw new Error("Cannot finalize after canceling.");return this._finalizePromise?(console.warn("Output has already been finalized."),this._finalizePromise):this._finalizePromise=(async()=>{this.state="finalizing";const e=await this._mutex.acquire(),t=this._tracks.map((e=>e.source._flushOrWaitForOngoingClose(!1)));await Promise.all(t),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}},as=class{constructor(){this._sizePromise=null,this.onread=null}getSize(){return this._sizePromise??=this._retrieveSize()}},ss=class extends as{constructor(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new TypeError("buffer must be an ArrayBuffer or Uint8Array.");super(),this._bytes=e instanceof Uint8Array?e:new Uint8Array(e)}async _read(e,t){return this._bytes.subarray(e,t)}async _retrieveSize(){return this._bytes.byteLength}},ns=class extends as{constructor(e){if(!e||"object"!=typeof e)throw new TypeError("options must be an object.");if("function"!=typeof e.read)throw new TypeError("options.read must be a function.");if("function"!=typeof e.getSize)throw new TypeError("options.getSize must be a function.");super(),this._options=e}async _read(e,t){return this._options.read(e,t)}async _retrieveSize(){return this._options.getSize()}},os=class extends as{constructor(e){if(!(e instanceof Blob))throw new TypeError("blob must be a Blob.");super(),this._blob=e}async _read(e,t){const r=this._blob.slice(e,t),i=await r.arrayBuffer();return new Uint8Array(i)}async _retrieveSize(){return this._blob.size}},ls=class extends as{constructor(e,t={}){if("string"!=typeof e&&!(e instanceof URL))throw new TypeError("url must be a string or URL.");if(!t||"object"!=typeof t)throw new TypeError("options must be an object.");if(void 0!==t.requestInit&&(!t.requestInit||"object"!=typeof t.requestInit))throw new TypeError("options.requestInit, when provided, must be an object.");if(void 0!==t.getRetryDelay&&"function"!=typeof t.getRetryDelay)throw new TypeError("options.getRetryDelay, when provided, must be a function.");super(),this._fullData=null,this._url=e,this._options=t}async _makeRequest(e){const t={};e&&(t.Range=`bytes=${e.start}-${e.end-1}`);const r=await H(this._url,W(this._options.requestInit??{},{method:"GET",headers:t}),this._options.getRetryDelay??(()=>null));if(!r.ok)throw new Error(`Error fetching ${this._url}: ${r.status} ${r.statusText}`);const i=await r.arrayBuffer();return 200===r.status&&(this._fullData=i),{response:i,statusCode:r.status}}async _read(e,t){if(this._fullData)return new Uint8Array(this._fullData,e,t-e);const{response:r,statusCode:i}=await this._makeRequest({start:e,end:t});return 200===i?new Uint8Array(r).subarray(e,t):new Uint8Array(r)}async _retrieveSize(){if(this._fullData)return this._fullData.byteLength;try{const e=await H(this._url,W(this._options.requestInit??{},{method:"HEAD"}),this._options.getRetryDelay??(()=>null));if(e.ok){const t=e.headers.get("Content-Length");if(t)return parseInt(t)}}catch{}const e=await H(this._url,W(this._options.requestInit??{},{method:"GET",headers:{Range:"bytes=0-0"}}),this._options.getRetryDelay??(()=>null));if(206===e.status){const t=e.headers.get("Content-Range");if(t){const e=t.match(/bytes \d+-\d+\/(\d+)/);if(e&&e[1])return parseInt(e[1])}}else if(200===e.status)return this._fullData=await e.arrayBuffer(),this._fullData.byteLength;const{response:t}=await this._makeRequest();return t.byteLength}},cs=class extends $i{constructor(e){super(e),this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.fragments=[],this.currentFragment=null,this.fragmentLookupMutex=new C,this.metadataReader=new ri(e._mainReader),this.chunkReader=new ri(new ga(e.source,67108864))}async computeDuration(){const e=await this.getTracks(),t=await Promise.all(e.map((e=>e.computeDuration())));return Math.max(0,...t)}async getTracks(){return await this.readMetadata(),this.tracks.map((e=>e.inputTrack))}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map((e=>e.inputTrack.getCodecParameterString())));return ti({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some((e=>"video"===e.info?.type)),hasAudio:this.tracks.some((e=>"audio"===e.info?.type)),codecStrings:e.filter(Boolean)})}readMetadata(){return this.metadataPromise??=(async()=>{const e=await this.metadataReader.reader.source.getSize();for(;this.metadataReader.pos<e;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+16);const e=this.metadataReader.pos,t=this.metadataReader.readBoxHeader();if("ftyp"===t.name){const e=this.metadataReader.readAscii(4);this.isQuickTime="qt  "===e}else if("moov"===t.name){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+t.contentSize),this.readContiguousBoxes(t.contentSize);for(const e of this.tracks){const t=e.editListPreviousSegmentDurations/this.movieTimescale;e.editListOffset-=Math.round(t*e.timescale)}break}this.metadataReader.pos=e+t.totalSize}if(this.isFragmented){await this.metadataReader.reader.loadRange(e-4,e),this.metadataReader.pos=e-4;const t=e-this.metadataReader.readU32();if(t>=0&&t<e){await this.metadataReader.reader.loadRange(t,e),this.metadataReader.pos=t;const r=this.metadataReader.readBoxHeader();"mfra"===r.name&&this.readContiguousBoxes(r.contentSize)}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;const t={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};if(e.sampleTable=t,this.metadataReader.pos=e.sampleTableByteOffset,this.currentTrack=e,this.traverseBox(),this.currentTrack=null,"audio"===e.info?.type&&e.info.codec&&ne.includes(e.info.codec)&&0===t.sampleCompositionTimeOffsets.length){s("audio"===e.info?.type);const r=Te(e.info.codec),i=[],a=[];for(let s=0;s<t.sampleToChunk.length;s++){const n=t.sampleToChunk[s],l=t.sampleToChunk[s+1],c=(l?l.startChunkIndex:t.chunkOffsets.length)-n.startChunkIndex;for(let s=0;s<c;s++){const l=n.startSampleIndex+s*n.samplesPerChunk,c=l+n.samplesPerChunk,d=R(t.sampleTimingEntries,l,(e=>e.startIndex)),h=t.sampleTimingEntries[d],u=R(t.sampleTimingEntries,c,(e=>e.startIndex)),p=t.sampleTimingEntries[u],m=h.startDecodeTimestamp+(l-h.startIndex)*h.delta,f=p.startDecodeTimestamp+(c-p.startIndex)*p.delta-m,g=o(i);g&&g.delta===f?g.count++:i.push({startIndex:n.startChunkIndex+s,startDecodeTimestamp:m,count:1,delta:f});const y=n.samplesPerChunk*r.sampleSize*e.info.numberOfChannels;a.push(y)}n.startSampleIndex=n.startChunkIndex,n.samplesPerChunk=1}t.sampleTimingEntries=i,t.sampleSizes=a}if(t.sampleCompositionTimeOffsets.length>0){t.presentationTimestamps=[];for(const e of t.sampleTimingEntries)for(let r=0;r<e.count;r++)t.presentationTimestamps.push({presentationTimestamp:e.startDecodeTimestamp+r*e.delta,sampleIndex:e.startIndex+r});for(const e of t.sampleCompositionTimeOffsets)for(let r=0;r<e.count;r++){const i=e.startIndex+r,a=t.presentationTimestamps[i];a&&(a.presentationTimestamp+=e.offset)}t.presentationTimestamps.sort(((e,t)=>e.presentationTimestamp-t.presentationTimestamp)),t.presentationTimestampIndexMap=Array(t.presentationTimestamps.length).fill(-1);for(let e=0;e<t.presentationTimestamps.length;e++)t.presentationTimestampIndexMap[t.presentationTimestamps[e].sampleIndex]=e}return t}async readFragment(){const e=this.metadataReader.pos;await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+16);const t=this.metadataReader.readBoxHeader();s("moof"===t.name);const r=this.metadataReader.pos;await this.metadataReader.reader.loadRange(r,r+t.contentSize),this.metadataReader.pos=e,this.traverseBox();const i=M(this.fragments,e,(e=>e.moofOffset));s(-1!==i);const a=this.fragments[i];s(a.moofOffset===e),this.metadataReader.reader.forgetRange(r,r+t.contentSize);for(const[t,r]of a.trackData){if(r.startTimestampIsFinal)continue;const i=this.tracks.find((e=>e.id===t));this.metadataReader.pos=0;let a=null,n=null;const o=R(i.fragments,e-1,(e=>e.moofOffset));-1!==o&&(a=i.fragments[o],n=a,this.metadataReader.pos=a.moofOffset+a.moofSize);let l=0===this.metadataReader.pos;for(;this.metadataReader.pos<e;){if(a?.nextFragment)a=a.nextFragment,this.metadataReader.pos=a.moofOffset+a.moofSize;else{await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+16);const e=this.metadataReader.pos,t=this.metadataReader.readBoxHeader();if("moof"===t.name){const t=M(this.fragments,e,(e=>e.moofOffset));let r;-1===t?(this.metadataReader.pos=e,r=await this.readFragment()):r=this.fragments[t],a&&(a.nextFragment=r),a=r,l&&(r.isKnownToBeFirstFragment=!0,l=!1)}this.metadataReader.pos=e+t.totalSize}a&&a.trackData.has(t)&&(n=a)}if(n){const e=n.trackData.get(t);s(e.startTimestampIsFinal),ys(r,e.endTimestamp)}r.startTimestampIsFinal=!0}return a}readContiguousBoxes(e){const t=this.metadataReader.pos;for(;this.metadataReader.pos-t<=e-8;)this.traverseBox()}traverseBox(){const e=this.metadataReader.pos,t=this.metadataReader.readBoxHeader(),r=e+t.totalSize;switch(t.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":case"wave":this.readContiguousBoxes(t.contentSize);break;case"mvhd":{const e=this.metadataReader.readU8();this.metadataReader.pos+=3,1===e?(this.metadataReader.pos+=16,this.movieTimescale=this.metadataReader.readU32(),this.movieDurationInTimescale=this.metadataReader.readU64()):(this.metadataReader.pos+=8,this.movieTimescale=this.metadataReader.readU32(),this.movieDurationInTimescale=this.metadataReader.readU32())}break;case"trak":{const e={id:-1,demuxer:this,inputTrack:null,info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,languageCode:j,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:null,currentFragmentState:null,fragments:[],fragmentsWithKeyFrame:[],editListPreviousSegmentDurations:0,editListOffset:0};if(this.currentTrack=e,this.readContiguousBoxes(t.contentSize),-1!==e.id&&-1!==e.timescale&&null!==e.info)if("video"===e.info.type&&-1!==e.info.width){const t=e;e.inputTrack=new ma(new hs(t)),this.tracks.push(e)}else if("audio"===e.info.type&&-1!==e.info.numberOfChannels){const t=e;e.inputTrack=new fa(new us(t)),this.tracks.push(e)}this.currentTrack=null}break;case"tkhd":{const e=this.currentTrack;s(e);const t=this.metadataReader.readU8();if(!(1&this.metadataReader.readU24()))break;if(0===t)this.metadataReader.pos+=8,e.id=this.metadataReader.readU32(),this.metadataReader.pos+=4,e.durationInMovieTimescale=this.metadataReader.readU32();else{if(1!==t)throw new Error(`Incorrect track header version ${t}.`);this.metadataReader.pos+=16,e.id=this.metadataReader.readU32(),this.metadataReader.pos+=4,e.durationInMovieTimescale=this.metadataReader.readU64()}this.metadataReader.pos+=16;const r=[this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_2_30(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_2_30(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_2_30()],i=n(V(ws(r),90));s(0===i||90===i||180===i||270===i),e.rotation=i}break;case"elst":{const e=this.currentTrack;s(e);const t=this.metadataReader.readU8();this.metadataReader.pos+=3;let r=!1,i=0;const a=this.metadataReader.readU32();for(let s=0;s<a;s++){const a=1===t?this.metadataReader.readU64():this.metadataReader.readU32(),s=1===t?this.metadataReader.readI64():this.metadataReader.readI32(),n=this.metadataReader.readFixed_16_16();if(0!==a){if(r){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(-1!==s){if(1!==n){console.warn("Unsupported edit list entry: media rate must be 1.");break}e.editListPreviousSegmentDurations=i,e.editListOffset=s,r=!0}else i+=a}}}break;case"mdhd":{const e=this.currentTrack;s(e);const t=this.metadataReader.readU8();this.metadataReader.pos+=3,0===t?(this.metadataReader.pos+=8,e.timescale=this.metadataReader.readU32(),e.durationInMediaTimescale=this.metadataReader.readU32()):1===t&&(this.metadataReader.pos+=16,e.timescale=this.metadataReader.readU32(),e.durationInMediaTimescale=this.metadataReader.readU64());let r=this.metadataReader.readU16();if(r>0){e.languageCode="";for(let t=0;t<3;t++)e.languageCode=String.fromCharCode(96+(31&r))+e.languageCode,r>>=5;U(e.languageCode)||(e.languageCode=j)}}break;case"hdlr":{const e=this.currentTrack;s(e),this.metadataReader.pos+=8;const t=this.metadataReader.readAscii(4);"vide"===t?e.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:"soun"===t&&(e.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{const r=this.currentTrack;s(r),r.sampleTableByteOffset=e,this.readContiguousBoxes(t.contentSize)}break;case"stsd":{const e=this.currentTrack;if(s(e),null===e.info||e.sampleTable)break;const t=this.metadataReader.readU8();this.metadataReader.pos+=3;const r=this.metadataReader.readU32();for(let i=0;i<r;i++){const r=this.metadataReader.pos,i=this.metadataReader.readBoxHeader(),a=i.name.toLowerCase();if("video"===e.info.type)"avc1"===a?e.info.codec="avc":"hvc1"===a||"hev1"===a?e.info.codec="hevc":"vp08"===a?e.info.codec="vp8":"vp09"===a?e.info.codec="vp9":"av01"===a?e.info.codec="av1":console.warn(`Unsupported video codec (sample entry type '${i.name}').`),this.metadataReader.pos+=24,e.info.width=this.metadataReader.readU16(),e.info.height=this.metadataReader.readU16(),this.metadataReader.pos+=50,this.readContiguousBoxes(r+i.totalSize-this.metadataReader.pos);else{"mp4a"===a||("opus"===a?e.info.codec="opus":"flac"===a?e.info.codec="flac":"twos"===a||"sowt"===a||"raw "===a||"in24"===a||"in32"===a||"fl32"===a||"fl64"===a||"lpcm"===a||"ipcm"===a||"fpcm"===a||("ulaw"===a?e.info.codec="ulaw":"alaw"===a?e.info.codec="alaw":console.warn(`Unsupported audio codec (sample entry type '${i.name}').`))),this.metadataReader.pos+=8;const s=this.metadataReader.readU16();this.metadataReader.pos+=6;let n=this.metadataReader.readU16(),o=this.metadataReader.readU16();this.metadataReader.pos+=4;let l=this.metadataReader.readU32()/65536;if(0===t&&s>0)if(1===s)this.metadataReader.pos+=4,o=8*this.metadataReader.readU32(),this.metadataReader.pos+=8;else if(2===s){this.metadataReader.pos+=4,l=this.metadataReader.readF64(),n=this.metadataReader.readU32(),this.metadataReader.pos+=4,o=this.metadataReader.readU32();const t=this.metadataReader.readU32();if(this.metadataReader.pos+=8,"lpcm"===a){const r=o+7>>3,i=Boolean(1&t),a=Boolean(2&t),s=4&t?-1:0;o>0&&o<=64&&(i?32===o&&(e.info.codec=a?"pcm-f32be":"pcm-f32"):s&1<<r-1?1===r?e.info.codec="pcm-s8":2===r?e.info.codec=a?"pcm-s16be":"pcm-s16":3===r?e.info.codec=a?"pcm-s24be":"pcm-s24":4===r&&(e.info.codec=a?"pcm-s32be":"pcm-s32"):1===r&&(e.info.codec="pcm-u8")),null===e.info.codec&&console.warn("Unsupported PCM format.")}}e.info.numberOfChannels=n,e.info.sampleRate=l,"twos"===a?8===o?e.info.codec="pcm-s8":16===o?e.info.codec="pcm-s16be":(console.warn(`Unsupported sample size ${o} for codec 'twos'.`),e.info.codec=null):"sowt"===a?8===o?e.info.codec="pcm-s8":16===o?e.info.codec="pcm-s16":(console.warn(`Unsupported sample size ${o} for codec 'sowt'.`),e.info.codec=null):"raw "===a?e.info.codec="pcm-u8":"in24"===a?e.info.codec="pcm-s24be":"in32"===a?e.info.codec="pcm-s32be":"fl32"===a?e.info.codec="pcm-f32be":"fl64"===a?e.info.codec="pcm-f64be":"ipcm"===a?e.info.codec="pcm-s16be":"fpcm"===a&&(e.info.codec="pcm-f32be"),this.readContiguousBoxes(r+i.totalSize-this.metadataReader.pos)}}}break;case"avcC":{const e=this.currentTrack;s(e&&e.info),e.info.codecDescription=this.metadataReader.readBytes(t.contentSize)}break;case"hvcC":{const e=this.currentTrack;s(e&&e.info),e.info.codecDescription=this.metadataReader.readBytes(t.contentSize)}break;case"vpcC":{const e=this.currentTrack;s(e&&"video"===e.info?.type),this.metadataReader.pos+=4;const t=this.metadataReader.readU8(),r=this.metadataReader.readU8(),i=this.metadataReader.readU8(),a=i>>4,n=i>>1&7,o=1&i,l=this.metadataReader.readU8(),c=this.metadataReader.readU8(),d=this.metadataReader.readU8();e.info.vp9CodecInfo={profile:t,level:r,bitDepth:a,chromaSubsampling:n,videoFullRangeFlag:o,colourPrimaries:l,transferCharacteristics:c,matrixCoefficients:d}}break;case"av1C":{const e=this.currentTrack;s(e&&"video"===e.info?.type),this.metadataReader.pos+=1;const t=this.metadataReader.readU8(),r=t>>5,i=31&t,a=this.metadataReader.readU8(),n=a>>7,o=a>>6&1,l=a>>4&1,c=a>>3&1,d=a>>2&1,h=3&a,u=2==r&&o?a>>5&1?12:10:o?10:8;e.info.av1CodecInfo={profile:r,level:i,tier:n,bitDepth:u,monochrome:l,chromaSubsamplingX:c,chromaSubsamplingY:d,chromaSamplePosition:h}}break;case"colr":{const e=this.currentTrack;if(s(e&&"video"===e.info?.type),"nclx"!==this.metadataReader.readAscii(4))break;const t=this.metadataReader.readU16(),r=this.metadataReader.readU16(),i=this.metadataReader.readU16(),a=Boolean(128&this.metadataReader.readU8());e.info.colorSpace={primaries:y[t],transfer:v[r],matrix:b[i],fullRange:a}}break;case"esds":{const e=this.currentTrack;s(e&&"audio"===e.info?.type),this.metadataReader.pos+=4,s(3===this.metadataReader.readU8()),this.metadataReader.readIsomVariableInteger(),this.metadataReader.pos+=2;const t=this.metadataReader.readU8(),r=!!(64&t),i=!!(32&t);if(!!(128&t)&&(this.metadataReader.pos+=2),r){const e=this.metadataReader.readU8();this.metadataReader.pos+=e}i&&(this.metadataReader.pos+=2),s(4===this.metadataReader.readU8());const a=this.metadataReader.readIsomVariableInteger(),n=this.metadataReader.pos,o=this.metadataReader.readU8();if(64===o||103===o?(e.info.codec="aac",e.info.aacCodecInfo={isMpeg2:103===o}):105===o||107===o?e.info.codec="mp3":221===o?e.info.codec="vorbis":console.warn(`Unsupported audio codec (objectTypeIndication ${o}) - discarding track.`),this.metadataReader.pos+=12,a>this.metadataReader.pos-n){s(5===this.metadataReader.readU8());const t=this.metadataReader.readIsomVariableInteger();if(e.info.codecDescription=this.metadataReader.readBytes(t),"aac"===e.info.codec){const t=xe(e.info.codecDescription);null!==t.numberOfChannels&&(e.info.numberOfChannels=t.numberOfChannels),null!==t.sampleRate&&(e.info.sampleRate=t.sampleRate)}}}break;case"enda":{const e=this.currentTrack;s(e&&"audio"===e.info?.type),255&this.metadataReader.readU16()&&("pcm-s16be"===e.info.codec?e.info.codec="pcm-s16":"pcm-s24be"===e.info.codec?e.info.codec="pcm-s24":"pcm-s32be"===e.info.codec?e.info.codec="pcm-s32":"pcm-f32be"===e.info.codec?e.info.codec="pcm-f32":"pcm-f64be"===e.info.codec&&(e.info.codec="pcm-f64"))}break;case"pcmC":{const e=this.currentTrack;s(e&&"audio"===e.info?.type),this.metadataReader.pos+=4;const t=this.metadataReader.readU8(),r=Boolean(1&t),i=this.metadataReader.readU8();"pcm-s16be"===e.info.codec?r?16===i?e.info.codec="pcm-s16":24===i?e.info.codec="pcm-s24":32===i?e.info.codec="pcm-s32":(console.warn(`Invalid ipcm sample size ${i}.`),e.info.codec=null):16===i?e.info.codec="pcm-s16be":24===i?e.info.codec="pcm-s24be":32===i?e.info.codec="pcm-s32be":(console.warn(`Invalid ipcm sample size ${i}.`),e.info.codec=null):"pcm-f32be"===e.info.codec&&(r?32===i?e.info.codec="pcm-f32":64===i?e.info.codec="pcm-f64":(console.warn(`Invalid fpcm sample size ${i}.`),e.info.codec=null):32===i?e.info.codec="pcm-f32be":64===i?e.info.codec="pcm-f64be":(console.warn(`Invalid fpcm sample size ${i}.`),e.info.codec=null));break}case"dOps":{const e=this.currentTrack;s(e&&"audio"===e.info?.type),this.metadataReader.pos+=1;const t=this.metadataReader.readU8(),r=this.metadataReader.readU16(),i=this.metadataReader.readU32(),a=this.metadataReader.readI16(),n=this.metadataReader.readU8();let o;o=0!==n?this.metadataReader.readBytes(2+t):new Uint8Array(0);const l=new Uint8Array(19+o.byteLength),c=new DataView(l.buffer);c.setUint32(0,1332770163,!1),c.setUint32(4,1214603620,!1),c.setUint8(8,1),c.setUint8(9,t),c.setUint16(10,r,!0),c.setUint32(12,i,!0),c.setInt16(16,a,!0),c.setUint8(18,n),l.set(o,19),e.info.codecDescription=l,e.info.numberOfChannels=t,e.info.sampleRate=i}break;case"dfLa":{const e=this.currentTrack;s(e&&"audio"===e.info?.type),this.metadataReader.pos+=4;const t=127,i=128,a=this.metadataReader.pos;for(;this.metadataReader.pos<r;){const r=this.metadataReader.readU8(),a=this.metadataReader.readU24();if(r&t)this.metadataReader.pos+=a;else{this.metadataReader.pos+=10;const t=this.metadataReader.readU32(),r=t>>>12,i=1+(t>>9&7);e.info.sampleRate=r,e.info.numberOfChannels=i,this.metadataReader.pos+=20}if(r&i)break}const n=this.metadataReader.pos;this.metadataReader.pos=a;const o=this.metadataReader.readBytes(n-a),l=new Uint8Array(4+o.byteLength);new DataView(l.buffer).setUint32(0,1716281667,!1),l.set(o,4),e.info.codecDescription=l}break;case"stts":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4;const t=this.metadataReader.readU32();let r=0,i=0;for(let a=0;a<t;a++){const t=this.metadataReader.readU32(),a=this.metadataReader.readU32();e.sampleTable.sampleTimingEntries.push({startIndex:r,startDecodeTimestamp:i,count:t,delta:a}),r+=t,i+=t*a}}break;case"ctts":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4;const t=this.metadataReader.readU32();let r=0;for(let i=0;i<t;i++){const t=this.metadataReader.readU32(),i=this.metadataReader.readI32();e.sampleTable.sampleCompositionTimeOffsets.push({startIndex:r,count:t,offset:i}),r+=t}}break;case"stsz":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4;const t=this.metadataReader.readU32(),r=this.metadataReader.readU32();if(0===t)for(let t=0;t<r;t++){const t=this.metadataReader.readU32();e.sampleTable.sampleSizes.push(t)}else e.sampleTable.sampleSizes.push(t)}break;case"stz2":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4,this.metadataReader.pos+=3;const t=this.metadataReader.readU8(),r=this.metadataReader.readU32(),i=this.metadataReader.readBytes(Math.ceil(r*t/8)),a=new c(i);for(let i=0;i<r;i++){const r=a.readBits(t);e.sampleTable.sampleSizes.push(r)}}break;case"stss":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4,e.sampleTable.keySampleIndices=[];const t=this.metadataReader.readU32();for(let r=0;r<t;r++){const t=this.metadataReader.readU32()-1;e.sampleTable.keySampleIndices.push(t)}}break;case"stsc":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4;const t=this.metadataReader.readU32();for(let r=0;r<t;r++){const t=this.metadataReader.readU32()-1,r=this.metadataReader.readU32(),i=this.metadataReader.readU32();e.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:t,samplesPerChunk:r,sampleDescriptionIndex:i})}let r=0;for(let t=0;t<e.sampleTable.sampleToChunk.length;t++)e.sampleTable.sampleToChunk[t].startSampleIndex=r,t<e.sampleTable.sampleToChunk.length-1&&(r+=(e.sampleTable.sampleToChunk[t+1].startChunkIndex-e.sampleTable.sampleToChunk[t].startChunkIndex)*e.sampleTable.sampleToChunk[t].samplesPerChunk)}break;case"stco":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4;const t=this.metadataReader.readU32();for(let r=0;r<t;r++){const t=this.metadataReader.readU32();e.sampleTable.chunkOffsets.push(t)}}break;case"co64":{const e=this.currentTrack;if(s(e),!e.sampleTable)break;this.metadataReader.pos+=4;const t=this.metadataReader.readU32();for(let r=0;r<t;r++){const t=this.metadataReader.readU64();e.sampleTable.chunkOffsets.push(t)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(t.contentSize);break;case"mehd":{const e=this.metadataReader.readU8();this.metadataReader.pos+=3;const t=1===e?this.metadataReader.readU64():this.metadataReader.readU32();this.movieDurationInTimescale=t}break;case"trex":{this.metadataReader.pos+=4;const e=this.metadataReader.readU32(),t=this.metadataReader.readU32(),r=this.metadataReader.readU32(),i=this.metadataReader.readU32(),a=this.metadataReader.readU32();this.fragmentTrackDefaults.push({trackId:e,defaultSampleDescriptionIndex:t,defaultSampleDuration:r,defaultSampleSize:i,defaultSampleFlags:a})}break;case"tfra":{const e=this.metadataReader.readU8();this.metadataReader.pos+=3;const t=this.metadataReader.readU32(),r=this.tracks.find((e=>e.id===t));if(!r)break;r.fragmentLookupTable=[];const i=this.metadataReader.readU32(),a=(48&i)>>4,s=(12&i)>>2,n=3&i,o=this.metadataReader,l=[o.readU8.bind(o),o.readU16.bind(o),o.readU24.bind(o),o.readU32.bind(o)],c=l[a],d=l[s],h=l[n],u=this.metadataReader.readU32();for(let t=0;t<u;t++){const t=1===e?this.metadataReader.readU64():this.metadataReader.readU32(),i=1===e?this.metadataReader.readU64():this.metadataReader.readU32();c(),d(),h(),r.fragmentLookupTable.push({timestamp:t,moofOffset:i})}}break;case"moof":this.currentFragment={moofOffset:e,moofSize:t.totalSize,implicitBaseDataOffset:e,trackData:new Map,dataStart:1/0,dataEnd:0,nextFragment:null,isKnownToBeFirstFragment:!1},this.readContiguousBoxes(t.contentSize),D(this.fragments,this.currentFragment,(e=>e.moofOffset));for(const[,e]of this.currentFragment.trackData){const t=e.samples[0],r=o(e.samples);this.currentFragment.dataStart=Math.min(this.currentFragment.dataStart,t.byteOffset),this.currentFragment.dataEnd=Math.max(this.currentFragment.dataEnd,r.byteOffset+r.byteSize)}this.currentFragment=null;break;case"traf":if(s(this.currentFragment),this.readContiguousBoxes(t.contentSize),this.currentTrack){const e=this.currentFragment.trackData.get(this.currentTrack.id);if(e){D(this.currentTrack.fragments,this.currentFragment,(e=>e.moofOffset)),null!==e.firstKeyFrameTimestamp&&D(this.currentTrack.fragmentsWithKeyFrame,this.currentFragment,(e=>e.moofOffset));const{currentFragmentState:t}=this.currentTrack;s(t),null!==t.startTimestamp&&(ys(e,t.startTimestamp),e.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{s(this.currentFragment),this.metadataReader.pos+=1;const e=this.metadataReader.readU24(),t=Boolean(1&e),r=Boolean(2&e),i=Boolean(8&e),a=Boolean(16&e),n=Boolean(32&e),o=Boolean(65536&e),l=Boolean(131072&e),c=this.metadataReader.readU32(),d=this.tracks.find((e=>e.id===c));if(!d)break;const h=this.fragmentTrackDefaults.find((e=>e.trackId===c));this.currentTrack=d,d.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:h?.defaultSampleDescriptionIndex??null,defaultSampleDuration:h?.defaultSampleDuration??null,defaultSampleSize:h?.defaultSampleSize??null,defaultSampleFlags:h?.defaultSampleFlags??null,startTimestamp:null},t?d.currentFragmentState.baseDataOffset=this.metadataReader.readU64():l&&(d.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),r&&(d.currentFragmentState.sampleDescriptionIndex=this.metadataReader.readU32()),i&&(d.currentFragmentState.defaultSampleDuration=this.metadataReader.readU32()),a&&(d.currentFragmentState.defaultSampleSize=this.metadataReader.readU32()),n&&(d.currentFragmentState.defaultSampleFlags=this.metadataReader.readU32()),o&&(d.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{const e=this.currentTrack;if(!e)break;s(e.currentFragmentState);const t=this.metadataReader.readU8();this.metadataReader.pos+=3;const r=0===t?this.metadataReader.readU32():this.metadataReader.readU64();e.currentFragmentState.startTimestamp=r}break;case"trun":{const e=this.currentTrack;if(!e)break;if(s(this.currentFragment),s(e.currentFragmentState),this.currentFragment.trackData.has(e.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}const t=this.metadataReader.readU8(),r=this.metadataReader.readU24(),i=Boolean(1&r),a=Boolean(4&r),n=Boolean(256&r),l=Boolean(512&r),c=Boolean(1024&r),d=Boolean(2048&r),h=this.metadataReader.readU32();let u=e.currentFragmentState.baseDataOffset;i&&(u+=this.metadataReader.readI32());let p=null;a&&(p=this.metadataReader.readU32());let m=u;if(0===h){this.currentFragment.implicitBaseDataOffset=m;break}let f=0;const g={startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(e.id,g);for(let r=0;r<h;r++){let i,a,o;n?i=this.metadataReader.readU32():(s(null!==e.currentFragmentState.defaultSampleDuration),i=e.currentFragmentState.defaultSampleDuration),l?a=this.metadataReader.readU32():(s(null!==e.currentFragmentState.defaultSampleSize),a=e.currentFragmentState.defaultSampleSize),c?o=this.metadataReader.readU32():(s(null!==e.currentFragmentState.defaultSampleFlags),o=e.currentFragmentState.defaultSampleFlags),0===r&&null!==p&&(o=p);let h=0;d&&(h=0===t?this.metadataReader.readU32():this.metadataReader.readI32());const u=!(65536&o);g.samples.push({presentationTimestamp:f+h,duration:i,byteOffset:m,byteSize:a,isKeyFrame:u}),m+=a,f+=i}g.presentationTimestamps=g.samples.map(((e,t)=>({presentationTimestamp:e.presentationTimestamp,sampleIndex:t}))).sort(((e,t)=>e.presentationTimestamp-t.presentationTimestamp));for(let e=0;e<g.presentationTimestamps.length;e++){const t=g.presentationTimestamps[e],r=g.samples[t.sampleIndex];if(null===g.firstKeyFrameTimestamp&&r.isKeyFrame&&(g.firstKeyFrameTimestamp=r.presentationTimestamp),e<g.presentationTimestamps.length-1){const i=g.presentationTimestamps[e+1];r.duration=i.presentationTimestamp-t.presentationTimestamp}}const y=g.samples[g.presentationTimestamps[0].sampleIndex],w=g.samples[o(g.presentationTimestamps).sampleIndex];g.startTimestamp=y.presentationTimestamp,g.endTimestamp=w.presentationTimestamp+w.duration,this.currentFragment.implicitBaseDataOffset=m}}this.metadataReader.pos=r}},ds=class{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){const e=await this.getFirstPacket({metadataOnly:!0});return e?.timestamp??0}async getFirstPacket(e){const t=await this.fetchPacketForSampleIndex(0,e);return t||!this.internalTrack.demuxer.isFragmented?t:this.performFragmentedLookup((()=>{const e=this.internalTrack.demuxer.fragments[0]??null;if(e?.isKnownToBeFirstFragment){let t=e;for(;t;){if(t.trackData.get(this.internalTrack.id))return{fragmentIndex:M(this.internalTrack.fragments,t.moofOffset,(e=>e.moofOffset)),sampleIndex:0,correctSampleFound:!0};t=t.nextFragment}}return{fragmentIndex:-1,sampleIndex:-1,correctSampleFound:!1}}),-1/0,1/0,e)}mapTimestampIntoTimescale(e){return z(e*this.internalTrack.timescale,14)+this.internalTrack.editListOffset}async getPacket(e,t){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),a=ps(i,r),s=await this.fetchPacketForSampleIndex(a,t);return vs(i)&&this.internalTrack.demuxer.isFragmented?this.performFragmentedLookup((()=>this.findSampleInFragmentsForTimestamp(r)),r,r,t):s}async getNextPacket(e,t){const r=this.packetToSampleIndex.get(e);if(void 0!==r)return this.fetchPacketForSampleIndex(r+1,t);const i=this.packetToFragmentLocation.get(e);if(void 0===i)throw new Error("Packet was not created from this track.");const a=i.fragment.trackData.get(this.internalTrack.id),n=M(this.internalTrack.fragments,i.fragment.moofOffset,(e=>e.moofOffset));return s(-1!==n),this.performFragmentedLookup((()=>{if(i.sampleIndex+1<a.samples.length)return{fragmentIndex:n,sampleIndex:i.sampleIndex+1,correctSampleFound:!0};{let e=i.fragment;for(;e.nextFragment;)if(e=e.nextFragment,e.trackData.get(this.internalTrack.id)){const t=M(this.internalTrack.fragments,e.moofOffset,(e=>e.moofOffset));return s(-1!==t),{fragmentIndex:t,sampleIndex:0,correctSampleFound:!0}}return{fragmentIndex:n,sampleIndex:-1,correctSampleFound:!1}}}),-1/0,1/0,t)}async getKeyPacket(e,t){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),a=ps(i,r),s=-1===a?-1:fs(i,a),n=await this.fetchPacketForSampleIndex(s,t);return vs(i)&&this.internalTrack.demuxer.isFragmented?this.performFragmentedLookup((()=>this.findKeySampleInFragmentsForTimestamp(r)),r,r,t):n}async getNextKeyPacket(e,t){const r=this.packetToSampleIndex.get(e);if(void 0!==r){const e=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=gs(e,r);return this.fetchPacketForSampleIndex(i,t)}const i=this.packetToFragmentLocation.get(e);if(void 0===i)throw new Error("Packet was not created from this track.");const a=i.fragment.trackData.get(this.internalTrack.id),n=M(this.internalTrack.fragments,i.fragment.moofOffset,(e=>e.moofOffset));return s(-1!==n),this.performFragmentedLookup((()=>{const e=a.samples.findIndex(((e,t)=>e.isKeyFrame&&t>i.sampleIndex));if(-1!==e)return{fragmentIndex:n,sampleIndex:e,correctSampleFound:!0};{let e=i.fragment;for(;e.nextFragment;){e=e.nextFragment;const t=e.trackData.get(this.internalTrack.id);if(t&&null!==t.firstKeyFrameTimestamp){const r=M(this.internalTrack.fragments,e.moofOffset,(e=>e.moofOffset));s(-1!==r);const i=t.samples.findIndex((e=>e.isKeyFrame));return s(-1!==i),{fragmentIndex:r,sampleIndex:i,correctSampleFound:!0}}}return{fragmentIndex:n,sampleIndex:-1,correctSampleFound:!1}}}),-1/0,1/0,t)}async fetchPacketForSampleIndex(e,t){if(-1===e)return null;const r=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=ms(r,e);if(!i)return null;let a;t.metadataOnly?a=Ui:(await this.internalTrack.demuxer.chunkReader.reader.loadRange(i.chunkOffset,i.chunkOffset+i.chunkSize),this.internalTrack.demuxer.chunkReader.pos=i.sampleOffset,a=this.internalTrack.demuxer.chunkReader.readBytes(i.sampleSize));const s=(i.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,n=i.duration/this.internalTrack.timescale,o=new Ni(a,i.isKeyFrame?"key":"delta",s,n,e,i.sampleSize);return this.packetToSampleIndex.set(o,e),o}async fetchPacketInFragment(e,t,r){if(-1===t)return null;const i=e.trackData.get(this.internalTrack.id).samples[t];let a;s(i),r.metadataOnly?a=Ui:(await this.internalTrack.demuxer.chunkReader.reader.loadRange(e.dataStart,e.dataEnd),this.internalTrack.demuxer.chunkReader.pos=i.byteOffset,a=this.internalTrack.demuxer.chunkReader.readBytes(i.byteSize));const n=(i.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,o=i.duration/this.internalTrack.timescale,l=new Ni(a,i.isKeyFrame?"key":"delta",n,o,e.moofOffset+t,i.byteSize);return this.packetToFragmentLocation.set(l,{fragment:e,sampleIndex:t}),l}findSampleInFragmentsForTimestamp(e){const t=R(this.internalTrack.fragments,e,(e=>e.trackData.get(this.internalTrack.id).startTimestamp));let r=-1,i=!1;if(-1!==t){const a=this.internalTrack.fragments[t].trackData.get(this.internalTrack.id),n=R(a.presentationTimestamps,e,(e=>e.presentationTimestamp));s(-1!==n),r=a.presentationTimestamps[n].sampleIndex,i=e<a.endTimestamp}return{fragmentIndex:t,sampleIndex:r,correctSampleFound:i}}findKeySampleInFragmentsForTimestamp(e){const t=R(this.internalTrack.fragmentsWithKeyFrame,e,(e=>e.trackData.get(this.internalTrack.id).startTimestamp));let r=-1,i=-1,a=!1;if(-1!==t){const n=this.internalTrack.fragmentsWithKeyFrame[t];r=M(this.internalTrack.fragments,n.moofOffset,(e=>e.moofOffset)),s(-1!==r);const o=n.trackData.get(this.internalTrack.id),l=I(o.presentationTimestamps,(t=>o.samples[t.sampleIndex].isKeyFrame&&t.presentationTimestamp<=e));s(-1!==l),i=o.presentationTimestamps[l].sampleIndex,a=e<o.endTimestamp}return{fragmentIndex:r,sampleIndex:i,correctSampleFound:a}}async performFragmentedLookup(e,t,r,i){const a=this.internalTrack.demuxer,s=await a.fragmentLookupMutex.acquire();try{const{fragmentIndex:s,sampleIndex:n,correctSampleFound:o}=e();if(o){const e=this.internalTrack.fragments[s];return this.fetchPacketInFragment(e,n,i)}const l=a.metadataReader,c=await l.reader.source.getSize();let d=null,h=s,u=n;const p=this.internalTrack.fragmentLookupTable?R(this.internalTrack.fragmentLookupTable,t,(e=>e.timestamp)):-1,m=-1!==p?this.internalTrack.fragmentLookupTable[p]:null;let f=!1;if(-1===s)l.pos=m?.moofOffset??0,f=0===l.pos;else{const e=this.internalTrack.fragments[s];!m||e.moofOffset>=m.moofOffset?(l.pos=e.moofOffset+e.moofSize,d=e):l.pos=m.moofOffset}for(;l.pos<c;){if(d){const e=d.trackData.get(this.internalTrack.id);if(e&&e.startTimestamp>r)break;if(d.nextFragment){l.pos=d.nextFragment.moofOffset+d.nextFragment.moofSize,d=d.nextFragment;continue}}await l.reader.loadRange(l.pos,l.pos+16);const t=l.pos,s=l.readBoxHeader();if("moof"===s.name){const r=M(a.fragments,t,(e=>e.moofOffset));let s;-1===r?(l.pos=t,s=await a.readFragment()):s=a.fragments[r],d&&(d.nextFragment=s),d=s,f&&(s.isKnownToBeFirstFragment=!0,f=!1);const{fragmentIndex:n,sampleIndex:o,correctSampleFound:c}=e();if(c){const e=this.internalTrack.fragments[n];return this.fetchPacketInFragment(e,o,i)}-1!==n&&(h=n,u=o)}l.pos=t+s.totalSize}let g=null;const y=-1!==h?this.internalTrack.fragments[h]:null;if(y&&(g=await this.fetchPacketInFragment(y,u,i)),!g&&m&&(!y||y.moofOffset<m.moofOffset)){const t=this.internalTrack.fragmentLookupTable[p-1],a=t?.timestamp??-1/0;return this.performFragmentedLookup(e,a,r,i)}return g}finally{s()}}},hs=class extends ds{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if("vp9"!==this.internalTrack.info.codec||this.internalTrack.info.vp9CodecInfo){if("av1"===this.internalTrack.info.codec&&!this.internalTrack.info.av1CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&St(e.data)}}else{const e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&xt(e.data)}return{codec:ye(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}},us=class extends ds{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:ve(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}},ps=(e,t)=>{if(e.presentationTimestamps){const r=R(e.presentationTimestamps,t,(e=>e.presentationTimestamp));return-1===r?-1:e.presentationTimestamps[r].sampleIndex}{const r=R(e.sampleTimingEntries,t,(e=>e.startDecodeTimestamp));if(-1===r)return-1;const i=e.sampleTimingEntries[r];return i.startIndex+Math.min(Math.floor((t-i.startDecodeTimestamp)/i.delta),i.count-1)}},ms=(e,t)=>{const r=R(e.sampleTimingEntries,t,(e=>e.startIndex)),i=e.sampleTimingEntries[r];if(!i||i.startIndex+i.count<=t)return null;let a=i.startDecodeTimestamp+(t-i.startIndex)*i.delta;const n=R(e.sampleCompositionTimeOffsets,t,(e=>e.startIndex)),o=e.sampleCompositionTimeOffsets[n];o&&t-o.startIndex<o.count&&(a+=o.offset);const l=e.sampleSizes[Math.min(t,e.sampleSizes.length-1)],c=R(e.sampleToChunk,t,(e=>e.startSampleIndex)),d=e.sampleToChunk[c];s(d);const h=d.startChunkIndex+Math.floor((t-d.startSampleIndex)/d.samplesPerChunk),u=e.chunkOffsets[h],p=d.startSampleIndex+(h-d.startChunkIndex)*d.samplesPerChunk;let m=0,f=u;if(1===e.sampleSizes.length)f+=l*(t-p),m+=l*d.samplesPerChunk;else for(let r=p;r<p+d.samplesPerChunk;r++){const i=e.sampleSizes[r];r<t&&(f+=i),m+=i}let g=i.delta;if(e.presentationTimestamps){const r=e.presentationTimestampIndexMap[t];s(void 0!==r),r<e.presentationTimestamps.length-1&&(g=e.presentationTimestamps[r+1].presentationTimestamp-a)}return{presentationTimestamp:a,duration:g,sampleOffset:f,sampleSize:l,chunkOffset:u,chunkSize:m,isKeyFrame:!e.keySampleIndices||-1!==M(e.keySampleIndices,t,(e=>e))}},fs=(e,t)=>{if(!e.keySampleIndices)return t;const r=R(e.keySampleIndices,t,(e=>e));return e.keySampleIndices[r]??-1},gs=(e,t)=>{if(!e.keySampleIndices)return t+1;const r=R(e.keySampleIndices,t,(e=>e));return e.keySampleIndices[r+1]??-1},ys=(e,t)=>{e.startTimestamp+=t,e.endTimestamp+=t;for(const r of e.samples)r.presentationTimestamp+=t;for(const r of e.presentationTimestamps)r.presentationTimestamp+=t},ws=e=>{const[t,,,r]=e,i=Math.hypot(t,r),a=t/i,s=r/i;return-Math.atan2(s,a)*(180/Math.PI)},vs=e=>0===e.sampleSizes.length,xs=[{id:290298740,flag:"seekHeadSeen"},{id:357149030,flag:"infoSeen"},{id:374648427,flag:"tracksSeen"},{id:475249515,flag:"cuesSeen"}],bs=class extends $i{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentCueTime=null,this.isWebM=!1,this.metadataReader=new mi(e._mainReader),this.clusterReader=new mi(new ga(e.source,67108864))}async computeDuration(){const e=await this.getTracks(),t=await Promise.all(e.map((e=>e.computeDuration())));return Math.max(0,...t)}async getTracks(){return await this.readMetadata(),this.segments.flatMap((e=>e.tracks.map((e=>e.inputTrack))))}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),t=await Promise.all(e.map((e=>e.getCodecParameterString())));return wi({isWebM:this.isWebM,hasVideo:this.segments.some((e=>e.tracks.some((e=>"video"===e.info?.type)))),hasAudio:this.segments.some((e=>e.tracks.some((e=>"audio"===e.info?.type)))),codecStrings:t.filter(Boolean)})}readMetadata(){return this.readMetadataPromise??=(async()=>{this.metadataReader.pos=0;const e=await this.input.source.getSize();for(;this.metadataReader.pos<=e-2;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+pi);const t=this.metadataReader.readElementHeader(),r=t.id;let i=t.size;const a=this.metadataReader.pos;if(440786851===r)yi(i),await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+i),this.readContiguousElements(this.metadataReader,i);else if(408125543===r){if(await this.readSegment(i),null===i)break}else if(524531317===r){null===i&&(i=(await this.clusterReader.searchForNextElementId(ci,e)??e)-a);const t=o(this.segments);t&&(t.elementEndPos=a+i)}yi(i),this.metadataReader.pos=a+i}})()}async readSegment(e){const t=this.metadataReader.pos;this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:t,elementEndPos:null===e?await this.input.source.getSize():t+e,clusterSeekStartPos:t,clusters:[],clusterLookupMutex:new C},this.segments.push(this.currentSegment),await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+16384);let r=!1;for(;this.metadataReader.pos<this.currentSegment.elementEndPos;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+pi);const e=this.metadataReader.pos,{id:t,size:i}=this.metadataReader.readElementHeader(),a=this.metadataReader.pos,s=xs.findIndex((e=>e.id===t));if(-1!==s){const e=xs[s].flag;this.currentSegment[e]=!0,yi(i),await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+i),this.readContiguousElements(this.metadataReader,i)}else 524531317===t&&(r||(r=!0,this.currentSegment.clusterSeekStartPos=e));if(this.currentSegment.infoSeen&&this.currentSegment.tracksSeen&&this.currentSegment.cuesSeen)break;if(this.currentSegment.seekHeadSeen){let e=this.currentSegment.infoSeen,t=this.currentSegment.tracksSeen,r=this.currentSegment.cuesSeen;for(const i of this.currentSegment.seekEntries)357149030===i.id?e=!0:374648427===i.id?t=!0:475249515===i.id&&(r=!0);if(e&&t&&r)break}if(null===i)break;this.metadataReader.pos=a+i,r||(this.currentSegment.clusterSeekStartPos=this.metadataReader.pos)}for(const e of xs){if(this.currentSegment[e.flag])continue;const r=this.currentSegment.seekEntries.find((t=>t.id===e.id));if(!r)continue;this.metadataReader.pos=t+r.segmentPosition,await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+4096);const{id:i,size:a}=this.metadataReader.readElementHeader();i===e.id&&(yi(a),this.currentSegment[e.flag]=!0,await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+a),this.readContiguousElements(this.metadataReader,a))}-1===this.currentSegment.timestampScale&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e3),this.currentSegment.tracks.sort(((e,t)=>Number(t.isDefault)-Number(e.isDefault))),this.currentSegment.cuePoints.sort(((e,t)=>e.clusterPosition-t.clusterPosition));const i=this.currentSegment.tracks.map((e=>e.id)),a=new Set;let n=null,o=null;for(const e of this.currentSegment.cuePoints){if(e.clusterPosition!==n){for(const e of a)s(o),this.currentSegment.tracks.find((t=>t.id===e)).cuePoints.push(o);for(const e of i)a.add(e)}(o=e,a.has(e.trackId))&&(this.currentSegment.tracks.find((t=>t.id===e.trackId)).cuePoints.push(e),a.delete(e.trackId),n=e.clusterPosition)}for(const e of a)s(o),this.currentSegment.tracks.find((t=>t.id===e)).cuePoints.push(o);for(const e of this.currentSegment.tracks)e.cuePoints.sort(((e,t)=>e.time-t.time));this.currentSegment=null}async readCluster(e){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+pi);const t=this.metadataReader.pos,r=this.metadataReader.readElementHeader(),i=r.id;let a=r.size;const n=this.metadataReader.pos;null===a&&(this.clusterReader.pos=n,a=(await this.clusterReader.searchForNextElementId(ci,e.elementEndPos)??e.elementEndPos)-n),s(524531317===i),this.clusterReader.pos=n,await this.clusterReader.reader.loadRange(this.clusterReader.pos,this.clusterReader.pos+a);const l={elementStartPos:t,elementEndPos:n+a,dataStartPos:n,timestamp:-1,trackData:new Map,nextCluster:null,isKnownToBeFirstCluster:!1};this.currentCluster=l,this.readContiguousElements(this.clusterReader,a);for(const[t,r]of l.trackData){const i=e.tracks.find((e=>e.id===t))??null;s(r.blocks.length>0);let a=!1,n=!1;for(let e=0;e<r.blocks.length;e++){const t=r.blocks[e];t.timestamp+=l.timestamp,a||=t.referencedTimestamps.length>0,n||=0!==t.lacing}a&&(r.blocks=ks(r.blocks)),r.presentationTimestamps=r.blocks.map(((e,t)=>({timestamp:e.timestamp,blockIndex:t}))).sort(((e,t)=>e.timestamp-t.timestamp));for(let e=0;e<r.presentationTimestamps.length;e++){const t=r.presentationTimestamps[e],a=r.blocks[t.blockIndex];if(null===r.firstKeyFrameTimestamp&&a.isKeyFrame&&(r.firstKeyFrameTimestamp=a.timestamp),e<r.presentationTimestamps.length-1){const t=r.presentationTimestamps[e+1];a.duration=t.timestamp-a.timestamp}else 0===a.duration&&null!=i?.defaultDuration&&0===a.lacing&&(a.duration=i.defaultDuration)}n&&(this.expandLacedBlocks(r.blocks,i),r.presentationTimestamps=r.blocks.map(((e,t)=>({timestamp:e.timestamp,blockIndex:t}))).sort(((e,t)=>e.timestamp-t.timestamp)));const c=r.blocks[r.presentationTimestamps[0].blockIndex],d=r.blocks[o(r.presentationTimestamps).blockIndex];r.startTimestamp=c.timestamp,r.endTimestamp=d.timestamp+d.duration,i&&(D(i.clusters,l,(e=>e.elementStartPos)),null!==r.firstKeyFrameTimestamp&&D(i.clustersWithKeyFrame,l,(e=>e.elementStartPos)))}return D(e.clusters,l,(e=>e.elementStartPos)),this.currentCluster=null,l}getTrackDataInCluster(e,t){let r=e.trackData.get(t);return r||(r={startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(t,r)),r}expandLacedBlocks(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(0===i.lacing)continue;const a=i.data;let n=0;const o=[],l=a[n]+1;switch(n++,i.lacing){case 1:{let e=0;for(let t=0;t<l-1;t++){let t=0;for(;n<a.length;){const r=a[n];if(t+=r,n++,r<255){o.push(t),e+=t;break}}}o.push(a.length-(n+e))}break;case 2:{const e=a.length-1,t=Math.floor(e/l);for(let e=0;e<l;e++)o.push(t)}break;case 3:{const e=gi(a,n);let t=e.value;o.push(t),n+=e.width;let r=t;for(let e=1;e<l-1;e++){const e=gi(a,n);t+=e.value-((1<<7*e.width-1)-1),o.push(t),n+=e.width,r+=t}o.push(a.length-(n+r))}break;default:s(!1)}s(o.length===l),e.splice(r,1);let c=n;for(let s=0;s<l;s++){const n=o[s],d=a.subarray(c,c+n),h=i.duration||l*(t?.defaultDuration??0),u=i.timestamp+h*s/l,p=h/l;e.splice(r+s,0,{timestamp:u,duration:p,isKeyFrame:i.isKeyFrame,referencedTimestamps:i.referencedTimestamps,data:d,lacing:0}),c+=n}r+=l,r--}}readContiguousElements(e,t){const r=e.pos;for(;e.pos-r<=t-2;)this.traverseElement(e)}traverseElement(e){const{id:t,size:r}=e.readElementHeader(),i=e.pos;switch(yi(r),t){case 17026:this.isWebM="webm"===e.readString(r);break;case 19899:{if(!this.currentSegment)break;const t={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(t),this.readContiguousElements(e,r),-1!==t.id&&-1!==t.segmentPosition||this.currentSegment.seekEntries.pop()}break;case 21419:{const t=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!t)break;t.id=e.readUnsignedInt(r)}break;case 21420:{const t=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!t)break;t.segmentPosition=e.readUnsignedInt(r)}break;case 2807729:if(!this.currentSegment)break;this.currentSegment.timestampScale=e.readUnsignedInt(r),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale;break;case 17545:if(!this.currentSegment)break;this.currentSegment.duration=e.readFloat(r);break;case 174:if(!this.currentSegment)break;if(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusters:[],clustersWithKeyFrame:[],cuePoints:[],isDefault:!1,inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,languageCode:j,info:null},this.readContiguousElements(e,r),this.currentTrack&&-1!==this.currentTrack.id&&this.currentTrack.codecId&&this.currentTrack.info){const e=this.currentTrack.codecId.indexOf("/"),t=-1===e?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,e);if("video"===this.currentTrack.info.type&&-1!==this.currentTrack.info.width&&-1!==this.currentTrack.info.height){this.currentTrack.codecId===fi.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===fi.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===fi.vp8?this.currentTrack.info.codec="vp8":t===fi.vp9?this.currentTrack.info.codec="vp9":t===fi.av1&&(this.currentTrack.info.codec="av1");const e=this.currentTrack,r=new ma(new Ts(e));this.currentTrack.inputTrack=r,this.currentSegment.tracks.push(this.currentTrack)}else if("audio"===this.currentTrack.info.type&&-1!==this.currentTrack.info.numberOfChannels&&-1!==this.currentTrack.info.sampleRate){t===fi.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2")},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===fi.mp3?this.currentTrack.info.codec="mp3":t===fi.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===fi.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===fi.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):"A_PCM/INT/LIT"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32"):"A_PCM/INT/BIG"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16be":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24be":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32be"):"A_PCM/FLOAT/IEEE"===this.currentTrack.codecId&&(32===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-f32":64===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-f64"));const e=this.currentTrack,r=new fa(new Cs(e));this.currentTrack.inputTrack=r,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null;break;case 215:if(!this.currentTrack)break;this.currentTrack.id=e.readUnsignedInt(r);break;case 131:{if(!this.currentTrack)break;const t=e.readUnsignedInt(r);1===t?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null}:2===t&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case 185:if(!this.currentTrack)break;e.readUnsignedInt(r)||(this.currentSegment.tracks.pop(),this.currentTrack=null);break;case 136:if(!this.currentTrack)break;this.currentTrack.isDefault=!!e.readUnsignedInt(r);break;case 134:if(!this.currentTrack)break;this.currentTrack.codecId=e.readString(r);break;case 25506:if(!this.currentTrack)break;this.currentTrack.codecPrivate=e.readBytes(r);break;case 2352003:if(!this.currentTrack)break;this.currentTrack.defaultDuration=this.currentTrack.segment.timestampFactor*e.readUnsignedInt(r)/1e9;break;case 2274716:if(!this.currentTrack)break;this.currentTrack.languageCode=e.readString(r),U(this.currentTrack.languageCode)||(this.currentTrack.languageCode=j);break;case 224:case 30320:if("video"!==this.currentTrack?.info?.type)break;this.readContiguousElements(e,r);break;case 176:if("video"!==this.currentTrack?.info?.type)break;this.currentTrack.info.width=e.readUnsignedInt(r);break;case 186:if("video"!==this.currentTrack?.info?.type)break;this.currentTrack.info.height=e.readUnsignedInt(r);break;case 21936:if("video"!==this.currentTrack?.info?.type)break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e,r);break;case 21937:{if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;const t=e.readUnsignedInt(r),i=b[t]??null;this.currentTrack.info.colorSpace.matrix=i}break;case 21945:if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=2===e.readUnsignedInt(r);break;case 21946:{if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;const t=e.readUnsignedInt(r),i=v[t]??null;this.currentTrack.info.colorSpace.transfer=i}break;case 21947:{if("video"!==this.currentTrack?.info?.type||!this.currentTrack.info.colorSpace)break;const t=e.readUnsignedInt(r),i=y[t]??null;this.currentTrack.info.colorSpace.primaries=i}break;case 30325:{if("video"!==this.currentTrack?.info?.type)break;const t=-e.readFloat(r);try{this.currentTrack.info.rotation=n(t)}catch{}}break;case 225:if("audio"!==this.currentTrack?.info?.type)break;this.readContiguousElements(e,r);break;case 181:if("audio"!==this.currentTrack?.info?.type)break;this.currentTrack.info.sampleRate=e.readFloat(r);break;case 159:if("audio"!==this.currentTrack?.info?.type)break;this.currentTrack.info.numberOfChannels=e.readUnsignedInt(r);break;case 25188:if("audio"!==this.currentTrack?.info?.type)break;this.currentTrack.info.bitDepth=e.readUnsignedInt(r);break;case 187:if(!this.currentSegment)break;this.readContiguousElements(e,r),this.currentCueTime=null;break;case 179:this.currentCueTime=e.readUnsignedInt(r);break;case 183:{if(null===this.currentCueTime)break;s(this.currentSegment);const t={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(t),this.readContiguousElements(e,r),-1!==t.trackId&&-1!==t.clusterPosition||this.currentSegment.cuePoints.pop()}break;case 247:{const t=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!t)break;t.trackId=e.readUnsignedInt(r)}break;case 241:{const t=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!t)break;s(this.currentSegment),t.clusterPosition=this.currentSegment.dataStartPos+e.readUnsignedInt(r)}break;case 231:if(!this.currentCluster)break;this.currentCluster.timestamp=e.readUnsignedInt(r);break;case 163:{if(!this.currentCluster)break;const t=e.readVarInt(),a=e.readS16(),s=e.readU8(),n=!!(128&s),o=s>>1&3;this.getTrackDataInCluster(this.currentCluster,t).blocks.push({timestamp:a,duration:0,isKeyFrame:n,referencedTimestamps:[],data:e.readBytes(r-(e.pos-i)),lacing:o})}break;case 160:if(!this.currentCluster)break;if(this.readContiguousElements(e,r),this.currentBlock){for(let e=0;e<this.currentBlock.referencedTimestamps.length;e++)this.currentBlock.referencedTimestamps[e]+=this.currentBlock.timestamp;this.currentBlock=null}break;case 161:{if(!this.currentCluster)break;const t=e.readVarInt(),a=e.readS16(),s=e.readU8()>>1&3,n=this.getTrackDataInCluster(this.currentCluster,t);this.currentBlock={timestamp:a,duration:0,isKeyFrame:!0,referencedTimestamps:[],data:e.readBytes(r-(e.pos-i)),lacing:s},n.blocks.push(this.currentBlock)}break;case 155:if(!this.currentBlock)break;this.currentBlock.duration=e.readUnsignedInt(r);break;case 251:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1;const t=e.readSignedInt(r);this.currentBlock.referencedTimestamps.push(t)}}e.pos=i+r}},Ss=class{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){const e=await this.getFirstPacket({metadataOnly:!0});return e?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}async getFirstPacket(e){return this.performClusterLookup((()=>{const e=this.internalTrack.segment.clusters[0]??null;if(e?.isKnownToBeFirstCluster){let t=e;for(;t;){if(t.trackData.get(this.internalTrack.id))return{clusterIndex:M(this.internalTrack.clusters,t.elementStartPos,(e=>e.elementStartPos)),blockIndex:0,correctBlockFound:!0};t=t.nextCluster}}return{clusterIndex:-1,blockIndex:-1,correctBlockFound:!1}}),-1/0,1/0,e)}intoTimescale(e){return z(e*this.internalTrack.segment.timestampFactor,14)}async getPacket(e,t){const r=this.intoTimescale(e);return this.performClusterLookup((()=>this.findBlockInClustersForTimestamp(r)),r,r,t)}async getNextPacket(e,t){const r=this.packetToClusterLocation.get(e);if(void 0===r)throw new Error("Packet was not created from this track.");const i=r.cluster.trackData.get(this.internalTrack.id),a=M(this.internalTrack.clusters,r.cluster.elementStartPos,(e=>e.elementStartPos));return s(-1!==a),this.performClusterLookup((()=>{if(r.blockIndex+1<i.blocks.length)return{clusterIndex:a,blockIndex:r.blockIndex+1,correctBlockFound:!0};{let e=r.cluster;for(;e.nextCluster;)if(e=e.nextCluster,e.trackData.get(this.internalTrack.id)){const t=M(this.internalTrack.clusters,e.elementStartPos,(e=>e.elementStartPos));return s(-1!==t),{clusterIndex:t,blockIndex:0,correctBlockFound:!0}}return{clusterIndex:a,blockIndex:-1,correctBlockFound:!1}}}),-1/0,1/0,t)}async getKeyPacket(e,t){const r=this.intoTimescale(e);return this.performClusterLookup((()=>this.findKeyBlockInClustersForTimestamp(r)),r,r,t)}async getNextKeyPacket(e,t){const r=this.packetToClusterLocation.get(e);if(void 0===r)throw new Error("Packet was not created from this track.");const i=r.cluster.trackData.get(this.internalTrack.id),a=M(this.internalTrack.clusters,r.cluster.elementStartPos,(e=>e.elementStartPos));return s(-1!==a),this.performClusterLookup((()=>{const e=i.blocks.findIndex(((e,t)=>e.isKeyFrame&&t>r.blockIndex));if(-1!==e)return{clusterIndex:a,blockIndex:e,correctBlockFound:!0};{let e=r.cluster;for(;e.nextCluster;){e=e.nextCluster;const t=e.trackData.get(this.internalTrack.id);if(t&&null!==t.firstKeyFrameTimestamp){const r=M(this.internalTrack.clusters,e.elementStartPos,(e=>e.elementStartPos));s(-1!==r);const i=t.blocks.findIndex((e=>e.isKeyFrame));return s(-1!==i),{clusterIndex:r,blockIndex:i,correctBlockFound:!0}}}return{clusterIndex:a,blockIndex:-1,correctBlockFound:!1}}}),-1/0,1/0,t)}async fetchPacketInCluster(e,t,r){if(-1===t)return null;const i=e.trackData.get(this.internalTrack.id).blocks[t];s(i);const a=r.metadataOnly?Ui:i.data,n=i.timestamp/this.internalTrack.segment.timestampFactor,o=i.duration/this.internalTrack.segment.timestampFactor,l=new Ni(a,i.isKeyFrame?"key":"delta",n,o,e.dataStartPos+t,i.data.byteLength);return this.packetToClusterLocation.set(l,{cluster:e,blockIndex:t}),l}findBlockInClustersForTimestamp(e){const t=R(this.internalTrack.clusters,e,(e=>e.trackData.get(this.internalTrack.id).startTimestamp));let r=-1,i=!1;if(-1!==t){const a=this.internalTrack.clusters[t].trackData.get(this.internalTrack.id),n=R(a.presentationTimestamps,e,(e=>e.timestamp));s(-1!==n),r=a.presentationTimestamps[n].blockIndex,i=e<a.endTimestamp}return{clusterIndex:t,blockIndex:r,correctBlockFound:i}}findKeyBlockInClustersForTimestamp(e){const t=R(this.internalTrack.clustersWithKeyFrame,e,(e=>e.trackData.get(this.internalTrack.id).firstKeyFrameTimestamp));let r=-1,i=-1,a=!1;if(-1!==t){const n=this.internalTrack.clustersWithKeyFrame[t];r=M(this.internalTrack.clusters,n.elementStartPos,(e=>e.elementStartPos)),s(-1!==r);const o=n.trackData.get(this.internalTrack.id),l=I(o.presentationTimestamps,(t=>o.blocks[t.blockIndex].isKeyFrame&&t.timestamp<=e));s(-1!==l),i=o.presentationTimestamps[l].blockIndex,a=e<o.endTimestamp}return{clusterIndex:r,blockIndex:i,correctBlockFound:a}}async performClusterLookup(e,t,r,i){const{demuxer:a,segment:n}=this.internalTrack,o=await n.clusterLookupMutex.acquire();try{const{clusterIndex:o,blockIndex:l,correctBlockFound:c}=e();if(c){const e=this.internalTrack.clusters[o];return this.fetchPacketInCluster(e,l,i)}const d=a.metadataReader,h=a.clusterReader;let u=null,p=o,m=l;const f=R(this.internalTrack.cuePoints,t,(e=>e.time)),g=-1!==f?this.internalTrack.cuePoints[f]:null;let y=!1;if(-1===o)d.pos=g?.clusterPosition??n.clusterSeekStartPos,y=d.pos===n.clusterSeekStartPos;else{const e=this.internalTrack.clusters[o];!g||e.elementStartPos>=g.clusterPosition?(d.pos=e.elementEndPos,u=e):d.pos=g.clusterPosition}for(;d.pos<n.elementEndPos;){if(u){const e=u.trackData.get(this.internalTrack.id);if(e&&e.startTimestamp>r)break;if(u.nextCluster){d.pos=u.nextCluster.elementEndPos,u=u.nextCluster;continue}}await d.reader.loadRange(d.pos,d.pos+pi);const t=d.pos,o=d.readElementHeader(),l=o.id;let c=o.size;const f=d.pos;if(524531317===l){const r=M(n.clusters,t,(e=>e.elementStartPos));let s;-1===r?(d.pos=t,s=await a.readCluster(n)):s=n.clusters[r],u&&(u.nextCluster=s),u=s,y&&(s.isKnownToBeFirstCluster=!0,y=!1);const{clusterIndex:o,blockIndex:l,correctBlockFound:c}=e();if(c){const e=this.internalTrack.clusters[o];return this.fetchPacketInCluster(e,l,i)}-1!==o&&(p=o,m=l)}if(null===c){524531317===l?(s(u),c=u.elementEndPos-f):(h.pos=f,c=(await h.searchForNextElementId(ci,n.elementEndPos)??n.elementEndPos)-f);const e=f+c;if(e>n.elementEndPos-2)break;if(h.pos=e,408125543===h.readElementId()){n.elementEndPos=e;break}}d.pos=f+c}let w=null;const v=-1!==p?this.internalTrack.clusters[p]:null;if(v&&(w=await this.fetchPacketInCluster(v,m,i)),!w&&g&&(!v||v.elementStartPos<g.clusterPosition)){const t=this.internalTrack.cuePoints[f-1],a=t?.time??-1/0;return this.performClusterLookup(e,a,r,i)}return w}finally{o()}}},Ts=class extends Ss{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return("vp9"===this.internalTrack.info.codec||"av1"===this.internalTrack.info.codec||"avc"===this.internalTrack.info.codec&&!this.internalTrack.info.codecDescription||"hevc"===this.internalTrack.info.codec&&!this.internalTrack.info.codecDescription)&&(e=await this.getFirstPacket({})),{codec:ye({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcCodecInfo:"avc"===this.internalTrack.info.codec&&e?dt(e.data):null,hevcCodecInfo:"hevc"===this.internalTrack.info.codec&&e?ut(e.data):null,vp9CodecInfo:"vp9"===this.internalTrack.info.codec&&e?xt(e.data):null,av1CodecInfo:"av1"===this.internalTrack.info.codec&&e?St(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}},Cs=class extends Ss{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:ve({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}},ks=e=>{const t=new Map;for(let r=0;r<e.length;r++){const i=e[r];t.set(i.timestamp,i)}const r=new Set,i=[],a=e=>{if(!r.has(e)){r.add(e);for(let r=0;r<e.referencedTimestamps.length;r++){const i=e.referencedTimestamps[r],s=t.get(i);s&&a(s)}i.push(e)}};for(let t=0;t<e.length;t++)a(e[t]);return i},Ps=class{constructor(e){this.reader=e,this.pos=0,this.fileSize=null}readBytes(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU16(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getUint16(t,!1)}readU32(){const{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,!1)}readAscii(e){const{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let i="";for(let a=0;a<e;a++)i+=String.fromCharCode(t.getUint8(r+a));return i}readId3(){return"ID3"!==this.readAscii(3)?(this.pos-=3,null):(this.pos+=3,{size:Ms(this.readU32())})}readNextFrameHeader(e){for(s(this.fileSize),e??=this.fileSize;this.pos<=e-4;){const e=this.readU32();this.pos-=4;const t=Di(e,this);if(t)return t}return null}},Ms=e=>{let t=2130706432,r=0;for(;0!==t;)r>>=1,r|=e&t,t>>=8;return r},Rs=class extends $i{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.loadingMutex=new C,this.lastLoadedPos=0,this.fileSize=0,this.nextTimestampInSamples=0,this.reader=new Ps(e._mainReader)}async readMetadata(){return this.metadataPromise??=(async()=>{for(this.fileSize=await this.input.source.getSize(),this.reader.fileSize=this.fileSize;!this.firstFrameHeader&&this.lastLoadedPos<this.fileSize;)await this.loadNextChunk();if(!this.firstFrameHeader)throw new Error("No MP3 frames found.");this.tracks=[new fa(new Ds(this))]})()}async loadNextChunk(){const e=await this.loadingMutex.acquire();try{s(this.lastLoadedPos<this.fileSize);const e=524288,t=Math.min(this.lastLoadedPos+e,this.fileSize);if(await this.reader.reader.loadRange(this.lastLoadedPos,t),this.lastLoadedPos=t,s(this.lastLoadedPos<=this.fileSize),0===this.reader.pos){const e=this.reader.readId3();e&&(this.reader.pos+=e.size)}this.parseFramesFromLoadedData()}finally{e()}}parseFramesFromLoadedData(){for(;;){const e=this.reader.pos,t=this.reader.readNextFrameHeader();if(!t)break;if(t.startPos+t.totalSize>this.lastLoadedPos){this.reader.pos=e,this.lastLoadedPos=e;break}const r=Ri(t.mpegVersionId,t.channel);this.reader.pos=t.startPos+r;const i=this.reader.readU32(),a=i===ki||i===Pi;if(this.reader.pos=t.startPos+t.totalSize-1,a)continue;this.firstFrameHeader||(this.firstFrameHeader=t);const s=t.audioSamplesInFrame/t.sampleRate,n={timestamp:this.nextTimestampInSamples/t.sampleRate,duration:s,dataStart:t.startPos,dataSize:t.totalSize};this.loadedSamples.push(n),this.nextTimestampInSamples+=t.audioSamplesInFrame}}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return s(e),e.computeDuration()}},Ds=class{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return s(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getLanguageCode(){return j}getCodec(){return"mp3"}getNumberOfChannels(){return s(this.demuxer.firstFrameHeader),3===this.demuxer.firstFrameHeader.channel?1:2}getSampleRate(){return s(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}async getDecoderConfig(){return s(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:3===this.demuxer.firstFrameHeader.channel?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}getPacketAtIndex(e,t){if(-1===e)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;return t.metadataOnly?i=Ui:(this.demuxer.reader.pos=r.dataStart,i=this.demuxer.reader.readBytes(r.dataSize)),new Ni(i,"key",r.timestamp,r.duration,e,r.dataSize)}async getFirstPacket(e){for(;0===this.demuxer.loadedSamples.length&&this.demuxer.lastLoadedPos<this.demuxer.fileSize;)await this.demuxer.loadNextChunk();return this.getPacketAtIndex(0,e)}async getNextPacket(e,t){const r=M(this.demuxer.loadedSamples,e.timestamp,(e=>e.timestamp));if(-1===r)throw new Error("Packet was not created from this track.");const i=r+1;for(;i>=this.demuxer.loadedSamples.length&&this.demuxer.lastLoadedPos<this.demuxer.fileSize;)await this.demuxer.loadNextChunk();return this.getPacketAtIndex(i,t)}async getPacket(e,t){for(;;){const r=R(this.demuxer.loadedSamples,e,(e=>e.timestamp));if(-1===r&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastLoadedPos===this.demuxer.fileSize)return this.getPacketAtIndex(r,t);if(r>=0&&r+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(r,t);await this.demuxer.loadNextChunk()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}},_s=class extends $i{constructor(e){super(e),this.readingMutex=new C,this.metadataPromise=null,this.fileSize=null,this.bitstreams=[],this.tracks=[],this.reader=new zi(new ga(e.source,67108864))}async readMetadata(){return this.metadataPromise??=(async()=>{for(this.fileSize=await this.input.source.getSize();this.reader.pos<this.fileSize-27;){await this.reader.reader.loadRange(this.reader.pos,this.reader.pos+ji);const e=this.reader.readPageHeader();if(!e)break;if(!(2&e.headerType))break;this.bitstreams.push({serialNumber:e.serialNumber,bosPage:e,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),this.reader.pos=e.headerStartPos+e.totalSize}for(const e of this.bitstreams){const t=await this.readPacket(this.reader,e.bosPage,0);t&&(t.data.byteLength>=7&&1===t.data[0]&&118===t.data[1]&&111===t.data[2]&&114===t.data[3]&&98===t.data[4]&&105===t.data[5]&&115===t.data[6]?await this.readVorbisMetadata(t,e):t.data.byteLength>=8&&79===t.data[0]&&112===t.data[1]&&117===t.data[2]&&115===t.data[3]&&72===t.data[4]&&101===t.data[5]&&97===t.data[6]&&100===t.data[7]&&await this.readOpusMetadata(t,e),null!==e.codecInfo.codec&&this.tracks.push(new fa(new Es(e,this))))}})()}async readVorbisMetadata(e,t){let r=await this.findNextPacketStart(this.reader,e);if(!r)return;const i=await this.readPacket(this.reader,r.startPage,r.startSegmentIndex);if(!i)return;if(r=await this.findNextPacketStart(this.reader,i),!r)return;const a=await this.readPacket(this.reader,r.startPage,r.startSegmentIndex);if(!a)return;if(3!==i.data[0]||5!==a.data[0])return;const s=[],n=e=>{for(;s.push(Math.min(255,e)),!(e<255);)e-=255};n(e.data.length),n(i.data.length);const o=new Uint8Array(1+s.length+e.data.length+i.data.length+a.data.length);o[0]=s.length,o.set(s,1),o.set(e.data,1+s.length),o.set(i.data,1+s.length+e.data.length),o.set(a.data,1+s.length+e.data.length+i.data.length),t.codecInfo.codec="vorbis",t.description=o,t.lastMetadataPacket=a;const l=p(e.data);t.numberOfChannels=l.getUint8(11),t.sampleRate=l.getUint32(12,!0);const c=l.getUint8(28);t.codecInfo.vorbisInfo={blocksizes:[1<<(15&c),1<<(c>>4)],modeBlockflags:kt(a.data).modeBlockflags}}async readOpusMetadata(e,t){const r=await this.findNextPacketStart(this.reader,e);if(!r)return;const i=await this.readPacket(this.reader,r.startPage,r.startSegmentIndex);if(!i)return;t.codecInfo.codec="opus",t.description=e.data,t.lastMetadataPacket=i;const a=Tt(e.data);t.numberOfChannels=a.outputChannelCount,t.sampleRate=a.inputSampleRate,t.codecInfo.opusInfo={preSkip:a.preSkip}}async readPacket(e,t,r){s(r<t.lacingValues.length),s(this.fileSize);let i=0;for(let e=0;e<r;e++)i+=t.lacingValues[e];let a=t,n=i,o=r;const l=[];e:for(;;){await e.reader.loadRange(a.dataStartPos,a.dataStartPos+a.dataSize),e.pos=a.dataStartPos;const r=e.readBytes(a.dataSize);for(;;){if(o===a.lacingValues.length){l.push(r.subarray(i,n));break}const e=a.lacingValues[o];if(n+=e,e<255){l.push(r.subarray(i,n));break e}o++}for(;;){if(e.pos=a.headerStartPos+a.totalSize,e.pos>=this.fileSize-27)return null;await e.reader.loadRange(e.pos,e.pos+ji);const r=e.readPageHeader();if(!r)return null;if(a=r,a.serialNumber===t.serialNumber)break}i=0,n=0,o=0}const c=l.reduce(((e,t)=>e+t.length),0),d=new Uint8Array(c);let h=0;for(let e=0;e<l.length;e++){const t=l[e];d.set(t,h),h+=t.length}return{data:d,endPage:a,endSegmentIndex:o}}async findNextPacketStart(e,t){if(s(null!==this.fileSize),t.endSegmentIndex<t.endPage.lacingValues.length-1)return{startPage:t.endPage,startSegmentIndex:t.endSegmentIndex+1};if(4&t.endPage.headerType)return null;for(e.pos=t.endPage.headerStartPos+t.endPage.totalSize;;){if(e.pos>=this.fileSize-27)return null;await e.reader.loadRange(e.pos,e.pos+ji);const r=e.readPageHeader();if(!r)return null;if(r.serialNumber===t.endPage.serialNumber)return{startPage:r,startSegmentIndex:0};e.pos=r.headerStartPos+r.totalSize}}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map((e=>e.getCodecParameterString())));return Bi({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){const e=await this.getTracks(),t=await Promise.all(e.map((e=>e.computeDuration())));return Math.max(0,...t)}},Es=class{constructor(e,t){this.bitstream=e,this.demuxer=t,this.encodedPacketToMetadata=new WeakMap,this.internalSampleRate="opus"===e.codecInfo.codec?be:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}async getDecoderConfig(){return s(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getLanguageCode(){return j}async getFirstTimestamp(){return 0}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return"opus"===this.bitstream.codecInfo.codec?(s(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,t,r){if(!e)return null;const{durationInSamples:i,vorbisBlockSize:a}=Li(e.data,this.bitstream.codecInfo,t.vorbisLastBlocksize),s=new Ni(r.metadataOnly?Ui:e.data,"key",Math.max(0,t.timestampInSamples)/this.internalSampleRate,i/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(s,{packet:e,timestampInSamples:t.timestampInSamples,durationInSamples:i,vorbisBlockSize:a}),s}async getFirstPacket(e,t=!0){const r=t?await this.demuxer.readingMutex.acquire():null;try{s(this.bitstream.lastMetadataPacket);const t=await this.demuxer.findNextPacketStart(this.demuxer.reader,this.bitstream.lastMetadataPacket);if(!t)return null;let r=0;"opus"===this.bitstream.codecInfo.codec&&(s(this.bitstream.codecInfo.opusInfo),r-=this.bitstream.codecInfo.opusInfo.preSkip);const i=await this.demuxer.readPacket(this.demuxer.reader,t.startPage,t.startSegmentIndex);return this.createEncodedPacketFromOggPacket(i,{timestampInSamples:r,vorbisLastBlocksize:null},e)}finally{r?.()}}async getNextPacket(e,t){const r=await this.demuxer.readingMutex.acquire();try{const r=this.encodedPacketToMetadata.get(e);if(!r)throw new Error("Packet was not created from this track.");const i=await this.demuxer.findNextPacketStart(this.demuxer.reader,r.packet);if(!i)return null;const a=r.timestampInSamples+r.durationInSamples,s=await this.demuxer.readPacket(this.demuxer.reader,i.startPage,i.startSegmentIndex);return this.createEncodedPacketFromOggPacket(s,{timestampInSamples:a,vorbisLastBlocksize:r.vorbisBlockSize},t)}finally{r()}}async getPacket(e,t){const r=await this.demuxer.readingMutex.acquire();try{s(null!==this.demuxer.fileSize);const r=z(e*this.internalSampleRate,14);if(0===r)return this.getFirstPacket(t,!1);if(r<0)return null;const i=this.demuxer.reader;s(this.bitstream.lastMetadataPacket);const a=await this.demuxer.findNextPacketStart(i,this.bitstream.lastMetadataPacket);if(!a)return null;let n=a.startPage,o=this.demuxer.fileSize;const l=[n];e:for(;n.headerStartPos+n.totalSize<o;){const e=n.headerStartPos,t=Math.floor((e+o)/2);let a=t;for(;;){const e=Math.min(a+65307,o-27);if(await i.reader.loadRange(a,e),i.pos=a,!i.findNextPageHeader(e)){o=t+27;continue e}await i.reader.loadRange(i.pos,i.pos+ji);const c=i.readPageHeader();s(c);let d=!1;if(c.serialNumber===this.bitstream.serialNumber)d=!0;else{await i.reader.loadRange(c.headerStartPos,c.headerStartPos+c.totalSize),i.pos=c.headerStartPos;const e=i.readBytes(c.totalSize);d=Oi(e)===c.checksum}if(d)if(d&&c.serialNumber!==this.bitstream.serialNumber)a=c.headerStartPos+c.totalSize;else{if(-1!==c.granulePosition){this.granulePositionToTimestampInSamples(c.granulePosition)>r?o=c.headerStartPos:(n=c,l.push(c));continue e}a=c.headerStartPos+c.totalSize}else a=c.headerStartPos+4}}let c=a.startPage;for(const e of l){if(e.granulePosition===n.granulePosition)break;(!c||e.headerStartPos>c.headerStartPos)&&(c=e)}let d=c;const h=[d];for(;d.serialNumber!==this.bitstream.serialNumber||d.granulePosition!==n.granulePosition;){i.pos=d.headerStartPos+d.totalSize,await i.reader.loadRange(i.pos,i.pos+ji);const e=i.readPageHeader();s(e),d=e,d.serialNumber===this.bitstream.serialNumber&&h.push(d)}s(-1!==d.granulePosition);let u,p,m=null,f=d,g=0;if(d.headerStartPos===a.startPage.headerStartPos)u=this.granulePositionToTimestampInSamples(0),p=!0,m=0;else{u=0,p=!1;for(let e=d.lacingValues.length-1;e>=0;e--)if(d.lacingValues[e]<255){m=e+1;break}if(null===m)throw new Error("Invalid page with granule position: no packets end on this page.");g=m-1;const e={data:Ui,endPage:f,endSegmentIndex:g};if(await this.demuxer.findNextPacketStart(i,e)){const e=Fs(h,d,m);s(e);const t=Is(h,e.page,e.segmentIndex);t&&(d=t.page,m=t.segmentIndex)}else for(;;){const e=Fs(h,d,m);if(!e)break;const t=Is(h,e.page,e.segmentIndex);if(!t)break;if(d=t.page,m=t.segmentIndex,e.page.headerStartPos!==f.headerStartPos){f=e.page,g=e.segmentIndex;break}}}let y=null,w=null;for(;null!==d;){s(null!==m);const e=await this.demuxer.readPacket(i,d,m);if(!e)break;if(!(d.headerStartPos===a.startPage.headerStartPos&&m<a.startSegmentIndex)){let i=this.createEncodedPacketFromOggPacket(e,{timestampInSamples:u,vorbisLastBlocksize:w?.vorbisBlockSize??null},t);s(i);let a=this.encodedPacketToMetadata.get(i);if(s(a),p||e.endPage.headerStartPos!==f.headerStartPos||e.endSegmentIndex!==g?u+=a.durationInSamples:(u=this.granulePositionToTimestampInSamples(d.granulePosition),p=!0,i=this.createEncodedPacketFromOggPacket(e,{timestampInSamples:u-a.durationInSamples,vorbisLastBlocksize:w?.vorbisBlockSize??null},t),s(i),a=this.encodedPacketToMetadata.get(i),s(a)),y=i,w=a,p&&(Math.max(u,0)>r||Math.max(a.timestampInSamples,0)===r))break}const n=await this.demuxer.findNextPacketStart(i,e);if(!n)break;d=n.startPage,m=n.startSegmentIndex}return y}finally{r()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}},Is=(e,t,r)=>{let i=t,a=r;e:for(;;){for(a--;a>=0;a--)if(i.lacingValues[a]<255){a++;break e}if(s(-1===a),!(1&i.headerType)){a=0;break}const t=E(e,(e=>e.headerStartPos<i.headerStartPos));if(!t)return null;i=t,a=i.lacingValues.length}if(s(-1!==a),a===i.lacingValues.length){const t=e[e.indexOf(i)+1];s(t),i=t,a=0}return{page:i,segmentIndex:a}},Fs=(e,t,r)=>{if(r>0)return{page:t,segmentIndex:r-1};const i=E(e,(e=>e.headerStartPos<t.headerStartPos));return i?{page:i,segmentIndex:i.lacingValues.length-1}:null},As=class{},Os=class extends As{async _getMajorBrand(e){if(await e._mainReader.source.getSize()<12)return null;const t=new ri(e._mainReader);return t.pos=4,"ftyp"!==t.readAscii(4)?null:t.readAscii(4)}_createDemuxer(e){return new cs(e)}},Ls=class extends Os{async _canReadInput(e){const t=await this._getMajorBrand(e);return!!t&&"qt  "!==t}get name(){return"MP4"}get mimeType(){return"video/mp4"}},Bs=class extends Os{async _canReadInput(e){return"qt  "===await this._getMajorBrand(e)}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}},js=class extends As{async isSupportedEBMLOfDocType(e,t){if(await e._mainReader.source.getSize()<8)return!1;const r=new mi(e._mainReader),i=r.readVarIntSize();if(i<1||i>8)return!1;if(440786851!==r.readUnsignedInt(i))return!1;const a=r.readElementSize();if(null===a)return!1;const s=r.pos;for(;r.pos<s+a;){const{id:e,size:i}=r.readElementHeader(),a=r.pos;if(null===i)return!1;switch(e){case 17030:case 17143:if(1!==r.readUnsignedInt(i))return!1;break;case 17026:if(r.readString(i)!==t)return!1;break;case 17031:if(r.readUnsignedInt(i)>4)return!1}r.pos=a+i}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new bs(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}},zs=class extends js{_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}},Vs=class extends As{async _canReadInput(e){const t=await e._mainReader.source.getSize();if(t<4)return!1;const r=new Ps(e._mainReader);r.fileSize=t;const i=r.readId3();i&&(r.pos+=i.size);const a=r.pos;await r.reader.loadRange(r.pos,r.pos+4096);const s=r.readNextFrameHeader(Math.min(a+4096,t));if(!s)return!1;if(i)return!0;r.pos=s.startPos+s.totalSize,await r.reader.loadRange(r.pos,r.pos+4);const n=r.readNextFrameHeader(r.pos+4);return!!n&&s.channel===n.channel&&s.sampleRate===n.sampleRate}_createDemuxer(e){return new Rs(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}},$s=class extends As{async _canReadInput(e){if(await e._mainReader.source.getSize()<12)return!1;const t=new ya(e._mainReader),r=t.readAscii(4);return("RIFF"===r||"RIFX"===r||"RF64"===r)&&(t.pos=8,"WAVE"===t.readAscii(4))}_createDemuxer(e){return new wa(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}},Us=class extends As{async _canReadInput(e){return!(await e._mainReader.source.getSize()<4)&&"OggS"===new zi(e._mainReader).readAscii(4)}_createDemuxer(e){return new _s(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}},Ns=new Ls,Ws=new Bs,Hs=new js,Gs=new zs,qs=new Vs,Ks=new $s,Qs=new Us,Ys=[Ns,Ws,Hs,Gs,Ks,Qs,qs],Xs=class{constructor(e){if(this._demuxerPromise=null,this._format=null,!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some((e=>!(e instanceof As))))throw new TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof as))throw new TypeError("options.source must be a Source.");this._formats=e.formats,this._source=e.source,this._mainReader=new ga(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{await this._mainReader.loadRange(0,4096);for(const e of this._formats)if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this);throw new Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),s(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter((e=>e.isVideoTrack()))}async getPrimaryVideoTrack(){return(await this.getTracks()).find((e=>e.isVideoTrack()))??null}async getAudioTracks(){return(await this.getTracks()).filter((e=>e.isAudioTrack()))}async getPrimaryAudioTrack(){return(await this.getTracks()).find((e=>e.isAudioTrack()))??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}},Js=e=>{if(void 0!==e&&(!e||"object"!=typeof e))throw new TypeError("options.video, when provided, must be an object.");if(void 0!==e?.discard&&"boolean"!=typeof e.discard)throw new TypeError("options.video.discard, when provided, must be a boolean.");if(void 0!==e?.forceTranscode&&"boolean"!=typeof e.forceTranscode)throw new TypeError("options.video.forceTranscode, when provided, must be a boolean.");if(void 0!==e?.codec&&!se.includes(e.codec))throw new TypeError(`options.video.codec, when provided, must be one of: ${se.join(", ")}.`);if(void 0!==e?.bitrate&&!(e.bitrate instanceof Me)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("options.video.bitrate, when provided, must be a positive integer or a quality.");if(void 0!==e?.width&&(!Number.isInteger(e.width)||e.width<=0))throw new TypeError("options.video.width, when provided, must be a positive integer.");if(void 0!==e?.height&&(!Number.isInteger(e.height)||e.height<=0))throw new TypeError("options.video.height, when provided, must be a positive integer.");if(void 0!==e?.fit&&!["fill","contain","cover"].includes(e.fit))throw new TypeError('options.video.fit, when provided, must be one of "fill", "contain", or "cover".');if(void 0!==e?.width&&void 0!==e.height&&void 0===e.fit)throw new TypeError("When both options.video.width and options.video.height are provided, options.video.fit must also be provided.");if(void 0!==e?.rotate&&![0,90,180,270].includes(e.rotate))throw new TypeError("options.video.rotate, when provided, must be 0, 90, 180 or 270.");if(void 0!==e?.frameRate&&(!Number.isFinite(e.frameRate)||e.frameRate<=0))throw new TypeError("options.video.frameRate, when provided, must be a finite positive number.")},Zs=e=>{if(void 0!==e&&(!e||"object"!=typeof e))throw new TypeError("options.audio, when provided, must be an object.");if(void 0!==e?.discard&&"boolean"!=typeof e.discard)throw new TypeError("options.audio.discard, when provided, must be a boolean.");if(void 0!==e?.forceTranscode&&"boolean"!=typeof e.forceTranscode)throw new TypeError("options.audio.forceTranscode, when provided, must be a boolean.");if(void 0!==e?.codec&&!le.includes(e.codec))throw new TypeError(`options.audio.codec, when provided, must be one of: ${le.join(", ")}.`);if(void 0!==e?.bitrate&&!(e.bitrate instanceof Me)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw new TypeError("options.audio.bitrate, when provided, must be a positive integer or a quality.");if(void 0!==e?.numberOfChannels&&(!Number.isInteger(e.numberOfChannels)||e.numberOfChannels<=0))throw new TypeError("options.audio.numberOfChannels, when provided, must be a positive integer.");if(void 0!==e?.sampleRate&&(!Number.isInteger(e.sampleRate)||e.sampleRate<=0))throw new TypeError("options.audio.sampleRate, when provided, must be a positive integer.")},en=48e3,tn=class e{constructor(e){if(this._addedCounts={video:0,audio:0,subtitle:0},this._totalTrackCount=0,this._trackPromises=[],this._executed=!1,this._synchronizer=new rn,this._totalDuration=null,this._maxTimestamps=new Map,this._canceled=!1,this.onProgress=void 0,this._computeProgress=!1,this._lastProgress=0,this.utilizedTracks=[],this.discardedTracks=[],!e||"object"!=typeof e)throw new TypeError("options must be an object.");if(!(e.input instanceof Xs))throw new TypeError("options.input must be an Input.");if(!(e.output instanceof is))throw new TypeError("options.output must be an Output.");if(e.output._tracks.length>0||"pending"!==e.output.state)throw new TypeError("options.output must be fresh: no tracks added and not started.");if("function"!=typeof e.video&&Js(e.video),"function"!=typeof e.audio&&Zs(e.audio),void 0!==e.trim&&(!e.trim||"object"!=typeof e.trim))throw new TypeError("options.trim, when provided, must be an object.");if(void 0!==e.trim?.start&&(!Number.isFinite(e.trim.start)||e.trim.start<0))throw new TypeError("options.trim.start, when provided, must be a non-negative number.");if(void 0!==e.trim?.end&&(!Number.isFinite(e.trim.end)||e.trim.end<0))throw new TypeError("options.trim.end, when provided, must be a non-negative number.");if(void 0!==e.trim?.start&&void 0!==e.trim.end&&e.trim.start>=e.trim.end)throw new TypeError("options.trim.start must be less than options.trim.end.");this._options=e,this.input=e.input,this.output=e.output,this._startTimestamp=e.trim?.start??0,this._endTimestamp=e.trim?.end??1/0;const{promise:t,resolve:r}=_();this._started=t,this._start=r}static async init(t){const r=new e(t);return await r._init(),r}async _init(){const e=await this.input.getTracks(),t=this.output.format.getSupportedTrackCounts();let r=1,i=1;for(const a of e){let e;a.isVideoTrack()?this._options.video&&("function"==typeof this._options.video?(e=await this._options.video(a,r),Js(e),r++):e=this._options.video):a.isAudioTrack()?this._options.audio&&("function"==typeof this._options.audio?(e=await this._options.audio(a,i),Zs(e),i++):e=this._options.audio):s(!1),e?.discard?this.discardedTracks.push({track:a,reason:"discarded_by_user"}):this._totalTrackCount!==t.total.max?this._addedCounts[a.type]!==t[a.type].max?a.isVideoTrack()?await this._processVideoTrack(a,e??{}):a.isAudioTrack()&&await this._processAudioTrack(a,e??{}):this.discardedTracks.push({track:a,reason:"max_track_count_of_type_reached"}):this.discardedTracks.push({track:a,reason:"max_track_count_reached"})}const a=this.discardedTracks.filter((e=>"discarded_by_user"!==e.reason));a.length>0&&console.warn("Some tracks had to be discarded from the conversion:",a)}async execute(){if(this._executed)throw new Error("Conversion cannot be executed twice.");this._executed=!0,this.onProgress&&(this._computeProgress=!0,this._totalDuration=Math.min(await this.input.computeDuration()-this._startTimestamp,this._endTimestamp-this._startTimestamp),this.onProgress?.(0)),await this.output.start(),this._start();try{await Promise.all(this._trackPromises)}catch(e){throw this._canceled||this.cancel(),e}this._canceled&&await new Promise((()=>{})),await this.output.finalize(),this._computeProgress&&this.onProgress?.(1)}async cancel(){"finalizing"!==this.output.state&&"finalized"!==this.output.state&&(this._canceled?console.warn("Conversion already canceled."):(this._canceled=!0,await this.output.cancel()))}async _processVideoTrack(e,t){const r=e.codec;if(!r)return void this.discardedTracks.push({track:e,reason:"unknown_source_codec"});let i;const a=n(e.rotation+(t.rotate??0)),o=this.output.format.supportsVideoRotationMetadata,[l,c]=a%180==0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth];let d=l,h=c;const u=d/h,p=e=>2*Math.ceil(e/2);void 0!==t.width&&void 0===t.height?(d=p(t.width),h=p(Math.round(d/u))):void 0===t.width&&void 0!==t.height?(h=p(t.height),d=p(Math.round(h*u))):void 0!==t.width&&void 0!==t.height&&(d=p(t.width),h=p(t.height));const m=await e.getFirstTimestamp(),f=!!t.forceTranscode||this._startTimestamp>0||m<0||!!t.frameRate,g=d!==l||h!==c||0!==a&&!o;let y=this.output.format.getSupportedVideoCodecs();if(f||t.bitrate||g||!y.includes(r)||t.codec&&t.codec!==r){if(!await e.canDecode())return void this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});t.codec&&(y=y.filter((e=>e===t.codec)));const r=t.bitrate??Ee,n=await Ye(y,{width:d,height:h,bitrate:r});if(!n)return void this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});const o=new Ba({codec:n,bitrate:r,onEncodedPacket:t=>this._reportProgress(e.id,t.timestamp+t.duration)});i=o,g?this._trackPromises.push((async()=>{await this._started;const r=new la(e,{width:d,height:h,fit:t.fit??"fill",rotation:a,poolSize:1}).canvases(this._startTimestamp,this._endTimestamp),i=t.frameRate;let n=null,l=null,c=null;const u=async e=>{s(n),s(void 0!==i);const t=Math.round((e-l)*i);for(let e=1;e<t;e++){const t=new Wi(n,{timestamp:l+e/i,duration:1/i});await o.add(t)}};for await(const{canvas:t,timestamp:a,duration:s}of r){if(this._synchronizer.shouldWait(e.id,a)&&await this._synchronizer.wait(a),this._canceled)return;let r=Math.max(a-this._startTimestamp,0);if(c=a+s,void 0!==i){const e=Math.floor(r*i)/i;if(null!==n){if(e<=l){n=t,l=e;continue}await u(e)}r=e}const d=new Wi(t,{timestamp:r,duration:void 0!==i?1/i:s});await o.add(d),void 0!==i?(n=t,l=r):d.close()}n&&(s(null!==c),s(void 0!==i),await u(Math.floor(c*i)/i)),o.close(),this._synchronizer.closeTrack(e.id)})()):this._trackPromises.push((async()=>{await this._started;const r=new oa(e),i=t.frameRate;let a=null,n=null,l=null;const c=async e=>{s(a),s(void 0!==i);const t=Math.round((e-n)*i);for(let e=1;e<t;e++)a.setTimestamp(n+e/i),a.setDuration(1/i),await o.add(a);a.close()};for await(const t of r.samples(this._startTimestamp,this._endTimestamp)){if(this._synchronizer.shouldWait(e.id,t.timestamp)&&await this._synchronizer.wait(t.timestamp),this._canceled)return void a?.close();let r=Math.max(t.timestamp-this._startTimestamp,0);if(l=t.timestamp+t.duration,void 0!==i){const e=Math.floor(r*i)/i;if(null!==a){if(e<=n){a.close(),a=t,n=e;continue}await c(e)}r=e,t.setDuration(1/i)}t.setTimestamp(r),await o.add(t),void 0!==i?(a=t,n=r):t.close()}a&&(s(null!==l),s(void 0!==i),await c(Math.floor(l*i)/i)),o.close(),this._synchronizer.closeTrack(e.id)})())}else{const t=new Aa(r);i=t,this._trackPromises.push((async()=>{await this._started;const r=new ra(e),i={decoderConfig:await e.getDecoderConfig()??void 0},a=Number.isFinite(this._endTimestamp)?await r.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const s of r.packets(void 0,a,{verifyKeyPackets:!0})){if(this._synchronizer.shouldWait(e.id,s.timestamp)&&await this._synchronizer.wait(s.timestamp),this._canceled)return;await t.add(s,i),this._reportProgress(e.id,s.timestamp+s.duration)}t.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addVideoTrack(i,{frameRate:t.frameRate,languageCode:e.languageCode,rotation:g?0:a}),this._addedCounts.video++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _processAudioTrack(e,t){const r=e.codec;if(!r)return void this.discardedTracks.push({track:e,reason:"unknown_source_codec"});let i;const a=e.numberOfChannels,s=e.sampleRate,n=await e.getFirstTimestamp();let o=t.numberOfChannels??a,l=t.sampleRate??s,c=o!==a||l!==s||this._startTimestamp>0||n<0,d=this.output.format.getSupportedAudioCodecs();if(t.forceTranscode||t.bitrate||c||!d.includes(r)||t.codec&&t.codec!==r){if(!await e.canDecode())return void this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});let r=null;t.codec&&(d=d.filter((e=>e===t.codec)));const a=t.bitrate??Ee,s=await Ke(d,{numberOfChannels:o,sampleRate:l,bitrate:a});if(s.some((e=>oe.includes(e)))||!d.some((e=>oe.includes(e)))||2===o&&l===en)r=s[0]??null;else{const e=(await Ke(d,{numberOfChannels:2,sampleRate:en,bitrate:a})).find((e=>oe.includes(e)));e&&(c=!0,r=e,o=2,l=en)}if(null===r)return void this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});if(c)i=this._resampleAudio(e,r,o,l,a);else{const t=new Wa({codec:r,bitrate:a,onEncodedPacket:t=>this._reportProgress(e.id,t.timestamp+t.duration)});i=t,this._trackPromises.push((async()=>{await this._started;const r=new ha(e);for await(const i of r.samples(void 0,this._endTimestamp)){if(this._synchronizer.shouldWait(e.id,i.timestamp)&&await this._synchronizer.wait(i.timestamp),this._canceled)return;await t.add(i),i.close()}t.close(),this._synchronizer.closeTrack(e.id)})())}}else{const t=new $a(r);i=t,this._trackPromises.push((async()=>{await this._started;const r=new ra(e),i={decoderConfig:await e.getDecoderConfig()??void 0},a=Number.isFinite(this._endTimestamp)?await r.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const s of r.packets(void 0,a)){if(this._synchronizer.shouldWait(e.id,s.timestamp)&&await this._synchronizer.wait(s.timestamp),this._canceled)return;await t.add(s,i),this._reportProgress(e.id,s.timestamp+s.duration)}t.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addAudioTrack(i,{languageCode:e.languageCode}),this._addedCounts.audio++,this._totalTrackCount++,this.utilizedTracks.push(e)}_resampleAudio(e,t,r,i,a){const s=new Wa({codec:t,bitrate:a,onEncodedPacket:t=>this._reportProgress(e.id,t.timestamp+t.duration)});return this._trackPromises.push((async()=>{await this._started;const t=new an({sourceNumberOfChannels:e.numberOfChannels,sourceSampleRate:e.sampleRate,targetNumberOfChannels:r,targetSampleRate:i,startTime:this._startTimestamp,endTime:this._endTimestamp,onSample:e=>s.add(e)}),a=new ha(e).samples(this._startTimestamp,this._endTimestamp);for await(const r of a){if(this._synchronizer.shouldWait(e.id,r.timestamp)&&await this._synchronizer.wait(r.timestamp),this._canceled)return;await t.add(r)}await t.finalize(),s.close(),this._synchronizer.closeTrack(e.id)})()),s}_reportProgress(e,t){if(!this._computeProgress)return;s(null!==this._totalDuration),this._maxTimestamps.set(e,Math.max(t,this._maxTimestamps.get(e)??-1/0));let r=0;for(const[,e]of this._maxTimestamps)r+=e;const i=r/this._totalTrackCount,a=B(i/this._totalDuration,0,1);a!==this._lastProgress&&(this._lastProgress=a,this.onProgress?.(a))}},rn=class{constructor(){this.maxTimestamps=new Map,this.resolvers=[]}computeMinAndMaybeResolve(){let e=1/0;for(const[,t]of this.maxTimestamps)e=Math.min(e,t);for(let t=0;t<this.resolvers.length;t++){const r=this.resolvers[t];r.timestamp-e<5&&(r.resolve(),this.resolvers.splice(t,1),t--)}return e}shouldWait(e,t){return this.maxTimestamps.set(e,Math.max(t,this.maxTimestamps.get(e)??-1/0)),t-this.computeMinAndMaybeResolve()>=5}wait(e){const{promise:t,resolve:r}=_();return this.resolvers.push({timestamp:e,resolve:r}),t}closeTrack(e){this.maxTimestamps.delete(e),this.computeMinAndMaybeResolve()}},an=class{constructor(e){this.sourceSampleRate=e.sourceSampleRate,this.targetSampleRate=e.targetSampleRate,this.sourceNumberOfChannels=e.sourceNumberOfChannels,this.targetNumberOfChannels=e.targetNumberOfChannels,this.startTime=e.startTime,this.endTime=e.endTime,this.onSample=e.onSample,this.bufferSizeInFrames=Math.floor(5*this.targetSampleRate),this.bufferSizeInSamples=this.bufferSizeInFrames*this.targetNumberOfChannels,this.outputBuffer=new Float32Array(this.bufferSizeInSamples),this.bufferStartFrame=0,this.maxWrittenFrame=-1,this.setupChannelMixer(),this.tempSourceBuffer=new Float32Array(this.sourceSampleRate*this.sourceNumberOfChannels)}setupChannelMixer(){const e=this.sourceNumberOfChannels,t=this.targetNumberOfChannels;this.channelMixer=1===e&&2===t?(t,r)=>t[r*e]:1===e&&4===t?(t,r,i)=>t[r*e]*+(i<2):1===e&&6===t?(t,r,i)=>t[r*e]*+(2===i):2===e&&1===t?(t,r)=>{const i=r*e;return.5*(t[i]+t[i+1])}:2===e&&4===t||2===e&&6===t?(t,r,i)=>t[r*e+i]*+(i<2):4===e&&1===t?(t,r)=>{const i=r*e;return.25*(t[i]+t[i+1]+t[i+2]+t[i+3])}:4===e&&2===t?(t,r,i)=>{const a=r*e;return.5*(t[a+i]+t[a+i+2])}:4===e&&6===t?(t,r,i)=>{const a=r*e;return i<2?t[a+i]:2===i||3===i?0:t[a+i-2]}:6===e&&1===t?(t,r)=>{const i=r*e;return Math.SQRT1_2*(t[i]+t[i+1])+t[i+2]+.5*(t[i+4]+t[i+5])}:6===e&&2===t?(t,r,i)=>{const a=r*e;return t[a+i]+Math.SQRT1_2*(t[a+2]+t[a+i+4])}:6===e&&4===t?(t,r,i)=>{const a=r*e;return i<2?t[a+i]+Math.SQRT1_2*t[a+2]:t[a+i+2]}:(t,r,i)=>i<e?t[r*e+i]:0}ensureTempBufferSize(e){let t=this.tempSourceBuffer.length;for(;t<e;)t*=2;if(t!==this.tempSourceBuffer.length){const e=new Float32Array(t);e.set(this.tempSourceBuffer),this.tempSourceBuffer=e}}async add(e){if(!e||e._closed)return;const t=e.numberOfFrames*e.numberOfChannels;this.ensureTempBufferSize(t);const r=e.allocationSize({planeIndex:0,format:"f32"}),i=new Float32Array(this.tempSourceBuffer.buffer,0,r/4);e.copyTo(i,{planeIndex:0,format:"f32"});const a=e.timestamp-this.startTime,n=e.numberOfFrames/this.sourceSampleRate,o=Math.min(a+n,this.endTime-this.startTime),l=Math.floor(a*this.targetSampleRate),c=Math.ceil(o*this.targetSampleRate);for(let t=l;t<c;t++){if(t<this.bufferStartFrame)continue;for(;t>=this.bufferStartFrame+this.bufferSizeInFrames;)await this.finalizeCurrentBuffer(),this.bufferStartFrame+=this.bufferSizeInFrames;const r=t-this.bufferStartFrame;s(r<this.bufferSizeInFrames);const n=(t/this.targetSampleRate-a)*this.sourceSampleRate,o=Math.floor(n),l=Math.ceil(n),c=n-o;for(let t=0;t<this.targetNumberOfChannels;t++){let a=0,s=0;o>=0&&o<e.numberOfFrames&&(a=this.channelMixer(i,o,t)),l>=0&&l<e.numberOfFrames&&(s=this.channelMixer(i,l,t));const n=a+c*(s-a),d=r*this.targetNumberOfChannels+t;this.outputBuffer[d]+=n}this.maxWrittenFrame=Math.max(this.maxWrittenFrame,r)}}async finalizeCurrentBuffer(){if(this.maxWrittenFrame<0)return;const e=(this.maxWrittenFrame+1)*this.targetNumberOfChannels,t=new Float32Array(e);t.set(this.outputBuffer.subarray(0,e));const r=this.bufferStartFrame/this.targetSampleRate,i=new qi({format:"f32",sampleRate:this.targetSampleRate,numberOfChannels:this.targetNumberOfChannels,timestamp:r,data:t});await this.onSample(i),this.outputBuffer.fill(0),this.maxWrittenFrame=-1}finalize(){return this.finalizeCurrentBuffer()}};return Ai=a,((a,s,n,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let n of r(s))i.call(a,n)||undefined===n||e(a,n,{get:()=>s[n],enumerable:!(o=t(s,n))||o.enumerable});return a})(e({},"__esModule",{value:!0}),Ai)})();"object"==typeof e.exports&&Object.assign(e.exports,t)},8936:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayerStyle=void 0;const i=r(9658);class a extends i.Drawer{ready;toDraw;constructor(e,t){super(e,t),this.ready=Promise.resolve().then((()=>this.initialize()))}async initialize(){}setMappedChannel(...e){this.toDraw.setMappedChannel(...e)}clearChannel(){this.toDraw.clearChannel()}setMaskArea(e){this.toDraw.setMaskArea(e)}draw(e){return this.toDraw.draw(),e}delete(){this.toDraw.delete()}}t.LayerStyle=a},8948:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.off=t.once=t.on=void 0;const r=["capture","self","once","prevent","stop","passive"],i=["ctrl","shift","alt"],a=["check","uncheck"],s=["up","down"],n={left:0,middle:1,right:2,main:0,auxiliary:1,secondary:2},o={keydown:l,keyup:l,keypress:l,mousedown:c,mousemove:c,mouseup:c,click:c,change:function(e,[t]){let r=e.target.checked;return r&&"check"===t||r&&"uncheck"===t},wheel:function(e,[t]){return e.deltaY<0&&"up"===t||e.deltaY>0&&"down"===t}};function l(e,t){let r=[];for(let a of t)if(i.includes(a)){if(!d(e,a))return!1}else r.push(a);return 0===r.length||r.includes(e.key.toLowerCase())||r.includes(e.code.toLowerCase())}function c(e,t){let r=[];for(let a of t)if(i.includes(a)){if(!d(e,a))return!1}else r.push(a);return 0===r.length||!!r.find((t=>n[t]===e.button))}function d(e,t){switch(t){case"ctrl":if(!e.ctrlKey)return!1;break;case"shift":if(!e.shiftKey)return!1;break;case"alt":if(!e.altKey)return!1}return!0}const h=new WeakMap;function u(e,t,l,c,d){let u=l,m=null;l.includes(".")&&([u,...m]=l.split("."),function(e,t,o){if(0===(o=o.filter((e=>!r.includes(e)))).length)return!0;if("change"===t){if(o.length>1||!a.includes(o[0]))throw new Error(`"${e}" is valid, check filter for change event must be one of "${a.join(",")}"`)}else if("wheel"===t){if(o.length>1||!s.includes(o[0]))throw new Error(`"${e}" is valid, direction filter for wheel event must be one of "${s.join(",")}"`)}else if("keydown"===t||"keyup"===t||"keypress"===t){if((o=o.filter((e=>!i.includes(e)))).length>1)throw new Error(`"${e}" is valid, only one key name can be specified as key`)}else if(("mousedown"===t||"mousemove"===t||"mouseup"===t||"click"===t)&&((o=o.filter((e=>!i.includes(e)))).length>1||!n.hasOwnProperty(o[0])))throw new Error(`"${e}" is valid, button filter for mouse event must be one of "${Object.keys(n).join(",")}"`)}(l,u,m));let f=function(e,t,i,a,s,n){let l=t?t.filter((e=>!r.includes(e))):null;return function(r){l&&l.length>0&&!(0,o[a])(r,l)||t&&t.includes("self")&&r.target!==i||(t&&t.includes("prevent")&&r.preventDefault(),t&&t.includes("stop")&&r.stopPropagation(),(e||t&&t.includes("once"))&&p(i,a,s,n),n?s.call(n,r):s(r))}}(e,m,t,u,c,d),g=!!m&&m.includes("capture"),y=!!m&&m.includes("passive"),w=y||"wheel"===u?{capture:g,passive:y}:g,v=h.get(t);v||(v={},h.set(t,v)),(v[u]||(v[u]=[])).push({name:l,handler:c,wrappedHandler:f,scope:d,capture:g}),t.addEventListener(u,f,w)}function p(e,t,r,i){let a=h.get(e);if(!a)return;let s=a[t=t.replace(/\..+/,"")];if(s)for(let a=s.length-1;a>=0;a--){let n=s[a];r&&n.handler!==r&&(!n.handler.hasOwnProperty("__original")||n.handler.__original!==r)||i&&n.scope!==i||(e.removeEventListener(t,n.wrappedHandler,n.capture),s.splice(a,1))}}t.on=function(e,t,r,i){u(!1,e,t,r,i)},t.once=function(e,t,r,i){u(!0,e,t,r,i)},t.off=p},8962:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalBlurEffect=void 0;const i=r(8341),a=r(6376),s=r(6339),n=r(3205),o=r(4452);class l extends i.Effect{async initialize(){let e=this.renderer.project.options;this.toDraw=new s.ToDrawEffect({renderer:this.renderer,fragCode:n.default});let t=e.motionBlurSamplingCount;this.toDraw.setUniform("samplingCount",t),this.toDraw.setUniform("repeatEdgePixels",!0)}update(){super.update();let e=(0,a.getPropertyValues)(this.data,this.time),{direction:t,blurLength:r}=e,i=this.transformStatus.projectVector(o.Vector2.fromAngle(t-90).multiplyScalarSelf(r));this.toDraw.setUniform("blurVector",i.xy)}draw(e){return this.toDraw.setInputPaintArea(e),this.toDraw.draw(),e}}t.DirectionalBlurEffect=l},9028:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(6949),t),a(r(5992),t),a(r(6269),t),a(r(4071),t),a(r(6099),t),a(r(6029),t),a(r(4588),t),a(r(1404),t),a(r(8325),t),a(r(1146),t),a(r(3163),t),a(r(2355),t),a(r(5048),t)},9100:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextAtlasCharPositions=void 0;const i=r(5365),a=r(5499),s=r(2298),n=r(4310);t.TextAtlasCharPositions=class{textAtlas;vertexCoords;layouts;constructor(e,t,r){this.textAtlas=e,this.vertexCoords=r,this.initializeLayouts(t)}initializeLayouts(e){let t=[],r=0,i=0,a=!0;for(let s=0;s<e.length;s++){let n=e[s],{char:o}=n,l=/\s/.test(o);!l&&s>0&&r++;let c=a&&!l;a=l,(0===s||n.lineIndex>e[s-1].lineIndex||c)&&s>0&&i++,t.push(Object.assign(n,{charIndex:s,charIndexExcludeSpace:r,wordIndex:i}))}this.layouts=t}getLength(){return this.layouts.length}getCharIndices(){return this.layouts}getVertexCoords(){return this.vertexCoords}getTextureCoords(){let e=[],{w:t,h:r}=this.textAtlas.renderedCanvasSize;for(let{char:i}of this.layouts){let{x1:a,y1:s,x2:n,y2:o}=this.textAtlas.renderedCharRectMap.get(i),l=a/t,c=n/t,d=1-s/r,h=1-o/r;e.push([l,d],[l,h],[c,d],[c,h])}return e}getCoordIndices(){let e=[];for(let t=0;t<this.layouts.length;t++){let r=4*t;e.push(r,r+1,r+2,r+1,r+2,r+3)}return e}getPerTextTransforms(e){let t=[],r=this.getTrackingMoves(e);for(let a=0;a<e.length;a++){let n=e[a],[o,l]=this.layouts[a].anchorPoint,c=(0,i.getTransformFromValues)(n),d=new s.Matrix4,h=r?r[a]:0;d.translateSelf(-o,-l),d.leftMultiplySelf(c),d.translateSelf(o+h,l),t.push(d)}return t}getTrackingMoves(e){if(!e.some((e=>e.trackingAmount)))return null;let t=(0,n.getAlignRateFromLeft)(this.textAtlas.state.values.justification),r=this.textAtlas.state.values.fontSize,i=[],s=Object.values((0,a.groupBy)(this.layouts,(e=>e.lineIndex))),o=0;for(let l of s){let s=e.slice(o,o+l.length).map((e=>(0,n.getLetterSpacingFronTrackingAmount)(r,e.trackingAmount||0))),c=-(0,a.sum)(s)*t;for(let e=0;e<s.length;e++)i.push(c+s[e]/2),c+=s[e];o+=l.length}return i}}},9154:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(356),a=r(9856),s=r(8948),n=["lazy","number"];i.defineBinding("model",class{constructor(e,t,r){if(this.isBooleanValue=!1,this.isMultiSelect=!1,this.unwatch=null,!t)throw new Error('A context must be provided when using ":model=property"');if(r){if(r.length>2)throw new Error(`Modifier "${r.join(".")}" is not allowed, at most two modifiers can be specified for ":model"`);for(let e of r)if(!n.includes(e))throw new Error(`Modifier "${r}" is not allowed, it must be one of ${n.map((e=>`"${e}"`)).join(", ")}`)}if(this.el=e,this.modifiers=r,this.context=t,this.isComModel=e.localName.includes("-"),this.isComModel)this.property="value",this.eventName="change";else{let t=["input","select","textarea"].includes(e.localName),i=r&&"lazy"===r[0];this.isBooleanValue="input"===e.localName&&("checkbox"===e.type||"radio"===e.type),this.isMultiSelect="select"===e.localName&&e.multiple,this.isBooleanValue?(this.property="checked",this.eventName="change"):t?(this.property="value",this.eventName=i?"change":"input"):(this.property="innerHTML",this.eventName=i?"blur":"input")}}update(e){if(!e||"string"!=typeof e)throw new Error(`"${e}" is not a valid model name`);if(this.modelName=e,this.isComModel){let e=a.getComponent(this.el);e?this.bindCom(e):a.onComponentCreatedAt(this.el,this.bindCom.bind(this))}else this.watchContextModelValue(),s.on(this.el,this.eventName,this.onEventInputOrChange.bind(this))}bindCom(e){this.com||(this.com=e,e.hasOwnProperty("checked")&&"boolean"==typeof e.checked&&(this.property="checked"),e.on(this.eventName,this.setModelValueToContext,this)),this.watchContextModelValue()}watchContextModelValue(){this.unwatch&&this.unwatch(),this.unwatch=this.context.watchImmediately(this.getModelValueFromContext.bind(this),this.setModelValueToTarget.bind(this))}getModelValueFromContext(){let e=this.modelName.split("."),t=this.context;for(let r of e){if(!t||"object"!=typeof t){t=void 0;break}t=t[r]}return t}setModelValueToContext(e){let t=this.modelName.split("."),r=this.context;for(let i=0;i<t.length;i++){let a=t[i];if(!r||"object"!=typeof r)break;i<t.length-1?r=r[a]:r[a]=e}}onEventInputOrChange(e){let t,r=this.modifiers&&this.modifiers.includes("number");this.isMultiSelect?(t=Array.from(this.el.options).filter((e=>e.selected)).map((e=>e.value)),r&&(t=t.map(Number))):(t=this.el[this.property],r&&(t=Number(t))),this.setModelValueToContext(t)}setModelValueToTarget(e){if(this.isComModel){let t=this.com;t[this.property]!==e&&(t[this.property]=e)}else this.setInputValue(e)}setInputValue(e){if(this.isMultiSelect&&!Array.isArray(e))throw new Error(`:model="${this.modelName}" of select[multiple] requires an array as value`);if(this.isMultiSelect)for(let t of this.el.options)t.selected=e.includes(t.value);else{let t=this.el;e=null==e?"":e,t[this.property]!==e&&(t[this.property]=e)}}remove(){this.setInputValue("")}})},9160:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToDrawMotionBlur=void 0;const i=r(2298),a=r(1830),s=r(277),n=r(5499),o=r(6339);class l extends o.ToDrawEffect{motionMatrix;motionArea;initializeOptions(e){(0,n.assignIf)(e,{fragCode:s.default}),super.initializeOptions(e)}initializeUniforms(){super.initializeUniforms();let e=this.renderer.project.options.motionBlurSamplingCount;this.setUniform("samplingCount",e),this.setUniform("repeatEdgePixels",!1)}setRepeatEdgePixels(e){this.setUniform("repeatEdgePixels",e)}setMotionMatrix(e){this.motionMatrix=e,this.setUniform("motionMatrix",e.toFloat32Array())}setInputPaintArea(e){this.setMotionAreaFromInputArea(e),super.setInputPaintArea(this.motionArea)}setMotionAreaFromInputArea(e){let t=e.multiplyBy(i.Matrix4.I.minus(this.motionMatrix));this.motionArea=a.PaintArea.union([t,e])}getPaintArea(){return this.motionArea}}t.ToDrawMotionBlur=l},9162:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"movesCount",desc:"Moves Count",min:6,max:100,step:2,value:24}];(0,r(4062).extendTransitions)({"zoom-blur":{uniformSlides:[{name:"maxBlurRadiusRate",desc:"Max Blur Radius Rate",min:0,max:1,step:.01,value:.2}],steps:[{fragShaderName:"zoom-blur"}]},"motion-blur-to-top":{uniformSlides:i,uniformValues:{directionAngle:90},steps:[{fragShaderName:"motion-blur"}]},"motion-blur-to-bottom":{uniformSlides:i,uniformValues:{directionAngle:-90},steps:[{fragShaderName:"motion-blur"}]},"motion-blur-to-left":{uniformSlides:i,uniformValues:{directionAngle:180},steps:[{fragShaderName:"motion-blur"}]},"motion-blur-to-right":{uniformSlides:i,uniformValues:{directionAngle:0},steps:[{fragShaderName:"motion-blur"}]},"motion-blur-to-top-left":{uniformSlides:i,uniformValues:{directionAngle:135},steps:[{fragShaderName:"motion-blur"}]},"motion-blur-to-top-right":{uniformSlides:i,uniformValues:{directionAngle:45},steps:[{fragShaderName:"motion-blur"}]},"motion-blur-to-bottom-left":{uniformSlides:i,uniformValues:{directionAngle:-135},steps:[{fragShaderName:"motion-blur"}]},"motion-blur-to-bottom-right":{uniformSlides:i,uniformValues:{directionAngle:-45},steps:[{fragShaderName:"motion-blur"}]}})},9176:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.triangulatePolygonLine=void 0;const i=r(4452);function a(e,t,r){let i=t.minus(e);return i.normalizeSelf().multiplyScalarSelf(r/2),[t.add(i.rotate(Math.PI/2)),t.add(i.rotate(-Math.PI/2))]}function s(e,t,r,i){let s=e.minus(t).normalizeSelf(),n=r.minus(t).normalizeSelf(),o=s.add(n),l=o.length();if(l<1e-9)return a(e,t,i);{let e=1/Math.sqrt(1-l*l/4);return o.multiplyScalarSelf(i/2*e/l),o.cross(s)>0?[t.add(o),t.minus(o)]:[t.minus(o),t.add(o)]}}t.triangulatePolygonLine=function(e,t,r){if(e.length<2)return[];let n=e.map((e=>new i.Vector2(e[0],e[1]))),o=[];for(let e=0;e<n.length;e++){let i=0===e?r?n[n.length-1]:null:n[e-1],l=n[e],c=e===n.length-1?r?n[0]:null:n[e+1];i?c?o.push(s(i,l,c,t)):o.push(a(i,l,t)):o.push(a(c,l,t).reverse())}let l=[];for(let e=0;e<o.length;e++){let[t,r]=o[e];l.push(t.xy,r.xy)}return r&&l.push(o[0][0].xy,o[0][1].xy),l}},9184:(e,t)=>{function r(e,t=0){if(e<0)return-r(-e,t);if(0===e)return 0;if(t>0){let r=Math.pow(10,t);return Math.round(e/r)*r}{let r=Math.pow(10,-t);return Math.round(e*r)/r}}Object.defineProperty(t,"__esModule",{value:!0}),t.constrain=t.mod=t.toPrecision=t.toPower=t.toDecimal=void 0,t.toDecimal=function(e,t=0){return r(e,-t)},t.toPower=r,t.toPrecision=function(e,t=1){return Number(e.toPrecision(t))},t.mod=function(e,t){return(e%t+Math.abs(t))%t},t.constrain=function(e,t,r){return t>r&&([t,r]=[r,t]),e<t?e=t:e>r&&(e=r),e}},9266:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Weak2WayPropMap=void 0,t.Weak2WayPropMap=class{constructor(){this.lm=new WeakMap,this.rm=new WeakMap}updateFromLeft(e,t){let r=this.lm.get(e);if(r&&0!==r.size){for(let[i,a]of t)r.has(i)?this.updateRightLeftMap(i,r.get(i),a,e):this.addRightLeftMap(i,a,e);for(let[i,a]of r)t.has(i)||this.removeRightLeftMap(i,a,e)}else for(let[r,i]of t)this.addRightLeftMap(r,i,e);this.lm.set(e,t)}addRightLeftMap(e,t,r){let i=this.rm.get(e);i||(i=new Map,this.rm.set(e,i));for(let e of t){let t=i.get(e);t||(t=new Set,i.set(e,t)),t.add(r)}}updateRightLeftMap(e,t,r,i){let a=this.rm.get(e);if(a){for(let e of r)if(!t.has(e)){let t=a.get(e);t||(t=new Set,a.set(e,t)),t.add(i)}for(let e of t)if(!r.has(e)){let t=a.get(e);t&&t.delete(i)}}}removeRightLeftMap(e,t,r){let i=this.rm.get(e);if(i)for(let e of t){let t=i.get(e);t&&t.delete(r)}}getFromRight(e,t){let r=this.rm.get(e);if(r)return r.get(t)}clearFromLeft(e){let t=this.lm.get(e);if(t){for(let[r,i]of t)this.removeRightLeftMap(r,i,e);this.lm.delete(e)}}clearFromRight(e){let t=this.rm.get(e);if(t)for(let r of t.values())for(let t of r)this.removeLeftRightMap(t,e)}removeLeftRightMap(e,t){let r=this.lm.get(e);r&&r.delete(t)}restoreFromRight(e){let t=this.rm.get(e);if(t)for(let[r,i]of t.entries())for(let t of i)this.addLeftRightMap(t,e,r)}addLeftRightMap(e,t,r){let i=this.lm.get(e);i||(i=new Map,this.lm.set(e,i));let a=i.get(t);a||(a=new Set,i.set(t,a)),a.add(r)}}},9276:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(2854),a=r(2501);class s extends a.TextACBase{isIn=!0;effectName="AC IN [8PR] Controls";initialize(){super.initialize()}calcAmount(e){let t=(this.effect.frequency||100)/100,r=(this.effect.decay||40)/10,i=Math.cos(e*t*Math.PI*2),a=1/Math.exp(r),s=1/Math.exp(e*r);return s=(s-a)/(1-a),i*s}rotation(){return this.effect.rotation||0}position(){return this.effect.position||[0,0,0]}scale(){return this.effect.scale||[0,0,0]}opacity(){return this.effect.opacity||100}trackingAmount(){return this.effect.tracking||-80}}(0,i.registerTextAnimaterPlugin)("AC IN [8PR] Overshoot",s),(0,i.registerTextAnimaterPlugin)("AC OUT [8PR] Overshoot",class extends s{isIn=!1;effectName="AC OUT [8PR] 2 Controls"})},9315:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"wipeBlurRate",desc:"Wipe Blur Rate",min:0,max:1,step:.01,value:0}];(0,r(4062).extendTransitions)({"slant-wipe-to-top-right":{uniformSlides:i,uniformValues:{directionAngle:45},steps:[{fragShaderName:"wipe"}]},"slant-wipe-to-top-left":{uniformSlides:i,uniformValues:{directionAngle:135},steps:[{fragShaderName:"wipe"}]},"slant-wipe-to-bottom-left":{uniformSlides:i,uniformValues:{directionAngle:-135},steps:[{fragShaderName:"wipe"}]},"slant-wipe-to-bottom-right":{uniformSlides:i,uniformValues:{directionAngle:-45},steps:[{fragShaderName:"wipe"}]}})},9381:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FrontalFacePoints=void 0,t.FrontalFacePoints=[[.19,.506],[.2,.596],[.216,.684],[.244,.766],[.284,.842],[.338,.912],[.398,.974],[.466,1.024],[.546,1.032],[.622,1.014],[.69,.956],[.746,.888],[.792,.81],[.82,.728],[.836,.642],[.842,.556],[.842,.466],[.228,.432],[.262,.388],[.318,.372],[.38,.376],[.438,.398],[.564,.388],[.62,.36],[.68,.352],[.738,.362],[.776,.4],[.51,.488],[.514,.548],[.514,.608],[.516,.668],[.446,.712],[.482,.722],[.52,.73],[.556,.72],[.59,.708],[.3,.506],[.332,.486],[.376,.486],[.414,.514],[.376,.522],[.334,.522],[.6,.506],[.636,.476],[.678,.47],[.716,.488],[.686,.506],[.644,.512],[.392,.812],[.44,.79],[.488,.778],[.52,.786],[.556,.778],[.606,.788],[.656,.806],[.612,.864],[.564,.89],[.524,.894],[.488,.89],[.44,.866],[.412,.816],[.488,.804],[.52,.808],[.56,.804],[.632,.81],[.56,.842],[.522,.846],[.488,.844]]},9395:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8622);Object.defineProperty(t,"observeTarget",{enumerable:!0,get:function(){return i.observeTarget}}),Object.defineProperty(t,"getObservedTarget",{enumerable:!0,get:function(){return i.getObservedTarget}});var a=r(4443);Object.defineProperty(t,"observe",{enumerable:!0,get:function(){return a.observe}});var s=r(5375);Object.defineProperty(t,"observeComTarget",{enumerable:!0,get:function(){return s.observeComTarget}});var n=r(8546);Object.defineProperty(t,"startUpdating",{enumerable:!0,get:function(){return n.startUpdating}}),Object.defineProperty(t,"endUpdating",{enumerable:!0,get:function(){return n.endUpdating}}),Object.defineProperty(t,"clearDependencies",{enumerable:!0,get:function(){return n.clearDependencies}}),Object.defineProperty(t,"clearAsDependency",{enumerable:!0,get:function(){return n.clearAsDependency}}),Object.defineProperty(t,"restoreAsDependency",{enumerable:!0,get:function(){return n.restoreAsDependency}});var o=r(3575);Object.defineProperty(t,"observeGetter",{enumerable:!0,get:function(){return o.observeGetter}})},9509:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodePart=void 0;const i=r(2855),a=r(5145),s=r(2951),n=r(6925);var o;!function(e){e[e.Templates=0]="Templates",e[e.Directive=1]="Directive",e[e.Text=2]="Text"}(o||(o={})),t.NodePart=class{constructor(e,t,r){this.templates=null,this.directive=null,this.textNode=null,this.contentType=null,this.anchor=e,this.context=r,this.update(t)}update(e){let t=this.getContentType(e);switch(t!==this.contentType&&(this.clearContent(),this.contentType=t),t){case o.Directive:this.updateDirective(e);break;case o.Templates:Array.isArray(e)?this.updateTemplates(e.filter((e=>e))):this.updateTemplates([e]);break;default:this.updateText(e)}}getContentType(e){return e instanceof s.DirectiveResult?o.Directive:e instanceof i.TemplateResult||Array.isArray(e)?o.Templates:o.Text}clearContent(){let e=this.contentType;if(null!==e)if(e===o.Directive)this.directive.remove(),this.directive=null;else if(e===o.Templates){for(let e of this.templates)e.remove();this.templates=null}else e===o.Text&&this.textNode&&(this.textNode.remove(),this.textNode=null)}updateDirective(e){if(this.directive){if(this.directive.canMergeWith(...e.args))return void this.directive.merge(...e.args);this.directive.remove()}this.directive=s.createDirectiveFromResult(this.anchor,this.context,e)}updateTemplates(e){let t=this.templates;t||(t=this.templates=[]);let r=Math.min(t.length,e.length);if(r>0)for(let i=0;i<r;i++){let r=t[i],s=e[i];if(r.canMergeWith(s))r.merge(s);else{let e=new a.Template(s,this.context),n=e.range.getFragment();r.range.startNode.before(n),r.remove(),t[i]=e}}if(e.length<t.length)for(let r=t.length-1;r>=e.length;r--)t.pop().remove();else if(t.length<e.length)for(let r=t.length;r<e.length;r++){let i=new a.Template(e[r],this.context),s=i.range.getFragment();this.anchor.insert(s),t.push(i)}}updateText(e){let t=null==e?"":n.trim(String(e));t?this.textNode?this.textNode.textContent=t:(this.textNode=document.createTextNode(t),this.anchor.insert(this.textNode)):this.textNode&&(this.textNode.textContent="")}remove(){this.clearContent()}}},9573:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VectorShapeBaseDrawer=void 0;const i=r(3481),a=r(6376),s=r(2440),n=r(501),o=r(4875),l=r(5305),c=r(5365),d=r(2298),h=r(9658);class u extends h.Drawer{forClipping;fillToDrawType=i.ToDrawType.TriangleStrip;strokeToDrawType=i.ToDrawType.TriangleStrip;toDrawFill=null;toDrawStroke=null;isDataDynamic;values;fillValues;strokeValues;constructor(e,t,r=!1){super(e,t),this.forClipping=r,this.isDataDynamic=this.checkIsDataDynamic()}initialize(){this.data.fill&&(this.toDrawFill=new s.ToDrawTransform({renderer:this.renderer,type:this.fillToDrawType,fragCode:this.getFragCode()})),this.data.stroke&&(this.toDrawStroke=new s.ToDrawTransform({renderer:this.renderer,type:this.strokeToDrawType,fragCode:this.getFragCode()}))}getFragCode(){return this.forClipping?o.default:n.default}checkIsDataDynamic(){return!(!this.data.stroke||!((0,a.isPropertyValueBeKeyFrames)(this.data.stroke.strokeWidth)||this.data.stroke.dashOffset&&(0,a.isPropertyValueBeKeyFrames)(this.data.stroke.dashOffset)||this.data.stroke.dashes&&this.data.stroke.dashes.some((e=>(0,a.isPropertyValueBeKeyFrames)(e)))))}setTime(e){if(this.time=e,this.data.fill&&(this.fillValues=(0,a.getPropertyValues)(this.data.fill,this.time,l.ShapeFillDefaultValues)),this.data.stroke){let e=this.strokeValues=(0,a.getPropertyValues)(this.data.stroke,this.time,l.ShapeStrokeDefaultValues);e.dashes&&(e.dashes=e.dashes.map((e=>(0,a.getPropertyValue)(e,this.time))))}}setTransformStatus(e){if(super.setTransformStatus(e),this.data.transform){let t=(0,c.getTransformValues)(this.data.transform,this.time);e.mergeTransformValues(t)}if(this.data.position){let t=new d.Matrix4;t.translateSelf(...this.values.position),e.mergeTransformMatrix(t)}if(this.fillValues&&this.toDrawFill){let t=e,r=this.fillValues.opacity/100;1!==r&&(t=e.clone(),t.mergeOpacity(r)),this.toDrawFill.setTransformStatus(t)}if(this.strokeValues&&this.toDrawStroke){let t=e,r=this.strokeValues.opacity/100;1!==r&&(t=e.clone(),t.mergeOpacity(r)),this.toDrawStroke.setTransformStatus(t)}}update(){this.fillValues&&this.toDrawFill&&this.toDrawFill.setUniform("solidColor",this.fillValues.color),this.strokeValues&&this.toDrawStroke&&this.toDrawStroke.setUniform("solidColor",this.strokeValues.color),this.updateCoords()}updateCoords(){if(this.toDrawFill&&(this.isDataDynamic||!this.toDrawFill.vertices)){let{coords:e,indices:t}=this.getFillCoords();this.toDrawFill.setCoords(e,void 0,t)}if(this.toDrawStroke&&(this.isDataDynamic||!this.toDrawStroke.vertices)){let{coords:e,indices:t}=this.getStrokCoords();this.toDrawStroke.setCoords(e,void 0,t)}}setMaskArea(e){this.toDrawFill&&this.toDrawFill.setMaskArea(e),this.toDrawStroke&&this.toDrawStroke.setMaskArea(e)}setMappedChannel(e){this.toDrawFill&&this.toDrawFill.setMappedChannel(e),this.toDrawStroke&&this.toDrawStroke.setMappedChannel(e)}clearChannel(){this.toDrawFill&&this.toDrawFill.clearChannel(),this.toDrawStroke&&this.toDrawStroke.clearChannel()}draw(){return this.toDrawFill&&this.toDrawFill.draw(),this.toDrawStroke&&this.toDrawStroke.draw(),this.getPaintArea()}getPaintArea(){return this.toDrawStroke?this.toDrawStroke.getPaintArea():this.toDrawFill?this.toDrawFill.getPaintArea():null}delete(){this.toDrawFill&&this.toDrawFill.delete(),this.toDrawStroke&&this.toDrawStroke.delete()}}t.VectorShapeBaseDrawer=u},9584:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayerStyleDrawer=void 0;const i=r(2440),a=r(5305),s=r(326),n=r(1830),o=r(6376),l=r(9658);class c extends l.Drawer{toBlendLayerStyle;styles;constructor(e,t){super(e,t),this.initializeToDraws()}initializeToDraws(){this.toBlendLayerStyle=new i.ToDrawTransform({renderer:this.renderer});let e={};if((this.data.blendingOption||a.LayerStyleBlendingOptionDefaultValues).fillOpacity){let t=(0,s.getLayerStyleClass)("original");e.fill=new t(this.renderer,this.data)}for(let t of Object.keys(this.data)){if("blendingOption"===t)continue;let r=(0,s.getLayerStyleClass)(t);e[t]=new r(this.renderer,this.data[t])}this.styles=e}setTransformStat(e){super.setTransformStat(e);for(let t of Object.values(this.styles))t.setTransformStat(e)}setTime(e){super.setTime(e);for(let t of Object.values(this.styles))t.setTime(e)}setTransformStatus(e){super.setTransformStatus(e);for(let t of Object.values(this.styles))t.setTransformStatus(e)}update(){for(let e of Object.values(this.styles))e.update()}willDraw(e,t){let{mappedSampler:r,paintArea:i}=this.renderer.drawAsMappedSamplerFromFn((()=>this.drawLayerStyle(e,t)));return i?(this.toBlendLayerStyle.setMappedChannel(r),this.toBlendLayerStyle.setInputPaintArea(i),()=>(this.toBlendLayerStyle.draw(),i)):null}drawLayerStyle(e,t){let r=[];for(let i of Object.keys(this.styles).reverse()){let a=this.styles[i];"dropShadow"===i&&a.setFillOpacity(this.getFillOpacity()),a.setMappedChannel(e);let s=a.draw(t);r.push(s),a.clearChannel()}return n.PaintArea.union(r)}getFillOpacity(){let e=this.data.blendingOption||a.LayerStyleBlendingOptionDefaultValues;return(0,o.getPropertyValue)(e.fillOpacity,this.time)/100}delete(){super.delete();for(let e of Object.values(this.styles))e.delete();this.toBlendLayerStyle.delete()}}t.LayerStyleDrawer=c},9611:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;const a=r(1416);let s=class extends a.Component{constructor(){super(...arguments),this.prefix="",this.path=""}onCreated(){this.path=this.getPathFromUri(location.href),a.on(window,"popstate",this.onStateChange,this)}getPathFromUri(e){let t=new URL(e).pathname;return this.prefix&&t.startsWith(this.prefix)&&(t=t.slice(this.prefix.length)),t||(t="/"),t}onDisconnected(){a.off(window,"popstate",this.onStateChange,this)}onStateChange(e){e.state&&this.redirectTo(e.state.path)}route(e,t,r={}){if(this.isMatch(e)){r.title&&(document.title=r.title);let i=this.match(e);return t({params:i?i.params:{},captures:i?i.captures:[]})}return""}isMatch(e){return n.isMatch(this.path,e)}match(e){return n.matchPath(this.path,e)}goto(e){this.path=e;let t=this.getURIFromPath(e);history.pushState({path:e},"",t)}redirectTo(e){this.path=e;let t=this.getURIFromPath(e);history.replaceState({path:e},"",t)}getURIFromPath(e){return e||(e="/"),this.prefix&&(e=this.prefix+e),e}};var n;s=i([a.define("f-router")],s),t.Router=s,function(e){const t=new Map;function r(e){return t.has(e)?t.get(e):function(e){let r=[],i={re:new RegExp(e.replace(/\./g,"\\.").replace(/\*/g,".*?").replace(/(\/?):(\w+)/g,(function(e,t,i){return i&&r.push(i),t+"?([\\w-]*?)"})).replace(/^/,"^").replace(/$/,"$"),"i"),keys:r};return t.set(e,i),i}(e)}e.isMatch=function(e,t){let i;return i="string"==typeof t?r(t).re:t,i.test(e)},e.matchPath=function(e,t){let i={},a=[];if("string"==typeof t){let{re:a,keys:s}=r(t),n=e.match(a);if(!n)return null;if(s)for(let e=0;e<s.length;e++)i[s[e]]=n[e+1]}else{let r=e.match(t);if(!r)return null;a=[...r]}return{params:i,captures:a}}}(n||(n={}))},9649:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventPart=void 0;const i=r(9856),a=r(8948);t.EventPart=class{constructor(e,t,r,i){this.el=e,this.name="@"===t[0]?t.slice(1):t,this.context=i,this.isComEvent=e.localName.includes("-")&&"@"!==t[0],this.update(r),this.bindListener()}update(e){if("function"!=typeof e)throw new Error(`Failed to register listener at "<${this.el.localName} @${this.name}='${e}'">, listener is not a function`);this.handler=e}bindListener(){if(this.isComEvent){let e=i.getComponent(this.el);e?this.bindComListener(e):i.onComponentCreatedAt(this.el,this.bindComListener.bind(this))}else a.on(this.el,this.name,this.triggerHandler,this)}bindComListener(e){e.on(this.name,this.triggerHandler,this)}triggerHandler(...e){this.handler.call(this.context,...e)}remove(){}}},9658:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Drawer=void 0,t.Drawer=class{data;renderer;time;transformStat;transformStatus;constructor(e,t){this.renderer=e,this.data=t}setTransformStat(e){this.transformStat=e}setTime(e){this.time=e}setTransformStatus(e){this.transformStatus=e}update(){}setMaskArea(e){}draw(e=null){return e}delete(){}}},9663:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"curlRadius",desc:"Curl Radius",min:.01,max:.5,step:.01,value:.05},{name:"shadowBlurRadius",desc:"Shadow Blur Radius",min:0,max:.1,step:.01,value:.02},{name:"shadowAlphaRate",desc:"Shadow Alpha Rate",min:0,max:1,step:.1,value:.2},{name:"backfaceOpacity",desc:"Backface Opacity ",min:0,max:1,step:.1,value:.2}];(0,r(4062).extendTransitions)({"page-curl-to-right":{uniformSlides:i,uniformValues:{directionAngle:0},steps:[{fragShaderName:"page-curl"}]},"page-curl-to-left":{uniformSlides:i,uniformValues:{directionAngle:-180},steps:[{fragShaderName:"page-curl"}]},"page-curl-to-top":{uniformSlides:i,uniformValues:{directionAngle:90},steps:[{fragShaderName:"page-curl"}]},"page-curl-to-bottom":{uniformSlides:i,uniformValues:{directionAngle:-90},steps:[{fragShaderName:"page-curl"}]},"page-curl-to-top-right":{uniformSlides:i,uniformValues:{directionAngle:45},steps:[{fragShaderName:"page-curl"}]},"page-curl-to-top-left":{uniformSlides:i,uniformValues:{directionAngle:135},steps:[{fragShaderName:"page-curl"}]},"page-curl-to-bottom-right":{uniformSlides:i,uniformValues:{directionAngle:-45},steps:[{fragShaderName:"page-curl"}]},"page-curl-to-bottom-left":{uniformSlides:i,uniformValues:{directionAngle:-135},steps:[{fragShaderName:"page-curl"}]}})},9673:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageVideoLayer=void 0;const i=r(7818),a=r(1007),s=r(2824),n=r(4684);class o extends i.PixelLayer{mediaShared;media;croppedSampler;toCropMedia=null;initializeMediaShared(){this.mediaShared=new n.SharedResource(this.getMediaPath())}async initializeToDraw(){let e=this.getToDrawVertexCode();this.toDraw=new a.ToDrawImageVideo({renderer:this.renderer,fragCode:e});let t=this.data.width,r=this.data.height,i=[[0,0],[0,r],[t,0],[t,r]];this.toDraw.setCoords(i,[[0,1],[0,0],[1,1],[1,0]]),this.willCropMedia()?(await this.initializeToCropMedia(),await this.setMedia(),"image"===this.data.type&&await this.mediaShared.deleteUnique("toCropMedia")):await this.setMedia()}getToDrawVertexCode(){}getMediaPath(){return this.renderer.resourceLoader.getLayerPath(this.data)}willCropMedia(){let{mediaWidth:e,mediaHeight:t}=this.data,r=this.data.width,i=this.data.height;return Math.round(i*e/t)!==r}async initializeToCropMedia(){this.toCropMedia=await this.mediaShared.unique("toCropMedia",(()=>this.createToCropMedia()),(()=>this.deleteToCropMedia()))}async deleteToCropMedia(){this.toCropMedia.delete(),this.toCropMedia=null}createToCropMedia(){let{mediaWidth:e,mediaHeight:t}=this.data,r=this.data.width,i=this.data.height;r>e&&(i=Math.round(i/r*e),r=e),i>t&&(r=Math.round(r/i*t),i=t);let s=[[0,0],[0,i],[r,0],[r,i]],n=this.getCroppedTextureCoords(),o=new a.ToDrawImageVideo({renderer:this.renderer});return o.setCoords(s,n),o}getCroppedTextureCoords(){let{mediaWidth:e,mediaHeight:t,mediaPosition:r}=this.data,i=this.data.width,a=this.data.height,s=1,n=0,o=0,l=1;if(e/t>i/a){let s=t/e/(a/i);o=(1-s)*r[0],l=s+o}else{let o=e/t/(i/a);s=1+(o-1)*r[1],n=s-o}return[[o,s],[o,n],[l,s],[l,n]]}async setMedia(){if(this.toCropMedia){let e=await this.mediaShared.syncOnce("updateMedia",(async()=>(await this.setMediaOf(this.toCropMedia),this.cropMediaAsSampler())));this.toDraw.setChannel(e)}else await this.setMediaOf(this.toDraw)}async setMediaOf(e){e.setSubMedia(0,this.media)}cropMediaAsSampler(){let e=this.toCropMedia,t={filter:s.SamplerFilter.Linear},r=e.getPaintArea(),i=this.renderer.project.data.width,a=this.renderer.project.data.height,n=this.renderer.sw.textureFrameManager.request(r,i,a,!1,1,t);return n.active(),e.draw(),n.deactive(),n.getSampler()}drawAsMappedSampler(){let e=this.extractMappedSampler();return e?{mappedSampler:e,paintArea:this.toDraw.getPaintArea()}:super.drawAsMappedSampler()}extractMappedSampler(){return this.layerStyleDrawer||this.maskDrawer?null:this.toDraw.extractMappedSampler()}delete(){super.delete(),this.mediaShared.delete()}}t.ImageVideoLayer=o},9687:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observeArrayTarget=void 0;const i=r(8546),a=r(8622),s=["push","pop","unshift","splice","shift","sort"];t.observeArrayTarget=function(e){let t=new Proxy(e,n);return a.proxyMap.set(e,t),a.proxyMap.set(t,t),a.targetMap.set(t,e),t};const n={get(e,t){let r=e[t],n=typeof r;if(e.hasOwnProperty(t)){if(i.mayAddDependency(e),r&&"object"===n){if(a.proxyMap.has(r))return a.proxyMap.get(r);if(i.isUpdating())return a.observeTarget(r)}}else"function"===n&&(i.mayAddDependency(e),s.includes(t)&&i.notifyObjectSet(e));return r},set:(e,t,r)=>(e[t]=r,i.notifyObjectSet(e),!0),has:(e,t)=>(i.mayAddDependency(e),t in e),deleteProperty:(e,t)=>!e.hasOwnProperty(t)||(i.mayAddDependency(e),delete e[t])}},9694:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec2 fTextureCoord;\nout vec4 fragColor;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform sampler2D iChannel[1];\nuniform mat4 iChannelMap[1];\nuniform float iOpacity;\nuniform float effectOpacity;\nuniform vec4 \t fillColor;\nuniform float fillOpacity;\nvec4 getFragColor() {\nvec2 textureCoord = (iChannelMap[0] * vec4(fTextureCoord, 0, 1)).xy;\nfloat colorAlpha = texture(iChannel[0], textureCoord).a;\nvec4 color = fillColor * colorAlpha;\ncolor *= fillOpacity;\nvec4 inputColor = texture(iChannel[0], textureCoord);\ncolor = mix(inputColor, color, effectOpacity);\ncolor *= iOpacity;\nreturn color;\n}\nvoid main() {\nfragColor = getFragColor();\n}\n"},9729:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="#version 300 es\n#ifdef GL_ES\nprecision mediump float;\n#endif\nin vec4 vPosition;\nin vec2 vTextureCoord;\nout vec2 fTextureCoord;\nout vec4 fRawCoord;\nout vec4 fProjectedCoord;\nuniform vec2 iResolution;\nuniform vec2 iVideoResolution;\nuniform mat4 iTransform;\nuniform mat4 iSamplingTransform;\nuniform mat4 iProjection;\nmat4 getPixelReflectionMatrix() {\nfloat w = iVideoResolution.x / 2.0;\nfloat h = iVideoResolution.y / 2.0;\nreturn mat4(\nw, 0, 0, 0,\n0, -h, 0, 0,\n0, 0, 0, 0,\nw, h, 0, 1\n);\n}\nvoid main() {\nvec4 openGLCoord = iProjection * iTransform * vPosition;;\nvec4 projectedCoord = getPixelReflectionMatrix() * openGLCoord;\ngl_Position = openGLCoord;\nfProjectedCoord = projectedCoord;\nfRawCoord = vPosition;\nfTextureCoord = (iSamplingTransform * vec4(vTextureCoord, 0, 1)).xy;\n}\n"},9737:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoLayer=void 0;const i=r(6376),a=r(7928),s=r(5499),n=r(1954),o=r(9673),l=r(4633);class c extends o.ImageVideoLayer{mediaVolume=1;needToPlay=!1;framesExtractor=null;async initialize(){await super.initialize(),this.media=await this.renderer.resourceLoader.loadVideo(this.data),this.data.mediaWidth=this.media.videoWidth,this.data.mediaHeight=this.media.videoHeight,this.media.volume=1,this.data.loop&&this.data.loop>1&&(this.media.loop=!0),(0,l.isMacSystem)()&&(this.framesExtractor=new n.VideoFrameExtractor),this.initializeMediaShared(),await this.initializeToDraw()}async setMediaOf(e){if(this.framesExtractor){let t=await this.framesExtractor.extract(this.media);e.setSubMedia(0,t)}else await super.setMediaOf(e)}active(){this.activated||(super.active(),this.mediaShared.syncEvery("pause",(async()=>!1)),this.media.paused&&(this.needToPlay=!0))}deactive(){this.activated&&(super.deactive(),this.mediaShared.syncEvery("pause",(async()=>(await(0,s.sleep)(16),!0))).then((e=>{e&&this.media.pause()})))}async syncTime(e){await this.mediaShared.syncOnce("updateTime",(async()=>{await this.updateMediaTime(e)})),this.media.readyState>=this.media.HAVE_CURRENT_DATA&&await this.setMedia()}async updateMediaTime(e){let t=Math.max(e,0),r=this.media.duration,i=this.data.frameRate,s=e>=0&&this.needToPlay;this.activated||(t+=.5/i),this.data.loop&&this.data.loop>1&&t>r?t%=r:t=Math.min(t,r);let o=(0,n.isSameFrameTimes)(t,this.media.currentTime,this.data.frameRate),l=(s||!this.activated)&&!o||this.activated&&Math.abs(t-this.media.currentTime)>1;if(l&&(this.media.currentTime=t),s){let e=a.debug.timeStart("Video Playing");try{await this.media.play()}catch(e){a.debug.log(e)}e(),this.needToPlay=!1}!this.activated&&l&&this.media.readyState<this.media.HAVE_CURRENT_DATA&&await this.waitForVideoDecoded()}async waitForVideoDecoded(){let e=a.debug.timeStart("Video Decoding");await(0,n.waitForVideoDecoded)(this.media,1e3)&&e()}update(){if(this.activated){let e=(0,i.getPropertyValue)(this.data.audioLevels,this.time,[0,0]),t=Math.pow(10,e[0]/10);t!==this.mediaVolume&&(this.media.volume=t,this.mediaVolume=t)}}}t.VideoLayer=c},9739:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Emitter=void 0,t.Emitter=class{constructor(){this.__events=new Map}__ensureEvents(e){let t=this.__events.get(e);return t||this.__events.set(e,t=[]),t}on(e,t,r){this.__ensureEvents(e).push({listener:t,scope:r,once:!1})}once(e,t,r){this.__ensureEvents(e).push({listener:t,scope:r,once:!0})}off(e,t,r){let i=this.__events.get(e);if(i)for(let e=i.length-1;e>=0;e--){let a=i[e];a.listener!==t||r&&a.scope!==r||i.splice(e,1)}}hasListener(e,t,r){let i=this.__events.get(e);if(!t)return!!i&&i.length>0;if(i&&t)for(let e=0,a=i.length;e<a;e++){let a=i[e];if(a.listener===t&&(!r||a.scope===r))return!0}return!1}emit(e,...t){let r=this.__events.get(e);if(r)for(let e=0;e<r.length;e++){let i=r[e];!0===i.once&&r.splice(e--,1),i.listener.apply(i.scope,t)}}removeAllListeners(){this.__events=new Map}}},9749:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extendsTemplateResult=void 0;const i=r(996),a=r(2855),s=r(6030),n=new Map;function o(e,t){return e.splice(t,c(e,t)+1-t)}function l(e,t){return e.splice(t+1,c(e,t)-1-t)}function c(e,t){let r=1;for(let a=t+1;a<e.length;a++){let t=e[a];switch(t.type){case i.HTMLTokenType.StartTag:t.selfClose||r++;break;case i.HTMLTokenType.EndTag:if(r--,0===r)return a}}return e.length-1}t.extendsTemplateResult=function(e,t){let r,c=[...e.values,...t.values],d=s.joinWithOrderedMarkers(e.strings),h=s.joinWithOrderedMarkers(t.strings,e.values.length),u=n.get(d);u&&(r=u.get(h)),r||(r=function(e,t){let r=i.parseToHTMLTokens(e),{attributes:a,slots:c,restTokens:d}=function(e){let t=e.findIndex((e=>e.type===i.HTMLTokenType.StartTag)),r=e.length-1,a=0,s=e[t].attributes,n={},l=[];for(let t=0;t<e.length;t++){let s=e[t];switch(s.type){case i.HTMLTokenType.StartTag:if(/slot\s*=\s*['"](\w+)/.test(s.attributes)){let r=s.attributes.match(/slot\s*=\s*['"](\w+)/)[1],i=o(e,t);n[r]=n[r]||[],n[r].push(...i),t--}else s.selfClose||a++;break;case i.HTMLTokenType.EndTag:a--,0===a&&(r=t+1)}}return r-t>2&&(l=e.slice(t+1,r-1)),{attributes:s,slots:n,restTokens:l}}(r),h=function(e){let t=i.parseToHTMLTokens(e),r=t[0];return r&&r.type===i.HTMLTokenType.StartTag&&"template"===r.tagName||(t.unshift({type:i.HTMLTokenType.StartTag,tagName:"template",attributes:""}),t.push({type:i.HTMLTokenType.EndTag,tagName:"template"})),t}(t);!function(e,t,r,a){if(e[0].attributes+=t,Object.keys(r).length>0||a.length>0)for(let t=0;t<e.length;t++){let s=e[t];if(s.type===i.HTMLTokenType.StartTag&&"slot"===s.tagName){let i=s.attributes.match(/name\s*=\s*['"](\w+)/),n=i?i[1]:null;if(n){if(r[n]){let i=r[n];l(e,t),e.splice(t+1,0,...i),t+=i.length}}else a.length&&(o(e,t),e.splice(t,0,...a),t+=a.length)}}}(h,a,c,d);let u=s.splitByOrderedMarkers(i.joinHTMLTokens(h)),p=n.get(e);return p||(p=new Map,n.set(e,p)),p.set(t,u),u}(d,h));let{strings:p,valueIndexes:m}=r,f=m.map((e=>c[e]));return new a.TemplateResult(e.type,p,f)}},9771:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Slider=void 0;const a=r(1416),s=r(8240),n=r(5499),o=r(6585);let l=class extends a.Component{constructor(){super(...arguments),this.vertical=!1,this.min=0,this.max=100,this.step=1,this.value=0,this.decimalCount=null,this.draging=!1}static style(){let{mainColor:e,borderColor:t,adjust:r,adjustFontSize:i,focusBlurRadius:n,backgroundColor:o}=s.theme,l=2*Math.ceil(r(7))+1;return a.css`
		:host{
			display: inline-flex;
			vertical-align: top;
			flex-direction: column;
			justify-content: center;
			position: relative;
			width: ${r(150)}px;
			height: ${r(28)}px;
			font-size: ${i(13)}px;
			cursor: pointer;

			&:focus .ball{
				box-shadow: 0 0 ${n}px ${e};
				border-color: ${e};
			}
		}

		.groove{
			position: relative;
			height: ${1}px;
		}

		.groove-bg{
			position: absolute;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background: ${t};
		}
	
		.progress{
			position: relative;
			background: ${e};
			height: 100%;
		}
	
		.ball{
			position: absolute;
			top: -${(l-1)/2}px;
			right: -${Math.round(l/2)}px;
			will-change: top right;
			border-radius: 50%;
			border: 1px solid ${t};
			background: ${o};
			float: right;
			width: ${l}px;
			height: ${l}px;

			&:hover{
				border-color: ${e};
			}
		}

		.dragging{
			.ball{
				border-color: ${e.darken(10)};
				background: ${e.darken(10)};
			}
		}

		:host[vertical]{
			width: ${r(30)}px;
			height: ${r(150)}px;
			flex-direction: row;

			.groove{
				width: ${1}px;
				height: 100%;
			}

			.progress{
				position: absolute;
				bottom: 0;
				width: 100%;
				height: 0;
			}

			.ball{
				margin: -${Math.round(l/2)}px -${(l-1)/2}px;
			}
		}

		.tooltip{
			font-family: monospace;
		}
		`}render(){let e=o.tooltip(this.renderTooltipValue(),{alignTo:()=>this.refs.ball,alignPosition:this.vertical?"r":"t"});return a.html`
		<template
			tabindex="0"
			:class.dragging=${this.draging}
			${e}
			@@mousedown=${this.onMouseDown}
			@@focus=${this.onFocus}
			@@blur=${this.onBlur}
		>
			<div class="groove" :ref="groove">
				<div class="groove-bg" />
				<div class="progress"
					:style.width.percent=${this.vertical?"":this.getPercent()}
					:style.height.percent=${this.vertical?this.getPercent():""}
				>
					<div class="ball" :ref="ball" />
				</div>
			</div>
		</template>
		`}renderTooltipValue(){let e=this.decimalCount;null===e&&(e=String(this.step).replace(/^\d+\.?/,"").length);let t=this.value.toFixed(e);return a.html`<span class="${this.scopeClassName("tooltip")}">${t}</span>`}getPercent(){if(this.value===this.min)return 0;let e=(this.value-this.min)/(this.max-this.min)*100;return n.constrain(e,0,100)}onMouseDown(e){let t=n.getRect(this.refs.groove),r=n.MouseLeave.keep(this.el);this.draging=!0,e.target.matches(this.scopeClassName(".ball"))||this.changeValueByEvent(e,t);let i=e=>{e.preventDefault(),this.changeValueByEvent(e,t)};a.on(document,"mousemove",i),a.once(document,"mouseup",(()=>{a.off(document,"mousemove",i),r(),this.draging=!1,this.emit("dragend")})),this.emit("dragstart")}changeValueByEvent(e,t){let r;r=this.vertical?n.constrain(1-(e.clientY-t.top)/t.height,0,1):n.constrain((e.clientX-t.left)/t.width,0,1);let i=(this.max-this.min)*r;this.step&&(i=Math.round(i/this.step)*this.step);let a=this.value,s=n.toDecimal(this.min+i,4);s!==a&&this.emit("change",this.value=s)}onWheel(e){if(!this.step||document.activeElement!==this.el)return;let t;t=e.deltaY<0&&this.vertical||e.deltaY>0&&!this.vertical?n.toDecimal(Math.min(this.value+this.step,this.max),4):n.toDecimal(Math.max(this.value-this.step,this.min),4),t!==this.value&&this.emit("change",this.value=t)}onFocus(){this.onBlur(),a.on(document,"keydown",this.onKeyDown,this),a.on(document,"wheel.prevent",this.onWheel,this)}onKeyDown(e){let t;this.vertical?"ArrowUp"===e.key?(e.preventDefault(),t=Math.min(this.value+this.step,this.max)):"ArrowDown"===e.key&&(e.preventDefault(),t=Math.max(this.value-this.step,this.min)):"ArrowLeft"===e.key?(e.preventDefault(),t=Math.max(this.value-this.step,this.min)):"ArrowRight"===e.key&&(e.preventDefault(),t=Math.min(this.value+this.step,this.max)),void 0!==t&&t!==this.value&&this.emit("change",this.value=t)}onBlur(){a.off(document,"keydown",this.onKeyDown,this),a.off(document,"wheel",this.onWheel,this)}};l=i([a.define("f-slider")],l),t.Slider=l},9773:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(2846),t),a(r(47),t),a(r(5242),t),a(r(6540),t),a(r(2443),t),a(r(2037),t),a(r(5417),t),a(r(4869),t),a(r(7947),t),a(r(7185),t),a(r(8638),t),a(r(2069),t),r(2623),a(r(4718),t)},9782:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var a,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,r,n):a(t,r))||n);return s>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;const a=r(1416),s=r(8240);let n=class extends a.Component{constructor(){super(...arguments),this.herizontal=!1,this.triangle=!0,this.appendTo="body",this.defaultPopupOptions=null,this.binding=null}static style(){let{popupBorderRadius:e,popupBackgroundColor:t,popupShadowBlurRadius:r,popupShadowColor:i,adjust:n}=s.theme,o=n(10),l=n(7),c=n(11);return a.css`
		:host{
			position: absolute;
			left: 0;
			top: 0;
			z-index: 1000;	// Same with window, so if in window, we must move it behind the window
			background: ${t};
			border-radius: ${e}px;
			filter: drop-shadow(0 0 ${r/2}px ${i});	// 3px nearly equals 6px in box-shadow.
		}

		.triangle{
			// Must be the styles in top position
			position: absolute;
			border-left: ${o/2}px solid transparent;
			border-right: ${o/2}px solid transparent;
			border-bottom: ${l}px solid ${t};
			top: -${l}px;
			left: ${c}px;	// 11 + 5 = 16

			&-herizontal{
				border-top: ${o/2}px solid transparent;
				border-bottom: ${o/2}px solid transparent;
				border-right: ${l}px solid ${t};
				border-left: 0;
				top: ${c}px;
				left: -${l}px;
			}
		}
		`}render(){return a.html`
		<template tabindex="0">
			${this.triangle?a.html`
				<div class="triangle" :ref="triangle" :class.triangle-herizontal=${this.herizontal} />
			`:""}
			<slot />
		</template>
		`}onConnected(){this.applyAppendTo()}applyAppendTo(){this.appendTo&&a.appendTo(this.el,this.appendTo)}setPopupBinding(e){this.binding=e}close(){this.binding?this.binding.hidePopupLater():this.el.remove()}};n=i([a.define("f-popup")],n),t.Popup=n},9803:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=[{name:"cellSizeRate",desc:"Cell Size Rate",min:.01,max:1,step:.01,value:.1}];(0,r(4062).extendTransitions)({"grid-zoom-in":{uniformSlides:i,uniformValues:{beZoomOut:!1,cellZoomOrigin:[.5,.5]},steps:[{fragShaderName:"grid-zoom"}]},"grid-zoom-out":{uniformSlides:i,uniformValues:{beZoomOut:!0,cellZoomOrigin:[.5,.5]},steps:[{fragShaderName:"grid-zoom"}]},"grid-zoom-in-from-top-left":{uniformSlides:i,uniformValues:{beZoomOut:!1,cellZoomOrigin:[0,1]},steps:[{fragShaderName:"grid-zoom"}]},"grid-zoom-out-from-top-left":{uniformSlides:i,uniformValues:{beZoomOut:!0,cellZoomOrigin:[1,0]},steps:[{fragShaderName:"grid-zoom"}]}})},9811:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoPerFrameLayer=void 0;const i=r(4088),a=r(9673),s=r(8086);class n extends a.ImageVideoLayer{mediaAlpha;extractAlphaChannel=!1;lastFrameTime=0;framesExtractor;lastProgress=0;async initialize(){await super.initialize(),this.initializeMediaShared(),await this.initializeFramesExtractor();let e=this.framesExtractor.mediaInfo;this.extractAlphaChannel=this.framesExtractor.extractAlphaChannel,this.data.mediaWidth=e.video.width,this.data.mediaHeight=e.video.height,this.data.duration=e.duration,this.data.frameRate=e.video.frameRate,await this.initializeToDraw()}mayHaveAlphaChannel(){return!this.data.replaceable}getToDrawVertexCode(){return this.extractAlphaChannel?s.default:void 0}async setMediaOf(e){await super.setMediaOf(e),this.extractAlphaChannel&&e.setSubMedia(1,this.mediaAlpha)}async initializeFramesExtractor(){this.framesExtractor=await this.mediaShared.unique("framesExtractor",(async()=>this.createFramesExtractor()),(async()=>this.deleteFramesExtractor()))}async createFramesExtractor(){let e=this.mayHaveAlphaChannel(),t=new i.VideoFramesExtractor(this.getMediaPath(),"jpeg",e);return await t.ready,t.on("progress",this.renderer.project.encoder.getFramesExtractProgressFn()),t}async deleteFramesExtractor(){this.framesExtractor.delete()}async syncTime(e){let t=Math.max(e,0),r=this.framesExtractor.mediaInfo.duration;this.data.loop&&this.data.loop>1&&e>r?e%=r:t=Math.min(e,r);let i=await this.framesExtractor.getFrameAtTime(t);i&&(this.media=i.image,this.mediaAlpha=i.alpha,await this.setMedia(),this.lastFrameTime=e)}extractMappedSampler(){return this.extractAlphaChannel?null:super.extractMappedSampler()}delete(){super.delete()}}t.VideoPerFrameLayer=n},9819:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(4062),a=r(2824),s=r(2298),n=[-1,1,0,-1,-1,0,0,1,0,0,-1,0],o=[0,1,0,0,-1,0,1,1,0,1,-1,0],l=[-1,1,0,-1,0,0,1,1,0,1,0,0],c=[-1,0,0,-1,-1,0,1,0,0,1,-1,0];(0,i.extendTransitions)({"split-herizontal":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:n,transform:e=>(new s.Matrix4).translateSelf(-e)},{useTexture:i.TextureReference.Source,vertices:o,transform:e=>(new s.Matrix4).translateSelf(e)}]},"split-vertical":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:l,transform:e=>(new s.Matrix4).translateSelf(0,e)},{useTexture:i.TextureReference.Source,vertices:c,transform:e=>(new s.Matrix4).translateSelf(0,-e)}]},"split-herizontal-fade":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:n,transform:e=>(new s.Matrix4).translateSelf(-e),fragShaderName:"split-fade"},{useTexture:i.TextureReference.Source,vertices:o,transform:e=>(new s.Matrix4).translateSelf(e),fragShaderName:"split-fade"}]},"split-vertical-fade":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:l,transform:e=>(new s.Matrix4).translateSelf(0,e),fragShaderName:"split-fade"},{useTexture:i.TextureReference.Source,vertices:c,transform:e=>(new s.Matrix4).translateSelf(0,-e),fragShaderName:"split-fade"}]},"split-herizontal-fade-black":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:n,transform:e=>(new s.Matrix4).translateSelf(-e),fragShaderName:"split-fade-black"},{useTexture:i.TextureReference.Source,vertices:o,transform:e=>(new s.Matrix4).translateSelf(e),fragShaderName:"split-fade-black"}]},"split-vertical-fade-black":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:l,transform:e=>(new s.Matrix4).translateSelf(0,e),fragShaderName:"split-fade-black"},{useTexture:i.TextureReference.Source,vertices:c,transform:e=>(new s.Matrix4).translateSelf(0,-e),fragShaderName:"split-fade-black"}]},"split-herizontal-cross":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:n,transform:e=>(new s.Matrix4).translateSelf(0,2*-e),fragShaderName:"split-fade"},{vertices:o,transform:e=>(new s.Matrix4).translateSelf(0,2*e),fragShaderName:"split-fade"}]},"split-vertical-cross":{sourceParams:{filter:a.SamplerFilter.Linear},steps:[{useTexture:i.TextureReference.Target},{useTexture:i.TextureReference.Source,vertices:l,transform:e=>(new s.Matrix4).translateSelf(2*e),fragShaderName:"split-fade"},{vertices:c,transform:e=>(new s.Matrix4).translateSelf(2*-e),fragShaderName:"split-fade"}]}})},9838:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.NodeRange=t.NodeAnchor=t.NodeAnchorType=void 0,function(e){e[e.Next=0]="Next",e[e.Root=1]="Root",e[e.Parent=2]="Parent"}(r=t.NodeAnchorType||(t.NodeAnchorType={})),t.NodeAnchor=class{constructor(e,t){this.el=e,this.type=t}insert(e){this.type===r.Next?this.el.before(e):this.el.append(e)}},t.NodeRange=class{constructor(e){this.fragment=null,this.fragment=e;let t=e.firstChild;t&&8!==t.nodeType||(t=document.createComment(""),e.prepend(t)),this.startNode=t,this.endNode=e.lastChild}getFragment(){let e;return this.fragment?(e=this.fragment,this.fragment=null):(e=document.createDocumentFragment(),e.append(...this.getNodes())),e}cacheFragment(){this.fragment=this.getFragment()}getNodes(){let e=[],t=this.startNode;for(;t&&(e.push(t),t!==this.endNode);)t=t.nextSibling;return e}getFirstElement(){let e=this.startNode;for(;e;){if(1===e.nodeType)return e;if(e===this.endNode)break;e=e.nextSibling}return null}remove(){this.getNodes().forEach((e=>e.remove()))}}},9856:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(900);Object.defineProperty(t,"getComponentConstructor",{enumerable:!0,get:function(){return i.getComponentConstructor}});var a=r(2255);Object.defineProperty(t,"Component",{enumerable:!0,get:function(){return a.Component}});var s=r(8231);Object.defineProperty(t,"getComponent",{enumerable:!0,get:function(){return s.getComponent}}),Object.defineProperty(t,"getComponentAsync",{enumerable:!0,get:function(){return s.getComponentAsync}}),Object.defineProperty(t,"getClosestComponent",{enumerable:!0,get:function(){return s.getClosestComponent}});var n=r(967);Object.defineProperty(t,"onComponentCreatedAt",{enumerable:!0,get:function(){return n.onComponentCreatedAt}}),Object.defineProperty(t,"updateComponents",{enumerable:!0,get:function(){return n.updateComponents}});var o=r(3393);Object.defineProperty(t,"getScopedClassNameSet",{enumerable:!0,get:function(){return o.getScopedClassNameSet}}),Object.defineProperty(t,"addGlobalStyle",{enumerable:!0,get:function(){return o.addGlobalStyle}}),Object.defineProperty(t,"updateStyles",{enumerable:!0,get:function(){return o.updateStyles}});var l=r(589);Object.defineProperty(t,"define",{enumerable:!0,get:function(){return l.define}}),Object.defineProperty(t,"createComponent",{enumerable:!0,get:function(){return l.createComponent}})},9886:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Timeline=void 0;const i=r(1443),a=r(5499);t.Timeline=class{project;timeOffset=1e-8;mutatedTimeRange=[-1,-1];mutatedTimeRangeForPreloading=[-1,-1];preloadedTimeRange=null;constructor(e){this.project=e,e.on("updateproject",this.resetAllTimeRanges,this),e.on("updatetimeline",this.resetTimeRange,this),e.on("updatelayer",this.resetTimeRange,this),e.on("updateeffect",this.resetTimeRange,this)}resetTimeRange(){this.mutatedTimeRange=[-1,-1]}resetAllTimeRanges(){this.mutatedTimeRange=[-1,-1],this.mutatedTimeRangeForPreloading=[-1,-1],this.preloadedTimeRange=null}getStartSafeTime(){return this.mutatedTimeRange[0]}getMutatedLayerDatas(e){return(e=(0,a.constrain)(e+this.timeOffset,0,this.project.data.duration))>=this.mutatedTimeRange[0]&&e<=this.mutatedTimeRange[1]?null:this.getShouldActivateLayerDatas(e)}getShouldActivateLayerDatas(e){let{datas:t,timeMoves:r}=this.filterRootLayerDatasFromTimeBounds(e,e),i=r.map((t=>t+e)),a=new Set;return t=t.filter((({rawId:e})=>!a.has(e)&&(a.add(e),!0))),this.mutatedTimeRange=i,t}getMutatedPreloadLayerDatas(e,t=this.project.options.preserveSeconds,r=this.project.options.preloadSeconds){return e>=this.mutatedTimeRangeForPreloading[0]&&e<=this.mutatedTimeRangeForPreloading[1]?null:this.getShouldPreloadLayerDatas(e,t,r)}getShouldPreloadLayerDatas(e,t,r){this.preloadedTimeRange&&e>=this.preloadedTimeRange[0]&&(r=Math.max(r,this.preloadedTimeRange[1]-e));let{datas:i,timeMoves:a}=this.filterRootLayerDatasFromTimeBounds(e-t,e+r),s=a.map((t=>t+e));return this.mutatedTimeRangeForPreloading=s,this.preloadedTimeRange=[Math.max(0,e-t),Math.min(e+r,this.project.data.duration)],i}filterRootLayerDatasFromTimeBounds(e,t){let r=this.project.data.duration;return this.filterLayerDatasFromTimeBounds(this.project.data.layers,r,e,t)}filterLayerDatasFromTimeBounds(e,t,r,i){let a=-t,s=t,n=[];for(let t of e){let{inPoint:e,outPoint:o,hidden:l}=t;if(l)continue;let c=[e-r,o-r,e-i,o-i];for(let e of c)e<0?a=Math.max(a,e):e>0&&(s=Math.min(s,e));if(o>=r&&e<=i&&(n.push(t),"composite"===t.type)){let{datas:e,timeMoves:n}=this.filterCompLayerDatasFromTimeBounds(t,r,i);t.layers=e,a=Math.max(a,n[0]),s=Math.min(s,n[1])}}return{datas:n,timeMoves:[a,s]}}filterCompLayerDatasFromTimeBounds(e,t,r){let a=this.project.data.getCompItemFromId(e.compItemId),s=i.TimeMap.fromLayer(e),n=s.map(t),o=s.map(r),l=(o-n)/(r-t)||1,{datas:c,timeMoves:d}=this.filterLayerDatasFromTimeBounds(a.layers,a.duration,n,o);return{datas:c,timeMoves:d.map((e=>e/l))}}}},9997:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.random=t.seedRandom=void 0,t.seedRandom=function(e,t,r){let i=43758.5453*Math.sin(12.9898*r+78.233);return e+(i-Math.floor(i))*(t-e)},t.random=function(e,t=0){return Math.random()*(t-e)+e}}},t={};function r(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(9773)})();
//# sourceMappingURL=bundle.js.map