# 其他算法备注

以下算法均来自于对于 Adobe Photoshop 的调色效果的逆向分析, 具体的算法会在需要的时候实现然后进行对照和调整.


### 色阶

色阶的调整基于 Gamma, 可调整范围 `e` 在 0.01 ~ 10 之间. 其具体的调整算法如下:

`y = x^e`

其中 x 为原通道值, y 为新的通道值.


### 色彩曲线

通过插入一个或者多个点得到一个通过 (0, 0), (1, 1) 和插入点的曲线, 这个曲线可以通过对应次数的贝塞尔曲线, 或者三次 Catmull–Rom (参见计算机图形学) 贝塞尔曲线.


### 色彩平衡 - 保留明度

在调整一个通道值时, 也会分别升高或者降低另外两个通道值来保持 RGB 均值不变.


### 黑白

黑白可以指定每个通道的分量百分比, 最终每个通道的输出均为一个相同的值 `Gray`:

`Gray = R * R 百分比 + G * G 百分比 + B * B 百分比`

如果需要叠加一个颜色来指定色调, 则每个通道的值 C 为此颜色的原通道值乘以上面的灰度值:

`C = C * Gray`

这个用于色调的颜色通过满明度 (有一个通道值为 1, 一个为 0) 的 HSL 颜色来指定.


### 通道混合

使用一个为每个通道配置的一个 RGBN 分量构成一个 4 * 3 的矩阵, 然后乘以向量 `(R, G, B, 1)` 得到 `(R', G', B')`.


### 反相

每个通道值 C 改变为:

`1 - C`


### 色调分离

色调分离一般有一个值为 2~256 的色阶参数, 它的含义为将 0~1 的通道区间分为阶梯, 例如阶梯为 2 时, 只有 `0, 1` 两个值; 为 3 时, 分为 `0, 0.5, 1` 3 个值.

然后对于 RGB 每个通道值, 将新的值设置为距离自己最近的阶梯的值.


### 阈值

阈值需要设置一个中间阈值, 一般是 128 (即 0~1 范围的 0.5), RGB 均值小于它时被设置为黑色, 否则白色.


### 渐变映射

获得像素的 RGB 均值, 然后查找此值在线性渐变的对应坐标处的颜色, 使用该颜色替代之前的颜色.


### 可选颜色 / CMYK 颜色

将颜色转换为 CMYK 颜色然后将调整百分比转为 -1~1 加到每个分量上.


### 色调均化

色调均化根据 RGB 均值的变化, 将集中的区域拉长, 稀疏的区域缩短, 从而让颜色在 0~1 的区间分布比较均匀.

猜测算法为对 RGB 均值在 0~1 的分布进行积分, 越集中的区域导数越大, 则积分曲线越陡峭. 然后将积分得到的函数重新映射到 0~1 范围, 将 RGB 通道值按照这个函数进行转换.

积分时使用的导数需要进行上下限处理, 例如上限 5, 下限 0.5, 这样可以防止最后生成的图像因为变化过大和原来截然不同.


### 3D LUT 文件

3D LUT 是 RGB 颜色映射文件, 它一般包含了 r^3 个数值 (r 一般为 2^n + 1), 可以通过线性插值还原到 256^3 个数字, 从而和 RGB 空间的颜色一一对应.



## 备注

以上算法中的 RGB 均值也可以使用 HSL 的亮度 (侧重于保持颜色), 或者灰度值 (侧重于保持灰阶) 来代替.