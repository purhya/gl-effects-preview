# 函数拟合 (Function Fitting)


### 根据穿过的点拟合函数

<function-generator></function-generator>


### 一个范例

在查询对比度的算法时, 这篇文章: <https://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/> 给出了一个调整因数:

$y = \frac{259 \* (100x + 255)}{255 \* (259 - 100x)}$

<function-curve .fn="y = 259 * (x * 100 + 255) / (255 * (259 - x * 100));" .xRange="[-1,1]"></function-curve>

这个函数是一个二次曲线. 它大体上经过了 $(-1, 0.4)$, $(0, 1)$, $(1, 2.3)$ 三个点.

如果你希望能稍微减小在 $x = -1$ 时 $y$ 的值, 比如从现在的大概 0.45 减为 0.3, 你也可以自己构造一个二次函数, 它通过三个点 $(-1, 0.3)$, $(0, 1)$, $(1, 2.3)$, 通过简单的数学解析即可获得该方程. 不过对于更一般的经过三个点的二次曲线构造, 如果用到一点线性代数知识的话会更加简单.

我们可以稍微修改为一个新的形式, 例如 $y = 0.3x^2 + x + 1$.

<function-curve .fn="y = 0.3 * x * x + x + 1" .xRange="[-1,1]"></function-curve>

这个曲线和之前曲线很类似, 但是还是有区别, 你可以看到它在 $x = 0$ 的变化速度更快, 即调整会产生更大的变化, 这可能不是我们想要的.

为了得到一个更加类似的曲线, 我们可以取通过的更多点, 或者也可以预设通过的点的导数 (对应贝塞尔曲线控制点的方向) 或者二阶导数 (和贝塞尔曲线控制点到引出点的线段长度有关联, 这个长度和曲率半径正相关, 或者说和一阶导数和二阶导数都相关) 来计算一个更加高次的曲线.

预设数目不超过 5 个时 (包括通过点和导数), 我们也可以使用一般二次方程 $ax^2 + by^2 + cxy + dx + ey + f = 0$, 不过由于它难以表述为 $y = f(x)$ 的形式, 我们通常可以去除一些部分来使用更加简单的表达式.

例如可以通过预设通过的 4 个点, 或者首尾其中一个导数得到另外, 加上通过的三个点一共 4 个值. 然后去除上面的函数表达式的 $by^2$, 这样得到一个方程可以表述为 $y = (ax^2 + dx + f) / (cx + e)$ 的形式, 更加利于计算.

也可以只预设通过的三个点, 然后再去掉上面的函数表达式的 $ax^2$, 这样得到一个方程可以表述为 $y = (dx + f) / (cx + e)$ 的形式, 这个看起来很眼熟, 因为它就是上面的对比度调整因数的形式.


### 齐次方程

为什么通过三个点可以计算出一个 4 个参数的方程, 你可以尝试将方程展开, 你会发现左边的参数是 $a, b, c, d$, 右边的常数则固定为 0. 事实上我们简单的将 4 个系数看作为 $a/d, b/d, c/d, 1$ (但实际计算时不会这么做, 因为 $d$ 可能等于 0), 这样它就变成了 3 个参数了.

这种方程在线性代数中被称为齐次方程, 其解法也在线性代数中有完整的交代.