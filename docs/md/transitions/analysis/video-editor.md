# Video Editor 转场的逆向分析


#### 扭曲

 - ~~`Distortion 1/2:` 根据当前像素的 RGB 值以及 progress 决定一个偏移值, 然后从新的位置获得像素.~~



#### 模糊

 - `Glow:` 首先根据 progress 选择一个滑动的模糊中点, 然后对每一个像素点向外选择一个随 progress 变大再变小的半径进行运动模糊, 同时改变前后照片像素分量大小, 在已有的 `Zoom-Blur` 的基础上稍微扩展一个可以移位的中点就可以实现.
 - `Radiation blur:` 取得根据按照一定规律分布 (均匀, 或者以花瓣一样伪随机分布) 的多个向量, 然后根据随 progress 变大再变小的半径进行采样再均匀混合, 同时改变前后照片像素分量大小.
 - ~~`Blur 系列`: 运动模糊, 首先做一个运动函数, 它会让照片的运动先快后慢, 不过结束时一定刚好运动整数个周期. 然后每一个像素根据当前的位置和速度进行采样, 采样的范围是纹理经过运动偏移之后的像素, 以及该像素运动方向上的前后的像素, 采样半径由运动速度决定, 然后进行1维高斯模糊加权 (此步可以简化为只采样数个像素点, 例如 10 个, 20 个, 然后按二次曲线加权). 在 progress 的某个位置切换新旧图, 可以选择做平滑与否.~~



#### 溶解

 - ~~`PaintedLines, Spikes, Ripple, Clouds, Drew, Fingers, Pieces, Polar, Sinenegsphere, Spikessphereinv, Spiral, Timewrap, Heart, Sift:` 准备一张黑白的蒙版纹理, 然后对于指定的像素位置采样这个纹理, 越接近黑色, 旧图的像素会更快地转变为新图, 为此我们需要确定一个随该像素渐变的终结时间. **由于这些效果依赖的纹理图非常容易被识别, 所以请不要直接使用友商的纹理, 直接找设计师要, 他们有很多**.~~
 - ~~`Flash`: 因为效果比较差, 建议更换一个算法, 从 `Fade-White` 的基础上改进, 但是让两个颜色在中间交叠, 并且适当更改函数曲线使得其过渡更加平滑.~~
 - ~~`Dissolve`: 按 progress 混合原图和新图.~~
 - ~~`Fade`: 按 progress 混合原图和新图, 以及一个其他颜色.~~

我在此基础上据此拓展出的溶解算法:
 
 - ~~使用噪声生成随机的纹理蒙版, 可以调节颗粒和纹理效果.~~
 - ~~根据原图的灰度值决定溶解的速度, 例如比较黑的地方消失的慢.~~
 - ~~通过多个顶点组成的一个填充的图形来进行溶解, 图形的边缘按照法线方向 (或者和中点的连线反方向) 逐渐变白. 并且在溶解的同时扩散它. 和上面的 Heart 类似, 但是能够提供好的多的效果. 具体实现过程为首先使用 360° 或者 720° 极坐标采样半径, 作为数据传入着色器, 然后在着色器中使用临近的角度, 读取半径后混合再根据 progress 决定透明度.~~



#### 几何变换: 

 - ~~`Radar:` 原 Sweep, 将坐标转为极坐标, 然后对角度进行滤波, 根据获得分量采样新旧纹理, 再混合.~~
 - ~~`Rays:` 将坐标转为极坐标, 将角度乘以 ray 数目后向前取整得到对应的起始点, 然后加上单个 ray 对应角度 * progress 得到结束点. 记得在起始点和结束点分别进行插值.~~
 - ~~`Alternate 系列`: 原 Dias 系列, 使用顶点建模实现.~~
 - ~~`Wipe, Slant-Wipe`: 使用向量建模实现.~~
 - ~~`Split 系列`: 使用顶点建模实现.~~
 - ~~`Push 系列`: 使用顶点建模实现.~~
 - ~~`Shuffle 系列`: 使用顶点建模实现.~~
 - ~~`Enlarge 系列`: 原 Central-In, 使用顶点建模实现.~~



#### 像素化

 - ~~`Pixelate:` 开启 mipmap, 将像素坐标进行离散 step 处理, 然后采样时使用 textureGrad (Version 3.00+). 原始算法是一个更加简单的算法, 直接进行采样位置的梯度映射 (例如乘以 10 向下取整, 就会形成 10 个梯度), 根据 progress 先增大梯度间隔再减小. 两个图的切换可以选择中间一个比较小的范围进行权重的平滑处理.~~



#### 条纹或者小块

 - ~~`Stripe-Merge`: 原 Scratch-Merge, 根据建立新旧交替的循环带的模型来实现.~~



#### 3D: 

 - ~~`Page-Crul:` 通过向量建模以及分层实现.~~
 - `Turn`: 建议通过 3D 顶点建模然后应用模型的运动变换来进行.



#### 物理效果

 - ~~`Wave:` 通过弦波函数以及光线的折射模型实现, 和原始效果有极大的不同, 原始的效果是一个正弦的扭曲, 并且函数的两个坡面分别显示新图和旧图.~~



#### 由于效果较差不予考虑的转场

 - `Scratch-Dust` - 太多噪点.
 - `Rapples-Center` - 不符合真实物理效果, 建议使用 `Wave`.
 - `Deposit Up` - 看起来比较杂乱.