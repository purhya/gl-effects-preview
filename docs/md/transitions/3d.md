# 3D

实现 3D 转场的最佳方式毫无疑问是通过顶点建模然后编写针对的顶点着色器.

不过为了方便移植, 我们的转场代码均基于纯片元着色器实现, 这会大大限制我们实现 3D 转场, 但是也有一些针对性的方法.


### 纯片元实现 3D 场景的建模

为了纯片元实现 3D 场景的建模, 我们先通过标准的顶点建模方式确定空间模型, 以及变换矩阵, 可以得到每个顶点的原始坐标位置以及纹理采样位置, 以及变换之后的位置.

我们在片元着色器中拿到了当前的片元坐标, 它和上面经过了变换处理的顶点坐标是一致的, 但是由于经过了投影变换并且深度信息不一致, 所以坐标之间的不是线性关系, 当顶点距离投影屏幕越远, 1px 在投影屏幕上面的变化会产生越大的原始坐标的变化.

实际上我们可以通过平面几何建模, 算出片元坐标相比于两个顶点坐标在他们构成的向量的投影方向上对应的比率, 如下 V1A 和 AB 的比率:

![](md/images/2019-12-04_12-20-02.jpg)

然后通过两次这样的计算可以最终确定片元坐标在原始的顶点坐标系下的坐标和采样位置. 但是这种方式复杂并且不利于维护.

当然也有一种非常简单的处理方式, 直接将以上的非线性关系处理为线性的, 例如 <https://gl-transitions.com/editor/cube> 这个转场. 不过你仔细观察时会发现它是假的.


### 其他

另外, 为了获得高质量的转场效果, 需要进行纹理边缘采样的平滑滤波以及开启各向异性过滤.