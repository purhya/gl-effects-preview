# 脸部变换 (Face Transform)

<face-transform-preview></face-transform-preview>


### 算法简介

将人脸进行标注后, 将三个点对应, 计算出一个变换矩阵, 然后将其拆解为平移, 旋转, 缩放, 斜切矩阵 (越靠前其动画效果越容易被留意到), 然后对每个子变换的参数应用线性变换来实现场景变换.

在场景变换的基础上计算出脸部每个顶点的细微偏移, 然后变换时也同时对这些偏移做渐变.

看起来有 3d 效果是因为分离出了场景变换矩阵并且对其做单独的过渡.

有额外的一些处理, 例如修复侧脸转正脸时的网格扭曲, 修复顶点进入其他三角形时产生的面片覆盖.


### 建议的缓动方式

linear 或者 ease in out.


### 眼睛或嘴唇的未对齐

这是因为目前使用的人脸识别 API 精确度不高, 在眼睛和嘴唇处会产生误差.


### 性能

目前在我底配电脑上 (MacBook 2014 款 , 2.2G x 2, 8GB 内存显存共享), 能够在 1920x1080 下 40 帧运行, 尺寸稍小时稳定 60 帧.

`Face-Transform-Faster` 相比 `Face-Transform` 简化了绘制流程, 可以在  1920x1080 下稳定 60 帧, 不过它可能产生一些细节处的多边形瑕疵 (这些瑕疵在人脸较小时比较难留意到). 可以通过开启背面剔除来缓解 (但是不能根除) 这个瑕疵.


### 产品化时一些需要注意的情况

首先, 在排列照片时应当尽量让前后两张照片正脸侧脸变化不是太大, 尤其是应当避免两个不同方向的侧脸.

其次, 尽量让脸部较小的图片排在前面, 这样可以减小变换时周围场景的空白.